import{c as E,Q as k,n as m,K as A,_ as S,R as Er,O as $r,k as M,p as v,S as le,E as xt,C as Nr,T as Ir,U as Lr,V as Wr}from"./src-2eX6lIN8-VI_Nykma.js";import{b as Mr}from"./records-Cei7yF1D-C5ys4Q3F.js";import{S as zr,b0 as ge,a$ as ye,bg as yt,b1 as Br,bh as Fr,bi as Hr,bj as Dr,bk as be,bl as we,bm as _r,bn as Vr,bo as pe,bp as jr,bq as ce,br as xe,bs as me,bt as Gr,bu as Ur,bv as he,bw as Yr,bx as Kr,by as Xr,e as qr,bz as Jr,bA as fe,bB as Zr,bC as Or,b5 as Qr,a3 as ke,bD as ti,bE as ei,bF as ri}from"./src-CURfSkGx-Bgs9tt00.js";import{r as q,E as Bt,a as ii}from"./src-CtUbQWIP-Vt_fnXRn.js";import{d as mt,e as Vt,h as si,g as ni,i as ai,r as oi,j as li,k as ci,l as Rt,o as hi,n as fi}from"./src-3nHXiifJ-B3Cja0hK.js";var ui={};S(ui,{arc:()=>Te,bezier:()=>Re,circle:()=>kt,connectedPoints:()=>At,copyToImg:()=>pi,dot:()=>T,drawingStack:()=>X,ellipse:()=>bi,getContext:()=>Ce,line:()=>Gt,lineThroughPoints:()=>yi,makeHelper:()=>ve,paths:()=>Pe,pointLabels:()=>Et,rect:()=>St,textBlock:()=>Ee,textBlockAligned:()=>Ci,textHeight:()=>Si,textRect:()=>Ut,textWidth:()=>ki,translatePoint:()=>wi,triangle:()=>mi});const Se=Math.PI*2,Ce=t=>{if(t===null)throw new Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(t===void 0)throw new Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");const e=t instanceof CanvasRenderingContext2D?t:t instanceof HTMLCanvasElement?t.getContext("2d"):typeof t=="string"?q(t).getContext("2d"):t;if(e===null)throw new Error("Could not create 2d context for canvas");return e},ve=(t,e)=>{const r=Ce(t);return{ctx:r,paths(i,s){Pe(r,i,s)},line(i,s){Gt(r,i,s)},rect(i,s){St(r,i,s)},bezier(i,s){Re(r,i,s)},connectedPoints(i,s){At(r,i,s)},pointLabels(i,s){Et(r,i,s)},dot(i,s){T(r,i,s)},circle(i,s){kt(r,i,s)},arc(i,s){Te(r,i,s)},textBlock(i,s){s.bounds===void 0&&e!==void 0&&(s={...s,bounds:{...e,x:0,y:0}}),Ee(r,i,s)}}},jt=t=>di(t.strokeStyle,t.fillStyle),w=(t,e={},...r)=>{if(t===void 0)throw new Error("ctx undefined");const i=X(t).push(jt(e),...r);return i.apply(),i},Te=(t,e,r={})=>{w(t,r);const i=n=>{t.beginPath(),t.arc(n.x,n.y,n.radius,n.startRadian,n.endRadian),t.stroke()},s=Array.isArray(e)?e:[e];for(const n of s)i(n)},di=(t,e)=>i=>{e&&(i.fillStyle=e),t&&(i.strokeStyle=t)},gi=(t,e,r)=>s=>{t&&(s.lineWidth=t),e&&(s.lineJoin=e),r&&(s.lineCap=r)},X=(t,e)=>(e??=new ce,{push:(...n)=>{e??=new ce;const a=e.push(...n);for(const o of n)o(t);return X(t,a)},pop:()=>{const n=e?.pop();return X(t,n)},apply:()=>{if(e===void 0)return X(t);for(const n of e.data)n(t);return X(t,e)}}),yi=(t,e,r)=>{w(t,r),t.moveTo(e[0].x,e[0].y);for(const[i,s]of e.entries()){if(i+2>=e.length)continue;const n=e[i+1],a={x:(s.x+n.x)/2,y:(s.y+n.y)/2},o=(a.x+s.x)/2,l=(a.x+n.x)/2;t.quadraticCurveTo(o,n.y,a.x,a.y),t.quadraticCurveTo(l,n.y,n.x,n.y)}},kt=(t,e,r={})=>{w(t,r);const i=s=>{t.beginPath(),t.arc(s.x,s.y,s.radius,0,Se),r.strokeStyle&&t.stroke(),r.fillStyle&&t.fill()};if(Array.isArray(e))for(const s of e)i(s);else i(e)},bi=(t,e,r={})=>{w(t,r);const i=n=>{t.beginPath();const a=n.rotation??0,o=n.startAngle??0,l=n.endAngle??Se;t.ellipse(n.x,n.y,n.radiusX,n.radiusY,a,o,l),r.strokeStyle&&t.stroke(),r.fillStyle&&t.fill()},s=Array.isArray(e)?e:[e];for(const n of s)i(n)},Pe=(t,e,r={})=>{w(t,r);const i=s=>{if(we(s))Ae(t,s,r);else if(jr(s))Gt(t,s,r);else throw new Error(`Unknown path type ${JSON.stringify(s)}`)};if(Array.isArray(e))for(const s of e)i(s);else i(e)},At=(t,e,r={})=>{const i=r.loop??!1;if(E(Er(e,"pts")),e.length!==0){for(const[s,n]of e.entries())be(n,`Index ${s}`);w(t,r),r.lineWidth&&(t.lineWidth=r.lineWidth),t.beginPath(),t.moveTo(e[0].x,e[0].y);for(const s of e)t.lineTo(s.x,s.y);i&&t.lineTo(e[0].x,e[0].y),(r.strokeStyle||r.strokeStyle===void 0&&r.fillStyle===void 0)&&t.stroke(),r.fillStyle&&t.fill()}},Et=(t,e,r={},i)=>{if(e.length!==0){for(const[s,n]of e.entries())be(n,`Index ${s}`);w(t,r);for(const[s,n]of e.entries()){const a=i!==void 0&&s<i.length?i[s]:s.toString();t.fillText(a.toString(),n.x,n.y)}}},wi=(t,e)=>{const r=t.getTransform();return{x:e.x*r.a+e.y*r.c+r.e,y:e.x*r.b+e.y*r.d+r.f}},pi=t=>{const e=document.createElement("img");return e.src=t.toDataURL("image/jpeg"),e},T=(t,e,r)=>{r??={};const i=r.radius??10,s=Array.isArray(e)?e:[e],n=r.stroke?r.stroke:r.strokeStyle!==void 0;let a=r.filled?r.filled:r.fillStyle!==void 0;!n&&!a&&(a=!0),w(t,r);for(const o of s)t.beginPath(),"radius"in o?t.arc(o.x,o.y,o.radius,0,2*Math.PI):t.arc(o.x,o.y,i,0,2*Math.PI),a&&t.fill(),n&&t.stroke()},Re=(t,e,r)=>{we(e)?Ae(t,e,r):_r(e)&&xi(t,e,r)},xi=(t,e,r={})=>{let i=w(t,r);const{a:s,b:n,cubic1:a,cubic2:o}=e,l=r.debug??!1;t.beginPath(),t.moveTo(s.x,s.y),t.bezierCurveTo(a.x,a.y,o.x,o.y,n.x,n.y),t.stroke(),l&&(i=i.push(jt({...r,strokeStyle:mt(r.strokeStyle??"silver",.6),fillStyle:mt(r.fillStyle??"yellow",.4)})),i.apply(),t.moveTo(s.x,s.y),t.lineTo(a.x,a.y),t.stroke(),t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.stroke(),t.fillText("a",s.x+5,s.y),t.fillText("b",n.x+5,n.y),t.fillText("c1",a.x+5,a.y),t.fillText("c2",o.x+5,o.y),T(t,a,{radius:3}),T(t,o,{radius:3}),T(t,s,{radius:3}),T(t,n,{radius:3}),i=i.pop(),i.apply())},Ae=(t,e,r={})=>{const{a:i,b:s,quadratic:n}=e,a=r.debug??!1;let o=w(t,r);t.beginPath(),t.moveTo(i.x,i.y),t.quadraticCurveTo(n.x,n.y,s.x,s.y),t.stroke(),a&&(o=o.push(jt({...r,strokeStyle:mt(r.strokeStyle??"silver",.6),fillStyle:mt(r.fillStyle??"yellow",.4)})),At(t,[i,n,s]),t.fillText("a",i.x+5,i.y),t.fillText("b",s.x+5,s.y),t.fillText("h",n.x+5,n.y),T(t,n,{radius:3}),T(t,i,{radius:3}),T(t,s,{radius:3}),o=o.pop(),o.apply())},Gt=(t,e,r={})=>{const i=r.debug??!1,s=gi(r.lineWidth,r.lineJoin,r.lineCap);w(t,r,s);const n=a=>{const{a:o,b:l}=a;t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(l.x,l.y),i&&(t.fillText("a",o.x,o.y),t.fillText("b",l.x,l.y),T(t,o,{radius:5,strokeStyle:"black"}),T(t,l,{radius:5,strokeStyle:"black"})),t.stroke()};if(Array.isArray(e))for(const a of e)n(a);else n(e)},mi=(t,e,r={})=>{w(t,r);const i=s=>{At(t,fe(s),{...r,loop:!0}),r.debug&&Et(t,fe(s),void 0,["a","b","c"])};if(Array.isArray(e))for(const s of e)i(s);else i(e)},St=(t,e,r={})=>{w(t,r);const i=r.filled??r.fillStyle!==void 0,s=r.stroke??r.strokeStyle!==void 0,n=a=>{const o="x"in a?a.x:0,l="y"in a?a.y:0;i&&t.fillRect(o,l,a.width,a.height),s&&(r.strokeWidth&&(t.lineWidth=r.strokeWidth),t.strokeRect(o,l,a.width,a.height)),r.crossed&&(t.beginPath(),t.moveTo(o,l),t.lineTo(a.width,a.height),t.stroke(),t.moveTo(0,a.height),t.lineTo(a.width,0),t.stroke()),r.debug&&Et(t,Vr(a),void 0,["NW","NE","SE","SW"])};if(Array.isArray(e))for(const a of e)n(a);else n(e)},ki=(t,e,r=0,i)=>Ut(t,e,r,i).width,Ut=(t,e,r=0,i)=>{if(e==null||e.length===0)return ye;const s=t.measureText(e);return{width:i?$r(s.width,i)+r:s.width+r,height:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+r+r}},Si=(t,e,r=0)=>Ut(t,e,r).height,Ee=(t,e,r)=>{w(t,r);const i=r.anchorPadding??0,s=r.align??"top",n=r.anchor,a=r.bounds??{x:0,y:0,width:1e6,height:1e6},o=e.map(f=>t.measureText(f)),l=o.map(f=>f.width),c=o.map(f=>f.actualBoundingBoxAscent+f.actualBoundingBoxDescent+3),h=Math.max(...l),g=c.reduce((f,y)=>f+y,0);let{x:b,y:u}=n;n.x+h>a.width?b=a.width-(h+i):b-=i,b<a.x&&(b=a.x+i),n.y+g>a.height?u=a.height-(g+i):u-=i,u<a.y&&(u=a.y+i),s==="top"?t.textBaseline="top":t.textBaseline="middle";for(const[f,y]of e.entries())t.fillText(y,b,u),u+=c[f]},Ci=(t,e,r)=>{const{bounds:i}=r,{horiz:s="left",vert:n="top"}=r,a=typeof e=="string"?[e]:e;w(t,r),t.save(),t.translate(i.x,i.y),t.textAlign="left",t.textBaseline="top";const o=i.width/2,l=i.height/2,c=a.map(u=>t.measureText(u)),h=c.map(u=>u.actualBoundingBoxAscent+u.actualBoundingBoxDescent),g=h.reduce((u,f)=>u+f,0);let b=0;n==="center"?b=l-g/2:n==="bottom"&&(b=i.height-g);for(const[u,f]of a.entries()){let y=0;s==="center"?y=o-c[u].width/2:s==="right"&&(y=i.width-c[u].width),t.fillText(f,y,b),b+=h[u]}t.restore()},z=t=>!(typeof t!="object"||!("h"in t)||!("s"in t)||!("l"in t)||!("unit"in t)||!("space"in t)||t.space!=="hsl"),N=t=>typeof t!="object"||!("r"in t)||!("g"in t)||!("b"in t)||!("space"in t)||!("unit"in t)?!1:t.space==="srgb",Yt=t=>{if(typeof t!="object")throw new TypeError(`Param 'v' is expected to be an object, got: ${typeof t}`);if("r"in t&&"g"in t&&"b"in t){if(!("unit"in t))if(t.r<=1&&t.g<=1&&t.b<=1)t.unit="scalar";else{if(t.r>255&&t.g<=255&&t.b<=255)return;t.unit="8bit"}return"space"in t||(t.space="srgb"),t}},Kt=t=>{if("h"in t&&"s"in t&&"l"in t){if(!("unit"in t))if(t.r<=1&&t.g<=1&&t.b<=1)t.unit="scalar";else{if(t.s>100&&t.l<=100)return;t.unit="absolute"}return"space"in t||(t.space="hsl"),t}},J=t=>typeof t!="object"||!("l"in t)||!("c"in t)||!("h"in t)||!("unit"in t)||!("space"in t)?!1:t.space==="lch"||t.space==="oklch",$e=t=>typeof t=="string"?!0:typeof t!="object"?!1:!!(z(t)||J(t)||N(t));function Ne(t,e,r=1){let i=-1,s=-1;e<t?(i=e-t,s=r-(t-e)):(i=e-t,s=i-r);const n=s>0?s:i,a=s>0?i:s;if(Math.abs(i)<Math.abs(s)){const o=s;s=i,i=o}return{long:i,short:s,forward:n,backward:a}}const Xt=t=>{const e=i=>{const s=Math.floor(i).toString(16);return s.length==1?"0"+s:s};let r=`#${e(t.r)}${e(t.g)}${e(t.b)}`;return typeof t.alpha<"u"&&t.alpha!==255&&(r+=e(t.alpha)),r};function Ie(t){return t=t%1,t<0?(1-Math.abs(t))%1:t}var Le={};S(Le,{absolute:()=>it,changeLightness:()=>vi,fromCss:()=>ot,fromHexString:()=>Ft,generateScalar:()=>Ri,guard:()=>tt,interpolator:()=>qt,parseCssHslFunction:()=>Me,scalar:()=>D,toAbsolute:()=>Q,toCssString:()=>Ct,toHexString:()=>Ht,toLibraryRgb:()=>et,toScalar:()=>Z,withOpacity:()=>We});const We=(t,e)=>{switch(t.unit){case"absolute":return{...t,opacity:e((t.opacity??100)/100,t)*100};case"scalar":return{...t,opacity:e(t.opacity??1,t)}}},vi=(t,e)=>{let r=0;if(typeof e.pdelta<"u")r=t.l+t.l*e.pdelta;else if(typeof e.delta<"u")r=e.delta+t.l;else if(typeof e.fixed<"u"){if(e.fixed<0)throw new TypeError("Cannot use negative value with 'fixed'");r=e.fixed}else throw new TypeError("Parameter 'amount' is missing 'delta/pdelta/fixed' properties");return{...t,l:Ti(t,r)}},Ti=(t,e,r)=>(t.unit==="scalar"?e>1?e=1:e<0&&(e=0):e>100?e=100:e<0&&(e=0),e),Pi=Object.freeze({h:0,s:0,l:0,opacity:0,unit:"absolute",space:"hsl"});function Ft(t,e={}){return $t(ai(t),e)}function ot(t,e={}){if(t=t.toLowerCase(),t.startsWith("hsla("))throw new Error("hsla() not supported");if(t.startsWith("rgba("))throw new Error("rgba() not supported");if(t.startsWith("#"))return Ft(t,e);if(t.startsWith("--"))try{t=Qt(t)}catch(r){if(typeof e.fallbackString<"u"&&(t=e.fallbackString),typeof e.fallbackColour<"u")return e.fallbackColour;throw r}if(t==="transparent")return Pi;if(typeof P[t]<"u")return Ft(P[t],e);if(t.startsWith("rgb(")){const r=ht(t);return $t(r,e)}if(!t.startsWith("hsl("))try{t=Vt(t,"hsl")}catch(r){if(e.fallbackString)t=e.fallbackString;else throw r}try{const r=Me(t);return e.scalar?Z(r):Q(r)}catch(r){if(e.fallbackColour)return e.fallbackColour;throw r}}const Ct=t=>{const e=Q(t);let r=`hsl(${e.h}deg ${e.s}% ${e.l}%`;return"opacity"in e&&e.opacity!==void 0&&e.opacity<100&&(r+=` / ${e.opacity}%`),r+=")",r},Ht=t=>{const e=et(t);return Xt(e)};function $t(t,e={}){if((typeof t>"u"||t===null)&&e.fallbackColour)return e.fallbackColour;const r=e.scalar??!0;return E(k(t.h,0,360,"h"),k(t.s,0,100,"s"),k(t.l,0,100,"l"),A(t.alpha??1,"alpha")),r?D(t.h/360,t.s/100,t.l/100,t.alpha??1):it(t.h,t.s,t.l,(t.alpha??1)*100)}const Q=t=>{if(typeof t=="string")return ot(t,{scalar:!1});if(N(t))return Q($t(ht(t),{scalar:!1}));const e=t;return tt(e),e.unit==="absolute"?e:{h:e.h*360,s:e.s*100,l:e.l*100,opacity:(e.opacity??1)*100,unit:"absolute",space:"hsl"}},Ri=(t,e=1,r=.5,i=1)=>{typeof t=="string"&&t.startsWith("--")&&(t=getComputedStyle(document.body).getPropertyValue(t).trim());const s=xe(t);if(e>1)throw new TypeError("Param 'saturation' must be between 0..1");if(r>1)throw new TypeError("Param 'lightness' must be between 0..1");if(i>1)throw new TypeError("Param 'opacity' must be between 0..1");return{h:me(s,"deg").value/360,s:e,l:r,opacity:i,unit:"scalar",space:"hsl"}},Z=t=>{if(typeof t=="string")return ot(t,{scalar:!0});if(N(t))return Z($t(ht(t),{scalar:!0}));const e=t;return tt(e),e.unit==="scalar"?e:{h:e.h/360,s:e.s/100,l:e.l/100,opacity:(e.opacity??1)/100,unit:"scalar",space:"hsl"}},tt=t=>{const{h:e,s:r,l:i,opacity:s,space:n,unit:a}=t;if(n!=="hsl")throw new Error(`Space is expected to be 'hsl'. Got: ${n}`);if(a==="absolute")E(m(e,"finite","h"),k(r,0,100,"s"),k(i,0,100,"l"),()=>{if(typeof s=="number")return k(s,0,100,"opacity")});else if(a==="scalar")E(m(e,"percentage","h"),m(r,"percentage","s"),m(i,"percentage","l"),()=>{if(typeof s=="number")return m(s,"percentage","opacity")});else throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${a}`)},qt=(t,e,r="shorter")=>{t=Z(t),e=Z(e);const i=t.opacity??1,s=Ne(t.h,e.h,1),n=r==="longer"?s.long:s.short,a=e.s-t.s,o=e.l-t.l,l=(e.opacity??1)-i;return c=>{c=M(c);let h=v(c,0,Math.abs(n));n<0?h=t.h-h:h=t.h+h;const g=v(c,0,a),b=v(c,0,o),u=v(c,0,l);return D(Ie(h),g+t.s,b+t.l,u+i)}};function D(t=.5,e=1,r=.5,i=1){const s={unit:"scalar",space:"hsl",h:t,s:e,l:r,opacity:i};return tt(s),s}function it(t=200,e=100,r=50,i=100){const s={unit:"absolute",space:"hsl",h:t,s:e,l:r,opacity:i};return tt(s),s}function Me(t){if(t.startsWith("hsla"))throw new Error("hsla() is not supported");if(!t.startsWith("hsl("))throw new Error("Expected hsl(..) CSS colour");const e=t.indexOf("("),r=t.indexOf(")");if(r<e)throw new Error("Is hsl() not terminated? Missing ')'");let s=t.substring(e+1,r).split(/[\s,]+/);if(s.length<3)throw new Error(`Expected three tokens. Got: ${s.length} length`);let n=!1;s[0].endsWith("%")&&(n=!0),s[1].endsWith("%")&&s[2].endsWith("%")&&(n=!0);const a=(l,c)=>{if(l==="none")return 0;if(l.endsWith("%"))return Number.parseFloat(l.substring(0,l.length-1))/100;l.endsWith("deg")&&c===0&&(l=l.substring(0,l.length-3));const h=Number.parseFloat(l);return c===0?h/360:c===3?h:h/100},o=(l,c)=>{if(l==="none")return 0;if(l.endsWith("%")){const g=Number.parseFloat(l.substring(0,l.length-1));return c===0?g*360:g}return l.endsWith("deg")&&c===0?Number.parseFloat(l.substring(0,l.length-3)):Number.parseFloat(l)};return s.length>3&&s[3]==="/"&&(s=[s[0],s[1],s[2],s[4]]),n?D(a(s[0],0),a(s[1],1),a(s[2],2),a(s[3]??"100%",3)):it(o(s[0],0),o(s[1],1),o(s[2],2),o(s[3]??"100%",3))}function et(t){if(typeof t=="string"){const r=ot(t,{scalar:!1});return et(r)}return t=Q(t),{...si({h:t.h,s:t.s,l:t.l}),alpha:(t.opacity??100)/100*255}}var ze={};S(ze,{OKLCH_CHROMA_MAX:()=>rt,absolute:()=>De,fromCss:()=>Nt,fromHexString:()=>Dt,fromLibrary:()=>vt,generateScalar:()=>$i,guard:()=>_,interpolator:()=>Jt,scalar:()=>Zt,toAbsolute:()=>It,toCssString:()=>Be,toHexString:()=>Fe,toScalar:()=>st,withOpacity:()=>He});const rt=.4,_=t=>{const{l:e,c:r,h:i,opacity:s,space:n,unit:a}=t;if(n!=="oklch")throw new Error(`Space is expected to be 'oklch'. Got: ${n}`);if(a==="absolute")E(A(e,"l"),()=>{if(typeof r=="number")return k(r,0,rt,"c")},()=>{if(typeof i=="number")return k(r,0,360,"h")},A(s??1,"opacity"));else if(a==="scalar")E(A(e,"l"),A(r,"c"),A(i,"h"),A(t.opacity??1,"opacity"));else throw new Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${a}`)};function vt(t,e={}){if((typeof t>"u"||t===null)&&e.fallbackColour)return e.fallbackColour;const r=e.scalar??!0;return E(A(t.l,"l"),A(t.c,"c"),k(t.h,0,360,"h"),A(t.alpha??1,"alpha")),r?Zt(t.l,t.c/rt,t.h/360,t.alpha??1):De(t.l,t.c,t.h,t.alpha??1)}const Dt=(t,e={})=>vt(li(t),e),Ai=Object.freeze({l:0,c:0,h:0,opacity:0,unit:"absolute",space:"oklch"});function Nt(t,e={}){if(t=t.toLowerCase(),t.startsWith("#"))return Dt(t,e);if(t==="transparent")return Ai;if(typeof P[t]<"u")return Dt(P[t],e);if(t.startsWith("rgb(")){const s=B(ee(t)),n=ci({r:s.r,g:s.g,b:s.b});return vt(n,e)}if(!t.startsWith("hsl(")&&!t.startsWith("oklch("))try{t=Vt(t,"oklch")}catch(s){if(e.fallbackString)t=e.fallbackString;else throw s}const i=new Rt(t).oklch;return vt(i,e)}const It=t=>typeof t=="string"?It(Nt(t,{scalar:!0})):(_(t),t.unit==="absolute"?t:{space:"oklch",unit:"absolute",l:t.l,c:t.c*rt,h:t.h*360,opacity:t.opacity}),st=t=>{if(typeof t=="string")return st(Nt(t,{scalar:!0}));const e=t;return _(e),e.unit==="scalar"?e:{l:e.l,c:e.c/rt,h:e.h/360,opacity:e.opacity??1,unit:"scalar",space:"oklch"}},Ei=t=>{const e=It(t);return{l:e.l,c:e.c,h:e.h,alpha:e.opacity}},Be=(t,e=3)=>{_(t);const{l:r,c:i,h:s,opacity:n}=t;let a="";switch(t.unit){case"absolute":a=`oklch(${(r*100).toFixed(e)}% ${i.toFixed(e)} ${s.toFixed(e)}`;break;case"scalar":a=`oklch(${r.toFixed(e)} ${(i*rt).toFixed(e)} ${(s*360).toFixed(e)}`;break}return typeof n<"u"&&n!==1&&(a+=` / ${n.toFixed(e)}`),a+=")",a},Fe=t=>{const e=Ei(t),r=hi(e);return Xt(r)},$i=(t,e=1,r=.5,i=1)=>{if(typeof t=="string"&&t.startsWith("--")&&(t=getComputedStyle(document.body).getPropertyValue(t).trim()),r>1)throw new TypeError("Param 'lightness' must be between 0..1");if(e>1)throw new TypeError("Param 'chroma' must be between 0..1");const s=xe(t),n=me(s,"deg").value/360;if(i>1)throw new TypeError("Param 'opacity' must be between 0..1");return{l:r,c:e,h:n,opacity:i,unit:"scalar",space:"oklch"}},He=(t,e)=>{switch(t.unit){case"absolute":return{...t,opacity:e((t.opacity??100)/100,t)*100};case"scalar":return{...t,opacity:e(t.opacity??1,t)}}},Jt=(t,e,r="shorter")=>{t=st(t),e=st(e);const i=t.opacity??1,s=Ne(t.h,e.h,1),n=r==="longer"?s.long:s.short,a=e.c-t.c,o=e.l-t.l,l=(e.opacity??1)-i;return c=>{c=M(c);let h=v(c,0,Math.abs(n));n<0?h=t.h-h:h=t.h+h;const g=v(c,0,a),b=v(c,0,o),u=v(c,0,l);return Zt(b+t.l,g+t.c,Ie(h),u+i)}};function Zt(t=.7,e=.1,r=.5,i=1){const s={unit:"scalar",space:"oklch",l:t,c:e,h:r,opacity:i};return _(s),s}const De=(t,e,r,i=1)=>{const s={space:"oklch",unit:"absolute",opacity:i,l:t,c:e,h:r};return _(s),s},Ot=t=>{if(t.startsWith("#"))return nt(t,!0);if(typeof P[t]<"u")return nt(P[t],!0);if(t.startsWith("--")){const e=getComputedStyle(document.body).getPropertyValue(t).trim();if(e.length===0||e===null)throw new Error(`Variable missing: ${t}`);return Ot(e)}if(t=t.toLowerCase(),t.startsWith("hsl("))return ot(t,{scalar:!0});if(t.startsWith("rgb("))return lt(t,{scalar:!0});if(t.startsWith("oklch("))return Nt(t,{scalar:!0});throw new Error(`String colour is not a hex colour, CSS variable nor well-defined colour. Input: '${t}'`)},Qt=(t,e)=>{if(t.startsWith("--")){const r=getComputedStyle(document.body).getPropertyValue(t).trim();if(r.length===0||r===null){if(typeof e<"u")return e;throw new Error(`CSS variable missing: '${t}'`)}return Qt(r)}return typeof P[t]<"u"?P[t]:t},P={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"#00000000"};var _e={};S(_e,{changeLightness:()=>Li,eightBit:()=>je,fromCss:()=>lt,fromHexString:()=>nt,guard:()=>V,interpolator:()=>re,lightness:()=>Wi,parseCssRgbFunction:()=>ee,scalar:()=>te,to8bit:()=>B,toCssString:()=>at,toHexString:()=>wt,toLibraryHsl:()=>ht,toScalar:()=>O,withOpacity:()=>Ve});const Ve=(t,e)=>{switch(t.unit){case"8bit":return{...t,opacity:e((t.opacity??255)/255,t)*255};case"scalar":return{...t,opacity:e(t.opacity??1,t)}}};function nt(t,e=!0){return ct(ni(t),{scalar:e})}const Ni=Object.freeze({r:0,g:0,b:0,opacity:0,unit:"8bit",space:"srgb"});function lt(t,e={}){if(t=t.toLowerCase(),t.startsWith("hsla("))throw new Error("hsla() not supported");if(t.startsWith("rgba("))throw new Error("rgba() not supported");const r=e.scalar??!0;if(t.startsWith("#"))return nt(t,r);if(t==="transparent")return Ni;if(typeof P[t]<"u"&&nt(P[t],r),t.startsWith("hsl(")){const i=et(t);return ct(i,e)}if(!t.startsWith("rgb("))try{t=Vt(t,"rgb")}catch(i){if(e.fallbackString)t=e.fallbackString;else throw i}try{const i=ee(t);return r?O(i):B(i)}catch(i){if(e.fallbackColour)return e.fallbackColour;throw i}}const wt=t=>{const e=Ii(t);return Xt(e)},at=t=>{switch(V(t),t.unit){case"8bit":return t.opacity===void 0||t.opacity===255?`rgb(${t.r} ${t.g} ${t.b})`:`rgb(${t.r} ${t.g} ${t.b} / ${(t.opacity??255)/255})`;case"scalar":return t.opacity===void 0||t.opacity===1?`rgb(${t.r*100}% ${t.g*100}% ${t.b*100}%)`:`rgb(${t.r*100}% ${t.g*100}% ${t.b*100}% / ${(t.opacity??1)*100}%)`;default:throw new Error(`Unknown unit: ${t.unit}`)}},Ii=t=>{const e=B(t);return{r:e.r,g:e.g,b:e.b,alpha:e.opacity}};function ct(t,e={}){return e.scalar?{r:t.r/255,g:t.g/255,b:t.b/255,opacity:t.alpha??1,unit:"scalar",space:"srgb"}:{r:t.r,g:t.g,b:t.b,opacity:t.alpha??255,unit:"8bit",space:"srgb"}}const B=t=>typeof t=="string"?lt(t,{scalar:!1}):z(t)?B(ct(et(t),{scalar:!1})):(V(t),t.unit==="8bit"?t:{r:t.r*255,g:t.g*255,b:t.b*255,opacity:(t.opacity??1)*255,unit:"8bit",space:"srgb"}),O=t=>typeof t=="string"?lt(t,{scalar:!0}):z(t)?O(ct(et(t),{scalar:!0})):(V(t),t.unit==="scalar"?t:{r:t.r/255,g:t.g/255,b:t.b/255,opacity:(t.opacity??1)/255,unit:"scalar",space:"srgb"}),V=t=>{const{r:e,g:r,b:i,opacity:s,space:n,unit:a}=t;if(n!=="srgb")throw new Error(`Space is expected to be 'srgb'. Got: ${n}`);if(a==="8bit")E(k(e,0,255,"r"),k(r,0,255,"g"),k(i,0,255,"b"),()=>{if(typeof s=="number")return k(s,0,255,"opacity")});else if(a==="scalar")E(m(e,"percentage","r"),m(r,"percentage","g"),m(i,"percentage","b"),()=>{if(typeof s=="number")return m(s,"percentage","opacity")});else throw new Error(`Unit is expected to be '8bit' or 'scalar'. Got: ${a}`)},Li=(t,e)=>{let r=0;const i=new Rt(at(t)),s=t.unit==="scalar";if(typeof e.pdelta<"u")r=i.oklab.l+i.oklab.l*e.pdelta;else if(typeof e.delta<"u")r=i.oklab.l+e.delta;else if(typeof e.fixed<"u"){if(e.fixed<0)throw new TypeError("Amount cannot be negative when using 'fixed'");r=e.fixed}else throw new TypeError("Parameter 'amount' is missing 'pdelta/delta/fixed' properties");r<0?r=0:r>1&&(r=1);const n=fi({a:i.oklab.a,b:i.oklab.b,l:r,alpha:i.oklab.alpha});return ct(n,{scalar:s})};function Wi(t){return new Rt(at(t)).oklab.l}function je(t=100,e=100,r=100,i=255){const s={unit:"8bit",space:"srgb",r:t,g:e,b:r,opacity:i};return V(s),s}function te(t=.5,e=.5,r=.5,i=1){const s={unit:"scalar",space:"srgb",r:t,g:e,b:r,opacity:i};return V(s),s}function ee(t){if(t.startsWith("rgba"))throw new Error("RGBA is not supported");if(!t.startsWith("rgb("))throw new Error("Expected rgb(..) CSS colour");const e=t.indexOf("("),r=t.indexOf(")");if(r<e)throw new Error("Is rgb() not terminated? Missing ')'");let s=t.substring(e+1,r).split(/[\s,]+/);if(s.length<3)throw new Error(`Expected three tokens. Got: ${s.length} length`);let n=0;for(const l of s)l.endsWith("%")&&n++;const a=(l,c)=>l.endsWith("%")?Number.parseFloat(l.substring(0,l.length-1))/100:c<3?Number.parseFloat(l)/255:Number.parseFloat(l),o=(l,c)=>l.endsWith("%")?Number.parseFloat(l.substring(0,l.length-1))/100*255:c<3?Number.parseFloat(l):Number.parseFloat(l)*255;return s.length>3&&s[3]==="/"&&(s=[s[0],s[1],s[2],s[4]]),n>1?te(a(s[0],0),a(s[1],1),a(s[2],2),a(s[3]??"1",3)):je(o(s[0],0),o(s[1],1),o(s[2],2),o(s[3]??"1",3))}const re=(t,e)=>{const r=O(t),i=O(e),s=r.opacity??1,n=(i.opacity??1)-s,a=i.r-r.r,o=i.g-r.g,l=i.b-r.b;return c=>(c=M(c),te(r.r+v(c,0,a),r.g+v(c,0,o),r.b+v(c,0,l),s+v(c,0,n)))};function ht(t){if(typeof t=="string"){const r=lt(t,{scalar:!1});return ht(r)}return t=B(t),{...oi({r:t.r,g:t.g,b:t.b}),alpha:(t.opacity??255)/255}}var Mi={};S(Mi,{accessor:()=>ft,byColumn:()=>Bi,byRow:()=>zi,grid:()=>j,setter:()=>ie,wrap:()=>Ge});const j=t=>({rows:t.width,cols:t.height}),Ge=t=>({...j(t),get:ft(t),set:ie(t)}),ft=t=>{const e=j(t),r=t.data;return(s,n="undefined")=>{const a=pe(e,s,n);if(a===void 0)return;const o=a*4;return{r:r[o],g:r[o+1],b:r[o+2],opacity:r[o+3],unit:"8bit",space:"srgb"}}},ie=t=>{const e=j(t),r=t.data;return(s,n,a="undefined")=>{const o=pe(e,n,a);if(o===void 0)throw new Error(`Cell out of range. ${n.x},${n.y}`);const l=B(s),c=o*4;r[c]=l.r,r[c+1]=l.g,r[c+2]=l.b,r[c+3]=l.opacity??255}};function*zi(t){const e=ft(t),r=j(t),i=Gr(r,{x:0,y:0});for(const s of i)yield s.map(a=>e(a,"undefined"))}function*Bi(t){const e=ft(t),r=j(t);for(let i=0;i<r.cols;i++){const s=[];for(let n=0;n<r.rows;n++){const a=e({x:i,y:n},"undefined");a&&s.push(a)}yield s}}var As=class extends zr{el;opts;#e;#t;#i=ge;#r=ye;#s;#n;#a;#c=!1;constructor(t,e={}){if(super(),!t)throw new Error("Param 'domQueryOrEl' is null or undefined. Expected canvas element.");if(this.el=q(t),this.el.nodeName!=="CANVAS")throw new Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);const r=this.el.getBoundingClientRect();this.opts={resizeLogic:e.resizeLogic??"none",disablePointerEvents:e.disablePointerEvents??!1,pixelZoom:e.pixelZoom??(window.devicePixelRatio||1),height:e.height??r.height,width:e.width??r.width,zIndex:e.zIndex??-1,coordinateScale:e.coordinateScale??"both",onResizing:e.onResizing,onResized:e.onResized,clearOnResize:e.clearOnResize??!0,draw:e.draw,skipCss:e.skipCss??!1,colourSpace:"srgb"},this.#e=yt("both"),this.#t=yt("both",r),this.#f()}getRectangle(){return{x:0,y:0,...this.#r}}dispose(t){this.#c||(this.#c=!0,this.#a&&(this.#a.dispose(`CanvasHelper disposing ${t}`.trim()),this.#a=void 0))}#o(t=!1){if(this.#s===void 0||t){const e=this.ratio,r=this.el.getContext("2d");if(r===null)throw new Error("Could not create drawing context");this.#s=r,r.setTransform(1,0,0,1,0,0),r.scale(e,e)}return this.#s}getPhysicalSize(){return{width:this.width*this.ratio,height:this.height*this.ratio}}getDrawHelper(){this.#n||(this.#n=ve(this.#o(),{width:this.width,height:this.height}))}setLogicalSize(t){Br(t,"logicalSize");const e=Fr(s=>Math.floor(s),t),r=this.opts.pixelZoom;this.#e=yt(this.opts.coordinateScale,t),this.#t=yt("both",t);const i=Hr(t,r);this.el.width=i.width,this.el.height=i.height,this.el.style.width=e.width.toString()+"px",this.el.style.height=e.height.toString()+"px",this.#o(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#r=e,this.opts.onResizing&&this.opts.onResizing(this.ctx,this.size,this),this.fireEvent("resize",{ctx:this.ctx,size:this.#r,helper:this})}#f(){const t=this.opts.draw;if(t){const r=()=>{t(this.ctx,this.#r,this),requestAnimationFrame(r)};setTimeout(()=>{r()},100)}if(this.opts.disablePointerEvents||this.#h(),(this.opts.resizeLogic??"none")==="none")this.setLogicalSize({width:this.opts.width,height:this.opts.height});else{const r={onSizeChanging:i=>{Dr(this.#r,i)||this.setLogicalSize(i)},onSizeDone:(i,s)=>{this.#l(i)},containerEl:this.opts.containerEl,naturalSize:{width:this.opts.width,height:this.opts.height},stretch:this.opts.resizeLogic??"none"};this.#a=new Bt(this.el,r)}this.#o()}#l(t){this.opts.onResized&&this.opts.onResized(this.ctx,this.size,this),this.fireEvent("resized",{ctx:this.ctx,size:this.#r,helper:this})}#h(){const t=e=>{const{offsetX:r,offsetY:i}=e,s=r*this.ratio,n=i*this.ratio;e=Mr(e);const a={physicalX:s,physicalY:n,...e};switch(e.type){case"pointerup":{this.fireEvent("pointerup",a);break}case"pointermove":{this.fireEvent("pointermove",a);break}case"pointerdown":{this.fireEvent("pointerup",a);break}}};this.el.addEventListener("pointermove",t),this.el.addEventListener("pointerdown",t),this.el.addEventListener("pointerup",t)}clear(){this.#s&&this.#s.clearRect(0,0,this.width,this.height)}fill(t){this.#s&&(t&&(this.#s.fillStyle=t),this.#s.fillRect(0,0,this.width,this.height))}get ctx(){if(this.#s===void 0)throw new Error("Context not available");return this.#o()}get viewport(){return this.#i}get width(){return this.#r.width}get height(){return this.#r.height}get size(){return this.#r}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}drawBounds(t="green"){const e=this.#o();St(e,{x:0,y:0,width:this.width,height:this.height},{crossed:!0,strokeStyle:t,strokeWidth:1}),St(e,this.#i,{crossed:!0,strokeStyle:"silver",strokeWidth:3})}get toRelative(){return this.#e.rel}get toAbsoluteFixed(){return this.#t.abs}get toRelativeFixed(){return this.#t.rel}get logicalCenter(){return{x:this.#r.width/2,y:this.#r.height/2}}get toAbsolute(){return this.#e.abs}get center(){return{x:this.width/2,y:this.height/2}}getImageData(){const t=this.getPhysicalSize(),e=this.ctx.getImageData(0,0,t.width,t.height,{colorSpace:this.opts.colourSpace});if(e==null)throw new Error("Could not get image data from context");return e}getWritableBuffer(){const t=this.ctx,e=this.getImageData(),r=j(e),i=ft(e),s=ie(e);return{grid:r,get:i,set:s,flip:()=>{t.putImageData(e,0,0)}}}};const Fi=Math.PI*2;var Hi=class{#e;#t;#i;#r;#s;#n;#a=[];constructor(t,e="min"){this.#e=q(t),this.#i=e,this.#n=window.devicePixelRatio||1,this.#r=this.#c(),this.#s=this.setLogicalSize({width:this.#e.width,height:this.#e.height})}setLogicalSize(t){this.#s=t;const e=this.#e;return e.width=t.width*this.#n,e.height=t.height*this.#n,e.style.width=`${t.width.toString()}px`,e.style.height=`${t.height.toString()}px`,this.#r=this.#c(),this.invalidateContext(),t}#c(){let t=1;switch(this.#i){case"min":t=Math.min(this.#e.width,this.#e.height);break;case"max":t=Math.max(this.#e.width,this.#e.height);break}const e=Lr(0,t,0,1);return{abs:e.in,rel:e.out}}invalidateContext(){this.#t=void 0}#o(t){if(!t)throw new Error("Param 'region' is undefined/null");if(this.#a.includes(t))throw new Error("Region already exists");return this.#a.push(t),t}toAbsPoint(t,e="independent"){let{x:r,y:i}=t;switch(e){case"independent":r*=this.width,i*=this.height}return{x:r,y:i}}get offset(){const t=this.#e.getBoundingClientRect();return{x:t.left,y:t.top}}toRelPoint(t,e,r="independent",i=!0){let{x:s,y:n}=t;if(e==="screen"){const a=this.#e.getBoundingClientRect();s-=a.x,n-=a.y}switch(r){case"independent":s/=this.width,n/=this.height;break}return i&&(s=M(s),n=M(n)),{x:s,y:n}}toAbsRect(t,e="independent"){let{width:r,height:i}=t;switch(e){case"independent":if(r*=this.width,i*=this.height,ti(t))return{...this.toAbsPoint(t),width:r,height:i}}return{width:r,height:i}}createRegion(t){const e=t.marginPx??0,r=e*2;if("absPositioned"in t){const i=ei(t.absPositioned,e,e);return this.#o(new bt(this,()=>i))}if("relativePositioned"in t){let i;const s=t.relativePositioned;switch(t.scale){case"independent":i=n=>({x:s.x*n.width+e,y:s.y*n.height+e,width:s.width*n.width-r,height:s.height*n.height-r});break;default:throw new Error(`Param 'kind' unknown (${t.scale})`)}return this.#o(new bt(this,i))}if("relativeSize"in t){let i;const s=t.relativeSize,n=t.position;switch(t.scale){case"independent":i=a=>{const o=s.width*a.width-r,l=s.height*a.height-r;let c=a.width/2-o/2,h=a.height/2-l/2;switch(n){case"n":h=0;break;case"s":h=a.height-l;break}return c+=e,h+=e,{width:o,height:l,x:c,y:h}};break;default:throw new Error(`Param 'kind' unknown (${t.scale})`)}return this.#o(new bt(this,i))}if("match"in t){const i=ii(t.match);if(!i.success)throw new Error(`Could not resolve match element. ${Wr(i)}`);const s=n=>{const a=i.value.getBoundingClientRect();return{x:a.x+e,y:a.y+e,width:a.width-r,height:a.height-r}};return this.#o(new bt(this,s))}throw new Error("Spec doesn't seem valid")}clear(){this.context.clearRect(0,0,this.width,this.height)}get context(){if(this.#t)return this.#t;const t=this.#e.getContext("2d");if(!t)throw new Error("Could not create 2d context");t.setTransform(1,0,0,1,0,0),t.scale(this.#n,this.#n),this.#t=t;for(const e of this.#a)e.recomputeRegion();return this.#t}get sizeScaler(){return this.#r}get width(){return this.#s.width}get height(){return this.#s.height}},bt=class{source;#e;#t;constructor(t,e){this.source=t,this.#e=e,this.#t=e(t)}recomputeRegion(){this.#t=this.#e(this.source)}toAbsRegion(t,e="both"){switch(e){case"both":return{x:t.x*this.#t.width,y:t.y*this.#t.height}}}applyRegionOffset(t){return{x:t.x+this.#t.x,y:t.y+this.#t.y}}drawConnectedPointsRelative(t,e,r=1){const i=t.map(s=>this.toAbsRegion(s));this.drawConnectedPoints(i,e,r)}drawConnectedPoints(t,e,r=1){const i=this.context;i.save(),i.translate(this.#t.x,this.#t.y),i.beginPath(),i.strokeStyle=e,i.lineWidth=r;for(let s=0;s<t.length;s++)s===0?i.moveTo(t[s].x,t[s].y):i.lineTo(t[s].x,t[s].y);i.stroke(),i.restore()}fillTextRelative(t,e,r="black",i,s="alphabetic",n="start"){const a=this.toAbsRegion(e);this.fillTextRelative(t,a,r,i,s,n)}fillText(t,e,r="black",i,s="alphabetic",n="start"){const a=this.context;a.save(),a.translate(this.#t.x,this.#t.y),i.length>0&&(a.font=i),a.textBaseline=s,a.textAlign=n,a.fillStyle=r,a.fillText(t,e.x,e.y),a.restore()}drawCircles(t,e,r="",i=1){const s=t.map(a=>({...this.toAbsRegion(a),radius:this.source.sizeScaler.abs(a.radius)})),n=this.context;n.save(),n.translate(this.#t.x,this.#t.y),n.fillStyle=e,n.strokeStyle=r,n.lineWidth=i;for(const a of s)n.beginPath(),n.arc(a.x,a.y,a.radius,0,Fi),n.closePath(),e.length>0&&n.fill(),r.length>0&&n.stroke();n.restore()}clear(){this.context.clearRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}fill(t="white"){const e=this.context;e.fillStyle=t,e.fillRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}drawBounds(t,e=1){this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}],t,e),this.drawConnectedPointsRelative([{x:0,y:1},{x:1,y:0}],t,e),this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:1}],t,e)}toRelPoint(t,e="screen",r="independent",i=!0){t=this.source.toRelPoint(t,e,"skip",!1);let{x:s,y:n}=t;switch(s-=this.x,n-=this.y,r){case"independent":s/=this.width,n/=this.height}return i&&(s=M(s),n=M(n)),{x:s,y:n}}absToRegionPoint(t,e,r){e==="screen"&&(t=ke(t,this.source.offset));let{x:i,y:s}=t;return i-=this.x,s-=this.y,r&&(i<0&&(i=0),s<0&&(s=0),i>this.width+this.x&&(i=this.x+this.width),s>this.height+this.y&&(s=this.y+this.height)),{x:i,y:s}}get center(){return ri(this.#t)}get context(){return this.source.context}set region(t){this.#t=t}get region(){return this.#t}get width(){return this.#t.width}get height(){return this.#t.height}get x(){return this.#t.x}get y(){return this.#t.y}get dimensionMin(){return Math.min(this.#t.width,this.#t.height)}};const $=(t,e)=>{e.fillStyle&&t.setAttributeNS(null,"fill",e.fillStyle),e.opacity&&t.setAttributeNS(null,"opacity",e.opacity.toString())},Di=t=>{const e=t.getAttributeNS(null,"width"),r=e===null?0:Number.parseFloat(e),i=t.getAttributeNS(null,"height"),s=i===null?0:Number.parseFloat(i);return{width:r,height:s}},_i=(t,e)=>{t.setAttributeNS(null,"width",e.width.toString()),t.setAttributeNS(null,"height",e.height.toString())},Lt=(t,e)=>{const r=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&(r.id=e),r},I=(t,e,r,i)=>{let s=null;if(r!==void 0&&(s=typeof r=="string"?t.querySelector(r):r),s===null){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return t.append(n),r&&typeof r=="string"&&r.startsWith("#")&&(n.id=i!==void 0&&!r.endsWith(i)?r.slice(1)+i:r.slice(1)),n}return s},Ue=(t,e=.5,r=.75,i=1)=>{E(m(t,"positive","index"),m(e,"percentage","saturation"),m(r,"percentage","lightness"),m(i,"percentage","alpha"));const n=t*137.508%360/360;return Ct(D(n,e,r,i))},Vi=(t=Math.random)=>t()*360;function Ye(t,e){return Ke(t,r=>M(r*e))}function Ke(t,e){const r=Wt(t);let i;switch(r.space){case"hsl":i=We(r,e);break;case"srgb":i=Ve(r,e);break;case"oklch":i=He(r,e);break;default:throw new Error(`Unknown space: '${r.space}'. Expected hsl, srgb, oklch`)}if(!i)throw new Error("Is colour in correct form?");return typeof t=="string"?p(i):i}function ji(t,e){const r=Wt(t);return r.opacity=e,typeof t=="string"?p(r):r}function Gi(t,e="hsl"){if(!Array.isArray(t))throw new Error(`Param 'colours' is not an array as expected. Got: ${typeof t}`);if(t.length<2)throw new Error(`Param 'colours' should be at least two in length. Got: ${t.length}`);const r=t.map(i=>Tt(i,e));return[...Ir(r)]}const Ui=t=>`linear-gradient(to right, ${t.map(r=>p(r)).join(", ")})`,Yi=(t,e,r={})=>{const i=r.space??"oklch",s=r.direction??"shorter";let n;switch(i){case"hsl":n=qt(x(t,"hsl-scalar"),x(e,"hsl-scalar"),s);break;case"srgb":n=re(x(t,"srgb-scalar"),x(e,"srgb-scalar"));break;default:n=Jt(x(t,"oklch-scalar"),x(e,"oklch-scalar"),s)}return a=>p(n(a))},Ki=(t,e={})=>{const r=e.direction??"shorter",i=e.space??"oklch",s=Gi(t,i);let n=0;if(typeof e.stepsBetween=="number"){if(n=e.stepsBetween,n<1)throw new Error("Param 'stepsBetween' must be at least 1")}else if(typeof e.stepsTotal=="number"){if(e.stepsTotal<=t.length)throw new Error(`Param 'stepsTotal' must be greater than number of provided colour stops (${t.length}) +1 per stop`);const l=e.stepsTotal-t.length;n=Math.floor(l/s.length)}const a=s.map(l=>{const c=Xe(l[0],l[1],{steps:n,space:i,direction:r,exclusive:!0});return c.push(l[1]),c}),o=s[0];return a.unshift([o[0]]),a.flat().map(l=>p(l))};function Xe(t,e,r={}){const i=r.exclusive??!1,s=r.steps??5,n=r.space??"oklch",a=r.direction??"shorter";if(!i&&s<2)throw new Error("Param 'steps' should be at least 2 when 'exclusive' is false");if(i&&s<1)throw new Error("Param 'steps' should be at least 1 when 'exlusive' is true");const o=Tt(t,n),l=Tt(e,n);let c;switch(n){case"hsl":c=qt(o,l,a);break;case"oklch":c=Jt(o,l,a);break;case"srgb":c=re(o,l);break;default:throw new Error(`Colour space '${n}' not supported for interpolation.`)}if(!c)throw new Error(`Could not create interpolator for space: ${n}`);let h=0,g=0,b=1;i?(h=1/(s+1),g=h,b=1-h):h=1/(s-1);const u=[];for(let f=g;f<=b;f+=h)u.push(c(f));return u}var qe={};S(qe,{HslSpace:()=>Le,OklchSpace:()=>ze,SrgbSpace:()=>_e,convert:()=>x,convertScalar:()=>Tt,convertToString:()=>Xi,createSteps:()=>Xe,cssDefinedHexColours:()=>P,cssLinearGradient:()=>Ui,fromCssColour:()=>Ot,goldenAngleColour:()=>Ue,guard:()=>Je,interpolator:()=>Yi,isColourish:()=>$e,isHsl:()=>z,isOkLch:()=>J,isRgb:()=>N,multiplyOpacity:()=>Ye,randomHue:()=>Vi,resolveCss:()=>Qt,rgbToHsl:()=>Zi,scale:()=>Ki,setOpacity:()=>ji,toColour:()=>Wt,toCssColour:()=>p,toHexColour:()=>qi,toLibraryColour:()=>Ji,toStringFirst:()=>H,tryParseObjectToHsl:()=>Kt,tryParseObjectToRgb:()=>Yt,withOpacity:()=>Ke});function x(t,e){if(e==="hsl-scalar"){if(typeof t=="string"||z(t)||N(t))return Z(t)}else if(e==="hsl-absolute"){if(typeof t=="string"||z(t))return Q(t)}else if(e==="oklch-scalar"){if(typeof t=="string"||J(t))return st(t)}else if(e==="oklch-absolute"){if(typeof t=="string"||J(t))return It(t)}else if(e==="srgb-8bit"){if(typeof t=="string"||N(t))return B(t)}else if(e==="srgb-scalar"){if(typeof t=="string"||N(t))return O(t)}else throw new Error(`Destination '${e}' not supported for input: ${JSON.stringify(t)}`);return x(p(t),e)}function Xi(t,e){const r=x(t,e);return p(r)}function Tt(t,e){if(e==="oklch")return x(t,"oklch-scalar");if(e==="srgb")return x(t,"srgb-scalar");if(e==="hsl")return x(t,"hsl-scalar");throw new Error(`Unknown destination: '${e}'`)}const p=t=>{if(typeof t=="string")return t;if(z(t))return Ct(t);if(N(t))return at(t);if(J(t))return Be(t);const e=Yt(t);if(e)return at(e);const r=Kt(t);if(r)return Ct(r);throw new Error(`Unknown colour format: '${JSON.stringify(t)}'`)},qi=t=>{if(z(t))return Ht(t);if(N(t))return wt(t);if(J(t))return Fe(t);if(typeof t=="string"){if(t.startsWith("#"))return t;const i=x(t,"srgb-8bit");return wt(i)}const e=Yt(t);if(e)return wt(e);const r=Kt(t);if(r)return Ht(r);throw new Error(`Unknown colour format: '${JSON.stringify(t)}'`)},Ji=t=>{const e=p(t);return new Rt(e)},Je=t=>{switch(t.space){case"hsl":tt(t);break;case"srgb":V(t);break;case"oklch":_(t);break;default:throw new Error(`Unsupported colour space: '${t.space}'`)}},Wt=t=>{if(!$e(t))throw new Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc. Got: ${JSON.stringify(t)}`);let e;if(typeof t=="string"?e=Ot(t):e=t,e===void 0)throw new Error("Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc.");return Je(e),e},H=(...t)=>{for(const e of t)if(e!==void 0&&e!==null)try{const r=Wt(e);return p(r)}catch{}return"rebeccapurple"};function Zi(t,e){let{r,g:i,b:s}=t;const n=t.opacity??1;t.unit==="8bit"&&(r/=255,i/=255,s/=255);const a=Math.max(r,i,s),o=Math.min(r,i,s);let l=(a+o)/2,c=l;const h=l;if(a===o)return e?D(0,0,0,n):it(0,0,0,n);const g=a-o;switch(c=h>=.5?g/(2-(a+o)):g/(a+o),a){case r:l=((i-s)/g+0)*60;break;case i:l=((s-r)/g+2)*60;break;case s:l=((r-i)/g+4)*60;break}return e?D(l/360,c,h,n):it(l,c*100,h*100,n)}const L=(t,e)=>{e.strokeStyle&&t.setAttributeNS(null,"stroke",e.strokeStyle),e.strokeWidth&&t.setAttributeNS(null,"stroke-width",e.strokeWidth.toString()),e.strokeDash&&t.setAttribute("stroke-dasharray",e.strokeDash),e.strokeLineCap&&t.setAttribute("stroke-linecap",e.strokeLineCap)},Ze=(t,e,r)=>{const i=Lt("marker",t);if(e.markerWidth&&i.setAttribute("markerWidth",e.markerWidth?.toString()),e.markerHeight&&i.setAttribute("markerHeight",e.markerHeight?.toString()),e.orient?i.setAttribute("orient",e.orient.toString()):i.setAttribute("orient","auto-start-reverse"),e.viewBox&&i.setAttribute("viewBox",e.viewBox.toString()),e.refX&&i.setAttribute("refX",e.refX.toString()),e.refY&&i.setAttribute("refY",e.refY.toString()),r){const s=r();i.appendChild(s)}return i},pt=(t,e,r)=>{if(t===null)return"(elem null)";const i=t.ownerSVGElement;if(i===null)throw new Error("parent for elem is null");const s=I(i,"defs","defs");let n=s.querySelector(`#${e.id}`);if(n!==null)return`url(#${e.id})`;if(e.id==="triangle")e={...e,strokeStyle:"transparent"},e.markerHeight||(e={...e,markerHeight:6}),e.markerWidth||(e={...e,markerWidth:6}),e.refX||(e={...e,refX:e.markerWidth}),e.refY||(e={...e,refY:e.markerHeight}),(!e.fillStyle||e.fillStyle==="none")&&(e={...e,fillStyle:"black"}),e.viewBox||(e={...e,viewBox:"0 0 10 10"}),n=Ze(e.id,e,()=>{const a=Lt("path");return a.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e&&$(a,e),a});else throw new Error(`Do not know how to make ${e.id}`);return n.id=e.id,s.appendChild(n),`url(#${e.id})`},Mt=(t,e)=>{e.markerEnd&&t.setAttribute("marker-end",pt(t,e.markerEnd)),e.markerStart&&t.setAttribute("marker-start",pt(t,e.markerStart)),e.markerMid&&t.setAttribute("marker-mid",pt(t,e.markerMid))};var Oe={};S(Oe,{circle:()=>rr,circleUpdate:()=>er,grid:()=>lr,group:()=>Oi,groupUpdate:()=>ir,line:()=>Pt,lineUpdate:()=>sr,path:()=>Qe,pathUpdate:()=>tr,polarRayUpdate:()=>Qi,text:()=>or,textPath:()=>ar,textPathUpdate:()=>nr,textUpdate:()=>se});const ue=t=>t>=0&&t<=1?`${t*100}%`:t.toString(),Qe=(t,e,r,i)=>{const s=I(e,"path",i),n=typeof t=="string"?t:t.join(`
`);return s.setAttributeNS(null,"d",n),e.append(s),tr(s,r)},tr=(t,e)=>(e&&$(t,e),e&&L(t,e),t),er=(t,e,r)=>(t.setAttributeNS(null,"cx",e.x.toString()),t.setAttributeNS(null,"cy",e.y.toString()),t.setAttributeNS(null,"r",e.radius.toString()),r&&$(t,r),r&&L(t,r),t),rr=(t,e,r,i)=>{const s=I(e,"circle",i);return er(s,t,r)},Oi=(t,e,r)=>{const i=I(e,"g",r);return ir(i,t)},ir=(t,e)=>{for(const r of e)r.parentNode!==t&&t.append(r);return t},Pt=(t,e,r,i)=>{const s=I(e,"line",i);return sr(s,t,r)},sr=(t,e,r)=>(t.setAttributeNS(null,"x1",e.a.x.toString()),t.setAttributeNS(null,"y1",e.a.y.toString()),t.setAttributeNS(null,"x2",e.b.x.toString()),t.setAttributeNS(null,"y2",e.b.y.toString()),r&&$(t,r),r&&Mt(t,r),r&&L(t,r),t),Qi=(t,e,r)=>{const i=Ur(e);return t.setAttributeNS(null,"x1",i.a.x.toString()),t.setAttributeNS(null,"y1",i.a.y.toString()),t.setAttributeNS(null,"x2",i.b.x.toString()),t.setAttributeNS(null,"y2",i.b.y.toString()),r&&$(t,r),r&&Mt(t,r),r&&L(t,r),t},nr=(t,e,r)=>(r?.method&&t.setAttributeNS(null,"method",r.method),r?.side&&t.setAttributeNS(null,"side",r.side),r?.spacing&&t.setAttributeNS(null,"spacing",r.spacing),r?.startOffset&&t.setAttributeNS(null,"startOffset",ue(r.startOffset)),r?.textLength&&t.setAttributeNS(null,"textLength",ue(r.textLength)),e&&(t.textContent=e),r&&$(t,r),r&&L(t,r),t),ar=(t,e,r,i,s,n)=>{const a=I(r,"text",s,"-text");se(a,void 0,void 0,i);const o=I(a,"textPath",n);return o.setAttributeNS(null,"href",t),nr(o,e,i)},se=(t,e,r,i)=>(e&&(t.setAttributeNS(null,"x",e.x.toString()),t.setAttributeNS(null,"y",e.y.toString())),r&&(t.textContent=r),i&&($(t,i),i&&L(t,i),i.anchor&&t.setAttributeNS(null,"text-anchor",i.anchor),i.align&&t.setAttributeNS(null,"alignment-baseline",i.align),(i.userSelect??!0)||(t.style.userSelect="none")),t),or=(t,e,r,i,s)=>{const n=I(e,"text",s);return se(n,r,t,i)},lr=(t,e,r,i,s,n={})=>{n.strokeStyle||(n={...n,strokeStyle:H("bg-dim","silver")}),n.strokeWidth||(n={...n,strokeWidth:1});const a=Lt("g");$(a,n),Mt(a,n),L(a,n);let o=0;for(;o<s;){const c=he(0,o,i,o);Pt(c,a),o+=r}let l=0;for(;l<i;){const c=he(l,0,l,s);Pt(c,a),l+=r}return t.append(a),a},cr=t=>{if(!t)throw new Error("Param 'el' is undefined");const e={x:t.x1.baseVal.value,y:t.y1.baseVal.value},r={x:t.x2.baseVal.value,y:t.y2.baseVal.value};return{a:e,b:r}},ts=(t,e)=>{const r=cr(t);return Zr(r,e)},hr=(t,e)=>{if(typeof e=="string"){const r=t.querySelector(e);if(r===null)return;r.remove()}else e.remove()},es=t=>{let e=t.lastElementChild;for(;e;)e.remove(),e=t.lastElementChild},rs=(t,e)=>(e&&($(t,e),L(t,e)),{remove:i=>{hr(t,i)},text:(i,s,n,a)=>or(i,t,s,n,a),textPath:(i,s,n,a,o)=>ar(i,s,t,n,a,o),line:(i,s,n)=>Pt(i,t,s,n),circle:(i,s,n)=>rr(i,t,s,n),path:(i,s,n)=>Qe(i,t,s,n),grid:(i,s,n,a,o)=>lr(t,i,s,n,a,o),query:i=>t.querySelector(i),get width(){const i=t.getAttributeNS(null,"width");return i===null?0:Number.parseFloat(i)},set width(i){t.setAttributeNS(null,"width",i.toString())},get parent(){return t},get height(){const i=t.getAttributeNS(null,"height");return i===null?0:Number.parseFloat(i)},set height(i){t.setAttributeNS(null,"height",i.toString())},clear:()=>{for(;t.firstChild;)t.lastChild.remove()}});var is={};S(is,{Elements:()=>Oe,applyOpts:()=>$,applyPathOpts:()=>Mt,applyStrokeOpts:()=>L,clear:()=>es,createEl:()=>Lt,createMarker:()=>Ze,createOrResolve:()=>I,getBounds:()=>Di,lineFromSvgLine:()=>cr,makeHelper:()=>rs,markerPrebuilt:()=>pt,polarRayFromSvgLine:()=>ts,remove:()=>hr,setBounds:()=>_i});var ss={};S(ss,{boxBlurKernel:()=>cs,convolve:()=>ur,convolveCell:()=>fr,convolveImage:()=>ns,edgeDetectionKernel:()=>os,gaussianBlur3Kernel:()=>hs,gaussianBlur5Kernel:()=>fs,identityKernel:()=>as,kernel2dToArray:()=>dr,multiply:()=>ut,rgbReducer:()=>gr,sharpenKernel:()=>ls,unsharpMasking5Kernel:()=>us});const ut=(t,e)=>{const r=t.length,i=t[0].length,s=[];for(let n=0;n<r;n++){s[n]=[];for(let a=0;a<i;a++)s[n][a]=t[n][a]*e}return s};function fr(t,e,r,i){const s=e.map(n=>{const a=Yr(r,t,n.cell,"stop");let o;return a&&(o=r.get(a,"undefined"),n.value),{cell:n.cell,value:o,kernel:n.value}});return i(s)}function*ns(t,e){const r=Ge(e);yield*ur(t,r,Kr(r),gr)}function*ur(t,e,r,i,s){if(!s){const a=t.length,o=t[0].length;s={x:Math.floor(a/2),y:Math.floor(o/2)}}const n=dr(t,s);for(const a of r){const o=fr(a,n,e,i);yield{cell:a,value:o}}}const dr=(t,e)=>{const r=[],i=t.length,s=t[0].length;e||(e={x:Math.floor(i/2),y:Math.floor(s/2)});for(let n=0;n<i;n++)for(let a=0;a<s;a++){const o={cell:{x:n-e.x,y:a-e.y},value:t[n][a]};r.push(o)}return r},gr=t=>{let e=0,r=0,i=0,s=0;for(const a of t){const o=a.value,l=a.kernel;o&&o.opacity!==0&&l!==0&&(e+=o.r*l,r+=o.g*l,i+=o.b*l,s+=(o.opacity??1)*l)}return{r:e,g:r,b:i,unit:"8bit",space:"srgb",opacity:s}},as=[[0,0,0],[0,1,0],[0,0,0]],os=[[0,-1,0],[-1,4,-1],[0,-1,0]],ls=[[0,-1,0],[-1,5,-1],[0,-1,0]],cs=ut([[1,1,1],[1,1,1],[1,1,1]],1/9),hs=ut([[1,2,1],[2,4,2],[1,2,1]],1/16),fs=ut([[1,4,6,4,1],[4,16,24,16,4],[6,24,36,24,6],[4,16,24,16,4],[1,4,6,4,1]],1/256),us=ut([[1,4,6,4,1],[4,16,24,16,4],[6,24,-476,24,6],[4,16,24,16,4],[1,4,6,4,1]],-1/256);var yr={};S(yr,{create:()=>ds});const ds=t=>new gs(t);var gs=class{#e=new Map;#t=new Map;fallbacks;#i=0;#r;constructor(t){t!==void 0?this.fallbacks=t:this.fallbacks=["red","blue","green","orange"],this.#r=document.body}setElementBase(t){this.#r=t}add(t,e){this.#e.set(t,e)}alias(t,e){this.#t.set(t,e)}get(t,e){const r=this.#t.get(t);r!==void 0&&(t=r);const i=this.#e.get(t);if(i!==void 0)return i;const s="--"+t;let n=getComputedStyle(this.#r).getPropertyValue(s).trim();if(n===void 0||n.length===0){if(e!==void 0)return e;n=this.fallbacks[this.#i],this.#i++,this.#i===this.fallbacks.length&&(this.#i=0)}return n}getOrAdd(t,e){if(this.has(t))return this.get(t);const r=this.get(t,e);return this.add(t,r),r}has(t){return this.#e.has(t)}},br={};S(br,{capture:()=>bs,frames:()=>ys,manualCapture:()=>ws});async function*ys(t,e={}){const r=e.maxIntervalMs??0,i=e.showCanvas??!1;let s=e.canvasEl,n,a;n=a=0,s===void 0&&(s=document.createElement("CANVAS"),s.classList.add("ixfx-frames"),i||(s.style.display="none"),document.body.appendChild(s));const o=()=>{s!==void 0&&(n=t.videoWidth,a=t.videoHeight,s.width=n,s.height=a)};let l=null;const c=Xr(r);for await(const h of c){if((n===0||a===0)&&o(),n===0||a===0)continue;if(l??=s.getContext("2d"),l===null)return;l.drawImage(t,0,0,n,a),yield l.getImageData(0,0,n,a)}}const bs=(t,e={})=>{const r=e.maxIntervalMs??0,i=e.showCanvas??!1,s=e.onFrame,n=t.videoWidth,a=t.videoHeight,o=document.createElement("CANVAS");o.classList.add("ixfx-capture"),i||(o.style.display="none"),o.width=n,o.height=a;let l=null,c;e.workerScript&&(c=new Worker(e.workerScript));const h=c||s;!h&&!i&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");const g=qr(()=>{if(l===null&&(l=o.getContext("2d")),l===null)return;l.drawImage(t,0,0,n,a);let b;if(h&&(b=l.getImageData(0,0,n,a)),c&&c.postMessage({pixels:b.data.buffer,width:n,height:a,channels:4},[b.data.buffer]),s)try{s(b)}catch(u){console.error(u)}},r);return{start:()=>{g.start()},cancel:()=>{g.cancel()},canvasEl:o}},ws=(t,e={})=>{const r=e.showCanvas??!1,i=t.videoWidth,s=t.videoHeight,n=e.canvasEl!==void 0;let a=e.canvasEl;return a||(a=document.createElement("CANVAS"),a.classList.add("ixfx-capture"),document.body.append(a),r||(a.style.display="none")),a.width=i,a.height=s,{canvasEl:a,capture:()=>{let h;if(h||(h=a.getContext("2d",{willReadFrequently:!0})),!h)throw new Error("Could not create graphics context");h.drawImage(t,0,0,i,s);const g=h.getImageData(0,0,i,s);return g.currentTime=t.currentTime,e.postCaptureDraw&&e.postCaptureDraw(h,i,s),g},dispose:()=>{if(!n)try{a.remove()}catch{}}}};var wr={};S(wr,{init:()=>ps});function de(t,e,r){const i=t.getAttribute(e);return i===null?r:Number.parseInt(i)}const ps=(t,e={})=>{const r=document.querySelector(t);if(!r)throw new Error(`Element query could not be found (${t})`);const i=e.labels??["x","y"],s=e.labelPrecision??2,n=e.asPercentages??!1,a=e.displayLastValues??0,o=e.showWhiskers??!0,l=e.showDot??!0,c=e.showLabels??!0,h=e.yAxisBottomNegative??!0,g=H(e.axisColour,"silver"),b=H(e.bgColour,"white"),u=H(e.whiskerColour,"black"),f=H(e.dotColour,e.whiskerColour,"black"),y=H(e.labelColour,e.axisColour,"silver"),Cr=e.axisWidth??1*window.devicePixelRatio,vr=e.dotRadius??5*window.devicePixelRatio,R=e.padding??10*window.devicePixelRatio,dt=e.whiskerSize??5*window.devicePixelRatio,G=e.width??de(r,"width",200)*window.devicePixelRatio,U=e.height??de(r,"height",200)*window.devicePixelRatio;let F;a>0&&(F=new Jr({capacity:a,discardPolicy:"older"})),r.width=G,r.height=U,r.style.width=`${G/window.devicePixelRatio}px`,r.style.height=`${U/window.devicePixelRatio}px`;const gt=U/2,Y=G/2,d=r.getContext("2d");if(!d)throw new Error("Could not create drawing context");window.devicePixelRatio>=2&&(d.font="20px sans-serif");const ne=n?C=>`${Math.round(C*100)}%`:C=>C.toFixed(s);c?(i[0]=i[0]+":",i[1]=i[1]+":"):(i[0]="",i[1]="");const Tr=e.renderBackground??((C,W,K)=>{e.bgColour==="transparent"?C.clearRect(0,0,W,K):(C.fillStyle=b,C.fillRect(0,0,W,K))});return(C,W)=>{C=le(C),W=le(W),Tr(d,G,U),d.fillStyle=y,d.textBaseline="top",d.save(),d.translate(Y,gt),d.rotate(-Math.PI/2),d.fillText((i[1]+" "+ne(W)).trim(),-Y+R,1),d.restore(),d.fillText((i[0]+" "+ne(C)).trim(),R,Y+2),h||(W*=-1),d.strokeStyle=g,d.lineWidth=Cr,d.beginPath(),d.moveTo(R,gt),d.lineTo(G-R,gt),d.moveTo(Y,R),d.lineTo(Y,U-R),d.stroke(),d.closePath();const K=(U-R-R)/2*-W,zt=(G-R-R)/2*C,ae={x:zt,y:K,radius:vr};if(F&&(F=F.enqueue(ae)),d.save(),d.translate(Y,gt),l)if(F){const Pr=1/F.length;let oe=1;F.forEach(Rr=>{const Ar=Ye(f,oe);kt(d,Rr,{fillStyle:Ar}),oe-=Pr})}else kt(d,ae,{fillStyle:f});o&&(d.strokeStyle=u,d.beginPath(),d.moveTo(0,K-dt),d.lineTo(0,K+dt),d.moveTo(zt-dt,0),d.lineTo(zt+dt,0),d.stroke(),d.closePath()),d.restore()}},_t=t=>{const e=t.map(c=>c.x),r=t.map(c=>c.y),i=Math.min(...e),s=Math.max(...e),n=Math.min(...r),a=Math.max(...r),o=s-i,l=a-n;return{min:{x:i,y:n},max:{x:s,y:a},width:o,height:l,minDim:Math.min(o,l),maxDim:Math.max(o,l)}},pr=t=>{if(!Number.isFinite(t.height))return i=>i;const e=xt(t.min.x,t.max.x),r=xt(t.min.y,t.max.y);return i=>({x:e(i.x),y:r(i.y)})},xr=t=>{const e=xt(0,1,t.min.x,t.max.x),r=xt(0,1,t.min.y,t.max.y);return i=>({x:e(i.x),y:r(i.y)})},mr=(t,e,r)=>{const i=[];let s=0;for(let a=t.min.x;a<t.max.x;a+=e){const o=s%r===0;i.push({x:a,y:0,major:o}),s++}s=0;const n=[];for(let a=t.min.y;a<t.max.y;a+=e){const o=s%r===0;n.push({x:0,y:a,major:o}),s++}return{x:i,y:n}};var kr=class{#e;#t;lastChange;constructor(){this.lastChange=performance.now(),this.#e=new Or,this.#t=new Map}get metaCount(){return this.#t.size}clear(){this.#e.clear(),this.lastChange=performance.now()}set(t,e){this.#e.setValues(t,e)}deleteBySeries(t){const e=this.#e.delete(t);return e&&(this.lastChange=performance.now()),e}setMeta(t,e){this.#t.set(t,e)}hasMeta(t){return this.#t.has(t)}getMeta(t){return this.#t.get(t)}*getValues(){yield*this.#e.valuesFlat()}*getEntries(){yield*this.#e.entries()}*getSeries(){yield*this.#e.values()}add(t,e="default"){this.#e.addKeyedValues(e,t),this.lastChange=performance.now()}};const xs=(t,e={})=>{const r=t.parent===void 0?document.body:q(t.parent),i=document.createElement("canvas");r.prepend(i);const s=new kr,n=new Hi(i,"min"),a=t.region??{relativePositioned:{x:0,y:0,width:1,height:1}},o=n.createRegion(a),l=new Sr(o,s,e);return t.canvasResizeTo==="viewport"?Bt.canvasViewport(i,{onSizeChanging:(c,h)=>{n.setLogicalSize(c),l.invalidateRange(),l.draw()}}):Bt.canvasParent(i,{onSizeChanging:(c,h)=>{n.setLogicalSize(c),l.invalidateRange(),l.draw()}}),l};var Sr=class{#e;#t;#i;actualDataRange=ge;visibleRange=Qr;show;whiskerLength;axisRounder=Nr(1,!0);onInvalidated;overlayLines=[];#r;#s;#n;#a;#c;#o;#f;#l;#h;#g;constructor(t,e,r={}){if(!e)throw new TypeError("Param 'data' is undefined");if(typeof e!="object")throw new TypeError(`Param 'data' is not an object. Got: ${typeof e}`);this.onInvalidated=r.onInvalidated,this.#e=e,this.#i=t,this.#t=0,this.#g=r.clear??"region",this.#s=r.range??"auto",this.#c=r.valueStyle??"dot",this.#o=r.connectStyle??"",this.whiskerLength=r.whiskerLength??5,this.#h=r.visualPadding??20,this.show={axes:!0,axisValues:!0,grid:!0,whiskers:!0,...r.show},this.#a={colour:"black",width:2,...r.axisStyle},this.#l={colour:"black",size:"1em",font:"system-ui",...r.textStyle},this.#r={increments:.1,major:5,colour:"whitesmoke",width:1,...r.grid}}getCurrentRange(){if(this.#e.lastChange===this.#t&&this.#n)return this.#n;this.#t=this.#e.lastChange;const t=this.#w();return this.#n=t,this.onInvalidated&&this.onInvalidated(),t}invalidateRange(){this.#n=void 0}#w(){const t=this.getDataRange(),e=pr(t),r=xr(t),i=this.#i,s=this.#h;let n=i.x+s,a=i.y+s;const o=i.height-s*2,l=i.width-s*2,c=Math.min(o,l);return l>=o?n+=l/2-c/2:a+=o/2-c/2,{absDataToRelative:e,relDataToCanvas:u=>{let{x:f,y}=u;return f===Number.NEGATIVE_INFINITY?f=0:f===Number.POSITIVE_INFINITY&&(f=1),y===Number.NEGATIVE_INFINITY?y=0:y===Number.POSITIVE_INFINITY&&(y=1),f=f*c,y=(1-y)*c,f+=n,y+=a,{x:f,y}},canvasToRelData:u=>{let{x:f,y}=u;return f-=n,y-=a,f=f/c,y=1-y/c,{x:f,y}},regionSpaceToRelative:u=>{let{x:f,y}=u;return f=f-i.x+this.#h,y=c+this.#h-y,f/=c,y=y/c,{x:f,y}},relDataToAbs:r,range:t}}positionElementAt(t,e,r="middle",i){const s=q(e);let{x:n,y:a}=this.valueToScreenSpace(t);if(r==="middle"){const o=s.getBoundingClientRect();n-=o.width/2,a-=o.height/2}else if(r!=="top-left")throw new Error("Param 'by' expected to be 'middle' or 'top-left'.");if(i){const l=q(i).getBoundingClientRect();n-=l.x,a-=l.y}s.style.left=`${n}px`,s.style.top=`${a}px`}getDataRange(){return this.#s==="auto"?_t([...this.#e.getValues()]):(this.#f||(this.#f=_t([this.#s.max,this.#s.min])),this.#f)}valueToScreenSpace(t){const e=this.valueToRegionSpace(t),r=this.canvasSource.offset;return{x:e.x+r.x,y:e.y+r.y}}valueToRegionSpace(t,e=!1){const r=this.getCurrentRange(),i=r.absDataToRelative(t),s=r.relDataToCanvas(i);return e&&console.log(`orig: ${t.x}x${t.y} rel: ${i.x}x${i.y} region: ${s.x}x${s.y}`),{...t,x:s.x,y:s.y}}pointToValue(t,e){const r=this.getCurrentRange(),i=ke(t,this.canvasSource.offset),s=r.canvasToRelData(i);return r.relDataToAbs(s)}#u(t,e,r=!1){return t=this.valueToRegionSpace(t,r),e=this.valueToRegionSpace(e,r),{a:t,b:e}}getDefaultMeta(){return{colour:Ue(this.#e.metaCount),lineWidth:2,dotRadius:5}}draw(){this.#g==="region"?this.#i.clear():this.canvasSource.clear(),this.#k(),this.show.axes&&this.#p();for(const[t,e]of this.#e.getEntries()){let r=this.#e.getMeta(t);r||(r=this.getDefaultMeta(),this.#e.setMeta(t,r)),this.#S(t,e,r)}for(const t of this.overlayLines)this.drawLine(t,t.colour,t.width)}drawLine(t,e,r){const i=this.#u(t.a,t.b);this.#d(i,e,r)}setMeta(t,e){this.#e.setMeta(t,{...this.getDefaultMeta(),...e})}#p(){const{colour:t,width:e}=this.#a,r=this.#u({x:0,y:Number.NEGATIVE_INFINITY},{x:0,y:Number.POSITIVE_INFINITY},!1),i=this.#u({x:Number.NEGATIVE_INFINITY,y:0},{x:Number.POSITIVE_INFINITY,y:0},!1);this.#d(i,t,e,!1),this.#d(r,t,e,!1)}#x(t){const e=this.#i.context;e.font=this.#l.size+" "+this.#l.font,e.fillStyle=this.#l.colour,e.textBaseline="middle";for(const r of t){if(r.x===0&&r.y===0)continue;const i=this.valueToRegionSpace(r,!1),n=this.axisRounder(r.y).toString(),a=e.measureText(n),o=i.x-a.width-this.whiskerLength/2-5,l=i.y;e.fillText(n,o,l)}}#m(t){const e=this.#i.context;e.font=this.#l.size+" "+this.#l.font,e.fillStyle=this.#l.colour,e.textBaseline="top";for(const r of t){const i=this.valueToRegionSpace(r,!1),n=this.axisRounder(r.x).toString(),a=e.measureText(n),o=i.x-a.width/2,l=i.y+a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+this.whiskerLength/2;e.fillText(n,o,l)}}#y(t,e){const r=this.whiskerLength/2,i=e?{x:t.x,y:0}:{y:t.y,x:0},s=this.valueToRegionSpace(i,!1),n=e?{a:{x:s.x,y:s.y-r},b:{x:s.x,y:s.y+r}}:{a:{y:s.y,x:s.x-r},b:{y:s.y,x:s.x+r}};this.#d(n,this.#a.colour,this.#a.width,!1)}#b(t,e){const r=e?this.#u({x:t.x,y:Number.NEGATIVE_INFINITY},{x:t.x,y:Number.POSITIVE_INFINITY}):this.#u({y:t.y,x:Number.NEGATIVE_INFINITY},{y:t.y,x:Number.POSITIVE_INFINITY},!1);this.#d(r,this.#r.colour,t.major?this.#r.width*2:this.#r.width)}#k(){const t=this.#r,e=this.show.grid,r=this.show.whiskers,i=this.show.axisValues,s=this.getCurrentRange().range,{increments:n,major:a}=t,o=mr(s,n,a);for(const l of o.x)e&&this.#b(l,!0),r&&l.major&&this.#y(l,!0);for(const l of o.y)e&&this.#b(l,!1),r&&l.major&&this.#y(l,!1);i&&(this.#m(o.x.filter(l=>l.major)),this.#x(o.y.filter(l=>l.major)))}#S(t,e,r){if(this.#o==="line"&&this.#C(e,r.colour,r.lineWidth),this.#c==="dot")for(const i of e)this.#v(i,r.colour,r.dotRadius)}#C(t,e,r){const i=this.#i.context;i.beginPath();for(const[s,n]of t.entries()){const a=this.valueToRegionSpace(n,!1);s===0&&i.moveTo(a.x,a.y),i.lineTo(a.x,a.y)}i.strokeStyle=p(e),i.lineWidth=r,i.stroke(),i.closePath()}#v(t,e,r){const i=p(t.fillStyle??e),s=this.valueToRegionSpace(t),n=t.radius??r;this.#i.drawCircles([{...s,radius:n}],i)}#d(t,e,r,i=!1){i&&console.log(t);const s=this.#i.context;e=p(e),s.beginPath(),s.moveTo(t.a.x,t.a.y),s.lineTo(t.b.x,t.b.y),s.strokeStyle=p(e),s.lineWidth=r,s.stroke(),s.closePath()}get dataSet(){return this.#e}get canvasRegion(){return this.#i}get canvasSource(){return this.#i.source}},ms={};S(ms,{BipolarView:()=>wr,CartesianCanvasPlot:()=>Sr,DataSet:()=>kr,absoluteCompute:()=>xr,computeAxisMark:()=>mr,computeMinMax:()=>_t,insert:()=>xs,relativeCompute:()=>pr});try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{NamedColourPalette:yr,Colour:qe,Video:br}})}catch{}export{As as C,qe as c,ui as d,ms as p};
