import"../../modulepreload-polyfill-B5Qt9EMX.js";import{b as button,s as select}from"../../forms-C4su1Q0P.js";import{t as toArray}from"../../async-Dr__bS9h.js";import{A as Adsr}from"../../Adsr-DCNQi82e.js";import{r as repeat}from"../../repeat-VL_PzXI7.js";import{s as serial}from"../../espruino-lL2Yqgry.js";import"../../resolve-el-BUhvOf7L.js";import"../../result-aflA1LW7.js";import"../../interval-type-CIaujdcR.js";import"../../numbers-SvRH5ijj.js";import"../../sleep-DwDBk_RX.js";import"../../simple-event-emitter-BaCTAiR9.js";import"../../with-events-BRQckvzl.js";import"../../state-machine-ROMMoZIR.js";import"../../index-C_lhlGLx.js";import"../../interpolate-CjV-b_hr.js";import"../../length-BrmuG0lR.js";import"../../guard-DRLb5kU_.js";import"../../guard-RzpFIjKH.js";import"../../from-top-left-CR5-Vjbi.js";import"../../guard-BPeP3-pA.js";import"../../guard-DHhxSbUy.js";import"../../scale-KzsViUdl.js";import"../../clamp-ClLuI7HB.js";import"../../error-message-BtgnhF27.js";import"../../queue-fns-Cpl8E1uR.js";async function*adsrIterable(t){const e=new Adsr(t.env),s=t.sampleRateMs??100;e.trigger();const i=repeat(()=>e.value,{while:()=>!e.isDone,delay:s,signal:t.signal});for await(const a of i)yield a}const effects=["strong click 100%","strong click 60%","strong click 30%","sharp click 100%","sharp click 60%","sharp click 30%","soft bump 100%","soft bump 60%","soft bump 30%","double click 100%","double click 60%","triple click 100%","soft fuzz 60%","strong buzz 100%","750 ms alert 100%","1000ms alert 100%","strong click 1 100%","strong click 2 80%","strong click 3 60%","strong click 4 30%","medium click 1 100%","medium click 2 80%","medium click 3 60%","sharp tick 1 100%","sharp tick 2 80%","sharp tick 3 60%","short double click strong 1 100%","short double click strong 2 80%","short double click strong 3 60%","short double click strong 4 30%","short double click medium 1 100%","short double click medium 2 80%","short double click medium 3 60%","short double sharp tick 1 100%","short double sharp tick 2 80%","short double sharp tick 3 60%","long double sharp click strong 1 100%","long double sharp click strong 2 80%","long double sharp click strong 3 60%","long double sharp click strong 4 30%","long double sharp click medium 1 100%","long double sharp click medium 2 80%","long double sharp click medium 3 60%","long double sharp tick 1 100%","long double sharp tick 2 80%","long double sharp tick 3 60%","buzz 1 100%","buzz 2 80%","buzz 3 60%","buzz 4 40%","buzz 5 20%","pulsing strong 1 100%","pulsing strong 2 60%","pulsing medium 1 100%","pulsing medium 2 60%","pulsing sharp 1 100%","pulsing sharp 2 60%","transition click 1 100%","transition click 2 80%","transition click 3 60%","transition click 4 40%","transition click 5 20%","transition click 6 10%","hum 1 100%","hum 2 80%","hum 3 60%","hum 4 40%","hum 5 20%","hum 6 10%","ramp down long smooth 1","ramp down long smooth 2","ramp down medium smooth 1","ramp down medium smooth 2","ramp down short smooth 1","ramp down short smooth 2","ramp down long sharp 1","ramp down long sharp 2","ramp down medium sharp 1","ramp down medium sharp 2","ramp down short sharp 1","ramp down short sharp 2","ramp up long smooth 1","ramp up long smooth 2","ramp up medium smooth 1","ramp up medium smooth 2","ramp up short smooth 1","ramp up short smooth 2","ramp up long sharp 1","ramp up long sharp 2","ramp up medium sharp 1","ramp up medium sharp 2","ramp up short sharp 1","ramp up short sharp 2","ramp down long smooth 1 half","ramp down long smooth 2 half","ramp down medium smooth 1 half","ramp down medium smooth 2 half","ramp down short smooth 1 half","ramp down short smooth 2 half","ramp down long sharp 1 half","ramp down long sharp 2 half","ramp down medium sharp 1 half","ramp down medium sharp 2 half","ramp down short sharp 1 half","ramp down short sharp 2 half","ramp up long smooth 1 half","ramp up long smooth 2 half","ramp up medium smooth 1 half","ramp up medium smooth 2 half","ramp up short smooth 1 half","ramp up short smooth 2 half","ramp up long sharp 1 half","ramp up long sharp 2 half","ramp up medium sharp 1 half","ramp up medium sharp 2 half","ramp up short sharp 1 half","ramp up short sharp 2 half","long buzz no stop","smooth hum 1 50%","smooth hum 2 40%","smooth hum 3 30%","smooth hum 4 20%","smooth hum 5 10%"],settings=Object.freeze({effects,durationLimit:500,selEffectsEl:document.querySelector("#selEffects"),seqArrayEl:document.querySelector("#seqArray"),txtEnvEl:document.querySelector("#txtEnv"),envArraysEl:document.querySelector("#envArrays"),numEnvResolutionEl:document.querySelector("#numEnvResolution"),btnEnvSendEl:document.querySelector("#btnEnvSend")});let state=Object.freeze({espruino:void 0});const setupTrigger=()=>{const{effects:t,selEffectsEl:e}=settings,s=select(e,a=>{console.log(a)}),i=t.map((a,l)=>`${l+1}. ${a}`);s.setOpts(i),button("#btnTrigger",()=>{const a=s.index+1;state.espruino&&state.espruino.write(`trigger(${a})
`)})},setupSequencer=()=>{const{effects:t,seqArrayEl:e}=settings,s=8,i=[],a=t.map((r,n)=>`${n+1}. ${r}`),l=()=>{const r=[];for(let n=0;n<s&&i[n].index!==0;n++)r[n]=i[n].index;return r},p=()=>{e.textContent=JSON.stringify(l())};let m=!0;for(let r=0;r<s;r++){const n=select(`#selSeq${r}`,()=>{m=!0,p()},{shouldAddChoosePlaceholder:!0});n.setOpts(a),i[r]=n}button("#btnSeqReset",()=>{for(const r of i)r.select(0);m=!0,p()}),button("#btnSeqStart",()=>{const{espruino:r}=state;r!==null&&(m&&(r?.write(`setSequence(${JSON.stringify(l())}
)`),m=!1),r?.write(`start()
`))}),button("#btnSeqStop",()=>{state.espruino&&state.espruino.write(`stop()
`)})},setupEnvelope=()=>{const{btnEnvSendEl,txtEnvEl,envArraysEl,durationLimit,numEnvResolutionEl}=settings;let amplitudes=[],durations=[];const reset=()=>{envArraysEl.innerHTML="1. Edit envelope and click 'Sample'.<br />2. Click 'Send to Espruino'",btnEnvSendEl.disabled=!0},sampleEnvironment=async()=>{const sampleRate=Number.parseInt(numEnvResolutionEl.value);try{const o=eval(`(${txtEnvEl.value.trim()})`);if(console.log(o),o.shouldLoop=!1,o.attackDuration>durationLimit)throw new Error(`attackDuration cannot be longer than ${durationLimit}ms.`);if(o.decayDuration>durationLimit)throw new Error(`decayDuration cannot be longer than ${durationLimit}ms.`);if(o.releaseDuration>durationLimit)throw new Error(`releaseDuration cannot be longer than ${durationLimit}ms.`);const data=await toArray(adsrIterable({env:o,sampleRateMs:sampleRate}));console.log(data),amplitudes=data.map(t=>Math.round(t*127)),durations=data.map(t=>sampleRate);const line1=`let amplitudes = ${JSON.stringify(amplitudes)};`,line2=`let durations = ${JSON.stringify(durations)};`;envArraysEl.innerHTML=line1+"<br />"+line2,btnEnvSendEl.disabled=!1}catch(t){console.log(t),envArraysEl.innerHTML=`<h1>:(</h1><p>There is an error in the envelope definition.</p><p>${t}</p>`,btnEnvSendEl.disabled=!0,amplitudes=[],durations=[]}};txtEnvEl.addEventListener("input",()=>{reset()}),button("#btnPasteEnv",async()=>{let t=await navigator.clipboard.readText();t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let e=t.split("\\n");e=e.filter(s=>(s=s.trim(),!(s.startsWith("shouldLoop")||s.startsWith("sustainLevel")))),txtEnvEl.value=e.join(`
`),amplitudes=[],durations=[],btnEnvSendEl.disabled=!0}),button("#btnSample",async()=>{sampleEnvironment()}),button(btnEnvSendEl,()=>{state.espruino&&amplitudes.length>0&&durations.length>0&&state.espruino.write(`rtpMode(${JSON.stringify(amplitudes)}, ${JSON.stringify(durations)})
`)}),reset()},onConnected=t=>{for(const e of document.querySelectorAll("section"))t?(e.classList.remove("disconnected"),e.classList.add("connected")):(e.classList.add("disconnected"),e.classList.remove("connected"))},setup=()=>{button("#btnConnect",async()=>{try{const t=await serial();t.addEventListener("change",e=>{console.log(`${e.priorState} -> ${e.newState}`),onConnected(e.newState==="connected")}),t.addEventListener("data",e=>{e.data!=="=undefined"&&console.log(e.data)}),onConnected(!0),updateState({espruino:t})}catch(t){console.error(t),onConnected(!1)}}),setupTrigger(),setupSequencer(),setupEnvelope()};setup();function updateState(t){state=Object.freeze({...state,...t})}
