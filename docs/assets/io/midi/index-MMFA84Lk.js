import"../../modulepreload-polyfill-B5Qt9EMX.js";var Bx=Object.create,Ys=Object.defineProperty,Tx=Object.getOwnPropertyDescriptor,zx=Object.getOwnPropertyNames,Ox=Object.getPrototypeOf,jx=Object.prototype.hasOwnProperty,Rx=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),A=(e,r)=>{for(var i in r)Ys(e,i,{get:r[i],enumerable:!0})},Vx=(e,r,i,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(var a=zx(r),n=0,s=a.length,l;n<s;n++)l=a[n],!jx.call(e,l)&&l!==i&&Ys(e,l,{get:(u=>r[u]).bind(null,l),enumerable:!(o=Tx(r,l))||o.enumerable});return e},id=(e,r,i)=>(i=e==null?{}:Bx(Ox(e)),Vx(Ys(i,"default",{value:e,enumerable:!0}),e));const od=e=>typeof e=="string"?e:e instanceof Error?e.message:e,_a=(...e)=>{let r=e.filter(o=>Ct(o));if(r.length===0)return;let i=r.map(o=>el(o));throw Error(i.join(", "))};function w(...e){for(let r of e){let i=typeof r=="object"?r:r();if(!(i===void 0||i.success))throw Lr(i)}return!0}function Lx(e){if(e.success)return!0;throw Lr(e)}const Ix=(...e)=>{for(let r of e){let i=typeof r=="object"?r:r();if(i!==void 0&&!i.success)return i}};function Ct(e){return typeof e=="object"?!e.success:!1}function ad(e){return typeof e=="object"?e.success:!1}function Lr(e){if(typeof e.error=="string")throw Error(e.error,{cause:e.info});if(e.error instanceof Error)throw e.error;return Error(JSON.stringify(e.error),{cause:e.info})}function qx(e){if(ad(e))return e.value;throw Lr(e)}function el(e){return e.error instanceof Error?od(e.error):typeof e.error=="string"?e.error:JSON.stringify(e.error)}const Wa=(...e)=>{let r;for(let i of e)if(r=typeof i=="object"?i:i(),r!==void 0&&!r.success)return r;if(!r)throw Error("No results");return r},_x=(e,r)=>{Ct(e)&&r(e)},nd=e=>Math.log2(e)%1==0,Wx=(e,r)=>{if(typeof e!="number")throw TypeError(`v is not a number. Got: ${typeof e}`);return Number.isNaN(e)?r:e},Gx=(e,r="",i=NaN)=>{if(e==null)return i;try{let o=Number.parseInt(typeof e=="number"?e.toString():e);return G(o,r,"parsed").success?o:i}catch{return i}},C=(e,r="",i="?",o)=>{if(e===null)return{success:!1,error:`Parameter '${i}' is null`,info:o};if(e===void 0)return{success:!1,error:`Parameter '${i}' is undefined`,info:o};if(Number.isNaN(e))return{success:!1,error:`Parameter '${i}' is NaN`,info:o};if(typeof e!="number")return{success:!1,error:`Parameter '${i}' is not a number (${JSON.stringify(e)})`,info:o};switch(r){case"finite":if(!Number.isFinite(e))return{success:!1,error:`Parameter '${i} must be finite (Got: ${e})`,info:o};break;case"positive":if(e<0)return{success:!1,error:`Parameter '${i}' must be at least zero (${e})`,info:o};break;case"negative":if(e>0)return{success:!1,error:`Parameter '${i}' must be zero or lower (${e})`,info:o};break;case"aboveZero":if(e<=0)return{success:!1,error:`Parameter '${i}' must be above zero (${e})`,info:o};break;case"belowZero":if(e>=0)return{success:!1,error:`Parameter '${i}' must be below zero (${e})`,info:o};break;case"percentage":if(e>1||e<0)return{success:!1,error:`Parameter '${i}' must be in percentage range (0 to 1). (${e})`,info:o};break;case"nonZero":if(e===0)return{success:!1,error:`Parameter '${i}' must non-zero. (${e})`,info:o};break;case"bipolar":if(e>1||e<-1)return{success:!1,error:`Parameter '${i}' must be in bipolar percentage range (-1 to 1). (${e})`,info:o};break}return{success:!0,value:e,info:o}},Ux=(e,r,i=3)=>{if(i===0)return e=Math.floor(e),r=Math.floor(r),e===r?{success:!0,value:e}:{success:!1,error:"A is not identical to B"};let o=10**i,a=Math.floor(e*o),n=Math.floor(r*o);return a===n?{success:!0,value:e}:{success:!1,error:`A is not close enough to B. A: ${e} B: ${r} Decimals: ${i}`}},tt=(e,r="?",i)=>C(e,"percentage",r,i),G=(e,r="",i="?")=>Wa(C(e,r,i),()=>Number.isInteger(e)?{success:!0,value:e}:{success:!1,error:`Param '${i}' is not an integer`}),sd=e=>{for(let r of e)if(Math.abs(r)%1!=0)return{success:!1,error:`Value is not an integer: ${r}`};return{success:!0,value:e}},Jx=e=>(typeof e=="string"&&(e=Number.parseFloat(e)),G(e).success),_e=(e,r,i,o="?")=>typeof e=="number"?Number.isNaN(e)?{success:!1,error:`Param '${o}' is not within range ${r}-${i}. Got: NaN`}:Number.isFinite(e)?e<r?{success:!1,error:`Param '${o}' is below range ${r}-${i}. Got: ${e}`}:e>i?{success:!1,error:`Param '${o}' is above range ${r}-${i}. Got: ${e}`}:{success:!0,value:e}:{success:!1,error:`Param '${o}' is not within range ${r}-${i}. Got: infinite`}:{success:!1,error:`Param '${o}' is not a number type. Got type: '${typeof e}' value: '${JSON.stringify(e)}'`},Ve=(e,r="?")=>Array.isArray(e)?{success:!0,value:e}:{success:!1,error:`Parameter '${r}' is expected to be an array'`},io=(e,r,i="index")=>Wa(Ve(e),G(r,"positive",i),_e(r,0,e.length-1,i)),Hx=e=>Array.isArray(e)?e.some(r=>typeof r!="string")?{success:!1,error:"Contains something not a string"}:{success:!0,value:e}:{success:!1,error:"Value is not an array"},Zt=(e,r="?")=>e===void 0?{success:!1,error:`${r} param is undefined`}:e===null?{success:!1,error:`${r} param is null`}:{success:!0,value:e},Kx=e=>e!==void 0,Qx=e=>e instanceof Function,xo=(e,r="?")=>e===void 0?{success:!1,error:`Param '${r}' is undefined. Expected: function.`}:e===null?{success:!1,error:`Param '${r}' is null. Expected: function.`}:typeof e=="function"?{success:!0,value:e}:{success:!1,error:`Param '${r}' is type '${typeof e}'. Expected: function`},ld=e=>{if(typeof e!="object"||!e)return{success:!1,error:"Value is null or not object type"};let r=Object.getPrototypeOf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)?{success:!0,value:e}:{success:!1,error:"Fancy object"}},Ga=e=>{let r=typeof e;return r==="symbol"?{success:!1,error:"Symbol type"}:r==="function"?{success:!1,error:"Function type"}:r==="bigint"||r==="number"||r==="string"||r==="boolean"?{success:!0,value:e}:ld(e)},Zx=(e,r)=>Wa(ud(e,r),sd(e)),ud=(e,r)=>{for(let i of e){if(r.minExclusive!==void 0&&i<=r.minExclusive)return{success:!1,error:`Value '${i}' must be higher than minExclusive: '${r.minExclusive}'`};if(r.minInclusive!==void 0&&i<r.minInclusive)return{success:!1,error:`Value '${i}' must be equal or higher than minInclusive: '${r.minInclusive}'`};if(r.maxExclusive!==void 0&&i>=r.maxExclusive)return{success:!1,error:`Value '${i}' must be less than maxExclusive: '${r.maxExclusive}'`};if(r.maxInclusive!==void 0&&i>r.maxInclusive)return{success:!1,error:`Value '${i}' must be equal or less than maxInclusive: '${r.maxInclusive}'`}}return{success:!0,value:e}},tl=(e,r="",i="?")=>{if(typeof e!="string")return{success:!1,error:`Param '${i} is not type string. Got: ${typeof e}`};switch(r){case"non-empty":if(e.length===0)return{success:!1,error:`Param '${i} is empty`};break}return{success:!0,value:e}};var Xx={};A(Xx,{arrayIndexTest:()=>io,arrayStringsTest:()=>Hx,arrayTest:()=>Ve,functionTest:()=>xo,getErrorMessage:()=>od,ifNaN:()=>Wx,integerArrayTest:()=>sd,integerParse:()=>Gx,integerTest:()=>G,isDefined:()=>Kx,isFunction:()=>Qx,isInteger:()=>Jx,isPowerOfTwo:()=>nd,nullUndefTest:()=>Zt,numberDecimalTest:()=>Ux,numberInclusiveRangeTest:()=>_e,numberTest:()=>C,percentTest:()=>tt,rangeIntegerTest:()=>Zx,rangeTest:()=>ud,resultErrorToString:()=>el,resultFirstFail_:()=>Ix,resultIsError:()=>Ct,resultIsOk:()=>ad,resultThrow:()=>w,resultThrowSingle:()=>Lx,resultToError:()=>Lr,resultToValue:()=>qx,resultWithFail:()=>_x,resultsCollate:()=>Wa,stringTest:()=>tl,testPlainObject:()=>ld,testPlainObjectOrPrimitive:()=>Ga,throwIfFailed:()=>_a});const Yx=e=>{_a(Ve(e,"options"));let r=[...e],i=0,o=()=>(i++,i===r.length&&(i=0),n()),a=()=>(i--,i===-1&&(i=r.length-1),n()),n=()=>r.at(i);return{toArray:()=>[...r],next:o,prev:a,get current(){return n()},select:u=>{if(typeof u=="number")i=u;else{let c=r.indexOf(u);if(c===-1)throw Error("Could not find value");i=c}}}},e1=(e,r)=>{if(w(C(r,"","index")),!Array.isArray(e))throw Error("Param 'array' is not an array");return r%=e.length,e.at(r)};function t1(e,r){_a(G(r,"aboveZero","size"),Ve(e,"array"));let i=[];for(let o=0;o<e.length;o+=r)i.push(e.slice(o,o+r));return i}const va=e=>typeof e=="string"?e:JSON.stringify(e),Eo=(e,r)=>e===r,r1=(e,r)=>e===r?!0:va(e)===va(r),i1=(e,r,i=Eo)=>{if(!Array.isArray(e))throw TypeError("Expects haystack parameter to be an array");if(!Array.isArray(r))throw TypeError(`Expects needles parameter to be an array. Got: ${typeof r}`);for(let o of r){let a=!1;for(let n of e)if(i(o,n)){a=!0;break}if(!a)return!1}return!0},o1=(e,r=va)=>{if(typeof e!="object")throw Error(`Param 'data' is expected to be an Iterable. Got type: ${typeof e}`);let i=new Set;for(let o of e){let a=r(o);if(i.has(a))return!0;i.add(a)}return!1},cd=e=>{if(!Array.isArray(e))throw Error("Parameter needs to be an array");for(let r=0;r<e.length;r++)for(let i=0;i<e.length;i++)if(r!==i&&e[r]===e[i])return!0;return!1};function a1(e,r,i="undefined"){if(e===void 0)throw Error("Data undefined");if(!Array.isArray(e))throw Error("data is not an array");if(e.length===r)return[...e];if(e.length>r)return e.slice(0,r);let o=[...e],a=r-o.length;for(let n=0;n<a;n++)switch(i){case"undefined":o.push(void 0);break;case"repeat":o.push(e[n%e.length]);break;case"first":o.push(e[0]);break;case"last":o.push(e.at(-1));break}return o}const fd=(e,r,i=Eo)=>{if(w(Ve(e,"arrayA"),Ve(r,"arrayB")),e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],r[o]))return!1;return!0},rl=(e,r)=>{if(!Array.isArray(e))throw Error("Param 'array' is not an array.");if(e.length===0)return!0;let i=r??r1,o=e[0];return!e.some(n=>!i(o,n))},n1=(e,r)=>{let i=[],o=[];for(let a of e)r(a)?i.push(a):o.push(a);return[i,o]};function*s1(e,r,i,o){w(Ve(e,"array")),i===void 0&&(i=0),o===void 0&&(o=e.length),w(io(e,i,"startIndex")),w(io(e,o-1,"endIndex"));for(let a=i;a<o;a++)r(e[a],a,e)&&(yield e[a])}const l1=e=>[...e].flat(),u1=(e,r)=>{if(!Array.isArray(r))throw TypeError(`Param 'array' is expected to be an array. Got type: '${typeof r}'`);let i=new Map;for(let o of r){let a=e(o);if(typeof a!="string"&&typeof a!="number")throw TypeError(`groupBy function is expected to return type string or number. Got type: '${typeof a}' for value: '${o}'`);let n=i.get(a);n??=0,n++,i.set(a,n)}return i},c1=(e,r)=>{let i=new Map;for(let o of e){let a=r(o),n=i.get(a);n||(n=[],i.set(a,n)),n.push(o)}return i},f1=(e,r=Eo)=>{let i=[],o=n=>{for(let s of i)if(r(s,n))return!0;return!1},a=e.flat(10);for(let n of a)o(n)||i.push(n);return i},dd=(e,r=va)=>{let i=new Set,o=[],a=e.flat(10);for(let n of a){let s=r(n);i.has(s)||(i.add(s),o.push(n))}return o},hd=(e,r,...i)=>(_a(Ve(e,"data"),io(e,r,"index")),r===e.length-1?[...e,...i]:r===0?[...i,...e]:[...e.slice(0,r),...i,...e.slice(r)]),d1=(...e)=>{if(e.some(a=>!Array.isArray(a)))throw Error("All parameters must be an array");let r=e.map(a=>a.length);if(!rl(r))throw Error("Arrays must be of same length");let i=[],o=r[0];for(let a=0;a<o;a++)for(let n of e)i.push(n[a]);return i},h1=(e,r,i=Eo)=>e.filter(o=>r.some(a=>i(o,a))),p1=(e,r,...i)=>{let o=new Map;for(let a of i)for(let n of a){if(n===void 0)continue;let s=e(n),l=o.get(s);l=l?r(l,n):n,o.set(s,l)}return[...o.values()]};function*pd(e){if(w(Ve(e,"values")),e.length<2)throw Error(`Array needs to have at least two entries. Length: ${e.length}`);for(let r=1;r<e.length;r++)yield[e[r-1],e[r]]}const y1=(e,r,i)=>{if(w(Ve(e,"arr")),e.length<2)return i;for(let o=0;o<e.length-1;o++)i=r(i,e[o],e[o+1]);return i},il=(e,r=Math.random)=>{w(Ve(e,"dataToShuffle"));let i=[...e];for(let o=i.length-1;o>0;o--){let a=Math.floor(r()*(o+1));[i[o],i[a]]=[i[a],i[o]]}return i},yd=(e,r=Math.random)=>(w(Ve(e,"array")),e[Math.floor(r()*e.length)]),g1=(e,r=Math.random)=>Math.floor(r()*e.length),gd=(e,r)=>{if(!Array.isArray(e))throw TypeError("'data' parameter should be an array");return w(io(e,r,"index")),[...e.slice(0,r),...e.slice(r+1)]},m1=(e,r)=>{if(!Array.isArray(e))throw TypeError(`Param 'array' is not actually an array. Got type: ${typeof e}`);let i=1;if(r<=1){let a=e.length*r;i=Math.round(e.length/a)}else i=r;if(w(G(i,"positive","amount")),i>e.length-1)throw Error("Subsample steps exceeds array length");let o=[];for(let a=i-1;a<e.length;a+=i)o.push(e[a]);return o},Do=(e,r)=>[...e].sort((i,o)=>{w(Ve(e,"data"));let a=i[r],n=o[r];return a<n?-1:a>n?1:0}),b1=(e,r,i)=>[...e].sort((o,a)=>{w(Ve(e,"data"));let n=o[r],s=a[r];return i===void 0?n<s?-1:n>s?1:0:i(n,s)});function*v1(e,r,i){let o=i;for(let a of e){let n=r(a,o);if(typeof n=="boolean"){if(n)break}else{let[s,l]=n;if(s)break;o=l}yield a}}const w1=e=>e.filter(r=>r!==void 0),Ua=(e,r,i=Eo)=>{if(Array.isArray(r)){let o=[];for(let a of e)r.some(n=>i(a,n))||o.push(a);return o}else return e.filter(o=>!i(o,r))},md=(...e)=>{if(e.some(a=>!Array.isArray(a)))throw Error("All parameters must be an array");let r=e.map(a=>a.length);if(!rl(r))throw Error("Arrays must be of same length");let i=[],o=r[0];for(let a=0;a<o;a++)i.push(e.map(n=>n[a]));return i};var x1={};A(x1,{atWrap:()=>e1,chunks:()=>t1,contains:()=>i1,containsDuplicateInstances:()=>cd,containsDuplicateValues:()=>o1,containsIdenticalValues:()=>rl,cycle:()=>Yx,ensureLength:()=>a1,filterAB:()=>n1,filterBetween:()=>s1,flatten:()=>l1,frequencyByGroup:()=>u1,groupBy:()=>c1,insertAt:()=>hd,interleave:()=>d1,intersection:()=>h1,isEqual:()=>fd,mergeByKey:()=>p1,pairwise:()=>pd,pairwiseReduce:()=>y1,randomElement:()=>yd,randomIndex:()=>g1,remove:()=>gd,sample:()=>m1,shuffle:()=>il,sortByNumericProperty:()=>Do,sortByProperty:()=>b1,unique:()=>dd,uniqueDeep:()=>f1,until:()=>v1,without:()=>Ua,withoutUndefined:()=>w1,zip:()=>md});const cs=(e,r)=>{let i={};for(let o of Object.entries(e)){let a=r(o[0]);i[a]=o[1]}return i},bd=(e,r)=>Jd(Object.keys(e),Object.keys(r)),E1=(e,r)=>{let i=Ja(e,r,!0);if(Object.entries(i.added).length>0||Object.entries(i.removed).length>0)throw Error("Shape of data has changed");return vd(i,r)},vd=(e,r)=>{let i={};if(e.isArray)return r;for(let o of Object.entries(e.changed))i[o[0]]=o[1];for(let o of Object.entries(e.added))i[o[0]]=o[1];for(let o of Object.entries(e.children)){let a=o[1];a.hasChanged&&(i[o[0]]=vd(a,r[o[0]]))}return i},Ki=(e,r,i=Y)=>{if(!Array.isArray(e))throw Error("Param 'a' is not an array");if(!Array.isArray(r))throw Error("Param 'b' is not an array");let o=Ja(e,r,!1,i);if(!o.isArray)throw Error("Change set does not have arrays as parameters");let a=s=>{if(s.startsWith("_"))return Number.parseInt(s.slice(1));throw Error(`Unexpected key '${s}'`)};return{...o,added:cs(o.added,a),changed:cs(o.changed,a),removed:o.removed.map(s=>a(s)),summary:o.summary.map(s=>[s[0],a(s[1]),s[2]])}},Ja=(e,r,i=!1,o=Y)=>{e??={},r??={};let a=Object.entries(e),n=Object.entries(r),s=new Set,l={},u={},c={},f=[],d=Array.isArray(e),h=[],p=!1;for(let y of a){let g=d?`_${y[0]}`:y[0],m=y[1],v=r[y[0]];if(s.add(y[0]),v===void 0){p=!0,i&&!d?(l[g]=v,h.push(["mutate",g,v])):(f.push(g),h.push(["del",g,m]));continue}if(typeof m=="object"){let D=Ja(m,v,i,o);D.hasChanged&&(p=!0),c[g]=D;let B=D.summary.map(V=>[V[0],g+"."+V[1],V[2]]);h.push(...B)}else o(m,v)||(l[g]=v,p=!0,h.push(["mutate",g,v]))}if(!i||d)for(let y of n){let g=d?`_${y[0]}`:y[0];s.has(y[0])||(u[g]=y[1],p=!0,h.push(["add",g,y[1]]))}return{changed:l,added:u,removed:f,children:c,hasChanged:p,isArray:d,summary:h}},wd=e=>{let r=[];for(let i in e){let o=e[i];Ga(o)&&r.push([i,o])}return Object.fromEntries(r)},fs=(e,r)=>{let i=Object.entries(e),o=i.map(([a,n],s)=>[a,r({value:n,field:a,index:s,path:a})]);return Object.fromEntries(o)};function xd(e,r){let i=Object.entries(e);for(let o of i)if(o[0]in r){let a=r[o[0]];o[1]=typeof a=="object"?xd(o[1],a):a(o[1],e)}return Object.fromEntries(i)}function it(e){return typeof e=="number"||typeof e=="string"||typeof e=="bigint"||typeof e=="boolean"}function D1(e){if(e.length===0)return"(empty)";let r="";for(let[i,o]of e.entries())r+="  ".repeat(i),r+=o.name+" = "+JSON.stringify(o.nodeValue)+`
`;return r}const Ed=(e,r=0,i={})=>{w(Zt(e,"node"));let o=i.name??"node",a=S1(e,o),n=`${"  ".repeat(r)} + name: ${a.name} value: ${JSON.stringify(a.nodeValue)}`,s=[...Ha(e,i)];return s.length>0?n+`
`+s.map(l=>Ed(l.nodeValue,r+1,{...i,name:l.name})).join(`
`):n};function*Ha(e,r={}){w(Zt(e,"node"));let i=r.filter??"none",o=a=>i==="none"?[!0,it(a)]:i==="leaves"&&it(a)?[!0,!0]:i==="branches"&&!it(a)?[!0,!1]:[!1,it(a)];if(Array.isArray(e))for(let[a,n]of e.entries()){let s=o(n);s[0]&&(yield{name:a.toString(),sourceValue:n,nodeValue:s[1]?n:void 0})}else if(typeof e=="object"){let a="entries"in e?e.entries():Object.entries(e);for(let[n,s]of a){let l=o(s);l[0]&&(yield{name:n,sourceValue:s,nodeValue:l[1]?s:void 0})}}}function*ol(e,r={},i=[]){for(let o of Ha(e,r))yield{...o,ancestors:[...i]},yield*ol(o.sourceValue,r,[...i,o.name])}function A1(e,r){for(let i of Ha(r))if(i.name===e)return i}function C1(e,r,i={}){let o=[...Dd(e,r,i)];if(o.length===0)throw Error(`Could not trace path: ${e} `);return o.at(-1)}function*Dd(e,r,i={}){w(Zt(e,"path"),Zt(r,"node"));let o=i.separator??".",a=e.split(o),n=[];for(let s of a){let l=A1(s,r);if(!l){yield{name:s,sourceValue:void 0,nodeValue:void 0,ancestors:n};return}r=l.sourceValue,yield{...l,ancestors:[...n]},n.push(s)}}function S1(e,r=""){return"name"in e&&"nodeValue"in e&&"sourceValue"in e?e:"name"in e?{name:e.name,nodeValue:e,sourceValue:e}:{name:r,nodeValue:e,sourceValue:e}}function F1(...e){return Object.assign({},...e)}const k1=(e,r="throw")=>{let i={};for(let o of Object.entries(e)){let a=Number.parseInt(o[0]);if(Number.isNaN(a))switch(r){case"throw":throw TypeError(`Cannot convert key '${o[0]}' to an integer`);case"ignore":continue;case"keep":i[o[0]]=o[1];continue;default:throw Error("Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.")}i[a]=o[1]}return i};var $1={};A($1,{changedObjectDataFields:()=>E1,cloneFromFields:()=>wd,compareArrays:()=>Ki,compareObjectData:()=>Ja,compareObjectKeys:()=>bd,getRecordEntryByPath:()=>C1,keysToNumbers:()=>k1,mapObjectByObject:()=>xd,mapObjectKeys:()=>cs,mapObjectShallow:()=>fs,mergeObjects:()=>F1,prettyPrintEntries:()=>D1,recordChildren:()=>Ha,recordEntriesDepthFirst:()=>ol,recordEntryPrettyPrint:()=>Ed,traceRecordEntryByPath:()=>Dd});const Ad=(e,r=null,i=new WeakSet,o="")=>{if(e===null)return e;if(typeof e!="object")throw TypeError(`Param 'value' must be an object. Got type: ${typeof e}`);i.add(e);let a=Object.entries(e);for(let n of a)if(!(n[1]===null||typeof n[1]!="object")){if(i.has(n[1])){n[1]=r;continue}n[1]=Ad(n[1],r,i,`${n[0]}.`)}return Object.fromEntries(a)},Mt=e=>typeof e=="string"?e:JSON.stringify(e),jf=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw TypeError("Symbol cannot be converted to string");try{return JSON.stringify(e)}catch(r){if(typeof e=="object")return JSON.stringify(Ad(e,"(circular)"));throw r}},M1=(e,r)=>e===r?0:e>r?1:-1,P1=(e,r)=>{if(e===void 0&&r===void 0)return 0;if(e===void 0)return 1;if(r===void 0)return-1;let i=jf(e),o=jf(r);return i<o?-1:i>o?1:0},Ao=(e,r)=>typeof e=="number"&&typeof r=="number"?M1(e,r):P1(e,r),Rf=e=>{if(typeof e=="string")return e;let r=new Set;return JSON.stringify(e,(i,o)=>(r.add(i),o)),JSON.stringify(e,[...r].sort())},Y=(e,r)=>e===r,Cd=(e,r)=>e===r?!0:Mt(e)===Mt(r),al=(e,r)=>e===r?!0:Rf(e)===Rf(r),Sd=(e,r,i)=>JSON.stringify(e)===JSON.stringify(r);var N1={};A(N1,{addObjectEntriesMutate:()=>xa,addValue:()=>sl,addValueMutate:()=>Nd,addValueMutator:()=>ll,deleteByValueCompareMutate:()=>$d,filterValues:()=>fl,findBySomeKey:()=>nl,findEntryByPredicate:()=>Md,findEntryByValue:()=>Pd,findValue:()=>dl,fromIterable:()=>Td,fromObject:()=>zd,getClosestIntegerKey:()=>Fd,getOrGenerate:()=>hl,getOrGenerateSync:()=>Id,hasAnyValue:()=>cl,hasKeyValue:()=>kd,mapToArray:()=>Vd,mapToObjectTransform:()=>Od,mergeByKey:()=>Ld,some:()=>oo,sortByValue:()=>Bd,sortByValueProperty:()=>ul,toArray:()=>wa,toObject:()=>Rd,transformMap:()=>jd,zipKeyValue:()=>Co});const Fd=(e,r)=>{if(r=Math.round(r),e.has(r))return r;{let i=1;for(;i<1e3;){if(e.has(r-i))return r-i;if(e.has(r+i))return r+i;i++}throw Error(`Could not find target ${r.toString()}`)}},nl=(e,r)=>{for(let i of r)if(e.has(i))return e.get(i)},kd=(e,r,i,o=Y)=>e.has(r)?[...e.values()].some(n=>o(n,i)):!1,$d=(e,r,i=Y)=>{for(let o of e.entries())i(o[1],r)&&e.delete(o[0])},Md=(e,r)=>{for(let i of e.entries())if(r(i[1],i[0]))return i},Pd=(e,r,i=Y)=>{for(let o of e.entries())if(i(o[1],r))return o},Nd=(e,r,i,...o)=>{let a=e??new Map;return ll(a,r,i)(...o),a},sl=(e,r,i,...o)=>{let a=e===void 0?new Map:new Map(e);for(let n of o){let s=r(n);if(i!=="overwrite"&&a.has(s)){if(i==="throw")throw Error(`Key '${s}' already in map`);if(i==="skip")continue}a.set(s,n)}return a},ll=(e,r,i="overwrite")=>(...o)=>{for(let a of o){let n=r(a);if(i!=="overwrite"&&e.has(n)){if(i==="throw")throw Error(`Key '${n}' already in map`);if(i==="skip")continue}e.set(n,a)}return e},Bd=(e,r)=>{let i=r??Ao;return[...e.entries()].sort((o,a)=>i(o[1],a[1]))},ul=(e,r,i)=>{let o=i===void 0?Ao:i;return[...e.entries()].sort((a,n)=>{let s=a[1],l=n[1];return o(s[r],l[r])})},cl=(e,r,i)=>[...e.entries()].some(a=>i(a[1],r));function*fl(e,r){for(let i of e.values())r(i)&&(yield i)}const wa=e=>[...e.values()],Td=(e,r=Mt,i="overwrite")=>{let o=new Map;for(let a of e){let n=r(a);if(o.has(n)){if(i==="throw")throw Error(`Key '${n}' is already used and new data will overwrite it. `);if(i==="skip")continue}o.set(n,a)}return o},zd=e=>{let r=new Map;if(Array.isArray(e))for(let i of e)xa(r,i);else xa(r,e);return r},xa=(e,r)=>{let i=Object.entries(r);for(let[o,a]of i)e.set(o,a)},dl=(e,r)=>[...e.values()].find(i=>r(i)),oo=(e,r)=>[...e.values()].some(i=>r(i)),Od=(e,r)=>[...e].reduce((i,[o,a])=>{let n=r(a);return i[o]=n,i},{}),Co=(e,r)=>{if(e.length!==r.length)throw Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((i,o)=>[i,r[o]]))},jd=(e,r)=>new Map(Array.from(e,i=>[i[0],r(i[1],i[0])])),Rd=e=>[...e].reduce((r,[i,o])=>(r[i]=o,r),{}),Vd=(e,r)=>[...e.entries()].map(i=>r(i[0],i[1])),Ld=(e,...r)=>{let i=new Map;for(let o of r)for(let[a,n]of o){let s=i.get(a);s=s?e(s,n):n,i.set(a,s)}return i},Id=(e,r)=>(i,o)=>{let a=e.get(i);return a===void 0&&(a=r(i,o),e.set(i,a)),a},hl=(e,r)=>async(i,o)=>{let a=e.get(i);if(a!==void 0)return a;if(a=await r(i,o),a===void 0)throw Error("fn returned undefined");return e.set(i,a),a};var B1={};A(B1,{applyChanges:()=>T1,compareData:()=>eo,getField:()=>qd,getPaths:()=>z1,getPathsAndData:()=>ps,updateByPath:()=>pl});const Vf=(e,r)=>{if(e===void 0)throw Error("Param 'target' is undefined");if(e===null)throw Error("Param 'target' is null");if(typeof e!="object")throw Error(`Param 'target' is not an object (got: ${typeof e})`);if(r){let i=[];for(let o in e){let a=e[o];Ga(a)&&i.push([o,a])}return i}else return Object.entries(e)};function*eo(e,r,i={}){if(e===void 0){yield{path:i.pathPrefix??"",value:r,state:"added"};return}if(r===void 0){yield{path:i.pathPrefix??"",previous:e,value:void 0,state:"removed"};return}let o=i.asPartial??!1,a=i.skipInstances??new WeakSet,n=i.undefinedValueMeansRemoved??!1,s=i.pathPrefix??"",l=i.deepEntries??!1,u=i.eq??Sd,c=i.includeMissingFromA??!1,f=i.includeParents??!1;if(it(e)&&it(r)){e!==r&&(yield{path:s,value:r,previous:e,state:"change"});return}if(it(r)){yield{path:s,value:r,previous:e,state:"change"};return}let d=Vf(e,l),h=new Set;for(let[p,y]of d){h.add(p);let g=p in r,m=r[p];if(typeof y=="object"&&y){if(a.has(y))continue;if(a.add(y),g){if(m===void 0)throw Error(`Pathed.compareData Value for key ${p} is undefined`);{let v=[...eo(y,m,{...i,skipInstances:a,pathPrefix:s+p+"."})];if(v.length>0){for(let D of v)yield D;f&&(yield{path:s+p,value:r[p],previous:y,state:"change"})}}}else{if(o)continue;yield{path:s+p,value:void 0,previous:y,state:"removed"}}}else{let v=s+p;if(g)m===void 0&&n?yield{path:v,previous:y,value:void 0,state:"removed"}:u(y,m,v)||(yield{path:v,previous:y,value:m,state:"change"});else{if(o)continue;yield{path:v,previous:y,value:void 0,state:"removed"}}}}if(c){let p=Vf(r,l);for(let[y,g]of p)h.has(y)||(yield{path:s+y,previous:void 0,value:g,state:"added"})}}const T1=(e,r)=>{for(let i of r)e=pl(e,i.path,i.value);return e},pl=(e,r,i,o=!1)=>{if(r===void 0)throw Error("Parameter 'path' is undefined");if(typeof r!="string")throw Error(`Parameter 'path' should be a string. Got: ${typeof r}`);if(e===void 0)throw Error("Parameter 'target' is undefined");if(e===null)throw Error("Parameter 'target' is null");let a=r.split(".");return ds(e,a,i,o)},ds=(e,r,i,o)=>{if(r.length===0){if(o)return i;if(Array.isArray(e)&&!Array.isArray(i))throw Error(`Expected array value, got: '${JSON.stringify(i)}'. Set allowShapeChange=true to ignore.`);if(!Array.isArray(e)&&Array.isArray(i))throw Error(`Unexpected array value, got: '${JSON.stringify(i)}'. Set allowShapeChange=true to ignore.`);if(typeof e!=typeof i)throw Error(`Cannot reassign object type. (${typeof e} -> ${typeof i}). Set allowShapeChange=true to ignore.`);if(typeof e=="object"&&!Array.isArray(e)){let s=bd(e,i);if(s.a.length>0)throw Error(`New value is missing key(s): ${s.a.join(",")}`);if(s.b.length>0)throw Error(`New value cannot add new key(s): ${s.b.join(",")}`)}return i}let a=r.shift();if(!a)return i;if(Ud(a)&&Array.isArray(e)){let s=Number.parseInt(a);if(s>=e.length&&!o)throw Error(`Array index ${s.toString()} is outside of the existing length of ${e.length.toString()}. Use allowShapeChange=true to permit this.`);let l=[...e];return l[s]=ds(l[s],r,i,o),l}else if(a in e){let s={...e};return s[a]=ds(s[a],r,i,o),s}else throw Error(`Path ${a} not found in data`)},qd=(e,r,i=".")=>{if(typeof r!="string")throw Error(`Param 'path' ought to be a string. Got: '${typeof r}'`);if(r.length===0)throw Error("Param string 'path' is empty");if(e===void 0)throw Error("Param 'object' is undefined");if(e===null)throw Error("Param 'object' is null");let o=r.split(i);return hs(e,o,r)},hs=(e,r,i)=>{if(e===void 0)return{success:!1,error:`Param 'object' is undefined. Position: ${i}`};if(r.length===0)return{success:!1,error:`Path has been exhausted. position: ${i}`};let o=r.shift();if(!o)return{success:!1,error:`Unexpected empty split path. Position: ${i}`};if(Ud(o)&&Array.isArray(e)){let n=Number.parseInt(o);return e[n]===void 0?{success:!1,error:`Index '${n}' does not exist. Length: ${e.length}. Position: ${i}`}:r.length===0?{value:e[n],success:!0}:hs(e[n],r,r.join("."))}else return typeof e=="object"&&o in e?r.length===0?{value:e[o],success:!0}:hs(e[o],r,r.join(".")):{success:!1,error:`Path '${o}' not found. Position: ${i}`}};function*z1(e,r=!1){if(e==null)return;let i=ol(e);for(let o of i){if(o.nodeValue===void 0&&r)continue;let a=o.name;o.ancestors.length>0&&(a=o.ancestors.join(".")+"."+a),yield a}}function*ps(e,r=!1,i=2**53-1,o=""){e!=null&&(yield*_d(e,o,r,i))}function*_d(e,r,i=!1,o){if(!(o<=0)&&typeof e=="object")for(let a of Object.entries(e)){let n=(r.length>0?r+".":"")+a[0],s=a[1];(i&&typeof s!="object"||!i)&&(yield{path:n,value:s}),yield*_d(s,n,i,o-1)}}const Yt=(e,r,i={})=>{let o=R(r,0);w(G(o,"positive","interval"));let a=i.fireBeforeWait??!1,n=i.onStartCalled,s=i.signal,l=!1,u="idle",c=0,f=0,d=performance.now(),h=r??0,p=!1,y,g=()=>{y!==void 0&&(globalThis.clearTimeout(y),y=void 0,c=0,d=NaN)},m=x=>{o===0?typeof requestAnimationFrame>"u"?y=globalThis.setTimeout(x,0):(y=void 0,requestAnimationFrame(x)):y=globalThis.setTimeout(x,o)},v=()=>{p||(p=!0,u!=="idle"&&(u="idle",g()))},D=async()=>{if(s?.aborted&&(u="idle"),u==="idle")return;u="running",c++,f++;let x=e(c,performance.now()-d),k=typeof x=="object"?await x:x;if(!p){if(u="scheduled",k!==void 0&&!k){v();return}p||m(D)}},B=()=>{if(l)throw Error("Disposed");if(p=!1,n!==void 0)switch(n(c,performance.now()-d)){case"cancel":v();return;case"reset":V();return;case"dispose":l=!0,v();return}u==="idle"&&(c=0,d=performance.now(),u="scheduled",a?D():m(D))},V=()=>{if(l)throw Error("Disposed");p=!1,c=0,d=NaN,u!=="idle"&&v(),B()};return{start:B,reset:V,cancel:v,get interval(){return h},get runState(){return u},get startCountTotal(){return f},get startCount(){return c},set interval(x){let k=R(x,0);w(G(k,"positive","interval")),o=k,h=x},get isDisposed(){return l},get elapsedMs(){return performance.now()-d}}},So=e=>typeof e=="string"?e:JSON.stringify(e),Nr=()=>{let e=performance.now();return()=>performance.now()-e},O1=()=>{let e=performance.now();return()=>{let r=performance.now(),i=r-e;return e=r,i}},j1=()=>()=>1/0;function*R1(e,r="."){for(;e.length>0;){yield e;let i=Ka(e,r);if(i===e)break;e=i}}function*V1(e,r="."){for(;e.length>0;){yield e;let i=Wd(e,r,{ifNoMatch:"original",fromEnd:!0});if(i===e)break;e=i}}const L1=(e,r=15)=>{if(w(G(r,"aboveZero","maxLength")),typeof e!="string")throw Error("Parameter 'source' is not a string");if(e.length>r&&e.length>3){if(r>15){let i=Math.round((r-2)/2);return e.slice(0,i)+"..."+e.slice(-i)}return e.slice(0,r)+"..."}return e},Ea=(e,r=20)=>e===void 0?"(undefined)":e===null?"(null)":L1(JSON.stringify(e),r),Da=(e,r,i=0,o=e.length-1)=>{for(let a=i;a<=o;a++)if(e.codePointAt(a)===r)return a;return-1},Aa=(e,r,i)=>e.slice(0,r)+e.slice(r+i),I1=(e,r)=>{if(w(G(r,"aboveZero","length")),e===null)throw Error("source parameter null");if(typeof e!="string")throw TypeError("source parameter not a string");let i=Math.ceil(e.length/r),o=[],a=0;for(let n=0;n<i;n++)o.push(e.slice(a,a+r)),a+=r;return o},Wd=(e,r,i={})=>Gd(e,r,i)[0],Ka=(e,r,i={})=>Gd(e,r,i)[1],Gd=(e,r,i={})=>{if(e===void 0)throw Error("Param 'source' is undefined");let o=i.fallback,a=i.ifNoMatch??(o?"fallback":"original");if(a==="original"&&(o=e),a==="fallback"&&o===void 0)throw Error("Fallback must be provided");let n=i.startPos??void 0,s=i.fromEnd??!1,l=s?e.lastIndexOf(r,n):e.indexOf(r,n);if(l<0&&a==="throw")throw Error(`Match '${r}' not found in source.`);return l<0&&a==="original"?[e,e]:l<0&&a==="fallback"?[o,o]:[e.slice(0,l),e.slice(Math.max(0,l+r.length))]},q1=e=>{let r=o=>o.replaceAll(/([!$()*+./:=?[\\\]^{|}])/g,"\\$1");e=e.split("*").map(o=>r(o)).join(".*"),e="^"+e+"$";let i=new RegExp(e);return o=>i.test(o)},Ud=e=>{if(e===void 0)return!1;if(typeof e=="string"){let r=Number.parseInt(e);return Number.isNaN(r)?!1:r.toString()===e.toString()}return typeof e=="number"?Number.isNaN(e)||!Number.isFinite(e)?!1:Math.round(e)===e:!1},Jd=(e,r,i=Y)=>{let o=[],a=[],n=[];for(let l of e){let u=!1;for(let c of r)if(i(l,c)){u=!0;break}u?o.push(l):a.push(l)}for(let l of r){let u=!1;for(let c of e)i(l,c)&&(u=!0);u||n.push(l)}let s=a.length===0&&n.length===0;return{shared:o,isSame:s,a,b:n}},na=(e,r=!1)=>i=>{let o=i.toSorted((a,n)=>Ao(a[e],n[e]));return r?o.reverse():o},_1=e=>{switch(e){case"value":return na(1,!1);case"value-reverse":return na(1,!0);case"key":return na(0,!1);case"key-reverse":return na(0,!0);default:throw Error(`Unknown sorting value '${e}'. Expecting: value, value-reverse, key or key-reverse`)}};function W1(e,r,i){w(G(e,"positive","decimalPlaces"));let o=typeof r=="boolean"?r:!1,a;if(e===0)a=Math.round;else{let n=10**e;a=o?s=>Math.ceil(s*n)/n:s=>Math.floor(s*n)/n}return typeof r=="number"?a(r):a}function R(e,r){if(G1(e)){if(typeof e=="number")return e;let i=e.millis??0;return i+=(e.hours??0)*60*60*1e3,i+=(e.mins??0)*60*1e3,i+=(e.secs??0)*1e3,i}else{if(r!==void 0)return r;throw Error(`Not a valid interval: ${JSON.stringify(e)}`)}}function G1(e){if(e==null)return!1;if(typeof e=="number")return!(Number.isNaN(e)||!Number.isFinite(e));if(typeof e!="object")return!1;let r="millis"in e,i="secs"in e,o="mins"in e,a="hours"in e;return r&&!C(e.millis).success||i&&!C(e.secs).success||o&&!C(e.mins).success||a&&!C(e.hours).success?!1:!!(r||i||a||o)}const Hd=(e,r=2)=>{let i=0;if(typeof e=="function"){let a=e();return Hd(a)}else typeof e=="number"?i=e:typeof e=="object"&&(i=R(i));let o=R(i);return o===void 0?"(undefined)":o<1e3?`${W1(r,o)}ms`:(o/=1e3,o<120?`${o.toFixed(1)}secs`:(o/=60,o<60?`${o.toFixed(2)}mins`:(o/=60,`${o.toFixed(2)}hrs`)))},U1=()=>{let e=new Set;return r=>{if(r===null)throw TypeError("Param 'value' cannot be null");if(r===void 0)throw TypeError("Param 'value' cannot be undefined");return e.has(r)?!1:(e.add(r),!0)}},J1=(e,r)=>new Promise(i=>{let o=(...a)=>{e.removeEventListener(r,o),Array.isArray(a)&&a.length===1?i(a[0]):i(a)};e.addEventListener(r,o)}),yl=e=>typeof e!="object"||!e?!1:"on"in e&&"onValue"in e,Kd=e=>yl(e)?"last"in e&&e.last()!==void 0:!1,H1=(e,r)=>(i,o)=>{let a=e.get(i);return a===void 0&&(a=r(i,o),e.set(i,a)),a},Xr=(e,r="log",i)=>o=>{o===void 0?o="(undefined)":typeof o=="object"&&(o=JSON.stringify(o));let a=i??e;switch(r){case"log":console.log(`%c${e} ${o}`,`color: ${Qd(a)}`);break;case"warn":console.warn(e,o);break;case"error":console.error(e,o);break}},ys=(e,r=!0,i)=>r?{log:Xr(e,"log",i),warn:Xr(e,"warn",i),error:Xr(e,"error",i)}:{log:o=>{},warn:Xr(e,"warn",i),error:Xr(e,"error",i)},gl=(e,r={})=>{if(e===void 0||typeof e=="boolean"&&!e)return a=>{};let i=r.category??"",o=r.kind??void 0;return typeof e=="boolean"?a=>{let n=typeof a=="string"?{msg:a}:a,s=n.kind??o,l=n.category??i,u=n.msg;switch(l&&(u=`[${l}] ${u}`),s){case"error":console.error(u);break;case"warn":console.warn(u);break;case"info":console.info(u);break;default:console.log(u)}}:e};let K1=0;const Qd=H1(new Map,()=>`hsl(${++K1*137.508},50%,75%)`),Q1=(e=!0,r=500)=>{let i=0,o=0,a=performance.now();return()=>{if(i++>=r){let n=performance.now()-a;a=performance.now(),i=0,o=Math.floor(r/n*1e3),e&&console.log(`fps: ${o}`)}return o}},st=e=>typeof e=="string"?e:e instanceof Error?e.message:e;var Z1={};A(Z1,{fpsCounter:()=>Q1,getErrorMessage:()=>st,logColours:()=>Qd,logSet:()=>ys,logger:()=>Xr,resolveLogOption:()=>gl});async function X1(e,...r){if(typeof e=="object")if("next"in e){let i=e[Symbol.toStringTag];if(i==="Generator"||i=="Array Iterator"){let o=e.next();return"done"in o&&"value"in o?o.value:o}else if(i==="AsyncGenerator"){let o=await e.next();return"done"in o&&"value"in o?o.value:o}else throw Error(`Object has 'next' prop, but does not have 'AsyncGenerator', 'Generator' or 'Array Iterator' string tag symbol. Got: '${i}'`)}else if(yl(e)){if(Kd(e))return e.last();throw Error("Reactive does not have last value")}else return e;else return typeof e=="function"?await e(r):e}function Zd(e,...r){if(typeof e=="object")if("next"in e){let i=e[Symbol.toStringTag];if(i==="Generator"||i=="Array Iterator"){let o=e.next();return"done"in o&&"value"in o?o.value:o}else throw Error(i==="AsyncGenerator"?"resolveSync cannot work with an async generator":`Object has 'next' prop, but does not have 'Generator' or 'Array Iterator' string tag symbol. Got: '${i}'`)}else if(yl(e)){if(Kd(e))return e.last();throw Error("Reactive does not have last value")}else return e;else return typeof e=="function"?e(r):e}function Y1(e,r,...i){let o=!1,a=r.value,n=r.overrideWithLast;if(a===void 0)throw Error("Needs a fallback value");try{let s=Zd(e,...i);return s===void 0||typeof s=="number"&&Number.isNaN(s)?a:(n&&(a=s),s)}catch(s){return o||(o=!0,console.warn("resolveWithFallbackSync swallowed an error. Additional errors not reported.",st(s))),a}}(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});const Ee=e=>{let r=R(e,1),i=e.signal,o=e.value;return w(C(r,"positive","timeoutMs")),r===0?new Promise(a=>requestAnimationFrame(n=>{a(o)})):new Promise((a,n)=>{let s=()=>{clearTimeout(l),i?(i.removeEventListener("abort",s),n(Error(i.reason))):n(Error("Cancelled"))};i&&i.addEventListener("abort",s);let l=setTimeout(()=>{if(i?.removeEventListener("abort",s),i?.aborted){n(Error(i.reason));return}a(o)},r)})};var Xd=class Yd extends Array{#e;#t;constructor(r=0){super(),w(G(r,"positive","capacity")),this.#e=r,this.#t=0}add(r){let i=Yd.from(this);return i[this.#t]=r,i.#e=this.#e,this.#e>0?i.#t=this.#t+1===this.#e?0:this.#t+1:i.#t=this.#t+1,i}get pointer(){return this.#t}get isFull(){return this.#e===0?!1:this.length===this.#e}};const Z=e=>typeof e!="object"||!e?!1:Symbol.asyncIterator in e,pi=e=>typeof e!="object"||!e?!1:Symbol.iterator in e;function*eh(e,r=0,i=1/0){if(i<r)throw Error("Param 'end' should be more than 'start'");if(r<0)throw Error("Param 'start' should be at least 0");let o=0;for(let a of e){if(o<r){o++;continue}if(o>i)break;yield a,o++}}function th(e,r,i){for(let o of e)i=r(i,o);return i}var rh={};A(rh,{asCallback:()=>oh,chunks:()=>ah,chunksOverlapping:()=>rE,concat:()=>nh,dropWhile:()=>sh,equals:()=>uh,every:()=>ch,fill:()=>fh,filter:()=>hh,find:()=>ph,first:()=>tE,flatten:()=>yh,forEach:()=>dh,fromArray:()=>Qa,fromIterable:()=>wh,last:()=>ml,map:()=>bl,max:()=>gh,min:()=>mh,next:()=>iE,reduce:()=>th,repeat:()=>oE,slice:()=>eh,some:()=>bh,toArray:()=>xh,unique:()=>gs,uniqueByValue:()=>ih,until:()=>lh,yieldNumber:()=>eE,zip:()=>vh});function*ih(e,r=Mt,i=new Set){for(let o of e){let a=r(o);i.has(a)||(i.add(a),yield o)}}function oh(e,r,i){for(let o of e)r(o);i&&i()}function eE(e,r){return()=>{let i=e.next().value;return i===void 0?r:i}}function tE(e){for(let r of e)return r}function ml(e){let r;for(let i of e)r=i;return r}function*rE(e,r){if(r<=1)throw Error("Size should be at least 2");let i=[];for(let o of e)i.push(o),i.length===r&&(yield i,i=[i.at(-1)]);i.length<=1||i.length>0&&(yield i)}function*ah(e,r){let i=[];for(let o of e)i.push(o),i.length===r&&(yield i,i=[]);i.length>0&&(yield i)}function*nh(...e){for(let r of e)yield*r}function*sh(e,r){for(let i of e)r(i)||(yield i)}const lh=(e,r)=>{for(let i of e){let o=r();if(typeof o=="boolean"&&!o)break}},iE=e=>()=>{let r=e.next();if(!r.done)return r.value};function uh(e,r,i){for(;;){let o=e.next(),a=r.next();if(i!==void 0){if(!i(o.value,a.value))return!1}else if(o.value!==a.value)return!1;if(o.done??a.done)return o.done&&a.done}}function ch(e,r){for(let i of e)if(!r(i))return!1;return!0}function*fh(e,r){for(let i of e)yield r}function dh(e,r){for(let i of e){let o=r(i);if(typeof o=="boolean"&&!o)break}}function*hh(e,r){for(let i of e)r(i)&&(yield i)}function ph(e,r){for(let i of e)if(r(i))return i}function*yh(e){for(let r of e)if(typeof r=="object"){if(Array.isArray(r))for(let i of r)yield i;else if(pi(r))for(let i of r)yield i}else yield r}function*bl(e,r){for(let i of e)yield r(i)}function*gh(e,r=(i,o)=>i>o){let i;for(let o of e){if(i===void 0){i=o,yield i;continue}r(o,i)&&(i=o,yield i)}return i}function*mh(e,r=(i,o)=>i>o){let i;for(let o of e)i===void 0&&(i=o,yield i),r(i,o)&&(i=o,yield i)}function bh(e,r){for(let i of e)if(r(i))return!0;return!1}function*oE(e,r){let i=typeof r=="number"?r:1/0,o=typeof r=="number"?void 0:r,a=i;for(;;){for(let n of e())if(yield n,o?.aborted)break;if(Number.isFinite(i)&&(a--,a===0)||o?.aborted)break}}function*gs(e){let r=[],i=[];i=Array.isArray(e)?e:[e];for(let o of i)for(let a of o)r.includes(a)||(r.push(a),yield a)}function*vh(...e){let r=e.map(i=>i[Symbol.iterator]());for(;;){let i=r.map(o=>o.next());if(i.some(o=>o.done))return;yield i.map(o=>o.value)}}function*wh(e){for(let r of e)yield r}function xh(e,r={}){let i=[],o=Date.now(),a=r.while,n=r.limit??1/0,s=R(r.elapsed,1/0);for(let l of e){if(a&&!a(i.length)||i.length>=n||Date.now()-o>s)break;i.push(l)}return i}function*Qa(e){for(let r of e)yield r}const aE=(e,r)=>{e.debug&&console.log(`queue:${r}`)},Eh=(e,r,i)=>{let o=r.length+i.length,a=e.capacity??o,n=o-a,s=e.discardPolicy??"additions";switch(s){case"additions":return r.length===0?i.slice(0,i.length-n):r.length===e.capacity?r:[...r,...i.slice(0,n-1)];case"newer":if(n>=r.length)return r.length===0?[...i.slice(0,a-1),i.at(-1)]:i.slice(Math.max(0,i.length-a),Math.min(i.length,a)+1);{let l=Math.max(1,i.length-r.length),u=i.slice(i.length-l,i.length);return[...r.slice(0,Math.min(r.length,a-1)),...u]}case"older":return[...r,...i].slice(n);default:throw Error(`Unknown overflow policy ${s}`)}},vl=(e,r,...i)=>{if(e===void 0)throw Error("opts parameter undefined");let o=r.length+i.length,a=e.capacity&&o>e.capacity,n=a?Eh(e,r,i):[...r,...i];if(e.capacity&&n.length!==e.capacity&&a)throw Error(`Bug! Expected return to be at capacity. Return len: ${n.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&n.length!==o)throw Error(`Bug! Return length not expected. Return len: ${n.length} expected: ${o} opts: ${JSON.stringify(e)}`);return n},wl=(e,r)=>{if(r.length===0)throw Error("Queue is empty");return r.slice(1)},Ca=(e,r)=>r[0],xl=(e,r)=>r.length===0,El=(e,r)=>e.capacity?r.length>=e.capacity:!1;var nE=class{#e=new Map;get(e){let r=this.#e.get(e);return r?[...r]:[]}size(e){let r=this.#e.get(e);return r?r.length:0}*iterateKey(e){let r=this.#e.get(e);r&&(yield*r.values())}*iterateValues(){for(let e of this.#e.keys())yield*this.iterateKey(e)}*iterateKeys(){yield*this.#e.keys()}addKeyedValues(e,...r){let i=this.#e.get(e);i||(i=[],this.#e.set(e,i)),i.push(...r)}deleteKeyValue(e,r){let i=this.#e.get(e);if(!i)return!1;let o=i.filter(a=>a!==r);return o.length===i.length?!1:(this.#e.set(e,o),!0)}clear(){this.#e.clear()}},Ze=class{#e=new nE;#t=!1;dispose(){this.#t||this.clearEventListeners()}get isDisposed(){return this.#t}fireEvent(e,r){if(this.#t)throw Error("Disposed");for(let i of this.#e.iterateKey(e))i(r,this)}addEventListener(e,r){if(this.#t)throw Error("Disposed");this.#e.addKeyedValues(e,r)}removeEventListener(e,r){this.#t||this.#e.deleteKeyValue(e,r)}clearEventListeners(){this.#t||this.#e.clear()}},sE={};A(sE,{SimpleEventEmitter:()=>Ze});var lt=class extends Ze{options;data;eq;constructor(e={},r=[]){if(super(),e===void 0)throw Error("opts parameter undefined");this.options=e,this.data=r,this.eq=e.eq??Y}clear(){let e=[...this.data];this.data=[],this.fireEvent("removed",{finalData:this.data,removed:e}),this.onClear()}onClear(){}at(e){if(e>=this.data.length)throw Error("Index outside bounds of queue");let r=this.data.at(e);if(r===void 0)throw Error("Index appears to be outside range of queue");return r}enqueue(...e){this.data=vl(this.options,this.data,...e);let r=this.data.length;return this.onEnqueue(this.data,e),r}onEnqueue(e,r){this.fireEvent("enqueue",{added:r,finalData:e})}dequeue(){let e=Ca(this.options,this.data);if(e!==void 0)return this.data=wl(this.options,this.data),this.fireEvent("dequeue",{removed:e,finalData:this.data}),this.onRemoved([e],this.data),e}onRemoved(e,r){this.fireEvent("removed",{removed:e,finalData:r})}removeWhere(e){let r=this.data.length,i=this.data.filter(o=>e(o));return i.length===0?0:(this.data=this.data.filter(o=>!e(o)),this.onRemoved(i,this.data),r-this.data.length)}toArray(){return[...this.data]}get isEmpty(){return xl(this.options,this.data)}get isFull(){return El(this.options,this.data)}get length(){return this.data.length}get peek(){return Ca(this.options,this.data)}};function Dh(e={},...r){return new lt({...e},[...r])}const Ah=(e,r,i)=>{let o=r.length+i.length,a=e.discardPolicy??"additions",n=e.capacity??o,s=o-n;switch(e.debug&&console.log(`Stack.push: stackLen: ${r.length} potentialLen: ${o} toRemove: ${s} policy: ${a}`),a){case"additions":return e.debug&&console.log(`Stack.push:DiscardAdditions: stackLen: ${r.length} slice: ${o-n} toAddLen: ${i.length}`),r.length===e.capacity?r:[...r,...i.slice(0,i.length-s)];case"newer":return s>=r.length?i.slice(Math.max(0,i.length-n),Math.min(i.length,n)+1):(e.debug&&console.log(` from orig: ${JSON.stringify(r.slice(0,r.length-s))}`),[...r.slice(0,r.length-s),...i.slice(0,Math.min(i.length,n-s+1))]);case"older":return[...r,...i].slice(s);default:throw Error(`Unknown discard policy ${a}`)}},Dl=(e,r,...i)=>{let o=r.length+i.length;return e.capacity&&o>e.capacity?Ah(e,r,i):[...r,...i]},Al=(e,r)=>{if(r.length===0)throw Error("Stack is empty");return r.slice(0,-1)},Sa=(e,r)=>r.at(-1),Cl=(e,r)=>r.length===0,Sl=(e,r)=>e.capacity?r.length>=e.capacity:!1;var Ir=class{opts;data;constructor(e={},r=[]){this.opts=e,this.data=r}push(...e){return e.length===0||(this.data=Dl(this.opts,this.data,...e)),this.data.length}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}pop(){let e=Sa(this.opts,this.data);return this.data=Al(this.opts,this.data),e}get isEmpty(){return Cl(this.opts,this.data)}get isFull(){return Sl(this.opts,this.data)}get peek(){return Sa(this.opts,this.data)}get length(){return this.data.length}};const lE=(e={},...r)=>new Ir({...e},[...r]),Fl=(e,r,i=al,o)=>{let a=Ch(e,r,i),n=uE(e,r,i),s={valueChanged:!a,a:e,b:r,added:n.added,removed:n.removed,childChanged:!1},l={value:s,childrenStore:[],parent:o},u=n.identical.map(f=>Fl(f[0],f[1],i,l)),c=Lf(s)||u.some(f=>Lf(f.value));return jh(l,u),l.toString=()=>Sh(l,0),l.value.childChanged=c,kh(l),l},Lf=e=>e===void 0?!1:!!(e.valueChanged||e.childChanged||e.added.length>0||e.removed.length>0),uE=(e,r,i=al)=>{let o=[...e.children()],a=[...r.children()],n=[],s=[];for(let u of o){let c=-1;for(let[f,d]of a.entries())if(Ch(u,d,i)){n.push([u,d]),c=f;break}c===-1?s.push(u):a.splice(c,1)}return{added:[...a],identical:n,removed:s}},Ch=(e,r,i)=>!!(e.getIdentity()===r.getIdentity()||i(e.getValue(),r.getValue())),sa=e=>JSON.stringify(e.getValue()),Sh=(e,r=0)=>{if(e===void 0)return"(undefined)";let i=cE(e.value,r);for(let o of e.childrenStore)i+=Sh(o,r+2);return i},cE=(e,r)=>{let i=" ".repeat(r);if(e===void 0)return`${i}(undefined)`;let o=[];if(o.push(`a: ${sa(e.a)} b: ${sa(e.b)}`),e.valueChanged?o.push(`Value changed. Child changed: ${e.childChanged}`):o.push(`Value unchanged. Child changed: ${e.childChanged}`),e.added.length>0){o.push("Added:");for(let a of e.added)o.push(" - "+sa(a))}if(e.removed.length>0){o.push(`Removed: ${e.removed.length}`);for(let a of e.removed)o.push(" - "+sa(a))}return o.push(`----
`),o.map(a=>i+a).join(`
`)};var Fh={};A(Fh,{add:()=>Tl,addValue:()=>ka,asDynamicTraversable:()=>ai,breadthFirst:()=>Ml,children:()=>pE,childrenLength:()=>xE,childrenValues:()=>yE,compare:()=>fE,computeMaxDepth:()=>vE,createNode:()=>ko,depthFirst:()=>hE,findAnyChildByValue:()=>bE,findChildByValue:()=>mE,findParentsValue:()=>Nh,followValue:()=>Rh,fromPlainObject:()=>zh,getRoot:()=>Nl,hasAnyChild:()=>Za,hasAnyParent:()=>Fa,hasChild:()=>$h,hasParent:()=>Bh,nodeDepth:()=>gE,parents:()=>Fo,parentsValues:()=>Ph,queryByValue:()=>Mh,queryParentsValue:()=>Bl,remove:()=>$l,root:()=>Xa,rootWrapped:()=>wE,setChildren:()=>jh,stripParentage:()=>kl,throwTreeTest:()=>kh,toStringDeep:()=>zl,treeTest:()=>Pl,value:()=>EE,wrap:()=>At});const fE=(e,r,i)=>Fl(ai(e),ai(r),i),kl=e=>({value:e.value,childrenStore:e.childrenStore.map(i=>kl(i))}),ar=e=>"wraps"in e?e.wraps:e,dE=e=>"wraps"in e?e:At(e),At=e=>({*children(){for(let r of e.childrenStore)yield At(r)},getValue:()=>e.value,getIdentity:()=>e,*queryValue(r){for(let i of Mh(r,ar(e)))yield At(i)},*queryParentsValue(r,i,o){for(let a of Bl(ar(r),i,o))yield At(a)},*parentsValues(r){yield*Ph(ar(r))},findParentsValue(r,i,o){let a=Nh(r,i,o);if(a!==void 0)return At(a)},getParent:()=>e.parent===void 0?void 0:At(e.parent),hasParent:r=>Bh(e,ar(r)),hasAnyParent:r=>Fa(e,ar(r)),hasChild:r=>$h(ar(r),e),hasAnyChild:r=>Za(ar(r),e),remove:()=>{$l(e)},addValue:r=>{let i=ka(r,e);return At(i)},add:r=>(Tl(ar(r),e),dE(r)),wraps:e}),$l=e=>{let r=e.parent;r!==void 0&&(e.parent=void 0,r.childrenStore=Ua(r.childrenStore,e))};function*hE(e){if(!Xa)return;let r=new Ir;r.push(...e.childrenStore);let i=r.pop();for(;i&&(yield i,i&&r.push(...i.childrenStore),!r.isEmpty);)i=r.pop()}function*Ml(e){if(!e)return;let r=new lt;r.enqueue(...e.childrenStore);let i=r.dequeue();for(;i&&(yield i,i&&r.enqueue(...i.childrenStore),!r.isEmpty);)i=r.dequeue()}function Pl(e,r=[]){if(e.parent===e)return[!1,"Root has itself as parent",e];if(r.includes(e))return[!1,"Same node instance is appearing further in tree",e];if(r.push(e),cd(e.childrenStore))return[!1,"Children list contains duplicates",e];for(let i of e.childrenStore){if(i.parent!==e)return[!1,"Member of childrenStore does not have .parent set",i];if(Za(e,i))return[!1,"Child has parent as its own child",i];let o=Pl(i,r);if(!o[0])return o}return[!0,"",e]}function kh(e){let r=Pl(e);if(!r[0])throw Error(`${r[1]} Node: ${Ea(r[2].value,30)}`,{cause:r[2]})}function*pE(e){for(let r of e.childrenStore)yield r}function*yE(e){for(let r of e.childrenStore)r.value!==void 0&&(yield r.value)}function*Fo(e){let r=e.parent;for(;r;)yield r,r=r.parent}function gE(e){return[...Fo(e)].length}const $h=(e,r)=>{for(let i of r.childrenStore)if(i===e)return!0;return!1},mE=(e,r,i=Y)=>{for(let o of r.childrenStore)if(i(e,o.value))return o};function*Mh(e,r,i=Y){for(let o of r.childrenStore)i(e,o.value)&&(yield o)}const Za=(e,r)=>{for(let i of Ml(r))if(i===e)return!0;return!1},bE=(e,r,i=Y)=>{for(let o of Ml(r))if(i(o.value,e))return o},Nl=e=>e.parent?Nl(e.parent):e,Fa=(e,r)=>{for(let i of Fo(e))if(i===r)return!0;return!1};function*Ph(e){for(let r of Fo(e))r.value!==void 0&&(yield r.value);return!1}function*Bl(e,r,i=Y){for(let o of Fo(e))o.value!==void 0&&i(o.value,r)&&(yield o);return!1}function Nh(e,r,i=Y){for(let o of Bl(e,r,i))return o}const Bh=(e,r)=>e.parent===r,vE=e=>Th(e,0),Th=(e,r=0)=>{let i=r;for(let o of e.childrenStore)i=Math.max(i,Th(o,r+1));return i},Tl=(e,r)=>{Oh(e,r);let i=e.parent;r.childrenStore=[...r.childrenStore,e],e.parent=r,i&&(i.childrenStore=Ua(i.childrenStore,e))},ka=(e,r)=>ko(e,r),Xa=e=>ko(e),zh=(e,r="",i,o=[])=>{let a=Object.entries(e);i=i===void 0?Xa():ka({label:r,value:e},i);for(let n of a){let s=n[1];o.includes(s)||(o.push(s),typeof n[1]=="object"?zh(s,n[0],i,o):ka({label:n[0],value:s},i))}return i},wE=e=>At(ko(e)),ko=(e,r)=>{let i={childrenStore:[],parent:r,value:e};return r!==void 0&&(r.childrenStore=[...r.childrenStore,i]),i},xE=e=>e.childrenStore.length,EE=e=>e.value,ai=e=>({*children(){for(let i of e.childrenStore)yield ai(i)},getParent(){if(e.parent!==void 0)return ai(e.parent)},getValue(){return e.value},getIdentity(){return e}}),Oh=(e,r)=>{if(r===e)throw Error("Cannot add self as child");if(e.parent!==r){if(Fa(r,e))throw Error("Child contains parent (1)",{cause:e});if(Fa(e,r))throw Error("Parent already contains child",{cause:e});if(Za(r,e))throw Error("Child contains parent (2)",{cause:e})}},jh=(e,r)=>{for(let i of r)Oh(i,e);e.childrenStore=[...r];for(let i of r)i.parent=e},zl=(e,r=0)=>{let i=`${"  ".repeat(r)} + ${e.value?JSON.stringify(e.value):"-"}`;return e.childrenStore.length>0?i+`
`+e.childrenStore.map(o=>zl(o,r+1)).join(`
`):i};function*Rh(e,r,i=1){for(let o of e.childrenStore){let a=o.value;a!==void 0&&r(a,i)&&(yield o.value,yield*Rh(o,r,i+1))}}var Vh={};A(Vh,{asDynamicTraversable:()=>Ol,children:()=>yi,create:()=>jl,createSimplified:()=>FE,createWrapped:()=>SE,depthFirst:()=>qh,getByPath:()=>CE,prettyPrint:()=>Lh,prettyPrintEntries:()=>DE,toStringDeep:()=>Ih,traceByPath:()=>_h});function DE(e){if(e.length===0)return"(empty)";let r="";for(let[i,o]of e.entries())r+="  ".repeat(i),r+=o.name+" = "+JSON.stringify(o.leafValue)+`
`;return r}const Lh=(e,r=0,i={})=>{w(Zt(e,"node"));let o=i.name??"node",a=kE(e,o),n=`${"  ".repeat(r)} + name: ${a.name} value: ${JSON.stringify(a.leafValue)}`,s=[...yi(e,i)];return s.length>0?n+`
`+s.map(l=>Lh(l.leafValue,r+1,{...i,name:l.name})).join(`
`):n},Ih=(e,r=0)=>{let i=" ".repeat(r)+` ${e.value?.name}`;if(e.value!==void 0){if("sourceValue"in e.value&&"leafValue"in e.value){let o=Ea(e.value.sourceValue,20),a=Ea(e.value.leafValue,20);o=o===a?"":"source: "+o,i+=` = ${a} ${o}`}else"sourceValue"in e.value&&e.value.sourceValue!==void 0&&(i+=` = ${e.value.sourceValue}`);"ancestors"in e.value&&(i+=` (ancestors: ${e.value.ancestors.join(", ")})`)}i+=`
`;for(let o of e.childrenStore)i+=Ih(o,r+1);return i};function*yi(e,r={}){w(Zt(e,"node"));let i=r.filter??"none",o=a=>i==="none"?[!0,it(a)]:i==="leaves"&&it(a)?[!0,!0]:i==="branches"&&!it(a)?[!0,!1]:[!1,it(a)];if(Array.isArray(e))for(let[a,n]of e.entries()){let s=o(n);s[0]&&(yield{name:a.toString(),_kind:"entry",sourceValue:n,leafValue:s[1]?n:void 0})}else if(typeof e=="object"){let a="entries"in e?e.entries():Object.entries(e);for(let[n,s]of a){let[l,u]=o(s);l&&(yield{name:n,_kind:"entry",sourceValue:s,leafValue:u?s:void 0})}}}function*qh(e,r={},i=[]){for(let o of yi(e,r))yield{...o,ancestors:[...i],_kind:"entry-ancestors"},yield*qh(o.sourceValue,r,[...i,o.name])}function AE(e,r){for(let i of yi(r))if(i.name===e)return i}function CE(e,r,i={}){let o=ml(_h(e,r,i));if(!o)throw Error(`Could not trace path: ${e} `);return o}function*_h(e,r,i={}){w(Zt(e,"path"),Zt(r,"node"));let o=i.separator??".",a=e.split(o),n=[];for(let s of a){let l=AE(s,r);if(!l){yield{name:s,sourceValue:void 0,leafValue:void 0,ancestors:n,_kind:"entry-ancestors"};return}r=l.sourceValue,yield{...l,ancestors:[...n],_kind:"entry-ancestors"},n.push(s)}}const Ol=(e,r={},i=[],o)=>{let a=r.name??"object",n={*children(){for(let{name:s,sourceValue:l,leafValue:u}of yi(e,r))yield Ol(l,{...r,name:s},[...i,a],n)},getParent(){return o},getValue(){return{name:a,sourceValue:e,ancestors:i,_kind:"entry-static"}},getIdentity(){return e}};return n},SE=(e,r)=>At(jl(e,r)),jl=(e,r={})=>{let i=r.valuesAtLeaves??!1;return Wh(e,(i?a=>{if(it(a))return a}:a=>a)(e),r,[])},Wh=(e,r,i={},o)=>{let a=i.name??"object_ci",n=Xa({name:a,sourceValue:r,ancestors:[...o],_kind:"entry-static"});o=[...o,a];for(let s of yi(e,i)){let l=i.valuesAtLeaves?s.leafValue:s.sourceValue;Tl(Wh(s.sourceValue,l,{...i,name:s.name},o),n)}return n},FE=(e,r={})=>kl(jl(e,r));function kE(e,r=""){return"name"in e&&"leafValue"in e&&"sourceValue"in e?{name:e.name,_kind:"entry",leafValue:e.leafValue,sourceValue:e.sourceValue}:"name"in e?{name:e.name,leafValue:e,sourceValue:e,_kind:"entry"}:{name:r,leafValue:e,sourceValue:e,_kind:"entry"}}var Gh={};A(Gh,{addValueByPath:()=>Uh,childrenLengthByPath:()=>ME,clearValuesByPath:()=>Hh,create:()=>$E,removeByPath:()=>Jh,valueByPath:()=>Kh,valuesByPath:()=>Vl});const $E=(e={})=>{let r;return{getRoot:()=>r,add:(h,p)=>{let y=Uh(h,p,r,e);r===void 0&&(r=Nl(y))},prettyPrint:()=>r===void 0?"(empty)":zl(r),remove:h=>r===void 0?!1:Jh(h,r,e),getValue:h=>{if(r!==void 0)return Kh(h,r,e)},getValues:h=>r===void 0?[]:Vl(h,r,e),hasPath:h=>r===void 0?!1:ii(h,r,e)!==void 0,childrenLength:h=>{if(r===void 0)return 0;let p=ii(h,r,e);return p===void 0?0:p.childrenStore.length},getNode:h=>r===void 0?void 0:ii(h,r,e),clearValues:h=>r===void 0?!1:Hh(h,r,e)}},Uh=(e,r,i,o={})=>{let a=o.separator??".",n=o.duplicates??"overwrite",s=r.split(a),l=0;for(let u of s){let c=l===s.length-1,f=Rl(u,i);if(f===void 0)i=ko({value:c?e:void 0,label:u},i);else if(i=f,c)switch(n){case"ignore":break;case"allow":{let d=Qh(i);i.value={values:[...d,e],label:u};break}case"overwrite":i.value={value:e,label:u};break}else i=f;l++}if(i===void 0)throw Error("Could not create tree");return i},Jh=(e,r,i={})=>{if(r===void 0)return!1;let o=ii(e,r,i);return o===void 0?!1:($l(o),!0)},Hh=(e,r,i={})=>{if(r===void 0)return!1;let o=ii(e,r,i);return o===void 0?!1:(o.value={label:o.value?.label??"",value:void 0},!0)},ME=(e,r,i={})=>{if(r===void 0)return 0;let o=ii(e,r,i);return o===void 0?0:o.childrenStore.length},Rl=(e,r)=>{if(r!==void 0){if(e===void 0)throw Error("Parameter 'label' cannot be undefined");if(r.value?.label===e)return r;for(let i of r.childrenStore)if(i.value?.label===e)return i}},Kh=(e,r,i={})=>{let o=Vl(e,r,i);if(o.length!==0){if(o.length>1)throw Error("Multiple values at path. Use getValues instead");return o[0]}},Qh=e=>e.value===void 0?[]:"values"in e.value?e.value.values:"value"in e.value?e.value.value===void 0?[]:[e.value.value]:[],ii=(e,r,i={})=>{let o=i.separator??".",a=e.split(o),n=r;for(let s of a)if(n=Rl(s,n),n===void 0)return;return n},Vl=(e,r,i={})=>{let o=i.separator??".",a=e.split(o),n=r;for(let s of a)if(n=Rl(s,n),n===void 0)return[];return Qh(n)};var Zh={};A(Zh,{breadthFirst:()=>gi,childrenLength:()=>PE,couldAddChild:()=>zE,depthFirst:()=>_l,find:()=>LE,findAnyChildByValue:()=>VE,findAnyParentByValue:()=>TE,findByValue:()=>IE,findChildByValue:()=>e0,findParentByValue:()=>ql,followValue:()=>t0,hasAnyChild:()=>ms,hasAnyChildValue:()=>OE,hasAnyParent:()=>NE,hasAnyParentValue:()=>BE,hasChild:()=>Xh,hasChildValue:()=>Yh,hasParent:()=>Ll,hasParentValue:()=>Il,parents:()=>RE,siblings:()=>jE,toString:()=>qE,toStringDeep:()=>r0});const PE=e=>[...e.children()].length,NE=(e,r,i)=>Ll(e,r,i,2**53-1),BE=(e,r,i)=>{if(e===void 0)throw TypeError("Param 'child' is undefined");return Il(e,r,i,2**53-1)},TE=(e,r,i)=>ql(e,r,i,2**53-1),Ll=(e,r,i=Y,o=0)=>{if(o<0)return!1;let a=Br(e),n=Br(r),s=a?e.getParent():e.parent;if(s===void 0)return!1;if(i(s,r))return!0;let l=a?s.getIdentity():s.value,u=n?r.getIdentity():r.value;return i(l,u)?!0:Ll(s,r,i,o-1)},Il=(e,r,i=Y,o=0)=>{if(e===void 0)throw Error("Param 'child' is undefined");if(o<0)return!1;let a="getParent"in e?e.getParent():e.parent;if(a===void 0)return!1;let n="getValue"in a?a.getValue():a.value;return i(n,r)?!0:Il(a,r,i,o-1)},ql=(e,r,i=Y,o=0)=>{if(o<0)return;let a="getParent"in e?e.getParent():e.parent;if(a===void 0)return;let n="getValue"in a?a.getValue():a.value;return i(n,r)?a:ql(a,r,i,o-1)},zE=(e,r,i=Y)=>{if(i(e,r))throw Error("Child equals parent");if(ms(e,r,i))throw Error("Circular. Parent already has child");if(ms(r,e,i))throw Error("Prospective child has parent as child relation")},ms=(e,r,i=Y)=>Xh(e,r,i,2**53-1),OE=(e,r,i=Y)=>Yh(e,r,i,2**53-1),Xh=(e,r,i=Y,o=0)=>{if(o<0)return!1;if(i(e,r))return!0;let a="getIdentity"in e?e.getIdentity():e.value,n="getIdentity"in r?r.getIdentity():r.value;if(i(a,n))return!0;for(let s of gi(e,o)){let l="getIdentity"in s?s.getIdentity():s.value;if(i(s,r)||i(l,n))return!0}return!1},Yh=(e,r,i=Y,o=0)=>{if(o<0)return!1;if(i(e.getValue(),r))return!0;for(let a of gi(e,o)){let n=a.getValue();if(i(n,r))return!0}return!1};function*jE(e){let r=e.getParent();if(r!==void 0)for(let i of r.children())i!==e&&(yield i)}function*RE(e){if(Br(e)){let r=e.getParent();for(;r!==void 0;)yield r,r=r.getParent()}else{let r=e.parent;for(;r!==void 0;)yield r,r=r.parent}}function VE(e,r,i=Y){return e0(e,r,i,2**53-1)}function e0(e,r,i=Y,o=0){if(o<0)return;let a=Br(e);if(a){if(i(e.getValue(),r))return e}else if(i(e.value,r))return e;for(let n of gi(e,o))if(a){if(i(n.getValue(),r))return n}else if(i(n.value,r))return n}function*_l(e){if(!e)return;let r=new Ir,i=e;for(;i;){let o=Br(i)?[...i.children()]:[...i.childrenStore];if(r.push(...o),r.isEmpty)break;i=r.pop(),i&&(yield i)}}function*gi(e,r=2**53-1){if(!e)return;let i=new lt,o=e;for(;o;){if(r<0)return;if(o!==void 0){let a="childrenStore"in o?o.childrenStore:o.children();for(let n of a)yield n,i.enqueue(n)}o=i.dequeue(),r--}}function LE(e,r,i="breadth"){if(r(e))return e;let o=i==="breadth"?gi:_l;for(let a of o(e))if(r(a))return a}function IE(e,r,i="breadth"){if(r(e.getValue()))return e;let o=i==="breadth"?gi:_l;for(let a of o(e))if(r(a.getValue()))return a}function*t0(e,r,i=1){for(let o of e.children())r(o.getValue(),i)&&(yield o.getValue(),yield*t0(o,r,i+1))}function r0(e,r=0){if(e===void 0)return"(undefined)";if(e===null)return"(null)";let i=e.getValue(),o=typeof i;Array.isArray(i)&&(o="array");let a="  ".repeat(r)+`value: ${JSON.stringify(i)} (${o})
`;for(let n of e.children())a+=r0(n,r+1);return a}function qE(...e){let r="";for(let i of e){let o=i.getValue(),a=Ea(o),n=[...i.children()],s=i.getParent(),l=typeof o;Array.isArray(o)&&(l="array"),r+=`value: ${a} (${l}) kids: ${n.length} parented: ${s?"y":"n"}
`}return r}var i0={};A(i0,{FromObject:()=>Vh,Mutable:()=>Fh,Pathed:()=>Gh,Traverse:()=>Zh,compare:()=>Fl,isTraversable:()=>Br,isTreeNode:()=>o0,toTraversable:()=>_E});const _E=e=>{if(Br(e))return e;if(o0(e))return ai(e);if(typeof e=="object")return Ol(e);throw Error("Parameter 'node' not convertible")},o0=e=>!!("parent"in e&&"childrenStore"in e&&"value"in e&&Array.isArray(e.childrenStore)),Br=e=>"children"in e&&"getParent"in e&&"getValue"in e&&"getIdentity"in e;var ao=class bs{opts;data;constructor(r={},i=[]){this.opts=r,this.data=i}push(...r){return new bs(this.opts,Dl(this.opts,this.data,...r))}pop(){return new bs(this.opts,Al(this.opts,this.data))}forEach(r){this.data.forEach(r)}forEachFromTop(r){[...this.data].reverse().forEach(r)}get isEmpty(){return Cl(this.opts,this.data)}get isFull(){return Sl(this.opts,this.data)}get peek(){return Sa(this.opts,this.data)}get length(){return this.data.length}};const WE=(e={},...r)=>new ao({...e},[...r]);var a0={};A(a0,{StackImmutable:()=>ao,StackMutable:()=>Ir,immutable:()=>WE,isEmpty:()=>Cl,isFull:()=>Sl,mutable:()=>lE,peek:()=>Sa,pop:()=>Al,push:()=>Dl,trimStack:()=>Ah});const n0=e=>new Wl(e);var Wl=class extends Ze{store=new Map;keyString;constructor(e){super(),this.keyString=e??So}get size(){return this.store.size}add(...e){let r=!1;for(let i of e){let o=this.has(i);this.store.set(this.keyString(i),i),super.fireEvent("add",{value:i,updated:o}),o||(r=!0)}return r}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(e){let r=this.store.delete(this.keyString(e));return r&&super.fireEvent("delete",e),r}has(e){return this.store.has(this.keyString(e))}toArray(){return[...this.store.values()]}},Gl=class vs{store;keyString;constructor(r,i){this.store=i??new Map,this.keyString=r??So}get size(){return this.store.size}add(...r){let i=new Map(this.store);for(let o of r){let a=this.keyString(o);i.set(a,o)}return new vs(this.keyString,i)}delete(r){let i=new Map(this.store),o=this.keyString(r);return i.delete(o)?new vs(this.keyString,i):this}has(r){let i=this.keyString(r);return this.store.has(i)}toArray(){return[...this.store.values()]}*values(){yield*this.store.values()}};const GE=(e=Mt)=>new Gl(e);var UE=class s0{#e;#t;children=new Map;values=[];constructor(r=1,i=0){this.#e=i,this.#t=r}sizeLocal(){return this.values.length}sizeChildren(){return[...this.children.values()].length}sizeChildrenDeep(){let r=this.sizeChildren();for(let i of this.children.values())r+=i.sizeChildrenDeep();return r}size(){let r=this.values.length;for(let i of this.children.values())r+=i.size();return r}add(r){if(typeof r!="string")throw Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw Error("Param 'value' is empty");let i=this.#i(r,!0);if(i===this){this.hasLocal(r)||this.values.push(r);return}if(!i)throw Error(`Could not create child set for: ${r}`);i.add(r)}remove(r){if(typeof r!="string")throw Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw Error("Param 'value' is empty");let i=this.#i(r,!1);return i===void 0?!1:i===this?this.hasLocal(r)?(this.values=this.values.filter(o=>o!==r),!0):!1:i.remove(r)}debugDump(){let r=this.#r();for(let i of r)console.log(i)}#r(r=0){let i=[];i.push(`Depth: ${this.#e} Max: ${this.#t}`);for(let[o,a]of this.children.entries()){let n=a.#r(r+1);i.push(` key: ${o}`);for(let s of n)i.push(" ".repeat(r+1)+s)}i.push(`Values: (${this.values.length})`);for(let o of this.values)i.push(` ${o}`);return i.map(o=>" ".repeat(r)+o)}#i(r,i){if(r===void 0)throw Error("Param 'value' undefined");if(this.#e===this.#t||r.length<=this.#e)return this;let o=r[this.#e];if(o===void 0)throw Error(`Logic error. Depth: ${this.#e} Len: ${r.length}`);let a=this.children.get(o);return a===void 0&&i&&(a=new s0(this.#t,this.#e+1),this.children.set(o,a)),a}hasLocal(r){for(let i of this.values)if(i===r)return!0;return!1}has(r){if(typeof r!="string")return!1;let i=this.#i(r,!1);return i===void 0?!1:i===this?this.hasLocal(r):i.has(r)}},l0={};A(l0,{MassiveSet:()=>UE,SetStringImmutable:()=>Gl,SetStringMutable:()=>Wl,immutable:()=>GE,mutable:()=>n0});var u0={};A(u0,{asCallback:()=>S0,chunks:()=>c0,concat:()=>f0,dropWhile:()=>d0,equals:()=>p0,every:()=>y0,fill:()=>g0,filter:()=>m0,find:()=>b0,flatten:()=>v0,forEach:()=>w0,fromArray:()=>Ul,fromIterable:()=>Jl,last:()=>x0,map:()=>E0,max:()=>D0,min:()=>A0,nextWithTimeout:()=>Hl,reduce:()=>C0,repeat:()=>JE,slice:()=>F0,some:()=>k0,toArray:()=>Ya,unique:()=>ws,uniqueByValue:()=>$0,until:()=>h0,withDelay:()=>HE,zip:()=>M0});async function*Ul(e,r=1){for(let i of e)yield i,await Ee(r)}async function*Jl(e,r=1){for await(let i of e)yield i,await Ee(r)}async function*c0(e,r){let i=[];for await(let o of e)i.push(o),i.length===r&&(yield i,i=[]);i.length>0&&(yield i)}async function*f0(...e){for await(let r of e)yield*r}async function*d0(e,r){for await(let i of e)r(i)||(yield i)}const h0=async(e,r)=>{for await(let i of e){let o=await r();if(typeof o=="boolean"&&!o)break}},JE=async function*(e,r){let i=typeof r=="number"?r:1/0,o=typeof r=="number"?void 0:r,a=i;for(;;){for await(let n of e())if(yield n,o?.aborted)break;if(Number.isFinite(i)&&(a--,a===0)||o?.aborted)break}};async function p0(e,r,i){let o=e[Symbol.asyncIterator](),a=r[Symbol.asyncIterator]();for(;;){let n=await o.next(),s=await a.next();if(i!==void 0){if(!i(n.value,s.value))return!1}else if(n.value!==s.value)return!1;if(n.done??s.done)return n.done&&s.done}}async function y0(e,r){for await(let i of e)if(!await r(i))return!1;return!0}async function*g0(e,r){for await(let i of e)yield r}async function*m0(e,r){for await(let i of e)await r(i)&&(yield i)}async function b0(e,r){for await(let i of e)if(await r(i))return i}async function*v0(e){for await(let r of e)if(typeof r=="object"){if(Array.isArray(r))for(let i of r)yield i;else if(Z(r))for await(let i of r)yield i;else if(pi(r))for(let i of r)yield i}else yield r}const w0=async function(e,r,i={}){let o=i.interval;if(Array.isArray(e))for(let a of e){let n=await r(a);if(typeof n=="boolean"&&!n)break;o&&await Ee(o)}else for await(let a of e){let n=await r(a);if(typeof n=="boolean"&&!n)break;o&&await Ee(o)}};async function x0(e,r={}){let i=r.abort,o;for await(let a of e){if(i?.aborted)return;o=a}return o}async function*E0(e,r){for await(let i of e)yield r(i)}async function*D0(e,r=(i,o)=>i>o){let i;for await(let o of e){if(i===void 0){i=o,yield i;continue}r(o,i)&&(i=o,yield o)}}async function*A0(e,r=(i,o)=>i>o){let i;for await(let o of e){if(i===void 0){i=o,yield i;continue}r(i,o)&&(i=o,yield o)}return i}async function C0(e,r,i){for await(let o of e)i=r(i,o);return i}async function S0(e,r,i){for await(let o of e)r(o);i&&i()}async function*F0(e,r=0,i=1/0){console.log(`Async slice start: ${r}`);let o=e[Symbol.asyncIterator]();if(i<r)throw Error("Param 'end' should be more than 'start'");for(;r>0;r--,i--)await o.next();for await(let a of e)if(i-- >0)yield a;else break}async function*HE(e,r){for(let i of e)await Ee(r),yield i}async function Hl(e,r){let i=R(r,1e3),o=await Promise.race([(async()=>{await Ee({millis:i,signal:r.signal})})(),(async()=>await e.next())()]);if(o===void 0)throw Error("Timeout");return o}async function k0(e,r){for await(let i of e)if(await r(i))return!0;return!1}async function Ya(e,r={}){let i=[],o=e[Symbol.asyncIterator](),a=Date.now(),n=r.limit??1/0,s=r.while,l=R(r.elapsed,1/0);for(;i.length<n&&Date.now()-a<l&&!(s&&!s(i.length));){let u=await o.next();if(u.done)break;i.push(u.value)}return i}async function*ws(e){let r=[],i=Array.isArray(e)?e:[e];for await(let o of i)for await(let a of o)r.includes(a)||(r.push(a),yield a)}async function*$0(e,r=Mt,i=new Set){for await(let o of e){let a=r(o);i.has(a)||(i.add(a),yield o)}}async function*M0(...e){let r=e.map(i=>i[Symbol.asyncIterator]());for(;;){let i=await Promise.all(r.map(o=>o.next()));if(i.some(o=>o.done))return;yield i.map(o=>o.value)}}function xs(e){return"_type"in e?e._type==="GenFactoryNoInput":!1}function*KE(e){yield e}async function*QE(e){yield e,await Ee(1)}function fe(e){if(Array.isArray(e)){let r=e.values();return r._name="arrayInput",r}else{if(typeof e=="number"||typeof e=="boolean"||typeof e=="string")return KE(e);if(typeof e=="function")return e()}return e}function Kl(e){if(e!==void 0)return Array.isArray(e)?Ul(e):typeof e=="number"||typeof e=="boolean"||typeof e=="string"?QE(e):typeof e=="function"?e():Z(e)?e:Jl(e)}function ZE(e){if(typeof e=="string"){let r=document.querySelector(e);if(!r)throw Error(`Element not found '${e}'`);return r}return e}var P0={};A(P0,{perValue:()=>YE,query:()=>eD});const XE=e=>{let r=e??(o=>o),i=new Map;return{has(o){return i.has(r(o))},get(o){return i.get(r(o))},set(o,a){i.set(r(o),a)},entries(){return i.entries()},delete(o){i.delete(o)}}};function YE(e={}){let r=e.byReference,i=e.tagName??"div";if(r&&e.key)throw Error("byReference and key options are mutually exclusive");let o=r?void 0:e.key??Mt,a=XE(o),n=e.parentEl??document.body,s=ZE(n),l=new Set;async function*u(c){for await(let f of fe(c)){let d=a.get(f);d||(d=document.createElement(i),a.set(f,d),e.beforeInsert&&e.beforeInsert(d),s.append(d),e.afterInsert&&e.afterInsert(d)),l.add(d),yield{el:d,value:f}}for(let[f,d]of a.entries())l.has(d)||(e.beforeRemove&&e.beforeRemove(d),d.remove(),a.delete(f))}return u._name="dom.perValue",u}function eD(e={}){let r=e.baseElement??document;async function*i(o){let a=fe(o);for await(let n of a)for(let s of r.querySelectorAll(n))yield s}return i._name="dom.query",i}const Ql=()=>{let e=-9007199254740991;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o){if(typeof a!="number")break;e=Math.max(a,e)}return e}},Zl=()=>{let e=9007199254740991;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o){if(typeof a!="number")break;e=Math.min(a,e)}return e}},Xl=()=>{let e=0;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o)typeof a=="number"&&(e+=a);return e}},Yl=()=>{let e=0,r=0;return o=>{let a=Array.isArray(o)?o:[o];for(let n of a)typeof n=="number"&&(r++,e+=n);return e/r}},eu=e=>{let r=0;return o=>(e&&Array.isArray(o)?r+=o.length:r++,r)};function tu(e,r={}){let i=r.includeType,o=r.emitEqualRanked??!1,a=r.emitRepeatHighest??!1,n;return s=>{if(!(i&&typeof s!==i)){if(n===void 0)return n=s,n;{let l=e(s,n);if(l=="a")return n=s,n;if(l==="eq"&&o||a)return n}}}}var N0={};A(N0,{average:()=>W0,chunk:()=>U0,debounce:()=>R0,delay:()=>j0,drop:()=>H0,duration:()=>O0,filter:()=>J0,max:()=>I0,min:()=>L0,rank:()=>q0,rankArray:()=>_0,reduce:()=>z0,sum:()=>G0,take:()=>T0,tally:()=>V0,transform:()=>B0});function B0(e){async function*r(i){i=fe(i);for await(let o of i)yield e(o)}return r._name="transform",r}function T0(e){async function*r(i){i=fe(i);let o=0;for await(let a of i){if(++o>e)break;yield a}}return r._name="take",r}function z0(e){async function*r(i){i=fe(i);for await(let o of i)yield e(o)}return r._name="reduce",r}function O0(e){let r=R(e,0);async function*i(o){o=fe(o);let a=Nr();for await(let n of o){if(a()>r)break;yield n}}return i._name="duration",i}function j0(e){let r=R(e.before,0),i=R(e.after,0);async function*o(a){a=fe(a);for await(let n of a)r>0&&await Ee(r),yield n,i>0&&await Ee(i)}return o._name="delay",o}function R0(e){let r=R(e,0);async function*i(o){o=fe(o);let a=Nr();for await(let n of o)a()<r||(yield n,a=Nr())}return i._name="debounce",i}function V0(e=!0){async function*r(i){i=fe(i);let o=eu(e);for await(let a of i)yield o(a)}return r._name="tally",r}function L0(){async function*e(r){r=fe(r);let i=Zl();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="min",e}function I0(){async function*e(r){r=fe(r);let i=Ql();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="max",e}function q0(e,r={}){async function*i(o){o=fe(o);let a=tu(e,r);for await(let n of o){let s=a(n);s!==void 0&&(yield s)}}return i._name="rank",i}function _0(e,r={}){let i=r.includeType,o=r.emitEqualRanked??!1,a=r.emitRepeatHighest??!1,n=r.withinArrays??!1;async function*s(l){l=fe(l);let u;for await(let c of l){let f=!1;n&&(u=void 0);for(let d of c)if(!(i&&typeof d!==i))if(u===void 0)u=d,f=!0;else{let h=e(d,u);h=="a"?(u=d,f=!0):(h==="eq"&&o||a)&&(f=!0)}f&&u&&(yield u)}}return s._name="rankArray",s}function W0(){async function*e(r){r=fe(r);let i=Yl();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="average",e}function G0(){async function*e(r){r=fe(r);let i=Xl();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="total",e}function U0(e,r=!0){w(G(e,"aboveZero","size"));async function*i(o){o=fe(o);let a=[];for await(let n of o)a.push(n),a.length>=e&&(yield a,a=[]);r&&a.length>0&&(yield a)}return i._name="chunk",i}function J0(e){async function*r(i){i=fe(i);for await(let o of i)e(o)&&(yield o)}return r._name="filter",r}function H0(e){async function*r(i){i=fe(i);for await(let o of i)e(o)||(yield o)}return r._name="drop",r}function tD(e,r=5){async function*i(){for(let o of e)await Ee(r),yield o}return i._name="fromArray",i._type="GenFactoryNoInput",i}function rD(e,r){async function*i(){for(;;)yield await J1(e,r)}return i._name="event",i._type="GenFactoryNoInput",i}function K0(e){async function*r(){for(;;){let i=await e();if(i===void 0)break;yield i}}return r._name="fromFunction",r._type="GenFactoryNoInput",r}function iD(e){async function*r(){for await(let i of e)yield i}return r._name="fromIterable",r._type="GenFactoryNoInput",r}function oD(e){let r=R(e.interval,0),i=e.asClockTime??!1,o=e.loops??2**53-1,a=0,n=R(e.elapsed,2**53-1);async function*s(){let l=Nr();for(;a<o&&l()<n;){yield i?Date.now():l();let u=a*r-l();await Ee(Math.max(0,r+u)),a++}}return s._name="timestamp",s._type="GenFactoryNoInput",s}var Q0={};A(Q0,{array:()=>tD,event:()=>rD,func:()=>K0,iterable:()=>iD,timestamp:()=>oD});async function aD(e,r){let i=typeof r=="function"?r():r;for await(let o of i)e.push(o)}async function nD(e,r={}){let i=typeof e=="function"?e():e;return Ya(i,r)}async function sD(e,r,i){let o=typeof e=="function"?e():e;for await(let a of o)r(a);i&&i()}function lD(e){let r,i=typeof e=="function"?e():e;async function o(){let a=await i.next();if(!a.done)return r=a.value,r}return o}function uD(e,r){let i=r,o=!1,a=typeof e=="function"?e():e;function n(){return o||(o=!0,a.next().then(s=>{i=s.value,o=!1}).catch(s=>{throw o=!1,s})),i}return n}async function*Z0(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=r.afterEmit??"last",n=e.map((f,d)=>({waiting:void 0,index:d,gen:fe(f),done:!1,lastValue:void 0})),s=()=>!n.some(f=>!f.done),l=()=>n.some(f=>f.waiting!==void 0),u=f=>!f.some(d=>d!==void 0),c=[];for(;;){let f=[];for(let y of n){if(y.done)continue;if(y.waiting!==void 0){f.push(y.waiting);continue}let g=Promise.resolve((async()=>{if(y.done)return y;let m=await y.gen.next();return y.waiting=void 0,m.done?(y.done=!0,o==="undefined"&&(y.lastValue=void 0)):y.lastValue=m.value,y})());y.waiting=g,f.push(g)}let d=await Promise.race(f);if("done"in d){if(d.done&&i==="break")break}else throw Error("Missing 'done' property");let h=n.map(y=>y.lastValue);if(h.length===0)return;let p=u(h);if(p&&!l())return;if(!fd(c,h)&&!p&&(c=h,yield h),a==="undefined")for(let y of n)y.waiting===void 0&&(y.lastValue=void 0);if(s())break}}async function*X0(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=r.afterEmit??"last",n=new Map;for(let[d,h]of Object.entries(e))n.set(d,{gen:fe(h),done:!1,lastValue:void 0,waiting:void 0,key:d});let s=()=>!oo(n,d=>!d.done),l=()=>oo(n,d=>d.waiting!==void 0),u=d=>{for(let h of Object.values(d))if(h!==void 0)return!1;return!0},c=()=>{let d={};for(let[h,p]of n)d[h]=p.lastValue;return d},f;for(;;){let d=[];for(let g of n.values()){if(g.done)continue;if(g.waiting!==void 0){d.push(g.waiting);continue}let m=Promise.resolve((async()=>{if(g.done)return g;let v=await g.gen.next();return g.waiting=void 0,v.done?(g.done=!0,o==="undefined"&&(g.lastValue=void 0)):g.lastValue=v.value,g})());g.waiting=m,d.push(m)}let h=await Promise.race(d);if("done"in h){if(h.done&&i==="break")break}else throw Error("Result missing 'done' property");let p=c(),y=u(p);if(y&&!l())return;if(!al(f,p)&&!y&&(f=p,yield p),a==="undefined")for(let g of n.values())g.waiting===void 0&&(g.lastValue=void 0);if(s())break}}const If=e=>e._name??e.name;function cD(){let e=[],r,i=a=>{a===void 0&&(a=r);let n=Kl(a);for(let s of e)if(n===void 0)if(xs(s))n=s();else throw Error(`Function '${If(s)}' requires input. Provide it to the function, or call 'input' earlier.`);else n=s(n);return n},o={rankArray:(a,n)=>(e.push(_0(a,n)),o),rank:(a,n)=>(e.push(q0(a,n)),o),transform:a=>(e.push(B0(a)),o),reduce:a=>(e.push(z0(a)),o),drop:a=>(e.push(H0(a)),o),delay:a=>(e.push(j0(a)),o),duration:a=>(e.push(O0(a)),o),debounce:a=>(e.push(R0(a)),o),fromFunction:a=>(e.push(K0(a)),o),take:a=>(e.push(T0(a)),o),chunk:(a,n=!0)=>(e.push(U0(a,n)),o),filter:a=>(e.push(J0(n=>a(n))),o),min:()=>(e.push(L0()),o),max:()=>(e.push(I0()),o),average:()=>(e.push(W0()),o),sum:()=>(e.push(G0()),o),tally:a=>(e.push(V0(a)),o),input(a){return r=a,o},asGenerator:i,asAsync(a){let n=a??r;for(let s of e)if(n===void 0&&xs(s))n=s();else{if(n===void 0)throw Error(`Function '${If(s)}' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);n=s(n)}return o},asArray:async a=>{let n=i(a);return await Ya(n)},firstOutput:async a=>(await i(a).next()).value,lastOutput:async a=>{let n=i(a),s;for await(let l of n)s=l;return s}};return o}var fD=class{#e=[];enqueue(e){this.#e.push(e)}dequeue(){return this.#e.shift()}};async function*dD(...e){let r=e.map(l=>Kl(l)),i=new fD,o=0,a=async l=>{if(l===void 0){o++;return}let u=await l.next();u.done?o++:(i.enqueue(u.value),setTimeout(()=>a(l),1))};for(let l of r)setTimeout(()=>a(l),1);let n=10,s=1;for(;o<r.length;){let l=i.dequeue();l===void 0?s=Math.min(s+1,10):(yield l,s=1),await Ee(n*s)}}async function*Y0(...e){let r;for(let i of e)r=typeof i=="function"?i(r??[]):fe(i);if(r!==void 0)for await(let i of r)yield i}async function*hD(e,r,i,o,a,n,s){let l,u=arguments;for(let c of u)l=typeof c=="function"?c(l??[]):fe(c);if(l!==void 0)for await(let c of l)yield c}function pD(...e){return i=>Y0(i,...e)}async function yD(e,r){return(await e([r]).next()).value}async function*gD(e,r={}){let i=r.onSourceDone??"break",o=R(r.maximumWait,2e3),a=r.finalValue??"undefined",n=e.map(f=>({seq:0,lastValue:void 0,gen:fe(f),done:!1})),s={millis:o},l=0,u=()=>!n.some(f=>!f.done),c=!0;for(;c;){l++;for(let f of n){if(f.done){f.seq=l;continue}let d=await Hl(f.gen,s);if(d.done){if(f.done=!0,f.seq=l,a==="undefined"&&(f.lastValue=void 0),i==="break")return}else f.lastValue=d.value,f.seq=l}if(c){let f=n.filter(d=>d.seq===l).map(d=>d.lastValue);if(f.length===0||!f.some(d=>d!==void 0))return;yield f}u()&&(c=!1)}}var ep={};A(ep,{Dom:()=>P0,From:()=>Q0,Links:()=>N0,addToArray:()=>aD,asArray:()=>nD,asCallback:()=>sD,asPromise:()=>lD,asValue:()=>uD,combineLatestToArray:()=>Z0,combineLatestToObject:()=>X0,isGenFactoryNoInput:()=>xs,lazy:()=>cD,mergeFlat:()=>dD,prepare:()=>pD,resolveToAsyncGen:()=>Kl,resolveToGen:()=>fe,run:()=>hD,runN:()=>Y0,single:()=>yD,syncToArray:()=>gD});const mD=(e,r)=>{let i,o=-9007199254740991;for(let a of e){let n=r(a);n>=o&&(o=n,i=a)}return i},bD=(e,r)=>{let i,o=9007199254740991;for(let a of e){let n=r(a);n<=o&&(o=n,i=a)}return i},vD=(e,r,i)=>{let o=Jd(e,r,i);return o.a.length===0&&o.b.length===0},wD=e=>{let r=R(e.delay,10),i,o=e.onValue,a="stopped",n=Yt(async()=>{if(i){let d=await i.next();if(d.done)return a="stopped",!1;let h=o(d.value);return typeof h=="boolean"?(h||(a="stopped"),h):!0}else return a="stopped",!1},r),s=()=>{a!=="stopped"&&(i=void 0,n.cancel(),a="stopped")},l=()=>{a!=="paused"&&(n.cancel(),a="paused")},u=()=>{a!=="running"&&(i||c(),a="running",n.start())},c=()=>{if(e.iterator)i=e.iterator();else throw Error("No source iterator")};return{start:u,cancel:s,restart:()=>{c(),u()},pause:l,get state(){return a}}},xD=(e,r)=>{let i=[],o=[],a=!1,n=c=>{i.length>0?i.shift()(...c):o.push(c)},s=()=>new Promise(c=>{if(o.length>0){let f=o.shift();c(...f)}else i.push(c)}),l=(...c)=>{n(c)};return e.addEventListener(r,l),{next:async()=>a?{done:!0,value:void 0}:{done:!1,value:await s()},return:async()=>(a=!0,e.removeEventListener(r,l),{done:!0,value:void 0}),throw:async c=>(a=!0,{done:!0,value:Promise.reject(Error(c))})}},ED=(e,r)=>{let i={...e};for(let[o,a]of Object.entries(e))typeof a=="number"?i[o]=r(a):i[o]=a;return i},tp=(e,r)=>{if(!Array.isArray(e))throw TypeError(`Param 'data' is expected to be an array. Got type: ${typeof e}`);let i=r??(o=>o);return e.map((o,a)=>{if(typeof o!="number")throw TypeError(`Param 'data' contains non-number at index: '${a}'. Type: '${typeof o}' value: '${o}'`);let n=a/(e.length-1),s=i(n);if(typeof s!="number")throw TypeError(`Weighting function returned type '${typeof s}' rather than number for input: '${n}'`);return o*s})},en=e=>e.filter(r=>typeof r=="number"&&!Number.isNaN(r)),rp=e=>{let r=0,i=e[0].length;for(let o=0;o<i;o++){let a=0;for(let[n,s]of e.entries())n===0?a=s[o]:a*=s[o];r+=a}return r},ip=e=>{if(e===void 0)throw Error("data parameter is undefined");let r=en(e);return r.reduce((o,a)=>o+a,0)/r.length},DD=e=>Math.min(...en(e)),AD=e=>e.reduce((r,i,o,a)=>i>a[r]?o:r,0),ru=(...e)=>e.reduce((r,i,o,a)=>i<a[r]?o:r,0),op=e=>Math.max(...en(e)),CD=e=>e.reduce((r,i)=>typeof i!="number"||Number.isNaN(i)||!Number.isFinite(i)?r:r+i,0),iu=e=>{let r=-9007199254740991;for(let i of e)r=Math.max(r,i);return r},ap=e=>{let r=0;for(let i of e)r+=i;return r},ou=e=>{let r=-9007199254740991;for(let i of e)r=Math.min(r,i);return r},np=(e,r)=>{typeof r=="function"&&(r=tp(e,r));let i=md(e,r),[o,a]=i.reduce((n,s)=>[n[0]+s[0]*s[1],n[1]+s[1]],[0,0]);return o/a},ie=(e,r=0,i=1)=>{if(Number.isNaN(e))throw Error("Param 'value' is NaN");if(Number.isNaN(r))throw Error("Param 'min' is NaN");if(Number.isNaN(i))throw Error("Param 'max' is NaN");return e<r?r:e>i?i:e},sp=(e=0,r=1)=>{if(Number.isNaN(e))throw Error("Param 'min' is NaN");if(Number.isNaN(r))throw Error("Param 'max' is NaN");return i=>i>r?r:i<e?e:i},Es=(e,r)=>{if(!Number.isInteger(e))throw TypeError(`v parameter must be an integer (${e})`);let i=Array.isArray(r)?r.length:r;if(!Number.isInteger(i))throw TypeError(`length parameter must be an integer (${i}, ${typeof i})`);return e=Math.round(e),e<0?0:e>=i?i-1:e},SD=(...e)=>{let r=-1,i=-9007199254740991;for(let o=0;o<e.length;o++){let a=Math.abs(e[o]);a>i&&(i=a,r=o)}return e[r]};function*FD(e,r=0){if(w(G(e,"","amount"),G(r,"","offset")),e===0)return;let i=0;do yield e<0?-i+r:i+r;while(i++<Math.abs(e)-1)}const kD=(e,r="absolute")=>i=>lp(r,i,e),$D=(e="absolute",r=NaN)=>{let i=r;return o=>{let a=lp(e,o,i);return i=o,a}},lp=(e="absolute",r,i)=>{if(Number.isNaN(i))return 0;let o=r-i,a=0;if(e==="absolute")a=Math.abs(o);else if(e==="numerical")a=o;else if(e==="relative")a=Math.abs(o/i);else if(e==="relativeSigned")a=o/i;else throw TypeError(`Unknown kind: '${e}' Expected: 'absolute', 'relative', 'relativeSigned' or 'numerical'`);return a},up=e=>!(typeof e!="number"||Number.isNaN(e));function*MD(e){for(let r of e)up(r)&&(yield r)}const PD=e=>r=>r>=e,ND=(e,r)=>i=>i>=e&&i<=r,BD=e=>(typeof e=="function"&&(e=e()),w(C(e,"percentage","v")),1-e),TD=function*(e,r=0,i,o=!1){if(e<=0)throw Error("Interval is expected to be above zero");i===void 0&&(i=2**53-1);let a=r;do for(;a<i;)yield a,a+=e;while(o)},cp=function*(e,r=0,i,o=!1,a){w(C(e,"nonZero"));let n=e<0;if(i!==void 0&&(n&&r<i||!n&&r>i))throw Error(`Interval of ${e.toString()} will never go from ${r.toString()} to ${i.toString()}`);a??=1e3,i===void 0?i=2**53-1:i*=a,e*=a;do{let s=r*a;for(;!n&&s<=i||n&&s>=i;)yield s/a,s+=e}while(o)},zD=function(e=.01,r=!1,i=0,o=1){return w(C(e,"percentage","interval"),C(i,"percentage","start"),C(o,"percentage","end")),cp(e,i,o,r)};function ni(e,r,i){w(G(e,"positive","decimalPlaces"));let o=typeof r=="boolean"?r:i??!1,a;if(e===0)a=Math.round;else{let n=10**e;a=o?s=>Math.ceil(s*n)/n:s=>Math.floor(s*n)/n}return typeof r=="number"?a(r):a}function OD(e,r,i){w(C(e,"percentage","rangePercent"));let o=Math.floor(e*100),a=(n,s)=>{try{if(typeof s!="number"||Number.isNaN(s)||!Number.isFinite(s))return!1;let l=Math.abs(s-n);return Math.floor(n===0?l*100:l/n*100)<=o}catch{return!1}};return r===void 0?a:(w(C(r,"","baseValue")),i===void 0?n=>a(r,n):a(r,i))}const jD=(e,...r)=>{let i=r.map(a=>a-e),o=r.map(a=>a+e);return(...a)=>{for(let n of a)for(let s=0;s<r.length;s++)if(n>=i[s]&&n<=o[s])return!0;return!1}};var fp={};A(fp,{clamp:()=>$r,fromScalar:()=>RD,immutable:()=>Yr,scale:()=>VD,scaleUnclamped:()=>LD,toScalar:()=>dp,towardZero:()=>hp});const Yr=(e=0)=>{if(e===void 0)throw Error("Start value is undefined");let r=typeof e=="number"?e:e.value;if(r>1)throw Error("Start value cannot be larger than 1");if(r<-1)throw Error("Start value cannot be smaller than -1");if(Number.isNaN(r))throw Error("Start value is NaN");let i=r;return{[Symbol.toPrimitive](o){return o==="number"?i:o==="string"?i.toString():!0},value:i,towardZero:o=>Yr(hp(i,o)),add:o=>Yr($r(i+o)),multiply:o=>Yr($r(i*o)),inverse:()=>Yr(-i),interpolate:(o,a)=>Yr($r(xe(o,i,a))),asScalar:(o=1,a=0)=>dp(i,o,a)}},dp=(e,r=1,i=0)=>{if(typeof e!="number")throw Error(`Expected v to be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw Error("Parameter is NaN");return ut(e,-1,1,i,r)},RD=e=>(w(C(e,"percentage","v")),e*2-1),VD=(e,r,i)=>$r(Pt(r,i,-1,1)(e)),LD=(e,r,i)=>Pt(r,i,-1,1)(e),$r=e=>{if(typeof e!="number")throw Error(`Param 'bipolarValue' must be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw Error("Param 'bipolarValue' is NaN");return e>1?1:e<-1?-1:e},hp=(e,r)=>{if(typeof e!="number")throw Error(`Parameter 'v' must be a number. Got: ${typeof e}`);if(typeof r!="number")throw Error(`Parameter 'amt' must be a number. Got: ${typeof r}`);if(r<0)throw Error("Parameter 'amt' must be positive");return e<0?(e+=r,e>0&&(e=0)):e>0&&(e-=r,e<0&&(e=0)),e},pp=(e,r=0,i=360)=>(w(G(e,void 0,"v"),G(r,void 0,"min"),G(i,void 0,"max")),e===r||e===i?r:(e>0&&e<r&&(e+=r),e-=r,i-=r,e%=i,e<0&&(e=i-Math.abs(e)+r),e+r)),no=(e,r=0,i=1)=>{if(w(C(e,"","min"),C(r,"","min"),C(i,"","max")),e===r||e===i)return r;for(;(e<=r||e>=i)&&!(e===i||e===r);)e>i?e=r+(e-i):e<r&&(e=i-(r-e));return e},ID=(e,r,i,o,a)=>{let n=0,s=Math.abs(a-o),l=Math.abs(r-o+a),u=Math.abs(o+(360-a)),c=Math.min(s,l,u);return n=c===u?o-i(c):c===l?o+i(c):o>a?o-i(c):o+i(c),pp(n,e,r)},qf=Math.PI*2;function xe(e,r,i,o){let a,n="clamp",s=f=>(a&&(f=a(f)),n===void 0||n==="clamp"?f=ie(f):n==="wrap"&&(f>1?f%=1:f<0&&(f=1+f%1)),f),l=(f,d,h)=>(w(C(d,"","a"),C(h,"","b"),C(f,"","amount")),f=s(f),(1-f)*d+f*h),u=(f={})=>{if(f.transform){if(typeof f.transform!="function")throw Error(`Param 'transform' is expected to be a function. Got: ${typeof f.transform}`);a=f.transform}n=f.limits??"clamp"},c=(f,d,h)=>(1-f)*d+f*h;if(typeof e!="number")throw TypeError(`First param is expected to be a number. Got: ${typeof e}`);if(typeof r=="number"){let f,d;if(i===void 0||typeof i=="object")return f=e,d=r,u(i),h=>l(h,f,d);if(typeof i=="number")return f=r,d=i,u(o),l(e,f,d);throw Error("Values for 'a' and 'b' not defined")}else if(r===void 0||typeof r=="object"){let f=s(e);return u(r),w(C(f,"","amount")),(d,h)=>c(f,d,h)}}const qD=(e,r=0,i=1,o=0,a)=>{let n=o;return(s,l)=>{if(s!==void 0&&(i=s),l!==void 0&&(r=l),n>=1)return i;let u=xe(n,r,i,a);return n+=e,u}},yp=(e,r,i,o)=>{let a=no(i-r,0,qf);return xe(e,r,r+(a>Math.PI?a-qf:a),o)};function*gp(e,r,i,o){w(C(e,"","start"),C(r,"","end"),C(i,"","steps"));let a=o?ni(o):s=>s,n=(r-e)/(i-1);if(w(C(n,"","step")),!Number.isFinite(n))throw TypeError("Calculated step value is infinite");for(let s=0;s<i;s++){let l=e+n*s;yield a(l)}}var _D=class{#e=[];enqueue(e){this.#e.push(e)}dequeue(){return this.#e.shift()}get data(){return this.#e}get size(){return this.#e.length}};const WD=Math.PI*2,to=(e=3)=>{w(C(e,"aboveZero","scaling"));let r=0,i=0;return o=>(C(o,"","v").success&&o!==void 0&&(i++,r+=(o-r)/Math.min(i,e)),r)},GD=(e=100,r)=>{let i=new _D;return o=>{if(C(o).success&&o!==void 0)for(i.enqueue(o);i.size>e;)i.dequeue();return r===void 0?ip(i.data):np(i.data,r)}},_f=(e,r)=>{let i=WD*r*e;return i/(i+1)},Wf=(e,r,i)=>e*r+(1-e)*i,UD=(e=1,r=0,i=1)=>{let o=0,a=0,n=0;return(l,u)=>{u??=performance.now();let c=u-n,f=_f(c,i),d=(l-o)/c,h=Wf(f,d,a),p=e+r*Math.abs(h),y=_f(c,p),g=Wf(y,l,o);return o=g,a=h,n=u,g}},ut=(e,r,i,o,a,n)=>Pt(r,i,o,a,n)(e),Pt=(e,r,i,o,a,n)=>{w(C(e,"finite","inMin"),C(r,"finite","inMax"));let s=o??1,l=i??0,u=n?sp(i,o):void 0;return c=>{if(e===r)return s;let f=(c-e)/(r-e);a!==void 0&&(f=a(f));let d=f*(s-l)+l;return u?u(d):d}},JD=()=>e=>e,HD=(e,r,i,o,a,n)=>{if(a===void 0&&(a=1),o===void 0&&(o=0),r===i)return a;let s=ut(e,r,i,o,a,n);return ie(s,o,a)},KD=(e,r,i=1)=>(w(C(e,"percentage","v"),C(r,"percentage","outMin"),C(i,"percentage","outMax")),ut(e,0,1,r,i)),QD=(e,r,i)=>mp(r,i)(e),mp=(e,r)=>i=>(w(C(i,"percentage","v")),ut(i,0,1,e,r)),bp=(e,r,i=0,o=1,a=!1,n)=>{let s=Pt(e,r,i,o,n,a),l=Pt(i,o,e,r,n,a);return{out:s,in:l}},$o=(e,r={})=>{if(e.length===0)return{total:NaN,min:NaN,max:NaN,avg:NaN,count:NaN};let i=r.nonNumbers??"throw",o=0,a=2**53-1,n=-9007199254740991,s=0;for(let l=0;l<e.length;l++){let u=e[l];if(typeof u!="number"){if(i==="ignore")continue;if(i==="throw")throw Error(`Param 'data' contains a non-number at index: ${l.toString()}`);i==="nan"&&(u=NaN)}Number.isNaN(u)||(a=Math.min(a,u),n=Math.max(n,u),o+=u,s++)}return{total:o,max:n,min:a,count:s,avg:o/s}};var vp={};A(vp,{array:()=>XD,stream:()=>ZD});const ZD=(e,r)=>{let i=e??9007199254740991,o=r??-9007199254740991;return w(C(i),C(o)),a=>(w(C(a)),i=Math.min(i,a),o=Math.max(o,a),ut(a,i,o))},XD=(e,r,i)=>{if(!Array.isArray(e))throw TypeError(`Param 'values' should be an array. Got: ${typeof e}`);let o=$o(e),a=r??o.min,n=i??o.max;return e.map(s=>ie(ut(s,a,n)))},YD=(e,r)=>(typeof e=="function"&&(e=e()),typeof r=="function"&&(r=r()),w(C(e,"percentage","v"),C(r,"percentage","t")),e*r),Sr=(e,r,i=!0)=>{let o=r.toString(),a=o.indexOf("."),n=1;a>=0&&(n=10*o.substring(a+1).length,r=Math.floor(n*r),e*=n),w(C(e,"","v"),G(r,"","every"));let s=e/r,l=s%1;return s=Math.floor(s),(l===.5&&i||l>.5)&&s++,r*s/n},e2=e=>{let r=e.reduce((a,n)=>Math.max(a,n),-1/0),i=e.map(a=>Math.exp(a-r)),o=i.reduce((a,n)=>a+n);return i.map(a=>a/o)};var t2={};A(t2,{Bipolar:()=>fp,Normalise:()=>vp,applyToValues:()=>ED,average:()=>ip,averageWeighted:()=>np,clamp:()=>ie,clampIndex:()=>Es,clamper:()=>sp,count:()=>FD,differenceFromFixed:()=>kD,differenceFromLast:()=>$D,dotProduct:()=>rp,filterIterable:()=>MD,flip:()=>BD,interpolate:()=>xe,interpolateAngle:()=>yp,interpolatorStepped:()=>qD,isApprox:()=>OD,isCloseToAny:()=>jD,isValid:()=>up,linearSpace:()=>gp,max:()=>op,maxAbs:()=>SD,maxFast:()=>iu,maxIndex:()=>AD,min:()=>DD,minFast:()=>ou,minIndex:()=>ru,movingAverage:()=>GD,movingAverageLight:()=>to,noiseFilter:()=>UD,numberArrayCompute:()=>$o,numericPercent:()=>zD,numericRange:()=>cp,numericRangeRaw:()=>TD,proportion:()=>YD,quantiseEvery:()=>Sr,rangeInclusive:()=>ND,round:()=>ni,scale:()=>ut,scaleClamped:()=>HD,scalePercent:()=>QD,scalePercentages:()=>KD,scaler:()=>Pt,scalerNull:()=>JD,scalerPercent:()=>mp,scalerTwoWay:()=>bp,softmax:()=>e2,thresholdAtLeast:()=>PD,total:()=>CD,totalFast:()=>ap,validNumbers:()=>en,weight:()=>tp,wrap:()=>no,wrapInteger:()=>pp,wrapRange:()=>ID});const r2=(e,r={})=>{if(e===void 0)throw Error("Param 'data' is undefined");if(Array.isArray(e))return $o(e,r);if(pi(e))return i2(e,r);throw Error("Param 'data' is neither an array nor iterable")};function i2(e,r={}){let i=0,o=r.nonNumbers??"ignore",a=2**53-1,n=-9007199254740991,s=0;for(let l of e){if(typeof l!="number"||Number.isNaN(l)){if(o==="throw")throw TypeError(`Data contains something not a number. Got type '${typeof l}'`);if(o==="nan"&&(l=NaN),o==="ignore")continue}i+=l,s++,a=Math.min(a,l),n=Math.max(n,l)}return{avg:i/s,total:i,max:n,min:a,count:s}}function o2(e,r={}){let i=0,o=0,a=r.nonNumbers??"ignore";for(let n of e){if(typeof n!="number"||Number.isNaN(n)){if(a==="throw")throw TypeError(`Data contains something not a number. Got type '${typeof n}'`);if(a==="nan"&&(n=NaN),a==="ignore")continue}o+=n,i++}return o/i}var a2={};A(a2,{Async:()=>u0,Chains:()=>ep,Sync:()=>rh,asCallback:()=>$2,chunks:()=>l2,combineLatestToArray:()=>Z0,combineLatestToObject:()=>X0,computeAverage:()=>o2,concat:()=>f2,dropWhile:()=>n2,equals:()=>A2,every:()=>D2,fill:()=>c2,filter:()=>u2,find:()=>d2,flatten:()=>g2,forEach:()=>h2,fromArray:()=>y2,fromEvent:()=>xD,fromFunction:()=>F2,fromFunctionAwaited:()=>k2,fromIterable:()=>S2,hasEqualValuesShallow:()=>vD,isAsyncIterable:()=>Z,isIterable:()=>pi,iteratorController:()=>wD,last:()=>Qi,map:()=>p2,max:()=>ca,maxScore:()=>mD,min:()=>wp,minScore:()=>bD,numbersCompute:()=>r2,reduce:()=>b2,slice:()=>v2,some:()=>m2,toArray:()=>E2,unique:()=>w2,uniqueByValue:()=>x2,until:()=>s2,zip:()=>C2});function wp(e,r=(i,o)=>i>o){return Z(e)?A0(e,r):mh(e,r)}function ca(e,r=(i,o)=>i>o){return Z(e)?D0(e,r):gh(e,r)}function n2(e,r){return Z(e)?d0(e,r):sh(e,r)}function s2(e,r){if(Z(e))return h0(e,r);lh(e,r)}function l2(e,r){return Z(e)?c0(e,r):ah(e,r)}function u2(e,r){return Z(e)?m0(e,r):hh(e,r)}function c2(e,r){return Z(e)?g0(e,r):fh(e,r)}function f2(...e){return Z(e[0])?f0(...e):nh(...e)}function d2(e,r){return Z(e)?b0(e,r):ph(e,r)}function h2(e,r,i={}){if(Z(e))return w0(e,r,i);dh(e,r)}function p2(e,r){return Z(e)?E0(e,r):bl(e,r)}function y2(e,r){return r===void 0?Qa(e):Ul(e,r)}function g2(e){return Z(e)?v0(e):yh(e)}function m2(e,r){return Z(e)?k0(e,r):bh(e,r)}function Qi(e){return Z(e)?x0(e):ml(e)}function b2(e,r,i){return Z(e)?C0(e,r,i):th(e,r,i)}function v2(e,r=0,i=1/0){return Z(e)?F0(e,r,i):eh(e,r,i)}function w2(e){return Array.isArray(e)?e.length===0?Qa([]):Z(e[0])?ws(e):gs(e):Z(e)?ws(e):gs(e)}function*x2(e,r=Mt,i=new Set){yield*Z(e)?$0(e,r,i):ih(e,r,i)}function E2(e,r={}){return Z(e)?Ya(e,r):xh(e,r)}function D2(e,r){return Z(e)?y0(e,r):ch(e,r)}function A2(e,r,i){return Z(e)&&Z(r)?p0(e,r,i):uh(e,r,i)}function C2(...e){return e.length===0?Qa([]):Z(e[0])?M0(...e):vh(...e)}function S2(e,r){return Z(e)||r!==void 0?Jl(e,r):wh(e)}function*F2(e){for(;;)yield e()}async function*k2(e){for(;;)yield await e()}function $2(e,r,i){if(Z(e))return S0(e,r);oh(e,r)}var au=class extends lt{constructor(e={}){e.eq===void 0&&(e={...e,eq:(r,i)=>Y(r.item,i.item)}),super(e)}enqueueWithPriority(e,r){w(C(r,"positive")),super.enqueue({item:e,priority:r})}changePriority(e,r,i=!1,o){if(e===void 0)throw Error("Item cannot be undefined");let a;for(let n of this.data)if(o){if(o(n.item,e)){a=n;break}}else if(this.eq(n,{item:e,priority:0})){a=n;break}if(a===void 0&&!i)throw Error(`Item not found in priority queue. Item: ${JSON.stringify(e)}`);a!==void 0&&this.removeWhere(n=>a===n),this.enqueueWithPriority(e,r)}dequeueMax(){let e=Qi(ca(this.data,(r,i)=>r.priority>=i.priority));if(e!==void 0)return this.removeWhere(r=>r===e),e.item}dequeueMin(){let e=Qi(ca(this.data,(r,i)=>r.priority>=i.priority));if(e!==void 0)return this.removeWhere(r=>r.item===e),e.item}peekMax(){let e=Qi(ca(this.data,(r,i)=>r.priority>=i.priority));if(e!==void 0)return e.item}peekMin(){let e=Qi(wp(this.data,(r,i)=>r.priority>=i.priority));if(e!==void 0)return e.item}};function M2(e={}){return new au(e)}var tn=class Ds{opts;#e;constructor(r={},i=[]){if(r===void 0)throw Error("opts parameter undefined");this.opts=r,this.#e=i}forEach(r){for(let i=this.#e.length-1;i>=0;i--)r(this.#e[i])}forEachFromFront(r){this.#e.forEach(i=>{r(i)})}enqueue(...r){return new Ds(this.opts,vl(this.opts,this.#e,...r))}dequeue(){return new Ds(this.opts,wl(this.opts,this.#e))}get isEmpty(){return xl(this.opts,this.#e)}get isFull(){return El(this.opts,this.#e)}get length(){return this.#e.length}get peek(){return Ca(this.opts,this.#e)}toArray(){return[...this.#e]}};const P2=(e={},...r)=>(e={...e},new tn(e,[...r]));var xp={};A(xp,{PriorityMutable:()=>au,QueueImmutable:()=>tn,QueueMutable:()=>lt,debug:()=>aE,dequeue:()=>wl,enqueue:()=>vl,immutable:()=>P2,isEmpty:()=>xl,isFull:()=>El,mutable:()=>Dh,peek:()=>Ca,priority:()=>M2,trimQueue:()=>Eh});const N2=(e={})=>new Ep(e);var Ep=class extends Ze{capacity;store;evictPolicy;autoDeleteElapsedMs;autoDeletePolicy;autoDeleteTimer;disposed=!1;constructor(e={}){if(super(),this.capacity=e.capacity??-1,w(G(this.capacity,"nonZero","capacity")),this.store=new Map,e.evictPolicy&&this.capacity<=0)throw Error("evictPolicy is set, but no capacity limit is set");this.evictPolicy=e.evictPolicy??"none",this.autoDeleteElapsedMs=e.autoDeleteElapsedMs??-1,this.autoDeletePolicy=e.autoDeletePolicy??"none",this.autoDeleteElapsedMs>0&&(this.autoDeleteTimer=setInterval(()=>{this.#e()},Math.max(1e3,this.autoDeleteElapsedMs*2)))}dispose(){this.disposed||(this.disposed=!0,this.autoDeleteTimer&&(clearInterval(this.autoDeleteTimer),this.autoDeleteTimer=void 0))}get keyLength(){return this.store.size}*entries(){for(let e of this.store.entries())yield[e[0],e[1].value]}*values(){for(let e of this.store.values())yield e.value}*keys(){yield*this.store.keys()}elapsedSet(e){let r=this.store.get(e);if(r!==void 0)return Date.now()-r.lastSet}elapsedGet(e){let r=this.store.get(e);if(r!==void 0)return Date.now()-r.lastGet}has(e){return this.store.has(e)}get(e){let r=this.store.get(e);if(r)return(this.autoDeletePolicy==="either"||this.autoDeletePolicy==="get")&&this.store.set(e,{...r,lastGet:performance.now()}),r.value}delete(e){let r=this.store.get(e);if(!r)return!1;let i=this.store.delete(e);return this.fireEvent("removed",{key:e,value:r.value}),i}clear(){this.store.clear()}touch(e){let r=this.store.get(e);return r?(this.store.set(e,{...r,lastSet:Date.now(),lastGet:Date.now()}),!0):!1}findEvicteeKey(){if(this.evictPolicy==="none")return;let e="";if(this.evictPolicy==="oldestGet")e="lastGet";else if(this.evictPolicy==="oldestSet")e="lastSet";else throw Error(`Unknown eviction policy ${this.evictPolicy}`);return ul(this.store,e)[0][0]}#e(){this.autoDeletePolicy!=="none"&&this.deleteWithElapsed(this.autoDeleteElapsedMs,this.autoDeletePolicy)}deleteWithElapsed(e,r){let i=[...this.store.entries()],o=[],a=R(e,1e3),n=performance.now();for(let s of i){let l=n-s[1].lastGet,u=n-s[1].lastSet;(r==="get"?l:r==="set"?u:Math.max(l,u))>=a&&o.push([s[0],s[1].value])}for(let s of o){this.store.delete(s[0]);let l={key:s[0],value:s[1]};this.fireEvent("expired",l),this.fireEvent("removed",l)}return o}set(e,r){let i=this.store.get(e);if(i){this.store.set(e,{...i,lastSet:performance.now()});return}if(this.keyLength===this.capacity&&this.capacity>0){let o=this.findEvicteeKey();if(!o)throw Error(`ExpiringMap full (capacity: ${this.capacity})`);let a=this.store.get(o);if(this.store.delete(o),a){let n={key:o,value:a.value};this.fireEvent("expired",n),this.fireEvent("removed",n)}}this.store.set(e,{lastGet:0,lastSet:performance.now(),value:r}),this.fireEvent("newKey",{key:e,value:r})}};const B2=(e,r)=>{let i=new Map(e.entries());for(let o of r){if(o[0]===void 0)throw Error("key cannot be undefined");if(o[1]===void 0)throw Error("value cannot be undefined");i.set(o[0],o[1])}return i},T2=(e,r)=>{let i=new Map(e.entries());for(let o of r){if(o.key===void 0)throw Error("key cannot be undefined");if(o.value===void 0)throw Error("value cannot be undefined");i.set(o.key,o.value)}return i},z2=(e,r)=>e.has(r),ro=(e,...r)=>{if(e===void 0)throw Error("map parameter is undefined");if(r===void 0)throw Error("data parameter i.s undefined");if(r.length===0)return e;let i=r[0];return i.key!==void 0&&i.value!==void 0?T2(e,r):B2(e,r)},Dp=(e,r,i)=>{let o=new Map(e.entries());return o.set(r,i),o},Ap=(e,r)=>{let i=new Map(e.entries());return i.delete(r),i},gt=e=>{if(e===void 0)return gt([]);if(Array.isArray(e))return gt(ro(new Map,...e));let r=e;return{add:(...i)=>{let o=ro(r,...i);return gt(o)},set:(i,o)=>{let a=Dp(r,i,o);return gt(a)},get:i=>r.get(i),delete:i=>gt(Ap(r,i)),clear:()=>gt(),has:i=>r.has(i),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0}},O2=(...e)=>{let r=ro(new Map,...e);return{add:(...i)=>{r=ro(r,...i)},delete:i=>{r=Ap(r,i)},clear:()=>{r=ro(new Map)},set:(i,o)=>{r=Dp(r,i,o)},get:i=>r.get(i),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0,has:i=>z2(r,i)}};var rn=class extends Ze{#e=new Map;groupBy;type;constructor(e,r={}){super(),this.type=e,this.groupBy=r.groupBy??Mt}get typeName(){return this.type.name}get lengthKeys(){return this.#e.size}get lengthMax(){let e=0;for(let r of this.#e.values())e=Math.max(e,this.type.count(r));return e}debugString(){let e=[...this.#e.keys()],r=`Keys: ${e.join(", ")}\r
`;for(let i of e){let o=this.#e.get(i);if(o===void 0)r+=` - ${i} (undefined)\r
`;else{let a=this.type.toArray(o);a!==void 0&&(r+=` - ${i} (${this.type.count(o)}) = ${JSON.stringify(a)}\r
`)}}return r}get isEmpty(){return this.#e.size===0}clear(){this.#e.clear(),super.fireEvent("clear",!0)}addKeyedValues(e,...r){let i=this.#e.get(e);i===void 0?(this.#e.set(e,this.type.addKeyedValues(void 0,r)),super.fireEvent("addedKey",{key:e}),super.fireEvent("addedValues",{values:r})):(this.#e.set(e,this.type.addKeyedValues(i,r)),super.fireEvent("addedValues",{values:r}))}set(e,r){return this.addKeyedValues(e,...r),this}addValue(...e){for(let r of e)this.addKeyedValues(this.groupBy(r),r)}hasKeyValue(e,r,i){let o=this.#e.get(e);return o===void 0?!1:this.type.has(o,r,i)}has(e){return this.#e.has(e)}deleteKeyValue(e,r){let i=this.#e.get(e);return i===void 0?!1:this.deleteKeyValueFromMap(i,e,r)}deleteKeyValueFromMap(e,r,i){let o=this.type.count(e),a=this.type.without(e,i),n=a.length;return this.#e.set(r,this.type.addKeyedValues(void 0,a)),o>n}deleteByValue(e){let r=!1;return[...this.#e.keys()].filter(i=>{let o=this.#e.get(i);if(!o)throw Error("Bug: map could not be accessed");this.deleteKeyValueFromMap(o,i,e)&&(r=!0,this.count(i)===0&&this.delete(i))}),r}delete(e){return this.#e.get(e)===void 0?!1:(this.#e.delete(e),this.fireEvent("deleteKey",{key:e}),!0)}firstKeyByValue(e,r=Y){return[...this.#e.keys()].find(a=>{let n=this.#e.get(a);if(n===void 0)throw Error("Bug: map could not be accessed");return this.type.has(n,e,r)})}count(e){let r=this.#e.get(e);return r===void 0?0:this.type.count(r)}*get(e){let r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}*valuesFor(e){let r=this.#e.get(e);r!==void 0&&(yield*this.type.iterable(r))}getSource(e){return this.#e.get(e)}*keys(){yield*this.#e.keys()}*entriesFlat(){for(let e of this.#e.entries())for(let r of this.type.iterable(e[1]))yield[e[0],r]}*valuesFlat(){for(let e of this.#e.entries())yield*this.type.iterable(e[1])}*entries(){for(let[e,r]of this.#e.entries()){let i=[...this.type.iterable(r)];yield[e,i]}}*keysAndCounts(){for(let e of this.keys())yield[e,this.count(e)]}merge(e){for(let r of e.keys()){let i=e.get(r);this.addKeyedValues(r,...i)}}get size(){return this.#e.size}get[Symbol.toStringTag](){return this.#e[Symbol.toStringTag]}};const j2=e=>{let r=e?.hash??Mt,i=(n,s)=>r(n)===r(s),o={get name(){return"set"},iterable:n=>n.values(),addKeyedValues:(n,s)=>sl(n,r,"skip",...s),count:n=>n.size,find:(n,s)=>dl(n,s),filter:(n,s)=>fl(n,s),toArray:n=>wa(n),has:(n,s)=>cl(n,s,i),without:(n,s)=>Ua(wa(n),s,i)};return new rn(o,e)},R2=e=>{let r=Y,i={get name(){return"circular"},addKeyedValues:(o,a)=>{let n=o??new Xd(e.capacity);for(let s of a)n=n.add(s);return n},count:o=>o.length,find:(o,a)=>o.find(a),filter:(o,a)=>o.filter(a),toArray:o=>o,iterable:o=>o.values(),has:(o,a)=>o.find(n=>r(n,a))!==void 0,without:(o,a)=>o.filter(n=>!r(n,a))};return new rn(i,e)};var Cp=class extends Map{defaultValue;constructor(e=0){super(),this.defaultValue=e}get(e){let r=super.get(e);return r===void 0?this.defaultValue:r}reset(e){return super.set(e,this.defaultValue),this.defaultValue}multiply(e,r){let i=super.get(e),o=i??this.defaultValue;return o*=r,super.set(e,o),o}add(e,r=1){let i=super.get(e),o=i??this.defaultValue;return o+=r,super.set(e,o),o}subtract(e,r=1){let i=super.get(e),o=i??this.defaultValue;return o-=r,super.set(e,o),o}};const V2=(e={})=>{let r=e.convertToString,i=r===void 0?Y:(s,l)=>r(s)===r(l),o=e.comparer??i,a={get name(){return"array"},addKeyedValues:(s,l)=>s===void 0?[...l]:[...s,...l],iterable:s=>s.values(),count:s=>s.length,find:(s,l)=>s.find(u=>l(u)),filter:(s,l)=>s.filter(u=>l(u)),toArray:s=>s,has:(s,l)=>s.some(u=>o(u,l)),without:(s,l)=>s.filter(u=>!o(u,l))};return new rn(a,e)},L2=(e,r)=>{for(let i of e.entries()){let o=i[1];for(let a of o)if(r(a,i[0]))return i}},I2=e=>{let r=["",0];for(let i of e.keysAndCounts())i[1]>r[1]&&(r=i);return r[1]},Sp=(e,r,i=Y)=>{for(let o of e.entries()){let a=o[1];for(let n of a)if(i(n,r))return o}};var Fp=class{map;groupBy;valueEq;constructor(e=So,r=Y,i=[]){this.groupBy=e,this.valueEq=r,this.map=new Map(i)}has(e){return this.map.has(e)}hasKeyValue(e,r){let i=this.map.get(e);if(!i)return!1;for(let o of i)if(this.valueEq(o,r))return!0;return!1}debugString(){let e="";return[...this.map.keys()].every(i=>{let o=this.map.get(i);o!==void 0&&(e+=i+` (${o.length}) = ${JSON.stringify(o)}\r
`)}),e}count(e){let r=this.map.get(e);return r?r.length:0}firstKeyByValue(e,r=Y){let i=Sp(this,e,r);if(i)return i[0]}*entriesFlat(){for(let e of this.map.keys())for(let r of this.map.get(e))yield[e,r]}*entries(){for(let[e,r]of this.map.entries())yield[e,[...r]]}*get(e){let r=this.map.get(e);r&&(yield*r.values())}*keys(){yield*this.map.keys()}*valuesFlat(){for(let e of this.map)yield*e[1]}*values(){for(let e of this.map)yield e[1]}*keysAndCounts(){for(let e of this.map)yield[e[0],e[1].length]}get lengthKeys(){return this.map.size}get isEmpty(){return this.map.size===0}},nu=class extends Fp{addKeyedValues(e,...r){let i=this.map.get(e);i===void 0?this.map.set(e,r):this.map.set(e,[...i,...r])}setValues(e,r){this.map.set(e,r)}addValue(...e){for(let r of e){let i=this.groupBy(r);this.addKeyedValues(i,r)}}deleteKeyValue(e,r){let i=this.map.get(e);if(i===void 0)return!1;let o=i.filter(a=>!this.valueEq(a,r));return this.map.set(e,o),o.length<i.length}deleteByValue(e){let r=!1,i=[...this.map.entries()];for(let o of i)for(let a of o[1])this.valueEq(a,e)&&(r=!0,this.deleteKeyValue(o[0],e));return r}delete(e){let r=this.map.get(e);return!r||r.length===0?!1:(this.map.delete(e),!0)}clear(){this.map.clear()}};const q2=(e=So,r=Y)=>new nu(e,r);var kp=class Zi extends Fp{addKeyedValues(r,...i){return this.addBatch([[r,i]])}addValue(...r){let i=r.map(o=>[this.groupBy(o),o]);return this.addBatch(i)}addBatch(r){let i=new Map([...this.map.entries()].map(o=>[o[0],[...o[1]]]));for(let[o,a]of r){let n=i.get(o);n===void 0?i.set(o,a):n.push(...a)}return new Zi(this.groupBy,this.valueEq,[...i.entries()])}clear(){return new Zi(this.groupBy,this.valueEq)}deleteKeyValue(r,i){throw Error("Method not implemented.")}deleteByValue(r,i){let o=[...this.map.entries()],a=i??this.valueEq,n=o.map(s=>{let l=s[0],u=s[1].filter(c=>!a(c,r));return[l,u]});return new Zi(this.groupBy,this.valueEq,n)}delete(r){let i=[...this.map.entries()].filter(o=>o[0]!==r);return new Zi(this.groupBy,this.valueEq,i)}};const _2=(e=So,r=Y)=>new kp(e,r);var $p={};A($p,{MapOfMutableImpl:()=>rn,MapOfSimple:()=>kp,NumberMap:()=>Cp,addObjectEntriesMutate:()=>xa,addValue:()=>sl,addValueMutate:()=>Nd,addValueMutator:()=>ll,deleteByValueCompareMutate:()=>$d,expiringMap:()=>N2,filterValues:()=>fl,findBySomeKey:()=>nl,findEntryByPredicate:()=>Md,findEntryByValue:()=>Pd,findValue:()=>dl,firstEntry:()=>L2,firstEntryByValue:()=>Sp,fromIterable:()=>Td,fromObject:()=>zd,getClosestIntegerKey:()=>Fd,getOrGenerate:()=>hl,getOrGenerateSync:()=>Id,hasAnyValue:()=>cl,hasKeyValue:()=>kd,immutable:()=>gt,lengthMax:()=>I2,mapOfSimpleMutable:()=>q2,mapToArray:()=>Vd,mapToObjectTransform:()=>Od,mergeByKey:()=>Ld,mutable:()=>O2,ofArrayMutable:()=>V2,ofCircularMutable:()=>R2,ofSetMutable:()=>j2,ofSimple:()=>_2,some:()=>oo,sortByValue:()=>Bd,sortByValueProperty:()=>ul,toArray:()=>wa,toObject:()=>Rd,transformMap:()=>jd,zipKeyValue:()=>Co});var su=class{rows=[];rowLabels=[];colLabels=[];columnMaxLength=0;getColumnLabelIndex(e){for(let[r,i]of this.colLabels.entries())if(i===e)return r}getRowLabelIndex(e){for(let[r,i]of this.rowLabels.entries())if(i===e)return r}print(){console.table([...this.rowsWithLabelsObject()])}asArray(){let e=[];for(let r of this.rows)r===void 0?e.push([]):e.push([...r]);return e}get rowCount(){return this.rows.length}get columnCount(){return this.columnMaxLength}*rowsWithLabelsObject(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsObject(e)}*rowsWithLabelsArray(){for(let e=0;e<this.rows.length;e++)yield this.getRowWithLabelsArray(e)}labelColumns(...e){this.colLabels=e}labelColumn(e,r){this.colLabels[e]=r}labelRows(...e){this.rowLabels=e}labelRow(e,r){this.rowLabels[e]=r}appendRow(...e){return this.columnMaxLength=Math.max(this.columnMaxLength,e.length),this.rows.push(e),e}getRowWithLabelsArray(e){let r=this.rows.at(e);if(r!==void 0)return r.map((i,o)=>[this.colLabels.at(o),i])}getRowWithLabelsObject(e){let r=this.rows.at(e);if(r===void 0)return;let i={};for(let o=0;o<this.colLabels.length;o++){let a=this.colLabels.at(o)??o.toString();i[a]=r[o]}return i}#e(e){let r=typeof e=="number"?e:this.getRowLabelIndex(e);if(r===void 0)return{success:!1,error:"row-label-notfound"};if(r<0)return{success:!1,error:"row-index-invalid"};if(r<this.rows.length)return{success:!0,value:this.rows[r]};let i=[];return this.rows[r]=i,{success:!0,value:i}}row(e){let r=this.#t(e);if(Ct(r))throw Error(r.error);return[...r.value]}set(e,r,i){let o=this.#e(e);if(Ct(o))throw Error(o.error);let a=o.value,n=typeof r=="number"?r:this.getColumnLabelIndex(r);if(n===void 0)throw Error(`Column label '${r}' not found or is invalid`);if(n<0)throw Error("Column index invalid (less than zero)");a[n]=i}get(e,r){let i=this.#t(e);if(Ct(i))throw Error(i.error);let o=this.#r(i.value,r);if(Ct(o))throw Error(o.error);return o.value.value}#t(e){let r=0;if(typeof e=="number")r=e;else if(r=this.getRowLabelIndex(e),typeof r!="number")return{error:"row-label-notfound",success:!1};return typeof r=="number"?r<0||r>=this.rows.length?{error:"row-index-out-of-range",success:!1}:{success:!0,value:this.rows[r]}:{error:"row-invalid",success:!1}}#r(e,r){let i=typeof r=="number"?r:this.getColumnLabelIndex(r);return typeof i=="number"?i<0||i>=e.length?{success:!1,error:"col-index-out-of-range"}:{success:!0,value:{index:i,value:e[i]}}:{success:!1,error:"col-label-notfound"}}setRow(e,r,i){let o=this.#e(e);if(Ct(o))throw Error(o.error);let a=o.value,n=typeof i=="number"?i:this.columnMaxLength;for(let s=0;s<n;s++)a[s]=r;return a}},Mp={};A(Mp,{adjacentVertices:()=>uu,areAdjacent:()=>tA,bfs:()=>rA,clone:()=>oA,connect:()=>zp,connectTo:()=>Cs,connectWithEdges:()=>Op,createVertex:()=>Pp,dfs:()=>jp,disconnect:()=>Tp,distance:()=>Np,distanceDefault:()=>Y2,dumpGraph:()=>J2,edges:()=>Bp,get:()=>G2,getCycles:()=>Lp,getOrCreate:()=>As,getOrFail:()=>X2,graph:()=>Rp,graphFromVertices:()=>Vp,hasKey:()=>W2,hasNoOuts:()=>Q2,hasOnlyOuts:()=>Z2,hasOut:()=>Tr,isAcyclic:()=>aA,pathDijkstra:()=>iA,toAdjacencyMatrix:()=>U2,topologicalSort:()=>nA,transitiveReduction:()=>Ip,updateGraphVertex:()=>on,vertexHasOut:()=>K2,vertices:()=>lu});const Pp=e=>({id:e,out:[]});function W2(e,r){return w(se(e)),e.vertices.has(r)}function G2(e,r){return w(se(e)),w(tl(r,"non-empty","key")),e.vertices.get(r)}function U2(e){w(se(e));let r=[...e.vertices.values()],i=new su;i.labelColumns(...r.map(o=>o.id)),i.labelRows(...r.map(o=>o.id));for(let o=0;o<r.length;o++){i.setRow(o,!1,r.length);let a=r[o];for(let[n,s]of r.entries())a.out.some(l=>l.id===s.id)&&i.set(o,n,!0)}return i}const J2=e=>H2(e).join(`
`),H2=e=>{let r=[],i="vertices"in e?e.vertices.values():e;for(let o of i){let a=eA(o);r.push(...a.map(n=>` ${n}`))}return r},Np=(e,r)=>r.weight===void 0?1:r.weight;function*Bp(e){w(se(e));let r=[...e.vertices.values()];for(let i of r)for(let o of i.out)yield o}function*lu(e){w(se(e));let r=[...e.vertices.values()];for(let i of r)yield i}function se(e,r="graph"){if(e===void 0)return{success:!1,error:`Param '${r}' is undefined. Expected Graph`};if(e===null)return{success:!1,error:`Param '${r}' is null. Expected Graph`};if(typeof e=="object"){if(!("vertices"in e))return{success:!1,error:`Param '${r}.vertices' does not exist. Is it a Graph type?`}}else return{success:!1,error:`Param '${r} is type '${typeof e}'. Expected an object Graph`};return{success:!0,value:e}}function*uu(e,r){if(w(se(e)),r===void 0)return;let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of i.out){let a=e.vertices.get(o.id);if(a===void 0)throw Error(`Could not find vertex: ${o.id}`);yield a}}const K2=(e,r)=>{if(e===void 0)return!1;let i=typeof r=="string"?r:r.id;return e.out.some(o=>o.id===i)},Q2=(e,r)=>{w(se(e));let i=typeof r=="string"?e.vertices.get(r):r;return i===void 0?!1:i.out.length===0},Z2=(e,r,...i)=>{w(se(e));let o=Qt(e,r),a=i.map(n=>Qt(e,n));if(a.length!==o.out.length)return!1;for(let n of a)if(!Tr(e,o,n))return!1;return!0},Tr=(e,r,i)=>{w(se(e));let o=Qt(e,r),a=typeof i=="string"?i:i.id;return o.out.some(n=>n.id===a)},As=(e,r)=>{w(se(e));let i=e.vertices.get(r);if(i!==void 0)return{graph:e,vertex:i};let o=Pp(r);return{graph:on(e,o),vertex:o}},X2=(e,r)=>{w(se(e));let i=e.vertices.get(r);if(i===void 0)throw Error(`Vertex '${r}' not found in graph`);return i},on=(e,r)=>(w(se(e)),{...e,vertices:e.vertices.set(r.id,r)}),Y2=(e,r)=>r.weight===void 0?1:r.weight;function Tp(e,r,i){w(se(e));let o=Qt(e,r),a=Qt(e,i);return Tr(e,o,a)?on(e,{...o,out:o.out.filter(n=>n.id!==a.id)}):e}function Cs(e,r,i,o){w(se(e));let a=As(e,r);e=a.graph;let n=As(e,i);e=n.graph;let s={id:i,weight:o};return Tr(e,a.vertex,n.vertex)||(e=on(e,{...a.vertex,out:[...a.vertex.out,s]})),{graph:e,edge:s}}function zp(e,r){if(typeof e!="object")throw TypeError(`Param 'graph' is expected to be a DirectedGraph object. Got: ${typeof e}`);if(typeof r!="object")throw TypeError(`Param 'options' is expected to be ConnectOptions object. Got: ${typeof r}`);return Op(e,r).graph}function Op(e,r){w(se(e));let{to:i,weight:o,from:a}=r,n=r.bidi??!1,s=Array.isArray(i)?i:[i],l=[];for(let u of s){let c=Cs(e,a,u,o);e=c.graph,l.push(c.edge)}if(!n)return{graph:e,edges:l};for(let u of s){let c=Cs(e,u,a,o);e=c.graph,l.push(c.edge)}return{graph:e,edges:l}}const eA=e=>{let r=[e.id],i=o=>o.weight===void 0?o.id:`${o.id} (${o.weight})`;for(let o of e.out)r.push(` -> ${i(o)}`);return e.out.length===0&&(r[0]+=" (terminal)"),r};function tA(e,r,i){if(w(se(e)),Tr(e,r,i.id)||Tr(e,i,r.id))return!0}function Qt(e,r){if(w(se(e)),r===void 0)throw Error("Param 'idOrVertex' is undefined. Expected string or Vertex");let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Id not found ${r}`);return i}function*rA(e,r,i){w(se(e));let o=Qt(e,r),a=i===void 0?void 0:Qt(e,i),n=new lt,s=new Set;for(n.enqueue(o);!n.isEmpty;){let l=n.dequeue();if(yield l,a!==void 0&&a===l)return;for(let u of uu(e,l))s.has(u.id)||(s.add(u.id),n.enqueue(Qt(e,u.id)))}}function*jp(e,r){w(se(e));let i=Qt(e,r),o=new Ir,a=new Set;for(o.push(i);!o.isEmpty;){let n=o.pop();if(n!==void 0&&!a.has(n.id)){a.add(n.id),yield n;for(let s of n.out){let l=e.vertices.get(s.id);l&&o.push(l)}}}}const iA=(e,r)=>{w(se(e));let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error("source vertex not found");let o=new Map,a=new Map;o.set(i.id,0);let n=new au,s=[...e.vertices.values()];for(let u of s)u.id!==i.id&&(o.set(u.id,2**53-1),a.set(u.id,null)),n.enqueueWithPriority(u.id,2**53-1);for(;!n.isEmpty;){let u=n.dequeueMin();if(u===void 0)throw Error("Bug. Queue unexpectedly empty");let c=e.vertices.get(u);for(let f of c.out){let d=o.get(u)+Np(e,f);d<o.get(f.id)&&(o.set(f.id,d),a.set(f.id,c),n.changePriority(f.id,d,!0))}}return{distances:o,previous:a,pathTo:u=>{let c=[];for(;u!==i.id;){let f=a.get(u);if(f==null)throw Error(`Id not present: ${u}`);c.push({id:u,weight:o.get(u)}),u=f.id}return c}}},oA=e=>(w(se(e)),{vertices:gt([...e.vertices.entries()])}),Rp=(...e)=>{let r={vertices:gt()};for(let i of e)r=zp(r,i);return r};function aA(e){return w(se(e)),Lp(e).length===0}function nA(e){w(se(e));let r=new Cp(0);for(let n of Bp(e))r.add(n.id,1);let i=new lt,o=0;for(let n of lu(e))r.get(n.id)===0&&i.enqueue(n),o++;let a=[];for(;!i.isEmpty;){let n=i.dequeue();a.push(n);for(let s of n.out)r.subtract(s.id,1)===0&&i.enqueue(e.vertices.get(s.id))}if(a.length!==o)throw Error("Graph contains cycles");return Vp(a)}function Vp(e){let r=bl(e,o=>[o.id,o]);return{vertices:gt([...r])}}function Lp(e){w(se(e));let r=0,i=new Ir,o=new Map,a=[];for(let s of e.vertices.values())o.set(s.id,{...s,lowlink:NaN,index:NaN,onStack:!1});let n=s=>{s.index=r,s.lowlink=r,r++,i.push(s),s.onStack=!0;for(let l of s.out){let u=o.get(l.id);Number.isNaN(u.index)?(n(u),s.lowlink=Math.min(s.lowlink,u.lowlink)):u.onStack&&(s.lowlink=Math.min(s.lowlink,u.lowlink))}if(s.lowlink===s.index){let l=[],u;for(;s!==u;)u=i.pop(),u.onStack=!1,l.push({id:u.id,out:u.out});l.length>1&&a.push(l)}};for(let s of o.values())Number.isNaN(s.index)&&n(s);return a}function Ip(e){w(se(e));for(let r of lu(e))for(let i of uu(e,r))for(let o of jp(e,i))if(i.id!==o.id&&Tr(e,r,o)){let a=Tp(e,r,o);return Ip(a)}return e}var qp={};A(qp,{adjacentVertices:()=>dA,connect:()=>Jp,connectTo:()=>Up,connectWithEdges:()=>Hp,createVertex:()=>_p,dumpGraph:()=>uA,edgesForVertex:()=>hA,getConnection:()=>cu,getOrCreate:()=>Ss,graph:()=>sA,hasConnection:()=>Gp,toAdjacencyMatrix:()=>lA,updateGraphVertex:()=>Wp});const _p=e=>({id:e}),Wp=(e,r)=>({...e,vertices:e.vertices.set(r.id,r)}),Ss=(e,r)=>{let i=e.vertices.get(r);if(i!==void 0)return{graph:e,vertex:i};let o=_p(r);return{graph:Wp(e,o),vertex:o}};function $a(e,r){if(r===void 0)throw Error("Param 'idOrVertex' is undefined. Expected string or Vertex");if(e===void 0)throw Error("Param 'graph' is undefined. Expected Graph");let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Id not found ${r}`);return i}const Gp=(e,r,i)=>cu(e,r,i)!==void 0,cu=(e,r,i)=>{if(r===void 0)throw Error("Param 'a' is undefined. Expected string or Vertex");if(i===void 0)throw Error("Param 'b' is undefined. Expected string or Vertex");if(e===void 0)throw Error("Param 'graph' is undefined. Expected Graph");let o=$a(e,r),a=$a(e,i);for(let n of e.edges)if(n.a==o.id&&n.b===a.id||n.a==a.id&&n.b===o.id)return n};function Up(e,r,i,o){e=Ss(e,r).graph,e=Ss(e,i).graph;let s=cu(e,r,i);return s!==void 0?{graph:e,edge:s}:(s={a:r,b:i,weight:o},{graph:{...e,edges:[...e.edges,s]},edge:s})}function Jp(e,r){return Hp(e,r).graph}function Hp(e,r){let{a:i,weight:o,b:a}=r,n=Array.isArray(a)?a:[a],s=[];for(let l of n){let u=Up(e,i,l,o);e=u.graph,s.push(u.edge)}return{graph:e,edges:s}}const sA=(...e)=>{let r={vertices:gt(),edges:[]};for(let i of e)r=Jp(r,i);return r};function lA(e){let r=[...e.vertices.values()],i=new su;i.labelColumns(...r.map(o=>o.id)),i.labelRows(...r.map(o=>o.id));for(let o=0;o<r.length;o++){i.setRow(o,!1,r.length);let a=r[o];for(let[n,s]of r.entries())Gp(e,a,s)&&i.set(o,n,!0)}return i}const uA=e=>cA(e).join(`
`),cA=e=>{let r=[];r.push(`Vertices: ${[...e.vertices.values()].map(i=>i.id).join(", ")}`),r.push("Edges:");for(let i of e.edges)r.push(fA(i));return r},fA=e=>{let r=e.weight?` (${e.weight})`:"";return`${e.a} <-> ${e.b}${r}`};function*dA(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of e.edges)o.a===r?yield $a(e,o.b):o.b===r&&(yield $a(e,o.a))}function*hA(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of e.edges)(o.a===r||o.b===r)&&(yield o)}var Kp={};A(Kp,{Directed:()=>Mp,Undirected:()=>qp});var pA={};A(pA,{CircularArray:()=>Xd,ExpiringMap:()=>Ep,Graphs:()=>Kp,MapOfSimpleMutable:()=>nu,Maps:()=>$p,QueueImmutable:()=>tn,QueueMutable:()=>lt,Queues:()=>xp,SetStringImmutable:()=>Gl,SetStringMutable:()=>Wl,Sets:()=>l0,StackImmutable:()=>ao,StackMutable:()=>Ir,Stacks:()=>a0,Table:()=>su,Trees:()=>i0});const U=e=>{let r=fu(e);if(r.success)return r.value;throw Lr(r)},fu=e=>{if(typeof e=="string"){let i=document.querySelector(e);if(i===null)return{success:!1,error:e.startsWith("#")?`Query '${e}' did not match anything. Try '#id', 'div', or '.class'`:`Query '${e}' did not match anything. Did you mean '#${e}?`};e=i}else{if(e===null)return{success:!1,error:"Param 'domQueryOrEl' is null"};if(e===void 0)return{success:!1,error:"Param 'domQueryOrEl' is undefined"}}return{success:!0,value:e}},qr=e=>e==null?[]:Array.isArray(e)?e:typeof e=="string"?[...document.querySelectorAll(e)]:[e];var Qp=Rx((e,r)=>{(function(i,o){typeof e=="object"&&r!==void 0?r.exports=o():typeof define=="function"&&define.amd?define(o):i.JSON5=o()})(e,function(){function i(b,S){return S={exports:{}},b(S,S.exports),S.exports}var o=i(function(b){var S=b.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=S)}),a=i(function(b){var S=b.exports={version:"2.6.5"};typeof __e=="number"&&(__e=S)});a.version;var n=function(b){return typeof b=="object"?b!==null:typeof b=="function"},s=function(b){if(!n(b))throw TypeError(b+" is not an object!");return b},l=function(b){try{return!!b()}catch{return!0}},u=!l(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),c=o.document,f=n(c)&&n(c.createElement),d=function(b){return f?c.createElement(b):{}},h=!u&&!l(function(){return Object.defineProperty(d("div"),"a",{get:function(){return 7}}).a!=7}),p=function(b,S){if(!n(b))return b;var N,L;if(typeof(N=b.toString)=="function"&&!n(L=N.call(b))||typeof(N=b.valueOf)=="function"&&!n(L=N.call(b)))return L;throw TypeError("Can't convert object to primitive value")},y=Object.defineProperty,g=u?Object.defineProperty:function(b,S,N){if(s(b),S=p(S),s(N),h)try{return y(b,S,N)}catch{}if("get"in N||"set"in N)throw TypeError("Accessors not supported!");return"value"in N&&(b[S]=N.value),b},m={f:g},v=function(b,S){return{enumerable:!1,configurable:!0,writable:!0,value:S}},D=u?function(b,S,N){return m.f(b,S,v(1,N))}:function(b,S,N){return b[S]=N,b},B={}.hasOwnProperty,V=function(b,S){return B.call(b,S)},x=0,k=Math.random(),M=function(b){return`Symbol(${b})_${(++x+k).toString(36)}`},P=i(function(b){var S="__core-js_shared__",N=o[S]||(o[S]={});(b.exports=function(L,z){return N[L]||(N[L]=z===void 0?{}:z)})("versions",[]).push({version:a.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),$=P("native-function-to-string",Function.toString),te=i(function(b){var S=M("src"),N="toString",L=(""+$).split(N);a.inspectSource=function(z){return $.call(z)},(b.exports=function(z,K,oe,we){var Je=typeof oe=="function";Je&&(V(oe,"name")||D(oe,"name",K)),z[K]!==oe&&(Je&&(V(oe,S)||D(oe,S,z[K]?""+z[K]:L.join(String(K)))),z===o?z[K]=oe:we?z[K]?z[K]=oe:D(z,K,oe):(delete z[K],D(z,K,oe)))})(Function.prototype,N,function(){return typeof this=="function"&&this[S]||$.call(this)})}),le=function(b){if(typeof b!="function")throw TypeError(b+" is not a function!");return b},be=function(b,S,N){if(le(b),S===void 0)return b;switch(N){case 1:return function(L){return b.call(S,L)};case 2:return function(L,z){return b.call(S,L,z)};case 3:return function(L,z,K){return b.call(S,L,z,K)}}return function(){return b.apply(S,arguments)}},Ue="prototype",J=function(b,S,N){var L=b&J.F,z=b&J.G,K=b&J.S,oe=b&J.P,we=b&J.B,Je=z?o:K?o[S]||(o[S]={}):(o[S]||{})[Ue],ir=z?a:a[S]||(a[S]={}),Li=ir[Ue]||(ir[Ue]={}),Ie,Vt,Xe,Er;for(Ie in z&&(N=S),N)Vt=!L&&Je&&Je[Ie]!==void 0,Xe=(Vt?Je:N)[Ie],Er=we&&Vt?be(Xe,o):oe&&typeof Xe=="function"?be(Function.call,Xe):Xe,Je&&te(Je,Ie,Xe,b&J.U),ir[Ie]!=Xe&&D(ir,Ie,Er),oe&&Li[Ie]!=Xe&&(Li[Ie]=Xe)};o.core=a,J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128;var Te=J,tr=Math.ceil,Oi=Math.floor,ji=function(b){return isNaN(b=+b)?0:(b>0?Oi:tr)(b)},Gn=function(b){if(b==null)throw TypeError("Can't call method on  "+b);return b},ra=function(b){return function(S,N){var L=String(Gn(S)),z=ji(N),K=L.length,oe,we;return z<0||z>=K?void 0:(oe=L.charCodeAt(z),oe<55296||oe>56319||z+1===K||(we=L.charCodeAt(z+1))<56320||we>57343?oe:(oe-55296<<10)+(we-56320)+65536)}},Un=ra();Te(Te.P,"String",{codePointAt:function(b){return Un(this,b)}}),a.String.codePointAt;var Jn=Math.max,px=Math.min,yx=function(b,S){return b=ji(b),b<0?Jn(b+S,0):px(b,S)},Nf=String.fromCharCode,Bf=String.fromCodePoint;Te(Te.S+Te.F*(!!Bf&&Bf.length!=1),"String",{fromCodePoint:function(b){for(var S=arguments,N=[],L=arguments.length,z=0,K;L>z;){if(K=+S[z++],yx(K,1114111)!==K)throw RangeError(K+" is not a valid code point");N.push(K<65536?Nf(K):Nf(((K-=65536)>>10)+55296,K%1024+56320))}return N.join("")}}),a.String.fromCodePoint;var gx=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,mx=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,bx=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,Hn={Space_Separator:gx,ID_Start:mx,ID_Continue:bx},ge={isSpaceSeparator:function(b){return typeof b=="string"&&Hn.Space_Separator.test(b)},isIdStartChar:function(b){return typeof b=="string"&&(b>="a"&&b<="z"||b>="A"&&b<="Z"||b==="$"||b==="_"||Hn.ID_Start.test(b))},isIdContinueChar:function(b){return typeof b=="string"&&(b>="a"&&b<="z"||b>="A"&&b<="Z"||b>="0"&&b<="9"||b==="$"||b==="_"||b==="‌"||b==="‍"||Hn.ID_Continue.test(b))},isDigit:function(b){return typeof b=="string"&&/[0-9]/.test(b)},isHexDigit:function(b){return typeof b=="string"&&/[0-9A-Fa-f]/.test(b)}},Kn,Dt,Ot,ia,rr,pt,Ae,Qn,Ri,vx=function(b,S){Kn=String(b),Dt="start",Ot=[],ia=0,rr=1,pt=0,Ae=void 0,Qn=void 0,Ri=void 0;do Ae=wx(),Dx[Dt]();while(Ae.type!=="eof");return typeof S=="function"?Zn({"":Ri},"",S):Ri};function Zn(b,S,N){var L=b[S];if(typeof L=="object"&&L)if(Array.isArray(L))for(var z=0;z<L.length;z++){var K=String(z),oe=Zn(L,K,N);oe===void 0?delete L[K]:Object.defineProperty(L,K,{value:oe,writable:!0,enumerable:!0,configurable:!0})}else for(var we in L){var Je=Zn(L,we,N);Je===void 0?delete L[we]:Object.defineProperty(L,we,{value:Je,writable:!0,enumerable:!0,configurable:!0})}return N.call(b,S,L)}var W,I,Vi,jt,H;function wx(){for(W="default",I="",Vi=!1,jt=1;;){H=Rt();var b=Tf[W]();if(b)return b}}function Rt(){if(Kn[ia])return String.fromCodePoint(Kn.codePointAt(ia))}function E(){var b=Rt();return b===`
`?(rr++,pt=0):b?pt+=b.length:pt++,b&&(ia+=b.length),b}var Tf={default:function(){switch(H){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":E();return;case"/":E(),W="comment";return;case void 0:return E(),ne("eof")}if(ge.isSpaceSeparator(H)){E();return}return Tf[Dt]()},comment:function(){switch(H){case"*":E(),W="multiLineComment";return;case"/":E(),W="singleLineComment";return}throw ue(E())},multiLineComment:function(){switch(H){case"*":E(),W="multiLineCommentAsterisk";return;case void 0:throw ue(E())}E()},multiLineCommentAsterisk:function(){switch(H){case"*":E();return;case"/":E(),W="default";return;case void 0:throw ue(E())}E(),W="multiLineComment"},singleLineComment:function(){switch(H){case`
`:case"\r":case"\u2028":case"\u2029":E(),W="default";return;case void 0:return E(),ne("eof")}E()},value:function(){switch(H){case"{":case"[":return ne("punctuator",E());case"n":return E(),wr("ull"),ne("null",null);case"t":return E(),wr("rue"),ne("boolean",!0);case"f":return E(),wr("alse"),ne("boolean",!1);case"-":case"+":E()==="-"&&(jt=-1),W="sign";return;case".":I=E(),W="decimalPointLeading";return;case"0":I=E(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":I=E(),W="decimalInteger";return;case"I":return E(),wr("nfinity"),ne("numeric",1/0);case"N":return E(),wr("aN"),ne("numeric",NaN);case'"':case"'":Vi=E()==='"',I="",W="string";return}throw ue(E())},identifierNameStartEscape:function(){if(H!=="u")throw ue(E());E();var b=Xn();switch(b){case"$":case"_":break;default:if(!ge.isIdStartChar(b))throw zf();break}I+=b,W="identifierName"},identifierName:function(){switch(H){case"$":case"_":case"‌":case"‍":I+=E();return;case"\\":E(),W="identifierNameEscape";return}if(ge.isIdContinueChar(H)){I+=E();return}return ne("identifier",I)},identifierNameEscape:function(){if(H!=="u")throw ue(E());E();var b=Xn();switch(b){case"$":case"_":case"‌":case"‍":break;default:if(!ge.isIdContinueChar(b))throw zf();break}I+=b,W="identifierName"},sign:function(){switch(H){case".":I=E(),W="decimalPointLeading";return;case"0":I=E(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":I=E(),W="decimalInteger";return;case"I":return E(),wr("nfinity"),ne("numeric",jt*(1/0));case"N":return E(),wr("aN"),ne("numeric",NaN)}throw ue(E())},zero:function(){switch(H){case".":I+=E(),W="decimalPoint";return;case"e":case"E":I+=E(),W="decimalExponent";return;case"x":case"X":I+=E(),W="hexadecimal";return}return ne("numeric",jt*0)},decimalInteger:function(){switch(H){case".":I+=E(),W="decimalPoint";return;case"e":case"E":I+=E(),W="decimalExponent";return}if(ge.isDigit(H)){I+=E();return}return ne("numeric",jt*Number(I))},decimalPointLeading:function(){if(ge.isDigit(H)){I+=E(),W="decimalFraction";return}throw ue(E())},decimalPoint:function(){switch(H){case"e":case"E":I+=E(),W="decimalExponent";return}if(ge.isDigit(H)){I+=E(),W="decimalFraction";return}return ne("numeric",jt*Number(I))},decimalFraction:function(){switch(H){case"e":case"E":I+=E(),W="decimalExponent";return}if(ge.isDigit(H)){I+=E();return}return ne("numeric",jt*Number(I))},decimalExponent:function(){switch(H){case"+":case"-":I+=E(),W="decimalExponentSign";return}if(ge.isDigit(H)){I+=E(),W="decimalExponentInteger";return}throw ue(E())},decimalExponentSign:function(){if(ge.isDigit(H)){I+=E(),W="decimalExponentInteger";return}throw ue(E())},decimalExponentInteger:function(){if(ge.isDigit(H)){I+=E();return}return ne("numeric",jt*Number(I))},hexadecimal:function(){if(ge.isHexDigit(H)){I+=E(),W="hexadecimalInteger";return}throw ue(E())},hexadecimalInteger:function(){if(ge.isHexDigit(H)){I+=E();return}return ne("numeric",jt*Number(I))},string:function(){switch(H){case"\\":E(),I+=xx();return;case'"':if(Vi)return E(),ne("string",I);I+=E();return;case"'":if(!Vi)return E(),ne("string",I);I+=E();return;case`
`:case"\r":throw ue(E());case"\u2028":case"\u2029":Ax(H);break;case void 0:throw ue(E())}I+=E()},start:function(){switch(H){case"{":case"[":return ne("punctuator",E())}W="value"},beforePropertyName:function(){switch(H){case"$":case"_":I=E(),W="identifierName";return;case"\\":E(),W="identifierNameStartEscape";return;case"}":return ne("punctuator",E());case'"':case"'":Vi=E()==='"',W="string";return}if(ge.isIdStartChar(H)){I+=E(),W="identifierName";return}throw ue(E())},afterPropertyName:function(){if(H===":")return ne("punctuator",E());throw ue(E())},beforePropertyValue:function(){W="value"},afterPropertyValue:function(){switch(H){case",":case"}":return ne("punctuator",E())}throw ue(E())},beforeArrayValue:function(){if(H==="]")return ne("punctuator",E());W="value"},afterArrayValue:function(){switch(H){case",":case"]":return ne("punctuator",E())}throw ue(E())},end:function(){throw ue(E())}};function ne(b,S){return{type:b,value:S,line:rr,column:pt}}function wr(b){for(var S=0,N=b;S<N.length;S+=1){var L=N[S],z=Rt();if(z!==L)throw ue(E());E()}}function xx(){var b=Rt();switch(b){case"b":return E(),"\b";case"f":return E(),"\f";case"n":return E(),`
`;case"r":return E(),"\r";case"t":return E(),"	";case"v":return E(),"\v";case"0":if(E(),ge.isDigit(Rt()))throw ue(E());return"\0";case"x":return E(),Ex();case"u":return E(),Xn();case`
`:case"\u2028":case"\u2029":return E(),"";case"\r":return E(),Rt()===`
`&&E(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw ue(E());case void 0:throw ue(E())}return E()}function Ex(){var b="",S=Rt();if(!ge.isHexDigit(S)||(b+=E(),S=Rt(),!ge.isHexDigit(S)))throw ue(E());return b+=E(),String.fromCodePoint(parseInt(b,16))}function Xn(){for(var b="",S=4;S-- >0;){var N=Rt();if(!ge.isHexDigit(N))throw ue(E());b+=E()}return String.fromCodePoint(parseInt(b,16))}var Dx={start:function(){if(Ae.type==="eof")throw xr();Yn()},beforePropertyName:function(){switch(Ae.type){case"identifier":case"string":Qn=Ae.value,Dt="afterPropertyName";return;case"punctuator":oa();return;case"eof":throw xr()}},afterPropertyName:function(){if(Ae.type==="eof")throw xr();Dt="beforePropertyValue"},beforePropertyValue:function(){if(Ae.type==="eof")throw xr();Yn()},beforeArrayValue:function(){if(Ae.type==="eof")throw xr();if(Ae.type==="punctuator"&&Ae.value==="]"){oa();return}Yn()},afterPropertyValue:function(){if(Ae.type==="eof")throw xr();switch(Ae.value){case",":Dt="beforePropertyName";return;case"}":oa()}},afterArrayValue:function(){if(Ae.type==="eof")throw xr();switch(Ae.value){case",":Dt="beforeArrayValue";return;case"]":oa()}},end:function(){}};function Yn(){var b;switch(Ae.type){case"punctuator":switch(Ae.value){case"{":b={};break;case"[":b=[];break}break;case"null":case"boolean":case"numeric":case"string":b=Ae.value;break}if(Ri===void 0)Ri=b;else{var S=Ot[Ot.length-1];Array.isArray(S)?S.push(b):Object.defineProperty(S,Qn,{value:b,writable:!0,enumerable:!0,configurable:!0})}if(typeof b=="object"&&b)Ot.push(b),Dt=Array.isArray(b)?"beforeArrayValue":"beforePropertyName";else{var N=Ot[Ot.length-1];Dt=N==null?"end":Array.isArray(N)?"afterArrayValue":"afterPropertyValue"}}function oa(){Ot.pop();var b=Ot[Ot.length-1];Dt=b==null?"end":Array.isArray(b)?"afterArrayValue":"afterPropertyValue"}function ue(b){return es(b===void 0?"JSON5: invalid end of input at "+rr+":"+pt:"JSON5: invalid character '"+Of(b)+"' at "+rr+":"+pt)}function xr(){return es("JSON5: invalid end of input at "+rr+":"+pt)}function zf(){return pt-=5,es("JSON5: invalid identifier character at "+rr+":"+pt)}function Ax(b){console.warn("JSON5: '"+Of(b)+"' in strings is not valid ECMAScript; consider escaping")}function Of(b){var S={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(S[b])return S[b];if(b<" "){var N=b.charCodeAt(0).toString(16);return"\\x"+("00"+N).substring(N.length)}return b}function es(b){var S=SyntaxError(b);return S.lineNumber=rr,S.columnNumber=pt,S}var Cx=function(b,S,N){var L=[],z="",K,oe,we="",Je;if(typeof S=="object"&&S&&!Array.isArray(S)&&(N=S.space,Je=S.quote,S=S.replacer),typeof S=="function")oe=S;else if(Array.isArray(S)){K=[];for(var ir=0,Li=S;ir<Li.length;ir+=1){var Ie=Li[ir],Vt=void 0;typeof Ie=="string"?Vt=Ie:(typeof Ie=="number"||Ie instanceof String||Ie instanceof Number)&&(Vt=String(Ie)),Vt!==void 0&&K.indexOf(Vt)<0&&K.push(Vt)}}return N instanceof Number?N=Number(N):N instanceof String&&(N=String(N)),typeof N=="number"?N>0&&(N=Math.min(10,Math.floor(N)),we="          ".substr(0,N)):typeof N=="string"&&(we=N.substr(0,10)),Xe("",{"":b});function Xe(re,ze){var q=ze[re];switch(q!=null&&(typeof q.toJSON5=="function"?q=q.toJSON5(re):typeof q.toJSON=="function"&&(q=q.toJSON(re))),oe&&(q=oe.call(ze,re,q)),q instanceof Number?q=Number(q):q instanceof String?q=String(q):q instanceof Boolean&&(q=q.valueOf()),q){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof q=="string")return Er(q);if(typeof q=="number")return String(q);if(typeof q=="object")return Array.isArray(q)?Px(q):$x(q)}function Er(re){for(var ze={"'":.1,'"':.2},q={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},ke="",yt=0;yt<re.length;yt++){var Oe=re[yt];switch(Oe){case"'":case'"':ze[Oe]++,ke+=Oe;continue;case"\0":if(ge.isDigit(re[yt+1])){ke+="\\x00";continue}}if(q[Oe]){ke+=q[Oe];continue}if(Oe<" "){var Dr=Oe.charCodeAt(0).toString(16);ke+="\\x"+("00"+Dr).substring(Dr.length);continue}ke+=Oe}var Lt=Je||Object.keys(ze).reduce(function(or,Ar){return ze[or]<ze[Ar]?or:Ar});return ke=ke.replace(new RegExp(Lt,"g"),q[Lt]),Lt+ke+Lt}function $x(re){if(L.indexOf(re)>=0)throw TypeError("Converting circular structure to JSON5");L.push(re);var ze=z;z+=we;for(var q=K||Object.keys(re),ke=[],yt=0,Oe=q;yt<Oe.length;yt+=1){var Dr=Oe[yt],Lt=Xe(Dr,re);if(Lt!==void 0){var or=Mx(Dr)+":";we!==""&&(or+=" "),or+=Lt,ke.push(or)}}var Ar;if(ke.length===0)Ar="{}";else{var aa;if(we==="")aa=ke.join(","),Ar="{"+aa+"}";else{var Nx=`,
`+z;aa=ke.join(Nx),Ar=`{
`+z+aa+`,
`+ze+"}"}}return L.pop(),z=ze,Ar}function Mx(re){if(re.length===0)return Er(re);var ze=String.fromCodePoint(re.codePointAt(0));if(!ge.isIdStartChar(ze))return Er(re);for(var q=ze.length;q<re.length;q++)if(!ge.isIdContinueChar(String.fromCodePoint(re.codePointAt(q))))return Er(re);return re}function Px(re){if(L.indexOf(re)>=0)throw TypeError("Converting circular structure to JSON5");L.push(re);var ze=z;z+=we;for(var q=[],ke=0;ke<re.length;ke++){var yt=Xe(String(ke),re);q.push(yt===void 0?"null":yt)}var Oe;if(q.length===0)Oe="[]";else if(we===""){var Dr=q.join(",");Oe="["+Dr+"]"}else{var Lt=`,
`+z,or=q.join(Lt);Oe=`[
`+z+or+`,
`+ze+"]"}return L.pop(),z=ze,Oe}},Sx={parse:vx,stringify:Cx},Fx=Sx,kx=Fx;return kx})}),Zp={};A(Zp,{fromList:()=>mA,fromObject:()=>ty});var Xp=id(Qp());const yA=(e,r)=>r.leftPadding&&e.length<r.leftPadding?"&nbsp;".repeat(r.leftPadding-e.length)+e:e,Yp=(e,r)=>{e=r.roundNumbers===void 0?e:ni(r.roundNumbers,e);let i=r.precision===void 0?e.toString():e.toFixed(r.precision);return i=yA(i.toString(),r),i},gA=(e,r)=>e===null?"(null)":e===void 0?"(undefined)":typeof e=="boolean"?e?"true":"false":typeof e=="string"?`"${e}"`:typeof e=="number"?Yp(e,r.numbers):typeof e=="object"?ey(e,r):Xp.default.stringify(e),ey=(e,r)=>{let i='<div style="display:grid; grid-template-columns: repeat(2, 1fr)">';for(let o of Object.entries(e)){let a=gA(o[1],r);i+=`<div class="label" style="display:table-cell">${o[0]}</div>
      <div class="data" style="display:table-cell">${a}</div>`}return i+="</div>",i},mA=(e,r)=>{let i=U(e),o=document.createElement("DIV");i.append(o);let a={numbers:{},objectsAsTables:!0},n=()=>o?(o.remove(),o=void 0,!0):!1,s=l=>{let u=new Set;for(let[f,d]of l){let h=`table-${f}`;u.add(h);let p=i.querySelector(`#${h}`);if(p===null){if(p=document.createElement("table"),!p)throw Error("Could not create table element");p.id=h,i.append(p)}Fs(p,d,a)}let c=Array.from(i.querySelectorAll("table"));for(let f of c)u.has(f.id)||f.remove()};return r&&s(r),{update:s,remove:n}},Fs=(e,r,i)=>{let o=i.numbers??{},a=i.idPrefix??"",n=i.objectsAsTables??!1;if(r===void 0){e.innerHTML="";return}let s=new Set;for(let[u,c]of Object.entries(r)){let f=`${a}-row-${u}`;s.add(f);let d=e.querySelector(`tr[data-key='${f}']`);if(d===null){d=document.createElement("tr"),e.append(d),d.setAttribute("data-key",f);let y=document.createElement("td");y.textContent=u,y.classList.add("label"),d.append(y)}let h=d.querySelector(`td[data-key='${f}-val']`);h===null&&(h=document.createElement("td"),h.classList.add("data"),h.setAttribute("data-key",`${f}-val`),d.append(h));let p;i.formatter&&(p=i.formatter(c,u)),p===void 0&&(p=typeof c=="object"?n?ey(c,i):Xp.default.stringify(c):typeof c=="number"?Yp(c,o):typeof c=="boolean"?c?"true":"false":typeof c=="string"?`"${c}"`:JSON.stringify(c)),h.innerHTML=p}let l=Array.from(e.querySelectorAll("tr"));for(let u of l){let c=u.getAttribute("data-key");s.has(c)||u.remove()}},ty=(e,r,i={})=>{let o=U(e),a=i.idPrefix??Math.floor(Math.random()*1e3).toString(),n={numbers:{},objectsAsTables:!0,idPrefix:"",...i},s=document.createElement("table");o.append(s);let l=()=>s?(s.remove(),s=void 0,!0):!1;return r&&Fs(s,r,n),{remove:l,update:c=>{if(!s)throw Error("Table disposed");Fs(s,c,{...n,idPrefix:a})}}},bA=e=>Q(e)&&e.z!==null?!1:e.x===null&&e.y===null,vA=e=>Q(e)&&!Number.isNaN(e.z)?!1:Number.isNaN(e.x)||Number.isNaN(e.y);function O(e,r="Point"){if(e===void 0)throw Error(`'${r}' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e===null)throw Error(`'${r}' is null. Expected {x,y} got ${JSON.stringify(e)}`);if(e.x===void 0)throw Error(`'${r}.x' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e.y===void 0)throw Error(`'${r}.y' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(typeof e.x!="number")throw TypeError(`'${r}.x' must be a number. Got ${typeof e.x}`);if(typeof e.y!="number")throw TypeError(`'${r}.y' must be a number. Got ${typeof e.y}`);if(e.z!==void 0){if(typeof e.z!="number")throw TypeError(`${r}.z must be a number. Got: ${typeof e.z}`);if(Number.isNaN(e.z))throw Error(`'${r}.z' is NaN. Got: ${JSON.stringify(e)}`)}if(e.x===null)throw Error(`'${r}.x' is null`);if(e.y===null)throw Error(`'${r}.y' is null`);if(Number.isNaN(e.x))throw Error(`'${r}.x' is NaN`);if(Number.isNaN(e.y))throw Error(`'${r}.y' is NaN`)}const ry=(e,r="pt")=>(O(e,r),w(C(e.x,"nonZero",`${r}.x`),C(e.y,"nonZero",`${r}.y`),()=>{if(e.z!==void 0)return C(e.z,"nonZero",`${r}.z`)}),!0);function j(e){return!(e==null||e.x===void 0||e.y===void 0)}const Q=e=>!(e==null||e.x===void 0||e.y===void 0||e.z===void 0),oi=e=>Q(e)&&e.z!==0?!1:e.x===0&&e.y===0,Mr=e=>Q(e)&&!Number.isNaN(e.z)?!1:Number.isNaN(e.x)&&Number.isNaN(e.y),zr=(e,r="Dimension")=>{if(e===void 0)throw Error(`${r} is undefined`);if(Number.isNaN(e))throw Error(`${r} is NaN`);if(e<0)throw Error(`${r} cannot be negative`)},ft=(e,r="rect")=>{if(e===void 0)throw Error("{$name} undefined");Se(e)&&O(e,r),zr(e.width,r+".width"),zr(e.height,r+".height")},du=(e,r)=>{if(ft(e),Se(e)&&r===void 0)return e;if(r===void 0)throw Error("Unpositioned rect needs origin parameter");return Object.freeze({...e,...r})},hu=(e,r="rect")=>{if(!Se(e))throw Error(`Expected ${r} to have x,y`);ft(e,r)},wA=e=>e.width===0&&e.height===0,iy=e=>Number.isNaN(e.width)&&Number.isNaN(e.height),Se=e=>e.x!==void 0&&e.y!==void 0,ot=e=>!(e===void 0||e.width===void 0||e.height===void 0),vt=e=>ot(e)&&Se(e),xA=e=>(ft(e),e.height*e.width);function oy(e,r,i){let o=typeof r=="number"?r:r.width,a=typeof r=="number"?i:r.height;if(o===void 0)throw Error("Param 'width' undefined");if(a===void 0)throw Error("Param 'height' undefined");if(o=e(o,"width"),a=e(a,"height"),typeof r=="object")if(Se(r)){let n=e(r.x,"x"),s=e(r.y,"y");return{...r,width:o,height:a,x:n,y:s}}else return{...r,width:o,height:a};return{width:o,height:a}}function Mo(e,r,i,o){if(ft(r,"a"),ot(i))return vt(r)?Object.freeze({...r,x:e(r.x,i.width),y:e(r.y,i.height),width:e(r.width,i.width),height:e(r.height,i.height)}):Object.freeze({...r,width:e(r.width,i.width),height:e(r.height,i.height)});if(typeof i!="number")throw TypeError(`Expected second parameter of type Rect or number. Got ${JSON.stringify(i)}`);if(typeof o!="number")throw Error(`Expected third param as height. Got ${JSON.stringify(o)}`);return vt(r)?Object.freeze({...r,x:e(r.x,i),y:e(r.y,o),width:e(r.width,i),height:e(r.height,o)}):Object.freeze({...r,width:e(r.width,i),height:e(r.height,o)})}function pu(e,r,i){return Se(r)?Object.freeze({...r,x:e(r.x,i),y:e(r.y,i),width:e(r.width,i),height:e(r.height,i)}):Object.freeze({...r,width:e(r.width,i),height:e(r.height,i)})}function yu(e,r,i){return Object.freeze({...r,width:e(r.width,i),height:e(r.height,i)})}const Ma=(e,r)=>{let{x:i,y:o,width:a,height:n}=e;switch(r){case"nw":return Object.freeze({x:i,y:o});case"n":return Object.freeze({x:i+a/2,y:o});case"ne":return Object.freeze({x:i+a,y:o});case"sw":return Object.freeze({x:i,y:o+n});case"s":return Object.freeze({x:i+a/2,y:o+n});case"se":return Object.freeze({x:i+a,y:o+n});case"w":return Object.freeze({x:i,y:o+n/2});case"e":return Object.freeze({x:i+a,y:o+n/2});case"center":return Object.freeze({x:i+a/2,y:o+n/2});default:throw Error(`Unknown direction: ${r}`)}},an=(e,r)=>(ft(e),r===void 0&&j(e)?r=e:r===void 0&&(r={x:0,y:0}),du(e,r),Object.freeze({x:r.x+e.width/2,y:r.y+e.height/2})),Pa=Object.freeze({x:NaN,y:NaN}),EA=Object.freeze({x:NaN,y:NaN,z:NaN}),Pr=(e,r)=>{let i=du(e,r);return[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}]},Po=(e,r="circle")=>{if(pe(e)&&O(e,"circle"),Number.isNaN(e.radius))throw Error(`${r}.radius is NaN`);if(e.radius<=0)throw Error(`${r}.radius must be greater than zero`)},Na=(e,r="circle")=>{if(!pe(e))throw Error("Expected a positioned circle with x,y");Po(e,r)},DA=e=>!!(Number.isNaN(e.radius)||pe(e)&&(Number.isNaN(e.x)||Number.isNaN(e.y))),ay=e=>e.x!==void 0&&e.y!==void 0,mi=e=>e.radius!==void 0,pe=e=>mi(e)&&ay(e),ny=(e,r)=>e.radius===r.radius?pe(e)&&pe(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):(!pe(e)&&pe(r),!1):!1;function No(e,r,i,o,a,n){if(Q(e)&&Q(r)||j(e)&&j(r))return[e,r];if(Q(e)){let u={x:r,y:i,z:o};if(!Q(u))throw Error("Expected x, y & z parameters");return[e,u]}if(j(e)){let u={x:r,y:i};if(!j(u))throw Error("Expected x & y parameters");return[e,u]}if(a!==void 0&&o!==void 0){let u={x:e,y:r,z:i},c={x:o,y:a,z:n};if(!Q(u))throw Error("Expected x,y,z for first point");if(!Q(c))throw Error("Expected x,y,z for second point");return[u,c]}let s={x:e,y:r},l={x:i,y:o};if(!j(s))throw Error("Expected x,y for first point");if(!j(l))throw Error("Expected x,y for second point");return[s,l]}function Pe(e,r,i){if(e===void 0)return{x:0,y:0};if(Array.isArray(e)){if(e.length===0)return Object.freeze({x:0,y:0});if(e.length===1)return Object.freeze({x:e[0],y:0});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});throw Error(`Expected array to be 1-3 elements in length. Got ${e.length}.`)}if(j(e))return e;if(typeof e!="number"||typeof r!="number")throw TypeError(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`);return Object.freeze(typeof i=="number"?{x:e,y:r,z:i}:{x:e,y:r})}function Qe(e,r,i,o,a,n){let[s,l]=No(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x+l.x,y:s.y+l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)+(l.z??0)),Object.freeze(u)}function De(e,r,i,o,a,n){let[s,l]=No(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x-l.x,y:s.y-l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)-(l.z??0)),Object.freeze(u)}const AA=(e,r)=>{let i={x:r.b.x-r.a.x,y:r.b.y-r.a.y},o={x:r.a.x-e.x,y:r.a.y-e.y},a=(i.x*o.x+i.y*o.y)*-2,n=2*(i.x*i.x+i.y*i.y),s=Math.sqrt(a*a-2*n*(o.x*o.x+o.y*o.y-e.radius*e.radius));if(Number.isNaN(s))return[];let l=(a-s)/n,u=(a+s)/n,c=[];return l<=1&&l>=0&&c.push({x:r.a.x+i.x*l,y:r.a.y+i.y*l}),u<=1&&u>=0&&c.push({x:r.a.x+i.x*u,y:r.a.y+i.y*u}),c},sy=(e,r)=>{let i=De(r,e),o=Math.hypot(i.y,i.x);if(o>e.radius+r.radius||o<Math.abs(e.radius-r.radius)||ny(e,r))return[];let a=(e.radius*e.radius-r.radius*r.radius+o*o)/(2*o),n={x:e.x+i.x*a/o,y:e.y+i.y*a/o},s=Math.sqrt(e.radius*e.radius-a*a),l={x:-i.y*(s/o),y:i.x*(s/o)};return[Qe(n,l),De(n,l)]},ly=(e,r)=>{let i=e.x-Math.max(r.x,Math.min(e.x,r.x+r.width)),o=e.y-Math.max(r.y,Math.min(e.y,r.y+r.height));return i*i+o*o<e.radius*e.radius},Gf=(e,r)=>sy(e,r).length===2;function Bo(e,r,i){ft(e,"rect");let o=0,a=0;if(typeof r=="number"){if(i===void 0)throw Error("x and y coordinate needed");o=r,a=i}else o=r.x,a=r.y;if(Se(e)){if(o-e.x>e.width||o<e.x||a-e.y>e.height||a<e.y)return!1}else if(o>e.width||o<0||a>e.height||a<0)return!1;return!0}const uy=(e,r)=>{if(!vt(e))throw Error("a parameter should be RectPositioned");if(pe(r))return ly(r,e);if(j(r))return Bo(e,r);throw Error(`Unknown shape for b: ${JSON.stringify(r)}`)};function X(e,r,i,o){let a=Pe(r,i,o);return O(a,"b"),O(e,"a"),Q(a)&&Q(e)?Math.hypot(a.x-e.x,a.y-e.y,a.z-e.z):Math.hypot(a.x-e.x,a.y-e.y)}const gu=(e,r)=>{if(hu(e,"rect"),O(r,"pt"),Bo(e,r))return 0;let i=Math.max(e.x-r.x,0,r.x-e.x+e.width),o=Math.max(e.y-r.y,0,r.y-e.y+e.height);return Math.hypot(i,o)},CA=(e,r)=>X(an(e),r),mu=(e,r)=>e/r;function SA(e,r,i){return Mo(mu,e,r,i)}function FA(e,r){return pu(mu,e,r)}function kA(e,r){return yu(mu,e,r)}const To=(e,r)=>(O(e,"a"),O(r,"b"),e=Object.freeze({...e}),r=Object.freeze({...r}),Object.freeze({a:e,b:r})),zo=(...e)=>{let r=[],i=e[0];for(let o=1;o<e.length;o++)r.push(To(i,e[o])),i=e[o];return r},cy=(e,r)=>{let i=Pr(e,r);return zo(...i,i[0])},ks=(e,r)=>{switch(ft(e),r){case"top":return j(e)?e.x:0;case"bottom":return j(e)?e.x:0;case"left":return j(e)?e.y:0;case"right":return j(e)?e.x+e.width:e.width}},$s=(e,r)=>{switch(ft(e),r){case"top":return j(e)?e.y:0;case"bottom":return j(e)?e.y+e.height:e.height;case"left":return j(e)?e.y:0;case"right":return j(e)?e.y:0}},nn=Object.freeze({width:0,height:0}),sn=Object.freeze({x:0,y:0,width:0,height:0}),$A=(e,...r)=>{let i=r.map(f=>f.x),o=r.map(f=>f.y),a=Math.min(...i,e.x),n=Math.min(...o,e.y),s=Math.max(...i,e.x+e.width),l=Math.max(...o,e.y+e.height),u=Math.max(e.width,s-a),c=Math.max(e.height,l-n);return Object.freeze({...e,x:a,y:n,width:u,height:c})},fy=(e,r,i)=>{O(e,"origin"),zr(r,"width"),zr(i,"height");let o=r/2,a=i/2;return{x:e.x-o,y:e.y-a,width:r,height:i}},MA=e=>({width:e.clientWidth,height:e.clientHeight});function PA(e,r,i,o){if(i===void 0||o===void 0){if(typeof e!="number")throw Error("width is not an number");if(typeof r!="number")throw TypeError("height is not an number");return Object.freeze({width:e,height:r})}if(typeof e!="number")throw Error("x is not an number");if(typeof r!="number")throw Error("y is not an number");if(typeof i!="number")throw Error("width is not an number");if(typeof o!="number")throw Error("height is not an number");return Object.freeze({x:e,y:r,width:i,height:o})}const cr=(e,r,i)=>(zr(r,"width"),zr(i,"height"),O(e,"origin"),{x:e.x,y:e.y,width:r,height:i});function NA(e,r,i,o){if(typeof e=="number")if(typeof r=="number"){if(typeof i=="number"&&typeof o=="number")return{x:e,y:r,width:i,height:o};if(ot(i))return{x:e,y:r,width:i.width,height:i.height};throw TypeError("If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect")}else throw TypeError("If parameter 'a' is a number, expect following parameters to be: y,w,h");else{if(vt(e))return e;if(ot(e)){if(typeof r=="number"&&typeof i=="number")return{width:e.width,height:e.height,x:r,y:i};if(j(r))return{width:e.width,height:e.height,x:r.x,y:r.y};throw TypeError("If param 'a' is a Rect, expects following parameters to be x,y")}else if(j(e)){if(typeof r=="number"&&typeof i=="number")return{x:e.x,y:e.y,width:r,height:i};if(ot(r))return{x:e.x,y:e.y,width:r.width,height:r.height};throw TypeError("If parameter 'a' is a Point, expect following params to be: Rect or width,height")}}throw TypeError("Expect a first parameter to be x,RectPositioned,Rect or Point")}const St=(...e)=>{if(e===void 0)throw Error("parameter 'p' is undefined");if(e.length<2)return!0;for(let r=1;r<e.length;r++)if(e[r].x!==e[0].x||e[r].y!==e[0].y)return!1;return!0},BA=(e,r)=>{if(e===void 0)throw Error("a undefined");if(r===void 0)throw Error("b undefined");return e.width===r.width&&e.height===r.height},dy=(e,r)=>Se(e)&&Se(r)?St(e,r)?e.width===r.width&&e.height===r.height:!1:!Se(e)&&!Se(r)?e.width===r.width&&e.height===r.height:!1,Tt=e=>!(e===void 0||e.a===void 0||e.b===void 0||!j(e.a)||!j(e.b)),hy=e=>Array.isArray(e)?!e.some(i=>!Tt(i)):!1,Oo=(e,r="line")=>{if(e===void 0)throw Error(`${r} undefined`);if(e.a===void 0)throw Error(`${r}.a undefined. Expected {a:Point, b:Point}. Got: ${JSON.stringify(e)}`);if(e.b===void 0)throw Error(`${r}.b undefined. Expected {a:Point, b:Point} Got: ${JSON.stringify(e)}`)},ln=(e,r)=>{let i;if(Tt(e))r=e.b,i=e.a;else if(i=e,r===void 0)throw Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(i)} b: ${JSON.stringify(r)}`);return O(i,"a"),O(i,"b"),[i,r]};function Re(e,r){if(hy(e))return e.reduce((l,u)=>Re(u)+l,0);if(e===void 0)throw TypeError("Parameter 'aOrLine' is undefined");let[i,o]=ln(e,r),a=o.x-i.x,n=o.y-i.y;if(i.z!==void 0&&o.z!==void 0){let s=o.z-i.z;return Math.hypot(a,n,s)}else return Math.hypot(a,n)}const TA=e=>(hu(e,"rect"),cy(e).map(r=>Re(r))),py=(e,r,i,o)=>{if(e.y>i.y)throw Error("topLeft.y greater than bottomRight.y");if(e.y>o.y)throw Error("topLeft.y greater than bottomLeft.y");let a=r.x-e.x,n=i.x-o.x,s=Math.abs(o.y-e.y),l=Math.abs(i.y-r.y);return{x:Math.min(e.x,o.x),y:Math.min(r.y,e.y),width:Math.max(a,n),height:Math.max(s,l)}},bu=(e,r)=>e*r;function zA(e,r,i){return Mo(bu,e,r,i)}function yy(e,r){return pu(bu,e,r)}function OA(e,r){return yu(bu,e,r)}const jA=(e,r)=>{let{x:i,y:o}=r;return i<e.x?i=e.x:i>e.x+e.width&&(i=e.x+e.width),o<e.y?o=e.y:o>e.y+e.height&&(o=e.y+e.height),Object.freeze({...r,x:i,y:o})},gy=Object.freeze({width:NaN,height:NaN}),vu=Object.freeze({x:NaN,y:NaN,width:NaN,height:NaN}),RA=e=>(ft(e),e.height+e.height+e.width+e.width),VA=e=>{let r=Math.max(e.width,e.height);return i=>{if(typeof i=="number")return i/r;if(Q(i))return Object.freeze({...i,x:i.x/r,y:i.y/r,z:i.x/r});if(j(i))return Object.freeze({...i,x:i.x/r,y:i.y/r});throw Error("Param 'value' is neither number nor Point")}},my=(e,r=Math.random)=>{let i=[],o=0;for(let a=0;a<e.length;a++)o+=e[a],i[a]=o;if(o!==1)throw Error(`Weightings should add up to 1. Got: ${o}`);return()=>{let a=r();for(let n=0;n<i.length;n++)if(a<=i[n])return n;throw Error("Bug: weightedIndex could not select index")}},by=(e,r=Math.random)=>Math.floor(r()*e.length);function LA(e,r={}){if(e===void 0)throw Error("Param 'array' is undefined");if(!Array.isArray(e))throw Error("Param 'array' is not an array");let i=r.mutate??!1,o=r.source??Math.random;if(e.length===0)return i?void 0:{value:void 0,remainder:[]};let a=by(e,o);if(i){let n=e[a];return e.splice(a,1),n}else{let n=[...e];return n.splice(a,1),{value:e[a],remainder:n}}}const vy=(e,r=Math.random)=>(w(Ve(e,"array")),e[Math.floor(r()*e.length)]),IA=(e,r,i=Math.random)=>{if(e.length!==r.length)throw Error("Lengths of 'array' and 'weightings' should be the same.");let o=my(r,i);return()=>{let a=o();return e[a]}},Ms=(e,r=Math.random)=>{let i=[...e];for(let o=i.length-1;o>0;o--){let a=Math.floor(r()*(o+1));[i[o],i[a]]=[i[a],i[o]]}return i},qA=(e,r,i,o)=>{let a=o??Math.random,n=l=>typeof l=="function"?l():l,s=n(e);return w(C(s,"percentage","p")),a()<=s?n(i):n(r)},wy=e=>{let r=un(e);return()=>r()*2-1},_A=e=>wy(e)(),un=(e=1)=>{let r=typeof e=="number"?{max:e}:e,i=r.max??1,o=r.min??0,a=r.source??Math.random;if(w(C(o,"","min"),C(i,"","max")),!r.min&&i<0&&(o=i,i=0),o>i)throw Error(`Min is greater than max. Min: ${o.toString()} max: ${i.toString()}`);return()=>a()*(i-o)+o},xy=(e=1)=>un(e)(),Ps=(e=Math.random)=>{let r=0;for(;r===0;)r=e();return r},WA=(e=1)=>Ey(e)(),Ey=(e=1)=>{let r=0,i=1,o=()=>{let a=Ps(),n=Ps(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*n);return s=s/10+.5,s>1||s<0?s=o():(s**=+e,s*=i-r,s+=r),s};return o},wu=(e={})=>{let r=e.source??Math.random,i=Math.trunc(r()*46656),o=Math.trunc(r()*46656),a=`000${i.toString(36)}`.slice(-3),n=`000${o.toString(36)}`.slice(-3);return a+n};function*GA(e,r=0){if(w(G(e,"","amount"),G(r,"","offset")),e===0)return;let i=0;do yield e<0?-i+r:i+r;while(i++<Math.abs(e)-1)}const xu=e=>{if(e===void 0)throw TypeError("maxOrOptions is undefined");let r=typeof e=="number"?{max:e}:e,i=Math.floor(r.max??100),o=Math.floor(r.min??0);!r.min&&i<0&&(i=1,o=r.max??0);let a=r.source??Math.random;if(o>i)throw Error(`Min value is greater than max (min: ${o.toString()} max: ${i.toString()})`);if(w(C(o,"","min"),C(i,"","max")),i===o)throw Error(`Max and min values cannot be the same (${i.toString()})`);let n=Math.abs(i-o);return()=>Math.floor(a()*n)+o},Dy=e=>xu(e)();function*UA(e){let r=typeof e=="number"?{max:e}:e,i=r.min??0,o=r.max??100,a=r.source??Math.random,n=r.loop??!1;if(w(G(i,"","min"),G(o,"","max")),i>o)throw Error(`Min value is greater than max. Min: ${i.toString()} Max: ${o.toString()}`);let s=[...GA(o-i,i)],l=Ms(s),u=0;for(;;){if(u===l.length)if(n)l=Ms(s,a);else return;yield l[u++]}}function JA(e){e||=Math.random()*4294967295;let r=Array(624);r[0]=e>>>0;let i=1812433253;for(let l=1;l<624;l++){let u=r[l-1]^r[l-1]>>>30;r[l]=((i&4294901760)*u>>>0)+((i&65535)*u>>>0)+l>>>0}let o=624,a=()=>{let l;if(o>=624){for(let u=0;u<227;u++)l=(r[u]&2147483648|r[u+1]&2147483647)>>>0,r[u]=(r[u+397]^l>>>1^(l&1?2567483615:0))>>>0;for(let u=227;u<623;u++)l=(r[u]&2147483648|r[u+1]&2147483647)>>>0,r[u]=(r[u-227]^l>>>1^(l&1?2567483615:0))>>>0;l=(r[623]&2147483648|r[0]&2147483647)>>>0,r[623]=(r[396]^l>>>1^(l&1?2567483615:0))>>>0,o=0}return l=r[o++],l=(l^l>>>11)>>>0,l=(l^l<<7&2636928640)>>>0,l=(l^l<<15&4022730752)>>>0,l=(l^l>>>18)>>>0,l};return{integer:(l,u=0)=>{if(l<1)throw Error("Upper bound must be greater than or equal to 1");if(l>4294967296)throw Error("Upper bound must not be greater than 4294967296");if(l===1)return 0;let c=l-u,f=Math.ceil(Math.log2(c)),d=(1<<f)-1;for(;;){let h=a()&d;if(h<c)return u+h}},float:()=>a()/4294967296}}const Ay=(e=5)=>{let r=typeof e=="number"?{length:e}:e,i=r.source??Math.random,o=r.length??5,a="";for(;a.length<o;)a+=i().toString(36).slice(2);return a.substring(0,o)},Cy=e=>{let r=typeof e=="number"?{max:e}:e,i=(r.min??0)*60*1e3,o=(r.max??5)*60*1e3;return xu({...r,max:o,min:i})},HA=e=>Cy(e)(),Sy=e=>{let r=typeof e=="number"?{max:e}:e,i=(r.min??0)*1e3,o=(r.max??5)*1e3;return()=>Dy({...r,max:o,min:i})},KA=e=>Sy(e)();function QA(e,r=0,i=1){return e<r?r:e>i?i:e}const Fy=e=>{let r=e.source??Math.random;if(e.easingFunction===void 0)throw Error("Param 'easingFunction' is undefined");let i=e.max??1,o=e.min??0;if(i===o)throw Error("Param 'max' is the same as  'min'");if(i<o)throw Error("Param 'max' should be greater than  'min'");return()=>{let n=QA(e.easingFunction(r()));return Math.floor(n*(i-o))+o}},ZA=e=>Fy(e)(),XA=e=>ky(e)(),ky=e=>{let r=e.source??Math.random;if(e.easingFunction===void 0)throw Error("Param 'easingFunction' is undefined");return()=>{let o=r();return e.easingFunction(o)}};var YA={};A(YA,{bipolar:()=>_A,bipolarSource:()=>wy,calculateNonZero:()=>Ps,chance:()=>qA,float:()=>xy,floatSource:()=>un,gaussian:()=>WA,gaussianSource:()=>Ey,integer:()=>Dy,integerSource:()=>xu,integerUniqueGen:()=>UA,mersenneTwister:()=>JA,minutesMs:()=>HA,minutesMsSource:()=>Cy,randomElement:()=>vy,randomElementWeightedSource:()=>IA,randomIndex:()=>by,randomPluck:()=>LA,secondsMs:()=>KA,secondsMsSource:()=>Sy,shortGuid:()=>wu,shuffle:()=>Ms,string:()=>Ay,weighted:()=>XA,weightedIndex:()=>my,weightedInteger:()=>ZA,weightedIntegerSource:()=>Fy,weightedSource:()=>ky});const eC=e=>(e??=Math.random,Object.freeze({x:e(),y:e(),width:e(),height:e()})),$y=(e,r={})=>{let i=r.randomSource??Math.random,o=r.margin??{x:0,y:0},a=i()*(e.width-o.x-o.x),n=i()*(e.height-o.y-o.y),s={x:a+o.x,y:n+o.y};return Se(e)?Qe(s,e):Object.freeze(s)},tC=(e,r)=>e-r;function rC(e,r,i){return Mo(tC,e,r,i)}function My(e,r,i){let o=typeof r=="number"?r:r.width,a=typeof r=="number"?i:r.height;if(a===void 0)throw Error("Expected height as third parameter");return{...e,width:e.width-o,height:e.height-a}}function iC(e,r){let i=0,o=0;Se(e)&&(i=e.x,o=e.y);let a=0,n=0;return Se(r)&&(a=r.x,n=r.y),Object.freeze({...e,x:i-a,y:o-n,width:e.width-r.width,height:e.height-r.height})}const oC=(e,r)=>e+r;function aC(e,r,i){return Mo(oC,e,r,i)}function nC(e,r){let i=0,o=0;Se(e)&&(i=e.x,o=e.y);let a=0,n=0;return Se(r)&&(a=r.x,n=r.y),Object.freeze({...e,x:i+a,y:o+n,width:e.width+r.width,height:e.height+r.height})}function sC(e){if(Se(e))return[e.x,e.y,e.width,e.height];if(ot(e))return[e.width,e.height];throw Error(`Param 'rect' is not a rectangle. Got: ${JSON.stringify(e)}`)}var Py={};A(Py,{Empty:()=>nn,EmptyPositioned:()=>sn,Placeholder:()=>gy,PlaceholderPositioned:()=>vu,applyDim:()=>yu,applyFields:()=>oy,applyMerge:()=>Mo,applyScalar:()=>pu,area:()=>xA,cardinal:()=>Ma,center:()=>an,corners:()=>Pr,distanceFromCenter:()=>CA,distanceFromExterior:()=>gu,divide:()=>SA,divideDim:()=>kA,divideScalar:()=>FA,dividerByLargestDimension:()=>VA,edges:()=>cy,encompass:()=>$A,fromCenter:()=>fy,fromElement:()=>MA,fromNumbers:()=>PA,fromTopLeft:()=>cr,getEdgeX:()=>ks,getEdgeY:()=>$s,getRectPositioned:()=>du,getRectPositionedParameter:()=>NA,guard:()=>ft,guardDim:()=>zr,guardPositioned:()=>hu,intersectsPoint:()=>Bo,isEmpty:()=>wA,isEqual:()=>dy,isEqualSize:()=>BA,isIntersecting:()=>uy,isPlaceholder:()=>iy,isPositioned:()=>Se,isRect:()=>ot,isRectPositioned:()=>vt,lengths:()=>TA,maxFromCorners:()=>py,multiply:()=>zA,multiplyDim:()=>OA,multiplyScalar:()=>yy,nearestInternal:()=>jA,perimeter:()=>RA,random:()=>eC,randomPoint:()=>$y,subtract:()=>rC,subtractOffset:()=>iC,subtractSize:()=>My,sum:()=>aC,sumOffset:()=>nC,toArray:()=>sC});function Ny(e){if(Q(e))return Object.freeze({...e,x:Math.abs(e.x),y:Math.abs(e.y),z:Math.abs(e.z)});if(j(e))return Object.freeze({...e,x:Math.abs(e.x),y:Math.abs(e.y)});throw TypeError("Param 'pt' is not a point")}const Ke=Math.PI*2,Ft=(e,r,i)=>(O(e,"a"),r===void 0?Math.atan2(e.y,e.x):(O(r,"b"),i===void 0?Math.atan2(r.y-e.y,r.x-e.x):(O(i,"c"),Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(i.y-e.y,i.x-e.x)))),lC=(e,r,i)=>{let o=Ft(e,r,i);return o<0?o+Ke:o};function uC(e,r){return O(e,"pt"),Q(e)?Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y"),z:r(e.z,"z")}):Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y")})}function cC(e,r){let i,o,a;switch(e){case"moving-average-light":let n=r.scaling??3;i=to(n),o=to(n),a=to(n);break;default:throw Error(`Unknown averaging kind '${e}'. Expected: 'moving-average-light'`)}return n=>{let s=i(n.x),l=o(n.y);if(Q(n)){let u=a(n.z);return Object.freeze({x:s,y:l,z:u})}else return Object.freeze({x:s,y:l})}}function Ht(e,...r){if(r.length===0)throw Error("No points provided");let i=r[0];for(let o of r)i=(Q(i)&&Q(o),e(i,o));return i}const jo=(...e)=>{let r=Ht((c,f)=>c.x<f.x?c:f,...e),i=Ht((c,f)=>c.x>f.x?c:f,...e),o=Ht((c,f)=>c.y<f.y?c:f,...e),a=Ht((c,f)=>c.y>f.y?c:f,...e),n={x:r.x,y:o.y},s={x:i.x,y:o.y},l={x:i.x,y:a.y},u={x:r.x,y:a.y};return py(n,s,l,u)},fC=(...e)=>{let r=jo(...e),i=Ht((a,n)=>a.z<n.z?a:n,...e),o=Ht((a,n)=>a.z>n.z?a:n,...e);return{...r,z:i.z,depth:o.z-i.z}},By=(...e)=>{if(!Array.isArray(e))throw Error("Expected list of points");let r=e.reduce((i,o)=>{if(o===void 0)return i;if(Array.isArray(o))throw TypeError("'points' list contains an array. Did you mean: centroid(...myPoints)?");if(!j(o))throw Error(`'points' contains something which is not a point: ${JSON.stringify(o)}`);return{x:i.x+o.x,y:i.y+o.y}},{x:0,y:0});return Object.freeze({x:r.x/e.length,y:r.y/e.length})};function dC(e,r=0,i=1){return Q(e)?Object.freeze({x:ie(e.x,r,i),y:ie(e.y,r,i),z:ie(e.z,r,i)}):Object.freeze({x:ie(e.x,r,i),y:ie(e.y,r,i)})}const Ty=(e,r)=>e.x<r.x&&e.y<r.y?-2:e.x>r.x&&e.y>r.y?2:e.x<r.x||e.y<r.y?-1:e.x>r.x||e.y>r.y?1:e.x===r.x&&e.x===r.y?0:NaN,zy=(e,r)=>e.x===r.x?0:e.x<r.x?-1:1,hC=(e,r)=>e.y===r.y?0:e.y<r.y?-1:1,pC=(e,r)=>e.z===r.z?0:e.z<r.z?-1:1,yC=(...e)=>{let r=[...e].sort(zy);if(r.length===1)return r;let i=n=>{let s=[];for(let l of n){for(;s.length>=2;){let u=s.at(-1),c=s.at(-2);if((u.x-c.x)*(l.y-c.y)>=(u.y-c.y)*(l.x-c.x))s.pop();else break}s.push(l)}return s.pop(),s},o=i(r),a=i(r.reverse());return o.length===1&&a.length===1&&St(a[0],o[0])?o:[...o,...a]},Eu=(e,r)=>(Na(e,"a"),pe(r)&&Na(r,"b"),X(e,r)),Du=(e,r)=>{if(Na(e,"a"),pe(r))return Math.max(0,Eu(e,r)-e.radius-r.radius);if(j(r)){let i=X(e,r);return i<e.radius?0:i}else throw Error("Second parameter invalid type")},gC=(e,r)=>{if(vt(r))return gu(r,e);if(pe(r))return Du(r,e);if(j(r))return X(e,r);throw Error("Unknown shape")},mC=(e,r)=>{if(vt(r))return gu(r,e);if(pe(r))return Du(r,e);if(j(r))return X(e,r);throw Error("Unknown shape")};function so(e,r,i,o,a,n){let[s,l]=No(e,r,i,o,a,n);if(O(s,"a"),O(l,"b"),l.x===0)throw TypeError("Cannot divide by zero (b.x is 0)");if(l.y===0)throw TypeError("Cannot divide by zero (b.y is 0)");let u={x:s.x/l.x,y:s.y/l.y};if(Q(s)||Q(l)){if(l.z===0)throw TypeError("Cannot divide by zero (b.z is 0)");u.z=(s.z??0)/(l.z??0)}return Object.freeze(u)}function bC(e,r,i){let o=Pe(e,r,i);return ry(o,"divisor"),(a,n,s)=>{let l=Pe(a,n,s);return l.z===void 0?Object.freeze({x:l.x/o.x,y:l.y/o.y}):Object.freeze({x:l.x/o.x,y:l.y/o.y,z:l.z/(o.z??1)})}}const Oy=e=>[e.x,e.y],jy=(...e)=>{let r=e.map(i=>Oy(i));return rp(r)},ee={x:0,y:0},Ry={x:1,y:1},vC={x:0,y:0,z:0},wC={x:1,y:1,z:1};function xC(e,r,i){if(Array.isArray(e)){if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});throw Error(`Expected array of length two or three, got ${e.length}`)}else{if(e===void 0)throw Error("Requires an array of [x,y] or x,y parameters at least");if(Number.isNaN(e))throw Error("x is NaN");if(r===void 0)throw Error("Param 'y' is missing");if(Number.isNaN(r))throw Error("y is NaN");return Object.freeze(i===void 0?{x:e,y:r}:{x:e,y:r,z:i})}}const EC=e=>{if(typeof e!="string")throw TypeError(`Param 'str' ought to be a string. Got: ${typeof e}`);let r=e.indexOf(","),i=Number.parseFloat(e.substring(0,r)),o=e.indexOf(",",r+1);if(o>0){let a=Number.parseFloat(e.substring(r+1,o-r+2)),n=Number.parseFloat(e.substring(o+1));return{x:i,y:a,z:n}}else{let a=Number.parseFloat(e.substring(r+1));return{x:i,y:a}}},Au=(...e)=>{let r=[];if(Array.isArray(e[0]))for(let i of e){if(i.length%2!=0)throw Error("coords array should be even-numbered");r.push(Object.freeze({x:i[0],y:i[1]}))}else{if(e.length%2!=0)throw Error("Expected even number of elements: [x,y,x,y...]");for(let i=0;i<e.length;i+=2)r.push(Object.freeze({x:e[i],y:e[i+1]}))}return r};function Vy(e){return Oo(e,"line"),{a:e.b,b:e.a}}function Nt(e,r,i,o){typeof i=="boolean"&&(o=i,i=void 0),w(o?C(e,"","amount"):tt(e,"amount"));let[a,n]=ln(r,i),s=Re(a,n),l=s*(1-e);if(s===0&&l===0)return Object.freeze({...n});let u=n.x-l*(n.x-a.x)/s,c=n.y-l*(n.y-a.y)/s;return Object.freeze({...n,x:u,y:c})}function DC(e,r,i=!0){i||(e=Vy(e));let o=e.b.x-e.a.x,a=e.b.y-e.a.y,n=Math.atan2(a,o),s=r*Math.cos(n),l=r*Math.sin(n);return{x:s+e.a.x,y:l+e.a.y}}const fa=(e,r,i,o=!1)=>Nt(e,r,i,o),kr=(e,r="both")=>{switch(r){case"both":return Q(e)?Object.freeze({...e,x:e.x*-1,y:e.y*-1,z:e.z*-1}):Object.freeze({...e,x:e.x*-1,y:e.y*-1});case"x":return Object.freeze({...e,x:e.x*-1});case"y":return Object.freeze({...e,y:e.y*-1});case"z":if(Q(e))return Object.freeze({...e,z:e.z*-1});throw Error("pt parameter is missing z");default:throw Error("Unknown what parameter. Expecting 'both', 'x' or 'y'")}};function hr(e,r,i,o,a,n){let[s,l]=No(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x*l.x,y:s.y*l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)*(l.z??0)),Object.freeze(u)}const mt=(e,r)=>Q(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,z:e.z*r}):Object.freeze({...e,x:e.x*r,y:e.y*r}),Cu=(e,r=1,i=0)=>{let o=X(e),a=1;return o>r?a=r/o:o<i&&(a=i/o),a===1?e:hr(e,a,a)},AC=(...e)=>Ht((r,i)=>r.x<=i.x?r:i,...e),CC=(...e)=>Ht((r,i)=>r.x>=i.x?r:i,...e),SC=(e,r)=>{if(j(e)&&(r=e.y,e=e.x),r===void 0)throw Error("Expected y");return Math.hypot(e,r)},Ro=(e,r)=>{let i=Pe(e,r),o=SC(i);return o===0?ee:Object.freeze({...i,x:i.x/o,y:i.y/o})};function Ns(e,r,i,o){if(j(e)){if(typeof r=="number"&&i!==void 0)w(C(r,"positive","width"),C(i,"positive","height"));else{if(!ot(r))throw Error("Expected second parameter to be a rect");i=r.height,r=r.width}return Object.freeze({x:e.x/r,y:e.y/i})}else{if(w(C(e,"positive","x")),typeof r!="number")throw TypeError("Expecting second parameter to be a number (width)");if(typeof i!="number")throw TypeError("Expecting third parameter to be a number (height)");if(w(C(r,"positive","y")),w(C(i,"positive","width")),o===void 0)throw Error("Expected height parameter");return w(C(o,"positive","height")),Object.freeze({x:e/i,y:r/o})}}const Ly=(e,...r)=>Su(...r)(e),Su=(...e)=>r=>e.reduce((i,o)=>o(i),r);var Iy=class extends Ze{#e;#t;constructor(e){super(),this.#e=new Map,e===void 0&&(e=r=>{if(r===void 0)throw Error("Cannot create key for undefined");return typeof r=="string"?r:JSON.stringify(r)}),this.#t=e}clear(){this.#e.clear(),this.fireEvent("change",{context:this})}keys(){return this.#e.keys()}values(){return this.#e.values()}toArray(){return[...this.#e.entries()]}debugString(){let e="";for(let[r,i]of this.#e.entries())e+=`${r}: ${i.toString()}, `;return e.endsWith(", ")?e.slice(0,Math.max(0,e.length-2)):e}frequencyOf(e){if(typeof e=="string")return this.#e.get(e);let r=this.#t(e);return this.#e.get(r)}relativeFrequencyOf(e){let r;if(typeof e=="string")r=this.#e.get(e);else{let o=this.#t(e);r=this.#e.get(o)}if(r===void 0)return;let i=this.computeValues();return r/i.total}entries(){return[...this.#e.entries()]}computeValues(){let e=[...this.values()];return $o(e)}entriesSorted(e="value"){return _1(e)(this.entries())}add(...e){if(e===void 0)throw Error("Param 'values' undefined");let r=e.map(i=>this.#t(i));for(let i of r){let o=this.#e.get(i)??0;this.#e.set(i,o+1)}this.fireEvent("change",{context:this})}};const FC=e=>new Iy(e);var Fu=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(e={}){this.id=e.id??"tracker",this.debug=e.debug??!1,this.sampleLimit=e.sampleLimit??-1,this.resetAfterSamples=e.resetAfterSamples??-1,this.storeIntermediate=e.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed("resize")),this.seenCount+=e.length;let r=this.filterData(e);return this.computeResults(r)}},qy=class extends Fu{values;timestamps;constructor(e){super(e),this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(e){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){let r=e.at(-1),i={value:r,at:performance.now()},o=e.map(a=>({at:performance.now(),value:a}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...o.map(a=>a.at));else switch(this.values.length){case 0:this.values.push(i.value),this.timestamps.push(i.at);break;case 2:this.values[1]=i.value,this.timestamps[1]=i.at;break;case 1:this.values.push(i.value),this.timestamps.push(i.at);break}return o}},ku=class extends qy{total=0;min=2**53-1;max=-9007199254740991;get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=2**53-1,this.max=-9007199254740991,this.total=0,super.onReset()}onTrimmed(e){this.min=ou(this.values),this.max=iu(this.values),this.total=ap(this.values)}computeResults(e){if(e.some(o=>Number.isNaN(o)))throw Error("Cannot add NaN");let r=e.map(o=>o.value);return this.total=r.reduce((o,a)=>o+a,this.total),this.min=Math.min(...r,this.min),this.max=Math.max(...r,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}};const da=(e={})=>new ku(e);var _y=class extends ku{lastMark=0;mark(){this.lastMark>0&&this.seen(performance.now()-this.lastMark),this.lastMark=performance.now()}};const kC=e=>new _y(e),Ba=(e,r="")=>typeof e=="object"&&"name"in e&&e.name!==void 0?e.name:r;function*$u(e,r){r===void 0&&(r=Ba(e));for(let[i,o]of Bs(e))yield[o,r];for(let[i,o]of Bs(e)){let a=Ba(o,"?"),n=r.length>0?r+"."+a:a;yield*$u(o,n)}}function*$C(e,r){r===void 0&&(r=Ba(e));for(let[i,o]of Bs(e)){yield[o,r];let a=Ba(o,"?"),n=r.length>0?r+"."+a:a;yield*$u(o,n)}}function MC(e){return e.seq!==void 0}function PC(e){return e.sel!==void 0}function*Bs(e){if(MC(e))yield*e.seq.entries();else if(PC(e))yield*e.sel.entries();else if(typeof e!="string")throw TypeError("Unexpected shape of node. seq/sel missing")}const NC=async(e,r)=>{let i=typeof r=="number"?{millis:r}:r,o=i.delay??"before";(o==="before"||o==="both")&&await Ee(i);let a=Promise.resolve(await e());return(o==="after"||o==="both")&&await Ee(i),a};async function*BC(){let e,r=new Promise(a=>e=a),i=0,o=()=>{e&&e(),r=new Promise(a=>e=a)};try{for(;;)i=globalThis.requestAnimationFrame(o),yield await r}finally{e&&e(),globalThis.cancelAnimationFrame(i)}}async function*Wy(e){let r=R(e);if(r===void 0)throw Error("timeout is undefined");if(r<0)throw Error("Timeout is less than zero");if(r===0)return yield*BC();let i,o=new Promise(s=>i=s),a,n=()=>{i&&i(),o=new Promise(s=>i=s)};try{for(;;)a=globalThis.setTimeout(n,r),yield await o}finally{i&&i(),a!==void 0&&globalThis.clearTimeout(a),a=void 0}}const bi=(e,r)=>{if(e===void 0)throw Error("callback parameter is undefined");let i=R(r);w(G(i,"aboveZero","interval"));let o,a=0,n=0,s=0,l="idle",u=()=>{a=0,globalThis.clearTimeout(o),l="idle"},c=async(d=r,h)=>new Promise((y,g)=>{a=performance.now();let m=R(d),v=G(m,"aboveZero","altTimeoutMs");if(Ct(v)){g(Lr(v));return}switch(l){case"scheduled":f();break}l="scheduled",o=globalThis.setTimeout(async()=>{if(l!=="scheduled"){console.warn("Timeout skipping execution since state is not 'scheduled'"),u();return}let D=h??[];n++,s++,l="running",await e(performance.now()-a,...D),l="idle",u(),y()},m)}),f=()=>{l!=="idle"&&u()};return{start:c,cancel:f,get runState(){return l},get startCount(){return n},get startCountTotal(){return s}}},TC=(e,r)=>{let i=bi(e,r);return(...o)=>{i.start(void 0,o)}};var Mu=class{#e;#t=0;#r=Math.floor(Math.random()*100);constructor(){this.#e=[]}isEmpty(){return this.#e.length===0}add(e,r={}){this.#t++;let i=r.once??!1,o={id:`${this.#r} - ${this.#t}`,handler:e,once:i};return this.#e.push(o),o.id}remove(e){let r=this.#e.length;return this.#e=this.#e.filter(i=>i.id!==e),this.#e.length!==r}notify(e){for(let r of this.#e)r.handler(e),r.once&&this.remove(r.id)}clear(){this.#e=[]}};const zC=(e,r)=>{w(G(e,"positive","nth"));let i=0;return o=>(i++,i===e?(i=0,r&&r(o),!0):!1)},Pu=async(e,r={},i)=>{let o=[],a=r.rank??Ao,n=Array.isArray(e)?e:[e];r.shuffle&&(n=il(n));for(let s=0;s<n.length;s++){let l=n[s],u;if(u=typeof l=="function"?await l(i):l,u!==void 0&&(o.push(u),o.sort(a)),r.stop!==void 0&&r.stop(u,o))break}return r.filter?o.filter(r.filter):o},OC=async(e,r={},i)=>{let o=await Pu(e,r,i);if(!o||o.length===0)return;let a=r.at??-1;return o.at(a)},Gy=(e,r,i={})=>{let o=i.timeoutMs??601e3,a=i.signal,n=!1,s=!1,l;return new Promise((c,f)=>{let d=p=>{"type"in p?r.includes(p.type)?(n=!0,c(p),h()):console.warn(`eventRace: Got event '${p.type}' that is not in race list`):(console.warn("eventRace: Event data does not have expected 'type' field"),console.log(p))};for(let p of r)e.addEventListener(p,d);let h=()=>{if(!s){l!==void 0&&clearTimeout(l),l=void 0,s=!0;for(let p of r)e.removeEventListener(p,d)}};l=setTimeout(()=>{n||s||(h(),f(Error(`eventRace: Events not fired within interval. Events: ${JSON.stringify(r)} Interval: ${o}`)))},o),a?.addEventListener("abort",()=>{n||s||(h(),f(Error(`Abort signal received ${a.reason}`)))})})},jC=e=>{let r=to(),i=Qy({...e,whatToCall:o=>{r(o)},fallback(){return e.default??0}});return o=>(i(o),r())};var Uy=class extends Ze{key;resource;_lastUpdate;_pool;_state;_userExpireAfterMs;constructor(e,r){super(),this.key=e,this.resource=r,this._lastUpdate=performance.now(),this._pool=r.pool,this._userExpireAfterMs=this._pool.userExpireAfterMs,this._state="idle",this._pool.log.log(`PoolUser ctor key: ${this.key}`)}toString(){return this.isDisposed?"PoolUser. State: disposed":`PoolUser. State: ${this._state} Elapsed: ${performance.now()-this._lastUpdate} Data: ${JSON.stringify(this.resource.data)}`}keepAlive(){if(this._state==="disposed")throw Error("PoolItem disposed");this._lastUpdate=performance.now()}_dispose(e,r){if(this._state==="disposed")return;let i=this.resource;this._state="disposed",i._release(this),this._pool.log.log(`PoolUser dispose key: ${this.key} reason: ${e}`),this.fireEvent("disposed",{data:r,reason:e}),super.clearEventListeners()}release(e){if(this.isDisposed)throw Error("User disposed");let r=this.resource,i=r.data;this._pool.log.log(`PoolUser release key: ${this.key} reason: ${e}`),this.fireEvent("released",{data:i,reason:e}),this._dispose(`release-${e}`,i)}get data(){if(this.isDisposed)throw Error("User disposed");return this.resource.data}get isExpired(){return this._userExpireAfterMs>0?performance.now()>this._lastUpdate+this._userExpireAfterMs:!1}get elapsed(){return performance.now()-this._lastUpdate}get isDisposed(){return this._state==="disposed"}get isValid(){return!(this.isDisposed||this.isExpired||this.resource.isDisposed)}},Jy=class{pool;#e;#t;#r;#i;#o;#a;constructor(e,r){if(this.pool=e,r===void 0)throw Error("Parameter 'data' is undefined");if(e===void 0)throw Error("Parameter 'pool' is undefined");this.#t=r,this.#a=0,this.#o=e.resourcesWithoutUserExpireAfterMs,this.#i=e.capacityPerResource,this.#r=[],this.#e="idle"}get data(){if(this.#e==="disposed")throw Error("Resource disposed");return this.#t}updateData(e){if(this.#e==="disposed")throw Error("Resource disposed");if(e===void 0)throw Error("Parameter 'data' is undefined");this.#t=e}toString(){return`Resource (expired: ${this.isExpiredFromUsers} users: ${this.#r.length}, state: ${this.#e}) data: ${JSON.stringify(this.data)}`}_assign(e){if(this.#r.find(i=>i===e||i.key===e.key))throw Error("User instance already assigned to resource");this.#r.push(e),this.#a=performance.now()}_release(e){this.#r=this.#r.filter(r=>r!==e),this.pool._release(e),this.#a=performance.now()}get hasUserCapacity(){return this.usersCount<this.#i}get usersCount(){return this.#r.length}get isExpiredFromUsers(){return this.#o<=0||this.#r.length>0?!1:performance.now()>this.#o+this.#a}get isDisposed(){return this.#e==="disposed"}dispose(e){if(this.#e==="disposed")return;let r=this.#t;this.#e="disposed",this.pool.log.log(`Resource disposed (${e})`);for(let i of this.#r)i._dispose(`resource-${e}`,r);this.#r=[],this.#a=performance.now(),this.pool._releaseResource(this,e),this.pool.freeResource&&this.pool.freeResource(r)}},Hy=class{_resources;_users;capacity;userExpireAfterMs;resourcesWithoutUserExpireAfterMs;capacityPerResource;fullPolicy;generateResource;freeResource;log=ys("Pool");constructor(e={}){this.capacity=e.capacity??-1,this.fullPolicy=e.fullPolicy??"error",this.capacityPerResource=e.capacityPerResource??1,this.userExpireAfterMs=e.userExpireAfterMs??-1,this.resourcesWithoutUserExpireAfterMs=e.resourcesWithoutUserExpireAfterMs??-1,this.generateResource=e.generate,this.freeResource=e.free,this._users=new Map,this._resources=[],this.log=ys("Pool",e.debug??!1);let r=Math.max(this.userExpireAfterMs,this.resourcesWithoutUserExpireAfterMs);r>0&&setInterval(()=>{this.maintain()},r*1.1)}dumpToString(){let e=`Pool
    capacity: ${this.capacity} userExpireAfterMs: ${this.userExpireAfterMs} capacityPerResource: ${this.capacityPerResource}
    resources count: ${this._resources.length}`,r=this._resources.map(i=>i.toString()).join(`\r
	`);e+=`\r
Resources:\r
	`+r,e+=`\r
Users: \r
`;for(let[i,o]of this._users.entries())e+=`	k: ${i} v: ${o.toString()}\r
`;return e}getUsersByLongestElapsed(){return[...this._users.values()].sort((e,r)=>{let i=e.elapsed,o=r.elapsed;return i===o?0:i<o?1:-1})}getResourcesSortedByUse(){return[...this._resources].sort((e,r)=>e.usersCount===r.usersCount?0:e.usersCount<r.usersCount?-1:1)}addResource(e){if(e===void 0)throw Error("Cannot add undefined resource");if(e===null)throw TypeError("Cannot add null resource");if(this.capacity>0&&this._resources.length===this.capacity)throw Error(`Capacity limit (${this.capacity}) reached. Cannot add more.`);this.log.log(`Adding resource: ${JSON.stringify(e)}`);let r=new Jy(this,e);return this._resources.push(r),r}maintain(){let e=!1,r=[];for(let o of this._resources)o.isDisposed?(this.log.log(`Maintain, disposed resource: ${JSON.stringify(o.data)}`),r.push(o)):o.isExpiredFromUsers&&(this.log.log(`Maintain, expired resource: ${JSON.stringify(o.data)}`),r.push(o));if(r.length>0){for(let o of r)o.dispose("diposed/expired");e=!0}let i=[];for(let[o,a]of this._users.entries())a.isValid||(this.log.log(`Maintain. Invalid user: ${a.key} (Disposed: ${a.isDisposed} Expired: ${a.isExpired} Resource disposed: ${a.resource.isDisposed})`),i.push(o),a._dispose("invalid",a.data));for(let o of i)this._users.delete(o),e=!0;e&&this.log.log(`End: resource len: ${this._resources.length} users: ${this.usersLength}`)}*resources(){let e=[...this._resources];for(let r of e)yield r}*values(){let e=[...this._resources];for(let r of e)yield r.data}release(e,r){let i=this._users.get(e);i&&i.release(r??"Pool.release")}_release(e){this._users.delete(e.key)}_releaseResource(e,r){this._resources=this._resources.filter(i=>i!==e)}hasResource(e){return this._resources.find(i=>i.data===e)!==void 0}hasUser(e){return this._users.has(e)}_assign(e,r){let i=new Uy(e,r);return this._users.set(e,i),r._assign(i),i}#e(e){let r=this.getResourcesSortedByUse();if(r.length>0&&r[0].hasUserCapacity)return this._assign(e,r[0]);if(this.generateResource&&(this.capacity<0||this._resources.length<this.capacity)){this.log.log(`capacity: ${this.capacity} resources: ${this._resources.length}`);let i=this.addResource(this.generateResource());return this._assign(e,i)}}get usersLength(){return[...this._users.values()].length}useValue(e){return this.use(e).resource.data}use(e){let r=this._users.get(e);if(r)return r.keepAlive(),r;this.maintain();let i=this.#e(e);if(i)return i;if(this.fullPolicy==="error")throw Error(`Pool is fully used (fullPolicy: ${this.fullPolicy}, capacity: ${this.capacity})`);if(this.fullPolicy==="evictOldestUser"){let o=this.getUsersByLongestElapsed();if(o.length>0){this.release(o[0].key,"evictedOldestUser");let a=this.#e(e);if(a)return a}}throw Error(`Pool is fully used (${this.fullPolicy})`)}};const RC=(e={})=>new Hy(e);function Ky(){let e,r;return{promise:new Promise((o,a)=>{e=o,r=a}),resolve:e,reject:r}}const Qy=e=>{let r=!1,i=bi(()=>{r||(i.start(),e.whatToCall(e.fallback()))},e.interval);return e.abort&&e.abort.addEventListener("abort",o=>{r=!0,i.cancel()}),i.start(),o=>{if(r)throw Error("AbortSignal has been fired");i.start(),e.whatToCall(o)}};async function*Zy(e,r){let i=r.signal??void 0,o=r.delayWhen??"before",a=r.count??void 0,n=r.allowUndefined??!1,s=r.delayMinimum?R(r.delayMinimum):void 0,l=r.while,u=!1,c=R(r.delay,R(r.delayMinimum,0)),f=performance.now(),d=async()=>{let y=performance.now()-f;if(s!==void 0&&(c=Math.max(0,s-y)),c&&await Ee({millis:c,signal:i}),f=performance.now(),i?.aborted)throw Error(`Signal aborted ${i.reason}`)};Array.isArray(e)&&(e=e.values()),r.onStart&&r.onStart();let h=!0,p=0;try{for(;!u;){p++,(o==="before"||o==="both")&&await d();let y=await X1(e);y===void 0&&!n?u=!0:(yield y,(o==="after"||o==="both")&&await d(),a!==void 0&&p>=a&&(u=!0)),l&&(l(p)||(u=!0))}h=!1}finally{u=!0,r.onComplete&&r.onComplete(h)}}function*VC(e,r){let i=r.signal??void 0,o=r.count??void 0,a=r.allowUndefined??!1,n=!1;Array.isArray(e)&&(e=e.values()),r.onStart&&r.onStart();let s=!0,l=0;try{for(;!n;){l++;let u=Zd(e);u===void 0&&!a?n=!0:(yield u,o!==void 0&&l>=o&&(n=!0),i?.aborted&&(n=!0))}s=!1}finally{n=!0,r.onComplete&&r.onComplete(s)}}var LC=class extends Ze{timeoutMs;whenUnmatchedResponse;keyRequest;keyResponse;#e=new Map;#t;constructor(e={}){if(super(),typeof window>"u"&&(globalThis.window={setTimeout,clearTimeout}),this.timeoutMs=e.timeoutMs??1e3,this.whenUnmatchedResponse=e.whenUnmatchedResponse??"throw",this.#t=Yt(()=>this.#r(),this.timeoutMs*2),e.key){if(e.keyRequest)throw Error("Cannot set 'keyRequest' when 'key' is set ");if(e.keyResponse)throw Error("Cannot set 'keyResponse' when 'key' is set ");this.keyRequest=e.key,this.keyResponse=e.key}else{if(!e.keyRequest||!e.keyResponse)throw Error("Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set");this.keyRequest=e.keyRequest,this.keyResponse=e.keyResponse}}#r(){let e=[...this.#e.values()],r=Date.now();for(let i of e)if(i.expiresAt<=r){i.promiseReject&&i.promiseReject("Request timeout");let o=i.callback;o&&setTimeout(()=>{o(!0,"Request timeout")},1),this.fireEvent("completed",{request:i.req,response:"Request timeout",success:!1}),this.#e.delete(i.id)}return this.debugDump(),this.#e.size>0}debugDump(){let e=[...this.#e.values()],r=Date.now();for(let i of e){let o=r-i.expiresAt;console.log(`${i.id} Expires in: ${Math.floor(o/1e3).toString()}s`)}}request(e,r){if(r!==void 0){this.#o(e,r);return}return this.#i(e)}requestAndForget(e){let r=this.keyRequest(e);if(this.#e.has(r))throw Error(`Already a request pending with id '${r}'`);let i={expiresAt:Date.now()+this.timeoutMs,id:r,req:e};this.#e.set(r,i),this.#t.start()}#i(e){let r=this.keyRequest(e);if(this.#e.has(r))throw Error(`Already a request pending with id '${r}'`);return new Promise((o,a)=>{let n={expiresAt:Date.now()+this.timeoutMs,id:r,req:e,promiseResolve:o,promiseReject:a};this.#e.set(r,n),this.#t.start()})}#o(e,r){let i=this.keyRequest(e);if(this.#e.has(i))throw Error(`Already a request pending with id '${i}'`);let o={expiresAt:Date.now()+this.timeoutMs,id:i,req:e,callback:r};this.#e.set(i,o),this.#t.start()}response(e,r){let i=this.keyResponse(e),o=this.#e.get(i);if(!o){if(this.whenUnmatchedResponse==="throw")throw Error(`Unmatched response with id: '${i}'`,{cause:e});return!1}return r?o.expiresAt=Date.now()+this.timeoutMs:this.#e.delete(i),o.promiseResolve&&o.promiseResolve(e),o.callback&&o.callback(!1,e),this.fireEvent("match",{request:o.req,response:e}),r||this.fireEvent("completed",{request:o.req,response:e,success:!0}),!0}};function*Xy(e={}){let r=e.startAt??1,i=e.limitAttempts??2**53-1,o=e.limitValue,a=e.power??1.1,n=r;for(w(G(i,"aboveZero","limitAttempts"),C(r,"","startAt"),C(i,"","limitAttempts"),()=>o===void 0?void 0:C(o,"","limitValue"),C(a,"","power"));i>0;){if(o&&n>=o)return;i--,yield n,n+=n**+a}}const Nu=(e,r={})=>Bu({async probe(){try{let o=await e();return o===void 0?{value:r.taskValueFallback,error:"Fallback",success:!1}:{value:o,success:!0}}catch(o){return{success:!1,error:o}}}},r),Bu=async(e,r={})=>{let i=r.abort,o=gl(r.log),a=r.predelayMs??0,n=Nr(),s=0,l=r.startAt??1e3,u=r.limitAttempts??2**53-1,c=Xy({...r,startAt:l,limitAttempts:u});if(l<=0)throw Error("Param 'initialValue' must be above zero");if(a>0)try{await Ee({millis:a,signal:i})}catch(f){return{success:!1,attempts:s,value:r.taskValueFallback,elapsed:n(),message:st(f)}}for(let f of c){s++;let d=await e.probe(s);if(d.success)return{success:d.success,value:d.value,attempts:s,elapsed:n()};if(o({msg:`retry attempts: ${s.toString()} t: ${Hd(f)}`}),s>=u)break;try{await Ee({millis:f,signal:i})}catch(h){return{success:!1,attempts:s,value:r.taskValueFallback,message:st(h),elapsed:n()}}}return{message:`Giving up after ${s.toString()} attempts.`,success:!1,attempts:s,value:r.taskValueFallback,elapsed:n()}},IC=e=>{let r=!1,i=!1;return()=>(r||(r=!0,i=e()),i)};var qC=class{#e;#t;#r;signal(){this.#e&&(this.#e(),this.#e=void 0),this.#r=Promise.resolve()}flush(){this.#t&&(this.#t("Flushed"),this.#t=void 0),this.#e=void 0,this.#r=void 0}#i(){let e=new Promise((r,i)=>{this.#e=r,this.#t=i});return this.#r=e,e}async forSignal(e){let r=this.#r;if(r??=this.#i(),e){let i=this.#t;setTimeout(()=>{i&&i(`Timeout elapsed ${e.toString()}`)},e)}await r,this.#r=void 0,this.#e=void 0,this.#t=void 0}async didSignal(e){try{return await this.forSignal(e),!0}catch{return!1}}},_C=class Yy extends Ze{static shared=new Yy;_loop;_queue;constructor(){super(),this._queue=Dh(),this._loop=Yt(()=>this.processQueue(),100)}enqueue(r){let i=this._queue.enqueue(r);return this._loop.runState==="idle"&&(this.fireEvent("started",{}),this._loop.start()),i}dequeue(){return this._queue.dequeue()}async processQueue(){let r=this._queue.dequeue();if(r===void 0)return this.fireEvent("empty",{}),!1;try{await r()}catch(i){console.error(i)}}clear(){this._queue.length!==0&&(this._queue.clear(),this._loop.cancel(),this.fireEvent("empty",{}))}get isEmpty(){return this._queue.isEmpty}get length(){return this._queue.length}};const WC=(e,r)=>{let i=0;return async(...o)=>{let a=performance.now()-i;if(a>=r){let n=e(a,...o);typeof n=="object"&&await n,i=performance.now()}}};function GC(e){let r=vi(R(e,0),{timer:yr(),clampValue:!0});return()=>r.isDone}function Tu(e,r={}){let i=R(e);if(!i)throw Error("Param 'duration' not valid");let o={...r,timer:yr()},a;return()=>(a??=vi(i,o),a.elapsed)}function eg(e,r={}){let i={...r,timer:zu()},o;return()=>(o??=vi(e,i),o.elapsed)}const tg=()=>({elapsed:1,isDone:!0,reset(){},mod(e){}}),rg=()=>({elapsed:0,isDone:!1,reset(){},mod(){}}),vi=(e,r={})=>{if(Number.isFinite(e)){if(Number.isNaN(e))return rg()}else return tg();let i=r.clampValue??!1,o=r.wrapValue??!1;if(i&&o)throw Error("clampValue and wrapValue cannot both be enabled");let a=1,n=r.timer??yr(),s=0,l=u=>{s=u;let c=u/(e*a);return i?c=ie(c):o&&c>=1&&(c%=1),c};return{mod(u){a=u},get isDone(){return l(s)>=1},get elapsed(){return l(n.elapsed)},reset:()=>{n.reset()}}},_r=(e,r={})=>{let i=r.timer??yr(),o=e/1e3,a=1,n=()=>{let s=i.elapsed*(o*a),l=s-Math.floor(s);if(l<0)throw Error(`Unexpected cycle fraction less than 0. Elapsed: ${s} f: ${l}`);if(l>1)throw Error(`Unexpected cycle fraction more than 1. Elapsed: ${s} f: ${l}`);return l};return{mod:s=>{a=s},reset:()=>{i.reset()},get isDone(){return n()>=1},get elapsed(){return n()}}},yr=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},zu=()=>{let e=0;return{reset:()=>{e=0},get peek(){return e},get elapsed(){return++e}}},Ou=(e,r)=>{if(typeof e!="function")throw Error(`Param 'fn' should be a function. Got: ${typeof e}`);let i=1;return{get elapsed(){return r.elapsed},get isDone(){return r.isDone},get runState(){return r.isDone?"idle":"scheduled"},get startCount(){return i},get startCountTotal(){return i},compute:()=>{let o=r.elapsed;return e(o)},reset:()=>{r.reset(),i++}}},UC=(e,r,i="slow")=>{let o=0,a,n=R(r,1e3);return()=>new Promise(async(s,l)=>{let u=performance.now()-o;if(a===void 0||u>n)try{o=performance.now(),a=await e(u),n=R(r,1e3)}catch(c){i==="fast"?(a=void 0,o=0):i==="backoff"&&(n=Math.floor(n*1.2)),l(c);return}s(a)})};var ig=class{#e;#t;#r=!1;constructor(){let{promise:e,resolve:r}=Ky();this.#e=e,this.#t=r}get(){return this.#e}add(e){if(this.#r)throw Error("QueueSingleUse has already been used");this.#r=!0,this.#t(e)}get isUsed(){return this.#r}};const JC=()=>new ig,ju=(e,r,i)=>{let o,a=!1,n=s=>{o!==void 0&&(window.clearTimeout(o),o=void 0),s?r(s):a=!0,i!==void 0&&i(a)};return o=globalThis.setTimeout(()=>{o=void 0;try{r(`Timeout after ${e}ms`)}finally{i!==void 0&&i(a)}},e),n},Ts=e=>Object.freeze({value:e.value,visited:[...e.visited],machine:e.machine}),wi=(e,r)=>{let[i,o]=og(e);if(!i)throw Error(o);let a=r??Object.keys(i.states)[0];if(i.states[a]===void 0)throw TypeError(`Initial state ('${a}') not found`);let n=HC(i.states);if(n===void 0)throw Error("Could not normalise transitions");return Object.freeze({value:a,visited:[],machine:Object.freeze(Object.fromEntries(n))})},zs=e=>wi(e.machine),og=e=>e===void 0?[void 0,"Parameter undefined"]:e===null?[void 0,"Parameter null"]:"states"in e?[e,""]:typeof e=="object"?[{states:e},""]:[void 0,`Unexpected type: ${typeof e}. Expected object`],Os=e=>lo(e).length===0,Ru=e=>{ng(e);let r=e.machine[e.value];return r.length===1&&r[0].state===null?[]:r},lo=e=>Ru(e).map(i=>i.state),ag=e=>{let r=i=>{if(i===null)return{state:null};if(typeof i=="string")return{state:i};if(typeof i=="object"&&"state"in i){let o=i.state;if(typeof o!="string")throw TypeError(`Target 'state' field is not a string. Got: ${typeof o}`);return"preconditions"in i?{state:o,preconditions:i.preconditions}:{state:o}}else throw Error(`Unexpected type: ${typeof i}. Expected string or object with 'state' field.`)};if(Array.isArray(e)){let i=!1,o=e.map(a=>{let n=r(a);if(!n)throw Error("Invalid target");return i||=n.state===null,n});if(i&&o.length>1)throw Error("Cannot have null as an possible state");return o}else{let i=r(e);return i?[i]:void 0}},HC=e=>{let r=new Map;for(let[i,o]of Object.entries(e)){if(i===void 0)throw TypeError("Top-level undefined state");if(o===void 0)throw TypeError(`Undefined target state for ${i}`);if(r.has(i))throw Error(`State defined twice: ${i}`);if(i.includes(" "))throw Error("State names cannot contain spaces");r.set(i,[])}for(let[i,o]of Object.entries(e)){let a=ag(o);if(a===void 0)throw Error("Could not normalise target");if(a!==null){let n=new Set;for(let s of a){if(n.has(s.state))throw Error(`Target state '${s.state}' already exists for '${i}'`);if(n.add(s.state),s.state!==null&&!r.has(s.state))throw Error(`Target state '${s.state}' is not defined as a top-level state. Defined under: '${i}'`)}r.set(i,a)}}return r},ng=e=>{if(e===void 0)throw TypeError("Param 'state' is undefined");if(typeof e.value!="string")throw TypeError("Existing state is not a string")},$e=(e,r)=>(ng(e),cn(e,r),Object.freeze({value:r,machine:e.machine,visited:dd([e.visited,[e.value]])})),sg=e=>{let r=Ru(e).at(0);if(!r||r.state===null)throw Error(`Not possible to move to a next state from '${e.value}`);return $e(e,r.state)},lg=(e,r)=>{try{return cn(e,r),!0}catch{return!1}},cn=(e,r)=>{if(r===null)throw Error("Cannot transition to null state");if(r===void 0)throw Error("Cannot transition to undefined state");if(typeof r!="string")throw TypeError(`Parameter 'toState' should be a string. Got: ${typeof r}`);let i=lo(e);if(i.length===0)throw Error("Machine is in terminal state");if(!i.includes(r))throw Error(`Target state '${r}' not available at current state '${e.value}'. Possible states: ${i.join(", ")}`)},KC=(...e)=>{let r={};if(!Array.isArray(e))throw Error("Expected array of strings");if(e.length<=2)throw Error("Expects at least two states");for(let i=0;i<e.length;i++){let o=e[i];if(typeof o!="string")throw TypeError(`Expected array of strings. Got type '${typeof o}' at index ${i.toString()}`);r[o]=i===e.length-1?null:e[i+1]}return r},QC=(...e)=>{let r={};if(!Array.isArray(e))throw Error("Expected array of strings");if(e.length<2)throw Error("Expects at least two states");for(let[i,o]of e.entries()){if(typeof o!="string")throw TypeError(`Expected array of strings. Got type '${typeof o}' at index ${i.toString()}`);r[o]=[]}for(let i=0;i<e.length;i++){let o=r[e[i]];i===e.length-1?e.length>1?o.push(e[i-1]):r[e[i]]=null:(o.push(e[i+1]),i>0&&o.push(e[i-1]))}return r};async function ZC(e,r){let i=Array.isArray(r)?{handlers:r}:r,o=gl(i.debug,{category:"StateMachineDriver"}),a=new Map;for(let u of i.handlers){let c=Array.isArray(u.if)?u.if:[u.if];for(let f of c){if(typeof f!="string")throw TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof f}'.`);if(a.has(f))throw Error(`Multiple handlers defined for state '${f}'. There should be at most one.`);a.set(f,u)}}let n={rank:(u,c)=>Ao(u.score??0,c.score??0),shuffle:i.shuffleHandlers??!1},s=wi(e);for(let[u]of a)if(s.machine[u]===void 0&&u!=="__fallback")throw Error(`StateMachineDriver handler references a state ('${u}') which is not defined on the machine. Therefore this handler will never run.'`);return{reset:()=>{s=zs(s)},getValue:()=>s.value,run:async()=>{o(`Run. State: ${s.value}`);let u=s.value,c=a.get(u);if(c===void 0&&(o(`  No handler for state '${u}', trying __fallback`),c=a.get("__fallback")),c===void 0){o("  No __fallback handler");return}let f=c.resultChoice==="first"?{...n,stop:p=>p?"reset"in p||"next"in p&&p.next!==void 0:!1}:n,d=await Pu(c.then,f,s);o(`  In state '${s.value}' results: ${d.length}. Choice: ${c.resultChoice}`);let h;switch(c.resultChoice??"highest"){case"highest":h=d.at(-1);break;case"first":h=d[0];break;case"lowest":h=d.at(0);break;case"random":h=yd(d);break;default:throw Error(`Unknown 'resultChoice' option: ${c.resultChoice}. Expected highest, first, lowest or random`)}return o(`  Chosen result: ${JSON.stringify(h)}`),h?.reset?s=zs(s):h&&h.next&&(typeof h.next=="boolean"?s=sg(s):(o(JSON.stringify(d)),s=$e(s,h.next))),s},to:u=>(s=$e(s,u),s)}}var fn=class extends Ze{#e;#t;#r;#i=!1;#o=!1;#a=j1();constructor(e,r={}){super(),this.#r=r.debug??!1,this.#e=wi(e,r.initial),this.#t=Ts(this.#e)}#n(e){this.#o!==e&&(this.#o=e,e?(this.#i=!0,setTimeout(()=>{this.#i&&(this.#i=!1,this.fireEvent("stop",{state:this.#e.value}))},2)):this.#i=!1)}get statesPossible(){return lo(this.#e)}get statesDefined(){return Object.keys(this.#e.machine)}next(){let e=lo(this.#e);return e.length===0?null:(this.state=e[0],e[0])}get isDone(){return Os(this.#e)}reset(){this.#n(!1),this.#e=Ts(this.#t),this.#a=Nr()}validateTransition(e){cn(this.#e,e)}isValid(e){return lg(this.#e,e)}set state(e){let r=this.#e.value;e!==this.#e.value&&(this.#e=$e(this.#e,e),this.#r&&console.log(`StateMachine: ${r} -> ${e}`),this.#a=Nr(),setTimeout(()=>{this.fireEvent("change",{newState:e,priorState:r})},1),Os(this.#e)&&this.#n(!0))}get state(){return this.#e.value}get changedAt(){return this.#a()}get elapsed(){return this.#a()}},ug={};A(ug,{StateMachineWithEvents:()=>fn,cloneState:()=>Ts,driver:()=>ZC,fromList:()=>KC,fromListBidirectional:()=>QC,init:()=>wi,isDone:()=>Os,isValidTransition:()=>lg,next:()=>sg,normaliseTargets:()=>ag,possible:()=>lo,possibleTargets:()=>Ru,reset:()=>zs,to:()=>$e,validateMachine:()=>og,validateTransition:()=>cn});var XC={};A(XC,{DispatchList:()=>Mu,Pool:()=>Hy,PoolUser:()=>Uy,RequestResponseMatch:()=>LC,Resource:()=>Jy,StateMachine:()=>ug,SyncWait:()=>qC,TaskQueueMutable:()=>_C,WaitForValue:()=>ig,backoffGenerator:()=>Xy,continuously:()=>Yt,create:()=>RC,debounce:()=>TC,delay:()=>NC,delayLoop:()=>Wy,elapsedMillisecondsAbsolute:()=>yr,elapsedTicksAbsolute:()=>zu,eventRace:()=>Gy,everyNth:()=>zC,frequencyTimer:()=>_r,hasElapsed:()=>GC,iterateBreadth:()=>$u,iterateDepth:()=>$C,movingAverageTimed:()=>jC,ofTotal:()=>Tu,ofTotalTicks:()=>eg,promiseWithResolvers:()=>Ky,rateMinimum:()=>Qy,relative:()=>vi,repeat:()=>Zy,repeatSync:()=>VC,retryFunction:()=>Nu,retryTask:()=>Bu,run:()=>Pu,runOnce:()=>IC,runSingle:()=>OC,singleItem:()=>JC,sleep:()=>Ee,throttle:()=>WC,timeout:()=>bi,timerAlwaysDone:()=>tg,timerNeverDone:()=>rg,timerWithFunction:()=>Ou,updateOutdated:()=>UC,waitFor:()=>ju});var cg=class{#e=[];#t;#r;#i;#o;constructor(e={}){this.#r=e.resetAfterSamples??2**53-1,this.#i=e.sampleLimit??2**53-1,e.timeoutInterval&&(this.#o=bi(()=>{this.reset()},e.timeoutInterval)),this.#t=performance.now()}mark(){this.#e.length>=this.#r?this.reset():this.#e.length>=this.#i&&(this.#e=this.#e.slice(1),this.#t=this.#e[0]),this.#e.push(performance.now()),this.#o&&this.#o.start()}computeIntervals(){let e=9007199254740991,r=-9007199254740991,i=0,o=0,a=0;for(let s of this.#e){if(o>0){let l=s-a;e=Math.min(l,e),r=Math.max(l,r),i+=l}a=s,o++}let n=i/o;return{min:e,max:r,avg:n}}get elapsed(){return performance.now()-this.#t}reset(){this.#e=[],this.#t=performance.now()}get perSecond(){return this.#e.length/(this.elapsed/1e3)}get perMinute(){return this.#e.length/(this.elapsed/1e3/60)}};const YC=(e={})=>new cg(e);var fg=class extends Fu{values;constructor(e={}){super(e),this.values=[]}onTrimmed(e){}trimStore(e){return e>=this.values.length||(this.values=this.values.slice(-e)),this.values.length}onReset(){this.values=[]}filterData(e){let r=e.map(o=>"at"in o?o:{...o,at:Date.now()}),i=r.at(-1);if(this.storeIntermediate)this.values.push(...r);else switch(this.values.length){case 0:this.values.push(i);break;case 1:this.values.push(i);break;case 2:this.values[1]=i;break}return r}get last(){return this.values.length===1?this.values[0]:this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){return Date.now()-this.values[0].at}},dg=class{store;gog;constructor(e){this.store=new Map,this.gog=hl(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...r){return(await this.getTrackedValue(e,...r)).seen(...r)}async getTrackedValue(e,...r){if(e===null)throw Error("id parameter cannot be null");if(e===void 0)throw Error("id parameter cannot be undefined");return await this.gog(e,r[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){let e=[...this.store.values()];e.sort((r,i)=>{let o=r.elapsed,a=i.elapsed;return o===a?0:o>a?-1:1});for(let r of e)yield r}*valuesByAge(){for(let e of this.trackedByAge())yield e.last}*last(){for(let e of this.store.values())yield e.last}*initialValues(){for(let e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},eS={};A(eS,{FrequencyTracker:()=>Iy,IntervalTracker:()=>_y,NumberTracker:()=>ku,ObjectTracker:()=>fg,PrimitiveTracker:()=>qy,RateTracker:()=>cg,TrackedValueMap:()=>dg,TrackerBase:()=>Fu,frequency:()=>FC,interval:()=>kC,number:()=>da,rate:()=>YC});const Vu=e=>!(e.distance===void 0||e.angleRadian===void 0),Ye=(e,r="Point")=>{if(e===void 0)throw Error(`'${r}' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e===null)throw Error(`'${r}' is null. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.angleRadian===void 0)throw Error(`'${r}.angleRadian' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.distance===void 0)throw Error(`'${r}.distance' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(typeof e.angleRadian!="number")throw TypeError(`'${r}.angleRadian' must be a number. Got ${e.angleRadian}`);if(typeof e.distance!="number")throw TypeError(`'${r}.distance' must be a number. Got ${e.distance}`);if(e.angleRadian===null)throw Error(`'${r}.angleRadian' is null`);if(e.distance===null)throw Error(`'${r}.distance' is null`);if(Number.isNaN(e.angleRadian))throw TypeError(`'${r}.angleRadian' is NaN`);if(Number.isNaN(e.distance))throw Error(`'${r}.distance' is NaN`)};function at(e){return Array.isArray(e)?e.map(r=>r*(Math.PI/180)):e*(Math.PI/180)}function hg(e){return(e+Math.PI)%(2*Math.PI)}function pg(e){return e*1.111111}function yg(e,r=!0){return r?e*.9%360:e*.9}function ha(e){return e*63.6619772368}function js(e){return e*.0157079633}function xi(e){return Array.isArray(e)?e.map(r=>r*180/Math.PI):e*180/Math.PI}const tS=e=>Math.atan2(e.x,e.y),dn=(e,r,i=!0)=>{if(i){let o=e+r;return o>=Ke&&(o%=Ke),o}else{let o=e-r;return o<0?Ke+o:o}},rS=(e,r,i=!0)=>xi(dn(at(e),at(r),i)),Lu=(e,r,i=!0)=>{let o=e;r<o&&(o=0,r=Ke-e+r);let a=r-o;return i&&(a=Ke-a),a>=Ke?a%Ke:a},iS=(e,r,i=!0)=>xi(Lu(at(e),at(r),i)),hn=e=>{if(oS(e))return e;if(typeof e=="number")return{value:e,unit:"deg"};e=e.toLowerCase();let r="deg",i=NaN;if(e.endsWith("grad")?(i=Number.parseFloat(e.substring(0,e.length-4)),r="grad"):e.endsWith("rad")?(i=Number.parseFloat(e.substring(0,e.length-3)),r="rad"):e.endsWith("turn")?(i=Number.parseFloat(e.substring(0,e.length-4)),r="turn"):e.endsWith("deg")?(i=Number.parseFloat(e.substring(0,e.length-3)),r="deg"):i=Number.parseFloat(e),Number.isNaN(i))throw Error("Invalid angle (bad value?)");if(r.length===0)throw Error("Invalid angle (no unit)");return{value:i,unit:r}},oS=e=>typeof e=="object"&&"unit"in e&&"value"in e?!(typeof e.unit!="string"||typeof e.value!="number"):!1,Iu=(e,r)=>{let i=typeof e=="object"?e:hn(e);switch(r){case"deg":if(i.unit==="deg")return i;if(i.unit==="rad")return{value:xi(i.value),unit:"deg"};if(i.unit==="grad")return{value:yg(i.value),unit:"deg"};if(i.unit==="turn")return{value:gg(i.value),unit:"deg"};throw Error(`Unknown unit: ${i.unit}`);case"grad":if(i.unit==="deg")return{value:pg(i.value),unit:"grad"};if(i.unit==="rad")return{value:ha(i.value),unit:"grad"};if(i.unit==="grad")return i;if(i.unit==="turn")return{value:ha(Rs(i.value)),unit:"grad"};throw Error(`Unknown unit: ${i.unit}`);case"rad":if(i.unit==="deg")return{value:at(i.value),unit:"rad"};if(i.unit==="rad")return i;if(i.unit==="grad")return{value:js(i.value),unit:"rad"};if(i.unit==="turn")return{value:ha(Rs(i.value)),unit:"grad"};throw Error(`Unknown unit: ${i.unit}`);case"turn":if(i.unit==="deg")return{value:mg(i.value),unit:"turn"};if(i.unit==="rad")return{value:Vs(i.value),unit:"turn"};if(i.unit==="grad")return{value:Vs(js(i.value)),unit:"turn"};if(i.unit==="turn")return i;throw Error(`Unknown unit: ${i.unit}`);default:throw Error(`Destination unit unknown ('${r}). Expects: deg, grad, rad or turn`)}},gg=(e,r=!0)=>r?e*360%360:e*360,Rs=e=>e*Ke,mg=e=>e/360,Vs=e=>e/Ke,bg=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+r}),aS=e=>(Ye(e,"c"),Object.freeze({...e,angleRadian:e.angleRadian-Math.PI})),nS=(e,r)=>(Ye(e,"a"),Ye(r,"b"),e.distance===r.distance?e.angleRadian===-r.angleRadian:!1),sS=(e,r)=>(Ye(e,"a"),Ye(r,"b"),e.angleRadian===r.angleRadian),lS=(e,r)=>(Ye(e,"a"),Ye(r,"b"),e.angleRadian===-r.angleRadian),uS=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+at(r)}),We=(e,r,i)=>{if(Vu(e)){if(r===void 0&&(r=ee),j(r))return Uf(e.distance,e.angleRadian,r);throw Error("Expecting (Coord, Point). Second parameter is not a point")}else{if(typeof e=="object")throw TypeError(`First param is an object, but not a Coord: ${JSON.stringify(e)}`);if(typeof e=="number"&&typeof r=="number"){if(i===void 0&&(i=ee),!j(i))throw Error("Expecting (number, number, Point). Point param wrong type");return Uf(e,r,i)}else throw TypeError(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof r}, ${typeof i}). a: ${JSON.stringify(e)}`)}},qu=(e,r)=>{e=De(e,r);let i=Math.atan2(e.y,e.x);return Object.freeze({...e,angleRadian:i,distance:Math.hypot(e.x,e.y)})},Uf=(e,r,i=ee)=>(O(i),Object.freeze({x:i.x+e*Math.cos(r),y:i.y+e*Math.sin(r)})),vg=(e,r)=>{if(e===void 0)return"(undefined)";if(e===null)return"(null)";let i=xi(e.angleRadian),o=r?e.distance.toFixed(r):e.distance,a=r?i.toFixed(r):i;return`(${o},${a})`},wg=(e,r=ee)=>(Ye(e,"v"),Object.freeze({x:r.x+e.distance*Math.cos(e.angleRadian),y:r.y+e.distance*Math.sin(e.angleRadian)})),xg=e=>{if(e.distance===0)throw Error("Cannot normalise vector of length 0");return Object.freeze({...e,distance:1})},Eg=(e,r=1,i=0)=>{let o=e.distance;return o>r&&(o=r),o<i&&(o=i),Object.freeze({...e,distance:o})},Dg=(e,r)=>(Ye(e,"a"),Ye(r,"b"),e.distance*r.distance*Math.cos(r.angleRadian-e.angleRadian)),cS=(e,r)=>(Ye(e),w(C(r,"","amt")),Object.freeze({...e,distance:e.distance*r})),fS=(e,r)=>(Ye(e),w(C(r,"","amt")),Object.freeze({...e,distance:e.distance/r})),dS=(e,r=Math.round)=>(O(e,"pt"),Object.freeze({x:r(e.x),y:r(e.y)})),hS=e=>{O(e,"pt");let r={...e};return delete r.z,Object.freeze(r)},pS=(e,r=0)=>(O(e,"pt"),Object.freeze({...e,z:r}));function uo(e,r){if(e===void 0)return"(undefined)";if(e===null)return"(null)";O(e,"pt");let i=r?e.x.toFixed(r):e.x,o=r?e.y.toFixed(r):e.y;if(e.z===void 0)return`(${i},${o})`;{let a=r?e.z.toFixed(r):e.z;return`(${i},${o},${a})`}}var Ag={};A(Ag,{fromLine:()=>bS,toCartesian:()=>yS,toString:()=>mS});const yS=(e,r)=>{let i=gS(e,r),o=We(e.offset,e.angleRadian,i),a=We(e.offset+e.length,e.angleRadian,i);return{a:o,b:a}},gS=(e,r)=>r===void 0?e.origin===void 0?{x:0,y:0}:e.origin:r,mS=e=>{let r=`PolarRay(angle: ${e.angleRadian} offset: ${e.offset} len: ${e.length}`;return e.origin&&(r+=` origin: ${uo(e.origin)}`),r+=")",r},bS=(e,r)=>{let i=r??e.a;return{angleRadian:Ft(e.b,i),offset:X(e.a,i),length:X(e.b,e.a),origin:i}};function*vS(e,r){let i=0;for(;;){let o=e*i++;yield{distance:r*o,angleRadian:o,step:i}}}const wS=(e,r,i)=>{let o=r*e;return Object.freeze({distance:i*o,angleRadian:o})};var Cg={};A(Cg,{Ray:()=>Ag,clampMagnitude:()=>Eg,divide:()=>fS,dotProduct:()=>Dg,fromCartesian:()=>qu,guard:()=>Ye,invert:()=>aS,isAntiParallel:()=>lS,isOpposite:()=>nS,isParallel:()=>sS,isPolarCoord:()=>Vu,multiply:()=>cS,normalise:()=>xg,rotate:()=>bg,rotateDegrees:()=>uS,spiral:()=>vS,spiralRaw:()=>wS,toCartesian:()=>We,toPoint:()=>wg,toString:()=>vg});var Sg={};A(Sg,{clampMagnitude:()=>kS,divide:()=>NS,dotProduct:()=>FS,fromLineCartesian:()=>kg,fromLinePolar:()=>$g,fromPointPolar:()=>Fg,fromRadians:()=>ES,multiply:()=>PS,normalise:()=>AS,quadrantOffsetAngle:()=>CS,subtract:()=>MS,sum:()=>$S,toCartesian:()=>Xt,toPolar:()=>Vo,toRadians:()=>DS,toString:()=>SS});const xS=Object.freeze({x:0,y:0}),pa=Math.PI*2,Ls=Math.PI,ES=e=>Object.freeze({x:Math.cos(e),y:Math.sin(e)}),DS=e=>Math.atan2(e.y,e.x),Fg=(e,r="",i=xS)=>{e=De(e,i);let o=Math.atan2(e.y,e.x);return r==="unipolar"&&o<0?o+=pa:r==="bipolar"&&(o>Ls?o-=pa:o<=-Ls&&(o+=pa)),Object.freeze({distance:X(e),angleRadian:o})},kg=e=>De(e.b,e.a),$g=e=>{Oo(e,"line");let r=De(e.b,e.a);return Fg(r)},wt=e=>!!Vu(e),Or=e=>!!j(e),AS=e=>{if(wt(e))return xg(e);if(Or(e))return Ro(e);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},CS=e=>e.x>=0&&e.y>=0?0:e.x<0&&e.y>=0||e.x<0&&e.y<0?Ls:pa,Vo=(e,r=ee)=>{if(wt(e))return e;if(Or(e))return qu(e,r);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},Xt=e=>{if(wt(e))return wg(e);if(Or(e))return e;throw Error(`Expected polar/cartesian vector. Got: ${e}`)},SS=(e,r)=>{if(wt(e))return vg(e,r);if(Or(e))return uo(e,r);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},FS=(e,r)=>{if(wt(e)&&wt(r))return Dg(e,r);if(Or(e)&&Or(r))return jy(e,r);throw Error("Expected two polar/Cartesian vectors.")},kS=(e,r=1,i=0)=>{if(wt(e))return Eg(e,r,i);if(Or(e))return Cu(e,r,i);throw Error("Expected either polar or Cartesian vector")},$S=(e,r)=>{let i=wt(e);e=Xt(e),r=Xt(r);let o=Qe(e,r);return i?Vo(o):o},MS=(e,r)=>{let i=wt(e);e=Xt(e),r=Xt(r);let o=De(e,r);return i?Vo(o):o},PS=(e,r)=>{let i=wt(e);e=Xt(e),r=Xt(r);let o=hr(e,r);return i?Vo(o):o},NS=(e,r)=>{let i=wt(e);e=Xt(e),r=Xt(r);let o=so(e,r);return i?Vo(o):o},_u=(e,r)=>{let i=o=>{let{a,b:n}=o,s={x:n.x-a.x,y:n.y-a.y},l={x:r.x-a.x,y:r.y-a.y},u=s.x*s.x+s.y*s.y,c=l.x*s.x+l.y*s.y,f=Math.min(1,Math.max(0,c/u));return c=(n.x-a.x)*(r.y-a.y)-(n.y-a.y)*(r.x-a.x),{x:a.x+s.x*f,y:a.y+s.y*f}};if(Array.isArray(e)){let o=e.map(n=>i(n)),a=o.map(n=>X(n,r));return Object.freeze(o[ru(...a)])}else return Object.freeze(i(e))},Ta=(e,r)=>{if(Oo(e,"line"),O(r,"point"),Re(e)===0)return Re(e.a,r);let i=_u(e,r);return Re(i,r)},Mg=e=>({x:e.b.x-e.a.x,y:e.b.y-e.a.y}),Pg=e=>{let r=Re(e),i=Mg(e);return{x:i.x/r,y:i.y/r}},Ng=(e,r)=>{let i=Mg(e),o=Pg(e),a={x:e.a.x-o.y*r,y:e.a.y+o.x*r};return{a,b:{x:a.x+i.x,y:a.y+i.y}}},Bg=(e,r,i=0)=>{let o=Nt(i,e),a=Pg(e);return{x:o.x-a.y*r,y:o.y+a.x*r}},Tg=e=>jo(e.a,e.b),zg=(e,r)=>Object.freeze({...e,a:so(e.a,r),b:so(e.b,r)}),Og=(e,r,i,o)=>{if(Number.isNaN(e))throw Error("x1 is NaN");if(Number.isNaN(i))throw Error("x2 is NaN");if(Number.isNaN(r))throw Error("y1 is NaN");if(Number.isNaN(o))throw Error("y2 is NaN");return To({x:e,y:r},{x:i,y:o})},BS=e=>{if(!Array.isArray(e))throw Error("arr parameter is not an array");if(e.length!==4)throw Error("array is expected to have length four");return Og(e[0],e[1],e[2],e[3])},TS=(e={x:.5,y:.5},r=1,i=0,o=.5)=>{let a=r*o,n=r*(1-o),s=We(a,hg(i),e),l=We(n,i,e);return Object.freeze({a:s,b:l})},jg=(e,r)=>{let[i,o]=ln(e,r);return Nt(.5,i,o)},Rg=(e,r)=>{let i=X(e.a,r),o=Re(e);return i/o},Vg=(e,r)=>Object.freeze({...e,a:Qe(e.a,r),b:Qe(e.b,r)}),Lg=(e,r,i)=>r===void 0||r===0?e:(i===void 0&&(i=.5),typeof i=="number"&&(i=Nt(i,e.a,e.b)),Object.freeze({...e,a:kt(e.a,r,i),b:kt(e.b,r,i)})),Ig=(e,r)=>St(e.a,r.a)&&St(e.b,r.b),qg=(e,r)=>Object.freeze({...e,a:hr(e.a,r),b:hr(e.b,r)}),_g=(e,r)=>Object.freeze({...e,a:De(e.a,r),b:De(e.b,r)});function Wg(e,r){if(Tt(e))Oo(e,"a"),r=e.b,e=e.a;else if(r===void 0)throw Error("Expect second point if first is a point");return uo(e)+"-"+uo(r)}const Ut=e=>{let{a:r,b:i}=e;return Object.freeze({...e,length:()=>Re(r,i),interpolate:o=>Nt(o,r,i),relativePosition:o=>Rg(e,o),bbox:()=>Tg(e),toString:()=>Wg(r,i),toFlatArray:()=>Qg(r,i),toSvgString:()=>Zg(r,i),toPoints:()=>[r,i],rotate:(o,a)=>Ut(Lg(e,o,a)),nearest:o=>_u(e,o),sum:o=>Ut(Vg(e,o)),divide:o=>Ut(zg(e,o)),multiply:o=>Ut(qg(e,o)),subtract:o=>Ut(_g(e,o)),midpoint:()=>jg(r,i),distanceToPoint:o=>Ta(e,o),parallel:o=>Ng(e,o),perpendicularPoint:(o,a)=>Bg(e,o,a),slope:()=>Wu(e),withinRange:(o,a)=>Hg(e,o,a),isEqual:o=>Ig(e,o),apply:o=>Ut(Jg(e,o)),kind:"line"})},zS=(e,r)=>Ut(To(e,r));var Gg={};A(Gg,{Empty:()=>Ug,Placeholder:()=>OS,angleRadian:()=>VS,apply:()=>Jg,asPoints:()=>GS,bbox:()=>Tg,distance:()=>Kg,distanceSingleLine:()=>Ta,divide:()=>zg,extendFromA:()=>_S,fromFlatArray:()=>BS,fromNumbers:()=>Og,fromPivot:()=>TS,fromPoints:()=>To,fromPointsToPath:()=>zS,getPointParameter:()=>ln,guard:()=>Oo,interpolate:()=>Nt,isEmpty:()=>jS,isEqual:()=>Ig,isLine:()=>Tt,isPlaceholder:()=>RS,isPolyLine:()=>hy,joinPointsToLines:()=>zo,length:()=>Re,midpoint:()=>jg,multiply:()=>qg,nearest:()=>_u,normaliseByRect:()=>LS,parallel:()=>Ng,perpendicularPoint:()=>Bg,pointAtDistance:()=>DC,pointAtX:()=>qS,pointsOf:()=>WS,relativePosition:()=>Rg,reverse:()=>Vy,rotate:()=>Lg,scaleFromMidpoint:()=>IS,slope:()=>Wu,subtract:()=>_g,sum:()=>Vg,toFlatArray:()=>Qg,toPath:()=>Ut,toString:()=>Wg,toSvgString:()=>Zg,withinRange:()=>Hg});const Ug=Object.freeze({a:Object.freeze({x:0,y:0}),b:Object.freeze({x:0,y:0})}),OS=Object.freeze({a:Object.freeze({x:NaN,y:NaN}),b:Object.freeze({x:NaN,y:NaN})}),jS=e=>oi(e.a)&&oi(e.b),RS=e=>Mr(e.a)&&Mr(e.b),Jg=(e,r)=>Object.freeze({...e,a:r(e.a),b:r(e.b)}),VS=(e,r)=>{let i;if(Tt(e))i=e.a,r=e.b;else if(i=e,r===void 0)throw Error("b point must be provided");return Math.atan2(r.y-i.y,r.x-i.x)},LS=(e,r,i)=>Object.freeze({...e,a:Ns(e.a,r,i),b:Ns(e.b,r,i)}),Hg=(e,r,i)=>Kg(e,r)<=i,Wu=(e,r)=>{let i;if(Tt(e))i=e.a,r=e.b;else if(i=e,r===void 0)throw Error("b parameter required");if(r===void 0)throw TypeError("Second point missing");return(r.y-i.y)/(r.x-i.x)},IS=(e,r)=>{let i=Nt(r/2,e),o=Nt(.5+r/2,e);return{a:i,b:o}},qS=(e,r)=>{let i=e.a.y+(r-e.a.x)*Wu(e);return Object.freeze({x:r,y:i})},_S=(e,r)=>{let i=Re(e);return Object.freeze({...e,a:e.a,b:Object.freeze({x:e.b.x+(e.b.x-e.a.x)/i*r,y:e.b.y+(e.b.y-e.a.y)/i*r})})};function*WS(e){let{a:r,b:i}=e,o=Math.floor(r.x),a=Math.floor(r.y),n=Math.floor(i.x),s=Math.floor(i.y),l=Math.abs(n-o),u=-Math.abs(s-a),c=o<n?1:-1,f=a<s?1:-1,d=l+u;for(;yield{x:o,y:a},!(o===n&&a===s);){let h=2*d;h>=u&&(d+=u,o+=c),h<=l&&(d+=l,a+=f)}}const Kg=(e,r)=>{if(Array.isArray(e)){let i=e.map(o=>Ta(o,r));return ou(i)}else return Ta(e,r)},Qg=(e,r)=>{if(Tt(e))return[e.a.x,e.a.y,e.b.x,e.b.y];if(j(e)&&j(r))return[e.x,e.y,r.x,r.y];throw Error("Expected single line parameter, or a and b points")};function*GS(e){for(let r of e)yield r.a,yield r.b}const Zg=(e,r)=>[`M${e.x} ${e.y} L ${r.x} ${r.y}`],ya=(e,r)=>{let i=Pe(e,r),o=0,a=0,n=0,s=performance.now(),l=i;return(c,f)=>{let d=Pe(c,f);o+=d.x,a+=d.y,n++;let h=X(d,i),p=X(d,l),y=performance.now(),g=p/(y-s);return s=y,l=d,Object.freeze({angle:Ft(d,i),distanceFromStart:h,distanceFromLast:p,speed:g,centroid:By(d,i),average:{x:o/n,y:a/n}})}};var Gu=class extends fg{initialRelation;markRelation;lastResult;constructor(e={}){super(e)}onTrimmed(e){this.initialRelation=void 0}onReset(){super.onReset(),this.lastResult=void 0,this.initialRelation=void 0,this.markRelation=void 0}seenEvent(e){if("getCoalescedEvents"in e){let r=e.getCoalescedEvents(),i=r.map(o=>({x:o.clientX,y:o.clientY}));return this.seen(...i)}else return this.seen({x:e.clientX,y:e.clientY})}mark(){this.markRelation=ya(this.last)}computeResults(e){let r=this.last,i=this.values.at(-2);if(this.initialRelation===void 0&&this.initial)this.initialRelation=ya(this.initial);else if(this.initialRelation===void 0)throw Error("Bug: No initialRelation, and this.inital is undefined?");let o=ya(i===void 0?r:i),a=this.initialRelation(r),n=this.markRelation===void 0?void 0:this.markRelation(r),s=i===void 0?0:Re(i,r)/(r.at-i.at),l={...o(r),speed:s},u={fromInitial:a,fromLast:l,fromMark:n,values:[...this.values]};return this.lastResult=u,u}get line(){return this.values.length===1?[]:zo(...this.values)}get vectorPolar(){return $g(this.lineStartEnd)}get vectorCartesian(){return kg(this.lineStartEnd)}get lineStartEnd(){let e=this.initial;return this.values.length<2||!e?Ug:{a:e,b:this.last}}distanceFromStart(){let e=this.initial;return this.values.length>=2&&e!==void 0?X(e,this.last):0}difference(){let e=this.initial;return this.values.length>=2&&e!==void 0?De(this.last,e):Pa}angleFromStart(){let e=this.initial;if(e!==void 0&&this.values.length>2)return Ft(e,this.last)}get length(){if(this.values.length===1)return 0;let e=this.line;return Re(e)}get x(){return this.last.x}get y(){return this.last.y}get z(){return this.last.z}},Uu=class extends dg{constructor(e={}){super((r,i)=>{if(i===void 0)throw Error("Requires start point");let o=new Gu({...e,id:r});return o.seen(i),o})}seenEvent(e){if("getCoalescedEvents"in e){let r=e.getCoalescedEvents(),i=r.map(o=>super.seen(o.pointerId.toString(),o));return Promise.all(i)}else return Promise.all([super.seen(e.pointerId.toString(),e)])}};const US=(e,r,i)=>{let o=De(e,r),a=De(i,r);return Q(o)&&Q(a)?(o.x*a.x+o.y*a.y+o.z*a.z)/(a.x*a.x+a.y*a.y+a.z*a.z):(o.x*a.x+o.y*a.y)/(a.x*a.x+a.y*a.y)},Is=(e,r,i)=>{let o=Math.cos(i)*r+e.x,a=Math.sin(i)*r+e.y;return{x:o,y:a}};function JS(e,r,i=!0){if(O(e,"pt"),O(r,"snap"),Q(e)){if(!Q(r))throw TypeError("Param 'snap' is missing 'z' field");return Object.freeze({x:Sr(e.x,r.x,i),y:Sr(e.y,r.y,i),z:Sr(e.z,r.z,i)})}return Object.freeze({x:Sr(e.x,r.x,i),y:Sr(e.y,r.y,i)})}const HS=e=>(e===void 0&&(e=Math.random),Object.freeze({x:e(),y:e()})),KS=e=>(e===void 0&&(e=Math.random),Object.freeze({x:e(),y:e(),z:e()})),Xg=(e,r,i)=>{i===void 0&&(i={x:0,y:0});let o=i;for(let a of e)o=r(a,o);return o};function kt(e,r,i){i===void 0&&(i={x:0,y:0}),O(i,"origin"),w(C(r,"","amountRadian"));let o=Array.isArray(e);if(r===0)return e;o||(e=[e]);let a=e;for(let[u,c]of a.entries())O(c,`pt[${u}]`);let n=a.map(u=>qu(u,i)),s=n.map(u=>bg(u,r)),l=s.map(u=>We(u,i));return o?l:l[0]}const QS=(e,r)=>{let i=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],o=[];for(let[a,n]of e.entries())o[a]=[i[0][0]*n[0]+i[0][1]*n[1],i[1][0]*n[0]+i[1][1]*n[1]];return o},ZS=(e,r,i)=>{let o=Pe(e,r);return i??=r,i??=2,Object.freeze({...o,x:ni(i,o.x),y:ni(i,o.y)})},XS=(e,r,i)=>{O(e,"a"),O(r,"b"),typeof i=="number"?(w(C(i,"positive","maxRange")),i={x:i,y:i}):O(i,"maxRange");let o=Math.abs(r.x-e.x),a=Math.abs(r.y-e.y);return o<=i.x&&a<=i.y},YS=(e,r,i)=>(r===void 0&&(r={x:1,y:1}),i===void 0&&(i={x:0,y:0}),O(e,"pt"),O(r,"ptMax"),O(i,"ptMin"),Object.freeze({x:no(e.x,i.x,r.x),y:no(e.y,i.y,r.y)}));var Yg={};A(Yg,{Empty:()=>ee,Empty3d:()=>vC,Placeholder:()=>Pa,Placeholder3d:()=>EA,PointTracker:()=>Gu,PointsTracker:()=>Uu,Unit:()=>Ry,Unit3d:()=>wC,abs:()=>Ny,angleRadian:()=>Ft,angleRadianCircle:()=>lC,apply:()=>uC,averager:()=>cC,bbox:()=>jo,bbox3d:()=>fC,centroid:()=>By,clamp:()=>dC,clampMagnitude:()=>Cu,compare:()=>Ty,compareByX:()=>zy,compareByY:()=>hC,compareByZ:()=>pC,convexHull:()=>yC,distance:()=>X,distanceToCenter:()=>gC,distanceToExterior:()=>mC,divide:()=>so,divider:()=>bC,dotProduct:()=>jy,findMinimum:()=>Ht,from:()=>xC,fromNumbers:()=>Au,fromString:()=>EC,getPointParameter:()=>Pe,getTwoPointParameters:()=>No,guard:()=>O,guardNonZeroPoint:()=>ry,interpolate:()=>fa,invert:()=>kr,isEmpty:()=>oi,isEqual:()=>St,isNaN:()=>vA,isNull:()=>bA,isPlaceholder:()=>Mr,isPoint:()=>j,isPoint3d:()=>Q,leftmost:()=>AC,multiply:()=>hr,multiplyScalar:()=>mt,normalise:()=>Ro,normaliseByRect:()=>Ns,pipeline:()=>Su,pipelineApply:()=>Ly,progressBetween:()=>US,project:()=>Is,quantiseEvery:()=>JS,random:()=>HS,random3d:()=>KS,reduce:()=>Xg,relation:()=>ya,rightmost:()=>CC,rotate:()=>kt,rotatePointArray:()=>QS,round:()=>ZS,subtract:()=>De,sum:()=>Qe,to2d:()=>hS,to3d:()=>pS,toArray:()=>Oy,toIntegerValues:()=>dS,toString:()=>uo,withinRange:()=>XS,wrap:()=>YS});var em={};A(em,{draggable:()=>eF});const eF=(e,r,i={})=>{let o=U(e),a=Pa,n,s=i.autoTranslate??!1,l=i.quickDrag??!1,u=i.fence?U(i.fence):void 0,c=i.fenceViewport,f=vu,d=window.getComputedStyle(o).position==="relative",h=()=>{o.classList.contains("drag-sel")&&o.classList.remove("drag-sel")},p=x=>{o.classList.contains("drag-sel")?o.classList.remove("drag-sel"):o.classList.add("drag-sel"),x.stopPropagation()};o.ownerDocument.addEventListener("click",h),o.addEventListener("click",p);let y=()=>{o.classList.remove("drag-progress"),o.ownerDocument.removeEventListener("pointermove",D),o.ownerDocument.removeEventListener("pointerup",B),o.ownerDocument.removeEventListener("pointercancel",V)},g=()=>{o.classList.contains("drag-progress")?V(void 0,"dispose"):y(),o.ownerDocument.removeEventListener("click",h),o.removeEventListener("click",p)},m=(x,k,M)=>(iy(f)||(x={x:ie(x.x,f.x,f.width),y:ie(x.y,f.y,f.height)},c&&(k=ie(k,c.x,c.x+c.width),M=ie(M,c.y,c.y+c.height))),[x,{x:k,y:M}]),v=ee,D=x=>{x.preventDefault(),x.stopPropagation();let{x:k,y:M}=x,P=Mr(a)?{x:x.offsetX,y:x.offsetY}:{x:k-a.x,y:M-a.y},$=m(P,k,M);P=$[0];let te={delta:P,initial:a,token:n,viewport:$[1]};if(r.progress!==void 0){let le=r.progress(te);if(le.abort){V(void 0,"discontinued");return}le.viewport&&(P={x:le.viewport.x-a.x,y:le.viewport.y-a.y})}if(v=P,s){let le=P.x,be=P.y;o.style.translate=`${le}px ${be}px`}},B=x=>{let k=o.getBoundingClientRect();y();let{x:M,y:P}=x,$=m(v,M,P),te={initial:a,token:n,delta:$[0],viewport:$[1]};if(s)if(o.style.translate="none",d){let le=o.parentElement?.getBoundingClientRect();o.style.left=`${k.x-le.left}px`,o.style.top=`${k.y-le.top}px`}else o.style.left=`${k.x}px`,o.style.top=`${k.y}px`;r.success!==void 0&&r.success(te)},V=(x,k="pointercancel")=>{y();let M=Pa;x&&"x"in x&&"y"in x&&(M={x:x.x,y:x.y});let P={token:n,initial:a,delta:{x:-1,y:-1},viewport:M};r.abort!==void 0&&r.abort(k,P)};return o.addEventListener("pointerdown",x=>{if(!o.classList.contains("drag-sel")&&!l)return;let M=x;a={x:M.x,y:M.y};let P=r.start===void 0?{allow:!0,token:n}:r.start();if(P.allow){if(n=P.token,u){let $=u.getBoundingClientRect();f={x:$.x-a.x,y:$.y-a.y,width:$.x+$.width-a.x,height:$.y+$.height-a.y}}else c&&(f={x:c.x-a.x,y:c.y-a.y,width:c.width+c.x-a.x,height:c.height+c.y-a.y});o.classList.add("drag-progress"),o.ownerDocument.addEventListener("pointermove",D),o.ownerDocument.addEventListener("pointerup",B),o.ownerDocument.addEventListener("pointercancel",V)}}),g};var tm={};A(tm,{button:()=>rm,buttonCreate:()=>oF,checkbox:()=>rF,numeric:()=>iF,select:()=>aF,textAreaKeyboard:()=>tF});const tF=e=>{e.addEventListener("keydown",r=>{let i=e.value,o=e.selectionStart,a=e.selectionEnd;if(r.key==="Tab"&&r.shiftKey)return e.value.substring(o-2,o)==="  "&&(e.value=i.slice(0,Math.max(0,o-2))+i.slice(Math.max(0,a))),e.selectionStart=e.selectionEnd=o-2,r.preventDefault(),!1;if(r.key==="Tab")return e.value=i.slice(0,Math.max(0,o))+"  "+i.slice(Math.max(0,a)),e.selectionStart=e.selectionEnd=o+2,r.preventDefault(),!1})},rF=(e,r)=>{let i=U(e);return r&&i.addEventListener("change",()=>{r(i.checked)}),{get checked(){return i.checked},set checked(o){i.checked=o}}},iF=(e,r,i)=>{let o=U(e),a=i?"change":"input";return r&&o.addEventListener(a,()=>{r(Number.parseInt(o.value))}),{get value(){return Number.parseInt(o.value)},set value(n){o.value=n.toString()}}},rm=(e,r)=>{let i=U(e),o=()=>{r&&i.addEventListener("click",r)},a=()=>{r&&i.removeEventListener("click",r)};return o(),{get title(){return i.textContent},set title(n){i.textContent=n},dispose(n=!1){a(),n&&i.remove()},onClick(n){a(),r=n,o()},click(){r&&r()},set disabled(n){i.disabled=n},get el(){return i}}},oF=(e,r)=>{let i=document.createElement("button"),o=rm(i,r);return o.title=e,o},aF=(e,r,i={})=>{let o=U(e),{placeholderOpt:a,shouldAddChoosePlaceholder:n=!1,autoSelectAfterChoice:s=-1}=i,l=()=>{r!==void 0&&r(o.value),s>=0&&(o.selectedIndex=s)};return r&&o.addEventListener("change",u=>{l()}),{set disabled(u){o.disabled=u},get value(){return o.value},get index(){return o.selectedIndex},get isSelectedPlaceholder(){return(n||i.placeholderOpt!==void 0)&&o.selectedIndex===0},setOpts(u,c){o.options.length=0,n?u=["-- Choose --",...u]:a!==void 0&&(u=[a,...u]);let f=0;for(let[d,h]of u.entries()){let p=document.createElement("option");p.value=h,p.innerHTML=h,c!==void 0&&h===c&&(f=d),o.options.add(p)}o.selectedIndex=f},select(u=0,c=!1){o.selectedIndex=u,c&&r&&l()}}};function im(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:e&&typeof e=="object"&&!!e&&e.nodeType===1&&typeof e.nodeName=="string"}const nF=e=>e.map(r=>{let i;Array.isArray(r)&&(i=r[1],r=r[0]);let o=r.indexOf("-");if(o<0)throw Error("Simple expression expects form of: 'elementid-attribute'");return{variable:r,attribute:r.slice(o+1),id:r.slice(0,o),defaultValue:i}}),sF=(e,...r)=>{let i=U(e),o=window.getComputedStyle(i);for(let a of r){let n=Ka(a.variable,"--"),s=o.getPropertyValue(`--${n}`);if(s===null||s.length===0){if(a.defaultValue===void 0)continue;s=a.defaultValue}let l,u;if("query"in a&&a.query!==void 0?l=a.query:"id"in a&&a.id!==void 0?l=`#${a.id}`:"object"in a&&a.object!==void 0&&(u=Array.isArray(a.object)?a.object:[a.object]),l===void 0){if(u===void 0)throw Error("Missing 'query', 'id' or 'object' fields")}else u=[...i.querySelectorAll(l)];if(u!=null)if(a.attribute)for(let c of u)if(im(c))c.setAttribute(a.attribute,s);else throw Error("Trying to set an attribute on something not a HTML element",{cause:c});else if(a.field)for(let c of u)if(typeof c=="object")c[a.field]=s;else throw Error(`Trying to set field on something that is not an object (${typeof c})`,{cause:c});else throw Error(`Neither 'attribute' or 'field' to set is defined in option (${JSON.stringify(a)})`)}};function lF(e,r){let i=getComputedStyle(r??document.body),o=Object.entries(e),a=o.map(n=>[n[0],om(i,n[0],n[1])]);return Object.fromEntries(a)}function uF(e,r){e.startsWith("--")||(e=`--${e}`);let i=getComputedStyle(document.body).getPropertyValue(e).trim();return i.length===0?r:i}function cF(e,r){let i=r===void 0?document.body.style:im(r)?r.style:r;for(let[o,a]of Object.entries(e)){let n=o.replaceAll("_","-");n.startsWith("--")||(n="--"+n),i.setProperty(n,a.toString())}}function om(e,r,i){r.startsWith("--")||(r="--"+r),r=r.replaceAll("_","-");let o=e.getPropertyValue(r);if(o.length===0)return i;if(typeof i=="number")return parseFloat(o);if(typeof i=="boolean"){if(o==="true")return!0;if(o==="false")return!1}return o}const fF=e=>{let r=U(e),i=r.getBoundingClientRect();r instanceof SVGElement&&(r=r.parentElement);let o=Ju(r,"borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth");return{x:i.x,y:i.y,width:i.width+o.borderLeftWidth+o.borderRightWidth,height:i.height+o.borderTopWidth+o.borderBottomWidth}},Ju=(e,...r)=>{let i=getComputedStyle(U(e)),o={};for(let a of r){let n=i[a];if(typeof n=="string")if(n.endsWith("px"))o[a]=Number.parseFloat(n.substring(0,n.length-2));else throw Error(`Property '${String(a)}' does not end in 'px'. Value: ${n}`);else throw Error(`Property '${String(a)}' is not type string. Got: ${typeof n} Value: ${n}`)}return o},Hu=(e,r,i)=>{let o=qr(e);if(o.length!==0)for(let a of o)r?a.classList.add(i):a.classList.remove(i)},Ku=(e,r)=>{let i=qr(e);if(i.length!==0)for(let o of i)o.classList.toggle(r)},Qu=(e,r)=>{let i=qr(e);if(i.length!==0)for(let o of i)o.style.display=r};var dF=class{dataTable;constructor(e={}){let r=e.theme??"dark";if(document.querySelector("#ixfx-data-display")!==null)throw Error("DataDisplay already loaded on this page");let o=document.createElement("div");o.id="ixfx-data-display",o.classList.add(`theme-${r}`);let a=document.createElement("style");a.textContent=`
    #ixfx-data-display {
      background: white;
      color: black;
      border: 2px solid hsl(0deg 0.61% 90%);
      border-radius: 4px;
      z-index: 1000;
      opacity: 40%;
      padding: 1em;
      font-family: monospace;
      position: fixed;
      right: 1em;
      top: 1em;
    }
    #ixfx-data-display.theme-dark {
      background: black;
      color: white;
      border: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display:hover {
      opacity: 100%;
    }
    #ixfx-data-display table {
      border-collapse: collapse;
    }
    #ixfx-data-display tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 90%);
    }
    #ixfx-data-display.dark tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display td {
      padding-bottom: 0.4em;
      padding-top: 0.4em;
    }
    #ixfx-data-display .label {
      color: hsl(0deg 0.61% 60%);
      text-align: right;
      padding-right: 0.5em;
    }
    #ixfx-data-display.theme-dark .label {
      color: gray;
    }
    `,o.style.display="inline-block",document.body.append(a),document.body.append(o),this.dataTable=ty(o,void 0,{objectsAsTables:!0,...e})}update(e){this.dataTable.update(e)}};function Zu(e,r){return pn("textContent",e,r)}function Xu(e,r){return pn("innerHTML",e,r)}function pn(e,r,i){let o=[],a=n=>{let s=typeof n,l=s==="string"||s==="number"||s==="boolean"?n:JSON.stringify(n);o.length===0&&(o=qr(r));for(let u of o)u[e]=l;return l};return i===void 0?a:a(i)}const hF=e=>{let r=qr(e),i=Zu(r),o=Xu(r);return{text:i,html:o,cssDisplay:a=>{Qu(r,a)},cssClass:(a,n)=>{Hu(r,a,n)},cssToggle:a=>{Ku(r,a)},el:()=>r[0],els:()=>r}},pF=e=>({text:r=>Zu(e,r),html:r=>Xu(e,r),cssDisplay:r=>{Qu(e,r)},cssClass:(r,i)=>{Hu(e,r,i)},cssToggle:r=>{Ku(e,r)},el:()=>U(e),els:()=>qr(e)});var am={};A(am,{fromPoints:()=>yF,init:()=>nm});const yF=(e,r={})=>{let i=zo(...e);return nm(i.map(o=>Ut(o)),r)},nm=(e,r={})=>{let i=r.maxDistanceFromLine??.1;return a=>{let n=e.map((u,c)=>{let f=u.nearest(a),d=X(a,f);return{positionRelative:u.relativePosition(f,i),path:u,index:c,nearest:f,distance:d,rank:9007199254740991}}),s=n.filter(u=>u.distance<=i),l=Do(s,"distance");for(let u=0;u<l.length;u++)l[u].rank=u;return l}},gF=Object.freeze({a:{x:0,y:0},b:{x:0,y:0},c:{x:0,y:0}}),mF=Object.freeze({a:{x:NaN,y:NaN},b:{x:NaN,y:NaN},c:{x:NaN,y:NaN}}),ga=(e,r=10,i=Math.PI/2)=>{e||=Object.freeze({x:0,y:0});let o=Is(e,r,Math.PI- -i/2),a=Is(e,r,Math.PI-i/2);return{a:o,b:e,c:a}},bF=(e,r,i={})=>{let o=i.tailLength??10,a=i.tailThickness??Math.max(o/5,5),n=i.angleRadian??0,s=i.arrowSize??Math.max(o/5,15),l=Math.PI/2,u,c;if(r==="tip")u=ga(e,s,l),c=Pr(cr({x:u.a.x-o,y:e.y-a/2},o,a));else if(r==="middle"){let d=o+s/2,h=a/2;u=ga({x:e.x+s*1.2,y:e.y},s,l),c=Pr(cr({x:e.x-d,y:e.y-h},o+s,a))}else c=Pr(cr({x:e.x,y:e.y-a/2},o,a)),u=ga({x:e.x+o+s*.7,y:e.y},s,l);return kt([c[0],c[1],u.a,u.b,u.c,c[2],c[3]],n,e)},Jf=Math.PI*2,sm=(e,r={})=>{let i=pe(e)?e:{x:0,y:0},o=r.strategy??"uniform",a=r.margin??0,n=e.radius-a,s=r.randomSource??Math.random;switch(o){case"naive":return Qe(i,We(s()*n,s()*Jf));case"uniform":return Qe(i,We(Math.sqrt(s())*n,s()*Jf));default:throw Error(`Unknown strategy '${o}'. Expects 'uniform' or 'naive'`)}},lm=e=>pe(e)?Object.freeze({x:e.x,y:e.y}):Object.freeze({x:e.radius,y:e.radius}),dt=(e,r="t")=>{if(e===void 0)throw Error("{$name} undefined");O(e.a,r+".a"),O(e.b,r+".b"),O(e.c,r+".c")},um=e=>{if(e===void 0)return!1;let r=e;return!(!j(r.a)||!j(r.b)||!j(r.c))},vF=e=>oi(e.a)&&oi(e.b)&&oi(e.c),wF=e=>Mr(e.a)&&Mr(e.b)&&Mr(e.c),xF=(e,r)=>St(e.a,r.a)&&St(e.b,r.b)&&St(e.c,r.c),Lo=e=>{dt(e);let r=Xg([e.a,e.b,e.c],(o,a)=>({x:o.x+a.x,y:o.y+a.y}));return{x:r.x/3,y:r.y/3}},cm=(e,r={})=>{if(pe(e))return sm(e,r);if(vt(e))return $y(e,r);throw Error("Unknown shape. Only CirclePositioned and RectPositioned are supported.")},EF=e=>{if(e===void 0)return Object.freeze({x:.5,y:.5});if(ot(e))return an(e);if(um(e))return Lo(e);if(mi(e))return lm(e);throw Error(`Unknown shape: ${JSON.stringify(e)}`)},fm=(e,r,i)=>{let o=Eu(e,r);if(mi(r))return o<Math.abs(e.radius-r.radius);if(j(r))return i===void 0?o<=e.radius:o<Math.abs(e.radius-i);throw Error("b parameter is expected to be CirclePositioned or Point")},Yu=(e,r,i)=>St(e,r)||fm(e,r,i)?!0:mi(r)?Gf(e,r):vt(r)?ly(e,r):j(r)&&i!==void 0?Gf(e,{...r,radius:i}):!1,dm=(e,r)=>{if(pe(e))return Yu(e,r);if(vt(e))return uy(e,r);throw Error(`a or b are unknown shapes. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)},DF=(e,r=5,i,o=ee,a)=>{w(G(r,"positive","points"));let n=Math.PI*2/r,s=n/2,l=a?.initialAngleRadian??-Math.PI/2;i===void 0&&(i=e/2);let u=l,c=[];for(let f=0;f<r;f++){let d=We(e,u,o),h=We(i,u-s,o),p=We(i,u+s,o);c.push(h,d),f+1<r&&c.push(p),u+=n}return c};var hm={};A(hm,{arrow:()=>bF,center:()=>EF,isIntersecting:()=>dm,randomPoint:()=>cm,starburst:()=>DF});var pm={};A(pm,{random:()=>AF});const AF=(e,r,i={})=>{if(!Array.isArray(e))throw Error("Parameter 'circles' is not an array");let o=i.attempts??2e3,a=Do(e,"radius"),n=[],s=(l,u)=>n.some(c=>Yu(c,l,u));for(;a.length>0;){let l=a.pop();if(!l)break;let u={...i,margin:{x:l.radius,y:l.radius}};for(let c=0;c<o;c++){let f=cm(r,u);if(!s(f,l.radius)){n.push(Object.freeze({...l,...f}));break}}}return n};var ym={};A(ym,{CirclePacking:()=>pm});const CF=e=>(Po(e),Math.PI*e.radius*e.radius),gm=e=>pe(e)?fy(e,e.radius*2,e.radius*2):{width:e.radius*2,height:e.radius*2,x:0,y:0};function*SF(e){let{x:r,y:i,radius:o}=e,a=o,n=0,s=1-r;for(;a>=n;)yield{x:a+r,y:n+i},yield{x:n+r,y:a+i},yield{x:-a+r,y:n+i},yield{x:-n+r,y:a+i},yield{x:-a+r,y:-n+i},yield{x:-n+r,y:-a+i},yield{x:a+r,y:-n+i},yield{x:n+r,y:-a+i},n++,s<0?s+=2*n+1:(a--,s+=2*(n-a+1))}function*FF(e){let r=e.x-e.radius,i=e.x+e.radius,o=e.y-e.radius,a=e.y+e.radius;for(let n=r;n<i;n++)for(let s=o;s<a;s++)Math.abs(X(e,n,s))<=e.radius&&(yield{x:n,y:s})}const kF=Math.PI*2,mm=(e,r)=>{let i=o=>{let a=Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),n=o.x+o.radius*((r.x-o.x)/a),s=o.y+o.radius*((r.y-o.y)/a);return{x:n,y:s}};if(Array.isArray(e)){let o=e.map(n=>i(n)),a=o.map(n=>X(n,r));return Object.freeze(o[ru(...a)])}else return Object.freeze(i(e))},bm=(e,r,i)=>(i===void 0&&(i=pe(e)?e:{x:0,y:0}),{x:Math.cos(-r)*e.radius+i.x,y:Math.sin(-r)*e.radius+i.y}),ec=e=>(Po(e),kF*e.radius),$F=e=>ec(e),MF=Math.PI*2,vm=(e,r)=>bm(e,r*MF);function PF(e,r){if(pe(e)){let i=mt(e,r);return Object.freeze({...e,...i,radius:e.radius*r})}else return Object.freeze({...e,radius:e.radius*r})}const wm=(e,r,i)=>{if(mi(e)){if(i!==void 0)return ts(e.radius,i,r);if(pe(e))return ts(e.radius,e,r);throw Error("origin parameter needed for non-positioned circle")}else{if(i===void 0)throw Error("origin parameter needed");return ts(e,i,r)}},ts=(e,r,i)=>{let{x:o,y:a}=r,n=i?"1":"0";return`
    M ${o}, ${a}
    m -${e}, 0
    a ${e},${e} 0 1,${n} ${e*2},0
    a ${e},${e} 0 1,${n} -${e*2},0
  `.split(`
`)},NF=e=>(Po(e),{...e,nearest:r=>mm(e,r),interpolate:r=>vm(e,r),bbox:()=>gm(e),length:()=>ec(e),toSvgString:(r=!0)=>wm(e,r),relativePosition:(r,i)=>{throw Error("Not implemented")},distanceToPoint:r=>{throw Error("Not implemented")},kind:"circular"}),tc=(e,r,i)=>{if(pe(e))return e;let o=Pe(r,i);return Object.freeze({...e,...o})};var xm={};A(xm,{area:()=>CF,bbox:()=>gm,center:()=>lm,circumference:()=>ec,distanceCenter:()=>Eu,distanceFromExterior:()=>Du,exteriorIntegerPoints:()=>SF,guard:()=>Po,guardPositioned:()=>Na,interiorIntegerPoints:()=>FF,interpolate:()=>vm,intersectionLine:()=>AA,intersections:()=>sy,isCircle:()=>mi,isCirclePositioned:()=>pe,isContainedBy:()=>fm,isEqual:()=>ny,isIntersecting:()=>Yu,isNaN:()=>DA,isPositioned:()=>ay,length:()=>$F,multiplyScalar:()=>PF,nearest:()=>mm,pointOnPerimeter:()=>bm,randomPoint:()=>sm,toPath:()=>NF,toPositioned:()=>tc,toSvg:()=>wm});const Ei=e=>e.quadratic!==void 0,yn=e=>e.cubic1!==void 0&&e.cubic2!==void 0,Em=function(e){if(Ei(e)||Tt(e))return e.a;throw Error(`Unknown path type ${JSON.stringify(e)}`)},qs=function(e){if(Ei(e)||Tt(e))return e.b;throw Error(`Unknown path type ${JSON.stringify(e)}`)};var Dm={};A(Dm,{bbox:()=>ac,computeDimensions:()=>Io,distanceToPoint:()=>ic,fromPaths:()=>uc,guardContinuous:()=>sc,interpolate:()=>rc,relativePosition:()=>oc,setSegment:()=>Am,toString:()=>nc,toSvgString:()=>lc});const Am=(e,r,i)=>{let o=[...e.segments];return o[r]=i,uc(...o)},rc=(e,r,i,o)=>{o===void 0&&(o=Io(e));let a=r*(i?o.totalWidth:o.totalLength),n=0,s=i?o.widths:o.lengths;for(let[l,u]of s.entries())if(n+u>=a){let c=a-n,f=c/u;return f>1&&(f=1),e[l].interpolate(f)}else n+=u;return{x:0,y:0}},ic=(e,r)=>{if(e.length===0)return 0;let i=e.map((o,a)=>({path:o,index:a,distance:o.distanceToPoint(r)}));if(i=Do(i,"distance"),i.length===0)throw Error("Could not look up distances");return i[0].distance},oc=(e,r,i,o)=>{o===void 0&&(o=Io(e));let a=e.map((c,f)=>({path:c,index:f,distance:c.distanceToPoint(r)}));if(a=Do(a,"distance"),a.length<0)throw Error("Point does not intersect with path");let n=a[0];if(n.distance>i)throw Error(`Point does not intersect with path. Minimum distance: ${n.distance}, threshold: ${i}`);let s=n.path.relativePosition(r,i),l=0;for(let c=0;c<n.index;c++)l+=o.lengths[c];l+=o.lengths[n.index]*s;let u=l/o.totalLength;return console.log(`acc: ${l} rel: ${u} on path: ${s} path: ${n.index}`),u},Io=e=>{let r=e.map(n=>n.bbox().width),i=e.map(n=>n.length()),o=0,a=0;for(let n of i)o+=n;for(let n of r)a+=n;return{totalLength:o,totalWidth:a,widths:r,lengths:i}},ac=e=>{let r=e.map(o=>o.bbox()),i=r.flatMap(o=>Pr(o));return jo(...i)},nc=e=>e.map(r=>r.toString()).join(", "),sc=e=>{let r=qs(e[0]);for(let i=1;i<e.length;i++){let o=Em(e[i]);if(!St(o,r))throw Error(`Path index ${i} does not start at prior path end. Start: ${o.x},${o.y} expected: ${r.x},${r.y}`);r=qs(e[i])}},lc=e=>e.flatMap(r=>r.toSvgString()),uc=(...e)=>{sc(e);let r=Io(e);return Object.freeze({segments:e,length:()=>r.totalLength,nearest:i=>{throw Error("not implemented")},interpolate:(i,o=!1)=>rc(e,i,o,r),relativePosition:(i,o)=>oc(e,i,o,r),distanceToPoint:i=>ic(e,i),bbox:()=>ac(e),toString:()=>nc(e),toSvgString:()=>lc(e),kind:"compound"})};var Cm={};A(Cm,{bbox:()=>ac,computeDimensions:()=>Io,distanceToPoint:()=>ic,fromPaths:()=>uc,getEnd:()=>qs,getStart:()=>Em,guardContinuous:()=>sc,interpolate:()=>rc,relativePosition:()=>oc,setSegment:()=>Am,toString:()=>nc,toSvgString:()=>lc});const Sm=(e,r)=>!(r.x<0||r.y<0||r.x>=e.cols||r.y>=e.rows),BF=e=>e===void 0?!1:"x"in e&&"y"in e,Bt=(e,r="Param",i)=>{if(e===void 0)throw Error(r+" is undefined. Expecting {x,y}");if(e.x===void 0)throw Error(r+".x is undefined");if(e.y===void 0)throw Error(r+".y is undefined");if(Number.isNaN(e.x))throw Error(r+".x is NaN");if(Number.isNaN(e.y))throw Error(r+".y is NaN");if(!Number.isInteger(e.x))throw TypeError(r+".x is non-integer");if(!Number.isInteger(e.y))throw TypeError(r+".y is non-integer");if(i!==void 0&&!Sm(i,e))throw Error(`${r} is outside of grid. Cell: ${e.x},${e.y} Grid: ${i.cols}, ${i.rows}`)},Wr=(e,r="Param")=>{if(e===void 0)throw Error(`${r} is undefined. Expecting grid.`);if(!("rows"in e))throw Error(`${r}.rows is undefined`);if(!("cols"in e))throw Error(`${r}.cols is undefined`);if(!Number.isInteger(e.rows))throw TypeError(`${r}.rows is not an integer`);if(!Number.isInteger(e.cols))throw TypeError(`${r}.cols is not an integer`)},qo=function(e,r,i="undefined"){Wr(e,"grid"),Bt(r,"cell");let o=r.x,a=r.y;switch(i){case"wrap":o%=e.cols,a%=e.rows,o<0?o=e.cols+o:o>=e.cols&&(o-=e.cols),a<0?a=e.rows+a:a>=e.rows&&(a-=e.rows),o=Math.abs(o),a=Math.abs(a);break;case"stop":o=Es(o,e.cols),a=Es(a,e.rows);break;case"undefined":if(o<0||a<0||o>=e.cols||a>=e.rows)return;break;case"unbounded":break;default:throw Error(`Unknown BoundsLogic '${i}'. Expected: wrap, stop, undefined or unbounded`)}return Object.freeze({x:o,y:a})};var Fm={};A(Fm,{access:()=>km,createArray:()=>Tm,createMutable:()=>OF,set:()=>zF,setMutate:()=>Mm,wrap:()=>Bm,wrapMutable:()=>Nm});const km=(e,r)=>{let i=_o(e,r);return(a,n="undefined")=>$m(i,e,a,n)},$m=(e,r,i,o)=>{let a=Ci(e,i,o);if(a!==void 0)return r[a]},Mm=(e,r)=>{let i=_o(e,r);return(o,a,n="undefined")=>TF(i,e,o,a,n)},TF=(e,r,i,o,a)=>{let n=Ci(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);return r[n]=i,r},zF=(e,r)=>{let i=_o(e,r);return(o,a,n)=>Pm(i,e,o,a,n)},Pm=(e,r,i,o,a)=>{let n=Ci(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);let s=[...r];return s[n]=i,r=s,s},_o=(e,r)=>({cols:r,rows:Math.ceil(e.length/r)}),Nm=(e,r)=>({..._o(e,r),get:km(e,r),set:Mm(e,r),get array(){return e}}),Bm=(e,r)=>{let i=_o(e,r);return{...i,get:(o,a="undefined")=>$m(i,e,o,a),set:(o,a,n="undefined")=>(e=Pm(i,e,o,a,n),Bm(e,r)),get array(){return e}}},Tm=(e,r,i)=>{let o=typeof r=="number"?r:r.rows,a=typeof r=="object"?r.cols:i;if(!a)throw Error("Parameter 'columns' missing");w(G(o,"aboveZero","rows"),G(a,"aboveZero","cols"));let n=[],s=o*a;for(let l=0;l<s;l++)n[l]=e;return n},OF=(e,r,i)=>{let o=typeof r=="number"?r:r.rows,a=typeof r=="object"?r.cols:i;if(!a)throw Error("Parameter 'columns' missing");let n=Tm(e,o,a);return Nm(n,a)};var zm={};A(zm,{access:()=>jm,create:()=>Di,set:()=>VF,setMutate:()=>Om,wrap:()=>Lm,wrapMutable:()=>RF});const Di=e=>{let r=NaN;for(let i of e)if(Number.isNaN(r))r=i.length;else if(r!==i.length)throw Error("Array does not have uniform column length");return{rows:e.length,cols:r}},Om=e=>{let r=Di(e);return(i,o,a="undefined")=>jF(r,e,i,o,a)},jF=(e,r,i,o,a)=>{let n=qo(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);return r[n.y][n.x]=i,r},jm=e=>{let r=Di(e);return(o,a="undefined")=>Rm(r,e,o,a)},Rm=(e,r,i,o)=>{let a=qo(e,i,o);if(a!==void 0)return r[a.y][a.x]},RF=e=>({...Di(e),get:jm(e),set:Om(e),get array(){return e}}),VF=e=>{let r=Di(e);return(i,o,a)=>Vm(r,e,i,o,a)},Vm=(e,r,i,o,a)=>{let n=qo(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);let s=[...r],l=[...s[n.y]];return l[n.x]=i,s[n.y]=l,r=s,s},Lm=e=>{let r=Di(e);return{...r,get:(i,o="undefined")=>Rm(r,e,i,o),set:(i,o,a="undefined")=>(e=Vm(r,e,i,o,a),Lm(e)),get array(){return e}}};function*Im(e,r){for(let i of r)Array.isArray(i)?yield i.map(o=>e.get(o,"undefined")):yield e.get(i,"undefined")}function*Ai(e,r,i=!0){r||={x:0,y:0},Wr(e,"grid"),Bt(r,"start",e);let{x:o,y:a}=r,n=!0;do yield{x:o,y:a},o++,o===e.cols&&(a++,o=0),a===e.rows&&(i?(a=0,o=0):n=!1),o===r.x&&a===r.y&&(n=!1);while(n)}function*LF(e,r,i=!0){yield*Im(e,Ai(e,r,i))}function*IF(e,r,i=!0){for(let o of Ai(e,r,i))yield{cell:o,value:e.get(o)}}var qm={};A(qm,{columns:()=>qF,rows:()=>_m});const _m=function*(e,r){r||={x:0,y:0};let i=r.y,o=[];for(let a of Ai(e,r))a.y===i?o.push(a):(yield o,o=[a],i=a.y);o.length>0&&(yield o)};function*qF(e,r){r||={x:0,y:0};for(let i=r.x;i<e.cols;i++){let o=[];for(let a=r.y;a<e.rows;a++)o.push({x:i,y:a});yield o}}const gn=function(e,r,i,o="undefined"){return qo(e,{x:r.x+i.x,y:r.y+i.y},o)},mn=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),Wm=Object.freeze(["n","e","s","w"]),_F=(e,r,i,o="stop")=>{Wr(e,"grid"),Bt(r,"start"),w(G(i,"aboveZero","steps"));let a=mn,n=a.map(l=>cc(l,i)),s=a.map((l,u)=>gn(e,r,n[u],o));return Co(a,s)},cc=(e,r=1)=>{let i;switch(e){case"n":i={x:0,y:-1*r};break;case"ne":i={x:1*r,y:-1*r};break;case"e":i={x:1*r,y:0};break;case"se":i={x:1*r,y:1*r};break;case"s":i={x:0,y:1*r};break;case"sw":i={x:-1*r,y:1*r};break;case"w":i={x:-1*r,y:0};break;case"nw":i={x:-1*r,y:-1*r};break;default:i={x:0,y:0}}return Object.freeze(i)};var Gm={};A(Gm,{cellValues:()=>LF,cells:()=>Ai,cellsAndValues:()=>IF});const WF=(e,r)=>{Bt(e),Bt(r);let i=e.x,o=e.y,a=Math.abs(r.x-i),n=Math.abs(r.y-o),s=i<r.x?1:-1,l=o<r.y?1:-1,u=a-n,c=[];for(;c.push(Object.freeze({x:i,y:o})),!(i===r.x&&o===r.y);){let f=2*u;f>-n&&(u-=n,i+=s),f<a&&(u+=a,o+=l)}return c},GF=function(e,r,i=!1){let o=[];if(e.x===r.x){let a=i?r.y+1:r.y;for(let n=e.y;n<a;n++)o.push({x:e.x,y:n})}else if(e.y===r.y){let a=i?r.x+1:r.x;for(let n=e.x;n<a;n++)o.push({x:n,y:e.y})}else throw Error(`Only does vertical and horizontal: ${e.x},${e.y} - ${r.x},${r.y}`);return o},Ci=(e,r,i)=>{if(Wr(e,"grid"),r.x<0)switch(i){case"stop":r={...r,x:0};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r=gn(e,{x:0,y:r.y},{x:r.x,y:0},"wrap");break}if(r.y<0)switch(i){case"stop":r={...r,y:0};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,y:e.rows+r.y};break}if(r.x>=e.cols)switch(i){case"stop":r={...r,x:e.cols-1};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,x:r.x%e.cols};break}if(r.y>=e.rows)switch(i){case"stop":r={...r,y:e.rows-1};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,y:r.y%e.rows};break}return r.y*e.cols+r.x},UF=(e,r)=>{let i=0;return i=typeof e=="number"?e:e.cols,w(G(i,"aboveZero","colsOrGrid")),{x:r%i,y:Math.floor(r/i)}},JF=(e,r)=>{if(r===void 0||e===void 0)return!1;if("rows"in e&&"cols"in e)if("rows"in r&&"cols"in r){if(e.rows!==r.rows||e.cols!==r.cols)return!1}else return!1;if("size"in e)if("size"in r){if(e.size!==r.size)return!1}else return!1;return!0},Um=(e,r)=>r===void 0||e===void 0?!1:e.x===r.x&&e.y===r.y,fc=e=>vy(e),HF=e=>!(e===void 0||e[1]===void 0),dc=(e,r,i,o)=>{let a=Jm(e,r,o,i);return Object.entries(a).filter(s=>HF(s))},Jm=(e,r,i="undefined",o)=>{let a=o??mn,n=a.map(s=>gn(e,r,cc(s),i));return Co(a,n)},KF=(e,r)=>{let i=[];for(let o=0;o<e.rows;o++)if(i[o]=Array.from({length:e.cols}),r)for(let a=0;a<e.cols;a++)i[o][a]=r;return i},Hm=e=>`Cell{${e.x},${e.y}}`;function*QF(e){for(let r of Ai(e))yield Km(e,r)}const ZF=(e,r)=>{let i=e.size;if(w(C(i,"positive","grid.size")),r.x<0||r.y<0)return;let o=Math.floor(r.x/i),a=Math.floor(r.y/i);if(!(o>=e.cols)&&!(a>=e.rows))return{x:o,y:a}},Km=(e,r)=>{Bt(r);let i=e.size,o=r.x*i,a=r.y*i;return cr({x:o,y:a},i,i)},XF=(e,r)=>{Bt(r);let i=e.size,o=r.x*i,a=r.y*i;return Object.freeze({x:o+i/2,y:a+i/2})},Qm=()=>({select:e=>e[0]}),Zm=()=>({select:e=>e.at(0),getNeighbours:(e,r)=>dc(e,r,mn,"undefined")}),Xm=(e={})=>{let r=e.reversed??!1;return{select:i=>i.find(o=>o[0]===(r?"n":"s")),getNeighbours:(i,o)=>(o=r?o.y>0?{x:o.x,y:o.y-1}:o.x===0?{x:i.cols-1,y:i.rows-1}:{x:o.x-1,y:i.rows-1}:o.y<i.rows-1?{x:o.x,y:o.y+1}:o.x<i.cols-1?{x:o.x+1,y:0}:{x:0,y:0},[[r?"n":"s",o]])}},Ym=()=>({select:e=>e.at(-1)}),eb=()=>({getNeighbours:(e,r)=>{let i=[];for(let o of Ai(e,r))i.push(["n",o]);return i},select:fc}),tb=()=>({select:fc}),rb=(e={})=>{let r=e.reversed??!1;return{select:i=>i.find(o=>o[0]===(r?"w":"e")),getNeighbours:(i,o)=>(o=r?o.x>0?{x:o.x-1,y:o.y}:o.y>0?{x:i.cols-1,y:o.y-1}:{x:i.cols-1,y:i.rows-1}:o.x<i.rows-1?{x:o.x+1,y:o.y}:o.y<i.rows-1?{x:0,y:o.y+1}:{x:0,y:0},[[r?"w":"e",o]])}};function*ib(e,r,i={}){Wr(r,"grid");let o=i.start??{x:0,y:0};Bt(o,"opts.start",r);let a=i.visited??n0(Hm),n=e.getNeighbours??((c,f)=>dc(c,f,Wm,"undefined")),s=[o],l=[],u;for(;s.length>0;){if(u===void 0){let c=s.pop();if(c===void 0)break;u=c}if(!a.has(u)){a.add(u),yield u;let c=n(r,u).filter(f=>f[1]===void 0?!1:!a.has(f[1]));if(c.length===0)u!==void 0&&(s=s.filter(f=>Um(f,u)));else for(let f of c)f===void 0||f[1]===void 0||l.push(f)}if(l=l.filter(c=>!a.has(c[1])),l.length===0)u=void 0;else{let c=e.select(l);c!==void 0&&(s.push(c[1]),u=c[1])}}}const YF=(e,r,i={x:0,y:0},o=1)=>{Wr(e,"grid"),Bt(i,"start"),w(G(o,"","resolution"));let a=[],n=0,s=0;for(let l of r(e,{start:i,boundsWrap:"undefined"}))n++,n%o===0&&a.push(l);return(l,u=!1)=>(w(G(l,"","step")),u?s=l:s+=l,a.at(s%a.length))};var ob={};A(ob,{breadthLogic:()=>Qm,columnLogic:()=>Xm,create:()=>ek,depthLogic:()=>Ym,neighboursLogic:()=>Zm,randomContiguousLogic:()=>tb,randomLogic:()=>eb,rowLogic:()=>rb,stepper:()=>YF,visitByNeighbours:()=>ib,withLogic:()=>lr});const ek=(e,r={})=>{switch(e){case"random-contiguous":return lr(tb(),r);case"random":return lr(eb(),r);case"depth":return lr(Ym(),r);case"breadth":return lr(Qm(),r);case"neighbours":return lr(Zm(),r);case"row":return lr(rb(r),r);case"column":return lr(Xm(r),r);default:throw TypeError(`Param 'type' unknown. Value: ${e}`)}},lr=(e,r={})=>(i,o={})=>ib(e,i,{...r,...o});var ab={};A(ab,{Array1d:()=>Fm,Array2d:()=>zm,As:()=>qm,By:()=>Gm,Visit:()=>ob,allDirections:()=>mn,applyBounds:()=>qo,asRectangles:()=>QF,cellAtPoint:()=>ZF,cellEquals:()=>Um,cellFromIndex:()=>UF,cellKeyString:()=>Hm,cellMiddle:()=>XF,crossDirections:()=>Wm,getLine:()=>WF,getVectorFromCardinal:()=>cc,guardCell:()=>Bt,guardGrid:()=>Wr,indexFromCell:()=>Ci,inside:()=>Sm,isCell:()=>BF,isEqual:()=>JF,neighbourList:()=>dc,neighbours:()=>Jm,offset:()=>gn,offsetCardinals:()=>_F,randomNeighbour:()=>fc,rectangleForCell:()=>Km,simpleLine:()=>GF,toArray2d:()=>KF,values:()=>Im});const{abs:Ii,cos:It,sin:Qr,acos:tk,atan2:qi,sqrt:nr,pow:et}=Math;function _i(e){return e<0?-et(-e,1/3):et(e,1/3)}const nb=Math.PI,la=2*nb,sr=nb/2,rk=1e-6,rs=2**53-1,is=-9007199254740991,ik={x:0,y:0,z:0},F={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,r){let i=r(e),o=i.x*i.x+i.y*i.y;return i.z!==void 0&&(o+=i.z*i.z),nr(o)},compute:function(e,r,i){if(e===0)return r[0].t=0,r[0];let o=r.length-1;if(e===1)return r[o].t=1,r[o];let a=1-e,n=r;if(o===0)return r[0].t=e,r[0];if(o===1){let l={x:a*n[0].x+e*n[1].x,y:a*n[0].y+e*n[1].y,t:e};return i&&(l.z=a*n[0].z+e*n[1].z),l}if(o<4){let l=a*a,u=e*e,c,f,d,h=0;o===2?(n=[n[0],n[1],n[2],ik],c=l,f=a*e*2,d=u):o===3&&(c=l*a,f=l*e*3,d=a*u*3,h=e*u);let p={x:c*n[0].x+f*n[1].x+d*n[2].x+h*n[3].x,y:c*n[0].y+f*n[1].y+d*n[2].y+h*n[3].y,t:e};return i&&(p.z=c*n[0].z+f*n[1].z+d*n[2].z+h*n[3].z),p}let s=JSON.parse(JSON.stringify(r));for(;s.length>1;){for(let l=0;l<s.length-1;l++)s[l]={x:s[l].x+(s[l+1].x-s[l].x)*e,y:s[l].y+(s[l+1].y-s[l].y)*e},s[l].z!==void 0&&(s[l].z=s[l].z+(s[l+1].z-s[l].z)*e);s.splice(s.length-1,1)}return s[0].t=e,s[0]},computeWithRatios:function(e,r,i,o){let a=1-e,n=i,s=r,l=n[0],u=n[1],c=n[2],f=n[3],d;if(l*=a,u*=e,s.length===2)return d=l+u,{x:(l*s[0].x+u*s[1].x)/d,y:(l*s[0].y+u*s[1].y)/d,z:o?(l*s[0].z+u*s[1].z)/d:!1,t:e};if(l*=a,u*=2*a,c*=e*e,s.length===3)return d=l+u+c,{x:(l*s[0].x+u*s[1].x+c*s[2].x)/d,y:(l*s[0].y+u*s[1].y+c*s[2].y)/d,z:o?(l*s[0].z+u*s[1].z+c*s[2].z)/d:!1,t:e};if(l*=a,u*=1.5*a,c*=3*a,f*=e*e*e,s.length===4)return d=l+u+c+f,{x:(l*s[0].x+u*s[1].x+c*s[2].x+f*s[3].x)/d,y:(l*s[0].y+u*s[1].y+c*s[2].y+f*s[3].y)/d,z:o?(l*s[0].z+u*s[1].z+c*s[2].z+f*s[3].z)/d:!1,t:e}},derive:function(e,r){let i=[];for(let o=e,a=o.length,n=a-1;a>1;a--,n--){let s=[];for(let l=0,u;l<n;l++)u={x:n*(o[l+1].x-o[l].x),y:n*(o[l+1].y-o[l].y)},r&&(u.z=n*(o[l+1].z-o[l].z)),s.push(u);i.push(s),o=s}return i},between:function(e,r,i){return r<=e&&e<=i||F.approximately(e,r)||F.approximately(e,i)},approximately:function(e,r,i){return Ii(e-r)<=(i||rk)},length:function(e){let r=.5,i=F.Tvalues.length,o=0;for(let a=0,n;a<i;a++)n=r*F.Tvalues[a]+r,o+=F.Cvalues[a]*F.arcfn(n,e);return r*o},map:function(e,r,i,o,a){let n=i-r,s=a-o,l=e-r,u=l/n;return o+s*u},lerp:function(e,r,i){let o={x:r.x+e*(i.x-r.x),y:r.y+e*(i.y-r.y)};return r.z!==void 0&&i.z!==void 0&&(o.z=r.z+e*(i.z-r.z)),o},pointToString:function(e){let r=e.x+"/"+e.y;return e.z!==void 0&&(r+="/"+e.z),r},pointsToString:function(e){return"["+e.map(F.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,r,i){let o=r.x-e.x,a=r.y-e.y,n=i.x-e.x,s=i.y-e.y,l=o*s-a*n,u=o*n+a*s;return qi(l,u)},round:function(e,r){let i=""+e,o=i.indexOf(".");return parseFloat(i.substring(0,o+1+r))},dist:function(e,r){let i=e.x-r.x,o=e.y-r.y;return nr(i*i+o*o)},closest:function(e,r){let i=et(2,63),o,a;return e.forEach(function(n,s){a=F.dist(r,n),a<i&&(i=a,o=s)}),{mdist:i,mpos:o}},abcratio:function(e,r){if(r!==2&&r!==3)return!1;if(e===void 0)e=.5;else if(e===0||e===1)return e;let i=et(e,r)+et(1-e,r),o=i-1;return Ii(o/i)},projectionratio:function(e,r){if(r!==2&&r!==3)return!1;if(e===void 0)e=.5;else if(e===0||e===1)return e;let i=et(1-e,r),o=et(e,r)+i;return i/o},lli8:function(e,r,i,o,a,n,s,l){let u=(e*o-r*i)*(a-s)-(e-i)*(a*l-n*s),c=(e*o-r*i)*(n-l)-(r-o)*(a*l-n*s),f=(e-i)*(n-l)-(r-o)*(a-s);return f==0?!1:{x:u/f,y:c/f}},lli4:function(e,r,i,o){let a=e.x,n=e.y,s=r.x,l=r.y,u=i.x,c=i.y,f=o.x,d=o.y;return F.lli8(a,n,s,l,u,c,f,d)},lli:function(e,r){return F.lli4(e,e.c,r,r.c)},makeline:function(e,r){return new co(e.x,e.y,(e.x+r.x)/2,(e.y+r.y)/2,r.x,r.y)},findbbox:function(e){let r=rs,i=rs,o=is,a=is;return e.forEach(function(n){let s=n.bbox();r>s.x.min&&(r=s.x.min),i>s.y.min&&(i=s.y.min),o<s.x.max&&(o=s.x.max),a<s.y.max&&(a=s.y.max)}),{x:{min:r,mid:(r+o)/2,max:o,size:o-r},y:{min:i,mid:(i+a)/2,max:a,size:a-i}}},shapeintersections:function(e,r,i,o,a){if(!F.bboxoverlap(r,o))return[];let n=[],s=[e.startcap,e.forward,e.back,e.endcap],l=[i.startcap,i.forward,i.back,i.endcap];return s.forEach(function(u){u.virtual||l.forEach(function(c){if(c.virtual)return;let f=u.intersects(c,a);f.length>0&&(f.c1=u,f.c2=c,f.s1=e,f.s2=i,n.push(f))})}),n},makeshape:function(e,r,i){let o=r.points.length,a=e.points.length,n=F.makeline(r.points[o-1],e.points[0]),s=F.makeline(e.points[a-1],r.points[0]),l={startcap:n,forward:e,back:r,endcap:s,bbox:F.findbbox([n,e,r,s])};return l.intersections=function(u){return F.shapeintersections(l,l.bbox,u,u.bbox,i)},l},getminmax:function(e,r,i){if(!i)return{min:0,max:0};let o=rs,a=is,n,s;i.indexOf(0)===-1&&(i=[0].concat(i)),i.indexOf(1)===-1&&i.push(1);for(let l=0,u=i.length;l<u;l++)n=i[l],s=e.get(n),s[r]<o&&(o=s[r]),s[r]>a&&(a=s[r]);return{min:o,mid:(o+a)/2,max:a,size:a-o}},align:function(e,r){let i=r.p1.x,o=r.p1.y,a=-qi(r.p2.y-o,r.p2.x-i),n=function(s){return{x:(s.x-i)*It(a)-(s.y-o)*Qr(a),y:(s.x-i)*Qr(a)+(s.y-o)*It(a)}};return e.map(n)},roots:function(e,r){r||={p1:{x:0,y:0},p2:{x:1,y:0}};let i=e.length-1,o=F.align(e,r),a=function(M){return 0<=M&&M<=1};if(i===2){let M=o[0].y,P=o[1].y,$=o[2].y,te=M-2*P+$;if(te!==0){let le=-nr(P*P-M*$),be=-M+P,Ue=-(le+be)/te,J=-(-le+be)/te;return[Ue,J].filter(a)}else if(P!==$&&te===0)return[(2*P-$)/(2*P-2*$)].filter(a);return[]}let n=o[0].y,s=o[1].y,l=o[2].y,u=o[3].y,c=-n+3*s-3*l+u,f=3*n-6*s+3*l,d=-3*n+3*s,h=n;if(F.approximately(c,0)){if(F.approximately(f,0))return F.approximately(d,0)?[]:[-h/d].filter(a);let M=nr(d*d-4*f*h),P=2*f;return[(M-d)/P,(-d-M)/P].filter(a)}f/=c,d/=c,h/=c;let p=(3*d-f*f)/3,y=p/3,g=(2*f*f*f-9*f*d+27*h)/27,m=g/2,v=m*m+y*y*y,D,B,V,x,k;if(v<0){let M=-p/3,P=M*M*M,$=nr(P),te=-g/(2*$),le=te<-1?-1:te>1?1:te,be=tk(le),Ue=_i($),J=2*Ue;return V=J*It(be/3)-f/3,x=J*It((be+la)/3)-f/3,k=J*It((be+2*la)/3)-f/3,[V,x,k].filter(a)}else{if(v===0)return D=m<0?_i(-m):-_i(m),V=2*D-f/3,x=-D-f/3,[V,x].filter(a);{let M=nr(v);return D=_i(-m+M),B=_i(m+M),[D-B-f/3].filter(a)}}},droots:function(e){if(e.length===3){let r=e[0],i=e[1],o=e[2],a=r-2*i+o;if(a!==0){let n=-nr(i*i-r*o),s=-r+i,l=-(n+s)/a,u=-(-n+s)/a;return[l,u]}else if(i!==o&&a===0)return[(2*i-o)/(2*(i-o))];return[]}if(e.length===2){let r=e[0],i=e[1];return r===i?[]:[r/(r-i)]}return[]},curvature:function(e,r,i,o,a){let n,s,l,u,c=0,f=0,d=F.compute(e,r),h=F.compute(e,i),p=d.x*d.x+d.y*d.y;if(o?(n=nr(et(d.y*h.z-h.y*d.z,2)+et(d.z*h.x-h.z*d.x,2)+et(d.x*h.y-h.x*d.y,2)),s=et(p+d.z*d.z,3/2)):(n=d.x*h.y-d.y*h.x,s=et(p,3/2)),n===0||s===0)return{k:0,r:0};if(c=n/s,f=s/n,!a){let y=F.curvature(e-.001,r,i,o,!0).k,g=F.curvature(e+.001,r,i,o,!0).k;u=(g-c+(c-y))/2,l=(Ii(g-c)+Ii(c-y))/2}return{k:c,r:f,dk:u,adk:l}},inflections:function(e){if(e.length<4)return[];let r=F.align(e,{p1:e[0],p2:e.slice(-1)[0]}),i=r[2].x*r[1].y,o=r[3].x*r[1].y,a=r[1].x*r[2].y,n=r[3].x*r[2].y,s=18*(-3*i+2*o+3*a-n),l=18*(3*i-o-3*a),u=18*(a-i);if(F.approximately(s,0)){if(!F.approximately(l,0)){let h=-u/l;if(0<=h&&h<=1)return[h]}return[]}let c=2*s;if(F.approximately(c,0))return[];let f=l*l-4*s*u;if(f<0)return[];let d=Math.sqrt(f);return[(d-l)/c,-(l+d)/c].filter(function(h){return 0<=h&&h<=1})},bboxoverlap:function(e,r){let i=["x","y"],o=i.length;for(let a=0,n,s,l,u;a<o;a++)if(n=i[a],s=e[n].mid,l=r[n].mid,u=(e[n].size+r[n].size)/2,Ii(s-l)>=u)return!1;return!0},expandbox:function(e,r){r.x.min<e.x.min&&(e.x.min=r.x.min),r.y.min<e.y.min&&(e.y.min=r.y.min),r.z&&r.z.min<e.z.min&&(e.z.min=r.z.min),r.x.max>e.x.max&&(e.x.max=r.x.max),r.y.max>e.y.max&&(e.y.max=r.y.max),r.z&&r.z.max>e.z.max&&(e.z.max=r.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,r,i){let o=e.bbox(),a=r.bbox(),n=1e5,s=i||.5;if(o.x.size+o.y.size<s&&a.x.size+a.y.size<s)return[(n*(e._t1+e._t2)/2|0)/n+"/"+(n*(r._t1+r._t2)/2|0)/n];let l=e.split(.5),u=r.split(.5),c=[{left:l.left,right:u.left},{left:l.left,right:u.right},{left:l.right,right:u.right},{left:l.right,right:u.left}];c=c.filter(function(d){return F.bboxoverlap(d.left.bbox(),d.right.bbox())});let f=[];return c.length===0||(c.forEach(function(d){f=f.concat(F.pairiteration(d.left,d.right,s))}),f=f.filter(function(d,h){return f.indexOf(d)===h})),f},getccenter:function(e,r,i){let o=r.x-e.x,a=r.y-e.y,n=i.x-r.x,s=i.y-r.y,l=o*It(sr)-a*Qr(sr),u=o*Qr(sr)+a*It(sr),c=n*It(sr)-s*Qr(sr),f=n*Qr(sr)+s*It(sr),d=(e.x+r.x)/2,h=(e.y+r.y)/2,p=(r.x+i.x)/2,y=(r.y+i.y)/2,g=d+l,m=h+u,v=p+c,D=y+f,B=F.lli8(d,h,g,m,p,y,v,D),V=F.dist(B,e),x=qi(e.y-B.y,e.x-B.x),k=qi(r.y-B.y,r.x-B.x),M=qi(i.y-B.y,i.x-B.x),P;return x<M?((x>k||k>M)&&(x+=la),x>M&&(P=M,M=x,x=P)):M<k&&k<x?(P=M,M=x,x=P):M+=la,B.s=x,B.e=M,B.r=V,B},numberSort:function(e,r){return e-r}};var os=class sb{constructor(r){this.curves=[],this._3d=!1,r&&(this.curves=r,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(r){return F.pointsToString(r.points)}).join(", ")+"]"}addCurve(r){this.curves.push(r),this._3d=this._3d||r._3d}length(){return this.curves.map(function(r){return r.length()}).reduce(function(r,i){return r+i})}curve(r){return this.curves[r]}bbox(){let r=this.curves;for(var i=r[0].bbox(),o=1;o<r.length;o++)F.expandbox(i,r[o].bbox());return i}offset(r){let i=[];return this.curves.forEach(function(o){i.push(...o.offset(r))}),new sb(i)}};const{abs:Wi,min:Hf,max:Kf,cos:ok,sin:ak,acos:nk,sqrt:Gi}=Math,sk=Math.PI;var co=class he{constructor(r){let i=r&&r.forEach?r:Array.from(arguments).slice(),o=!1;if(typeof i[0]=="object"){o=i.length;let p=[];i.forEach(function(y){["x","y","z"].forEach(function(g){y[g]!==void 0&&p.push(y[g])})}),i=p}let a=!1,n=i.length;if(o){if(o>4){if(arguments.length!==1)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");a=!0}}else if(n!==6&&n!==8&&n!==9&&n!==12&&arguments.length!==1)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let s=this._3d=!a&&(n===9||n===12)||r&&r[0]&&r[0].z!==void 0,l=this.points=[];for(let p=0,y=s?3:2;p<n;p+=y){var u={x:i[p],y:i[p+1]};s&&(u.z=i[p+2]),l.push(u)}let c=this.order=l.length-1,f=this.dims=["x","y"];s&&f.push("z"),this.dimlen=f.length;let d=F.align(l,{p1:l[0],p2:l[c]}),h=F.dist(l[0],l[c]);this._linear=d.reduce((p,y)=>p+Wi(y.y),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(r,i,o,a){if(a===void 0&&(a=.5),a===0)return new he(i,i,o);if(a===1)return new he(r,i,i);let n=he.getABC(2,r,i,o,a);return new he(r,n.A,o)}static cubicFromPoints(r,i,o,a,n){a===void 0&&(a=.5);let s=he.getABC(3,r,i,o,a);n===void 0&&(n=F.dist(i,s.C));let l=n*(1-a)/a,u=F.dist(r,o),c=(o.x-r.x)/u,f=(o.y-r.y)/u,d=n*c,h=n*f,p=l*c,y=l*f,g={x:i.x-d,y:i.y-h},m={x:i.x+p,y:i.y+y},v=s.A,D={x:v.x+(g.x-v.x)/(1-a),y:v.y+(g.y-v.y)/(1-a)},B={x:v.x+(m.x-v.x)/a,y:v.y+(m.y-v.y)/a},V={x:r.x+(D.x-r.x)/a,y:r.y+(D.y-r.y)/a},x={x:o.x+(B.x-o.x)/(1-a),y:o.y+(B.y-o.y)/(1-a)};return new he(r,V,x,o)}static getUtils(){return F}getUtils(){return he.getUtils()}static get PolyBezier(){return os}valueOf(){return this.toString()}toString(){return F.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let r=this.points,i=r[0].x,o=r[0].y,a=["M",i,o,this.order===2?"Q":"C"];for(let n=1,s=r.length;n<s;n++)a.push(r[n].x),a.push(r[n].y);return a.join(" ")}setRatios(r){if(r.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=r,this._lut=[]}verify(){let r=this.coordDigest();r!==this._print&&(this._print=r,this.update())}coordDigest(){return this.points.map(function(r,i){return""+i+r.x+r.y+(r.z?r.z:0)}).join("")}update(){this._lut=[],this.dpoints=F.derive(this.points,this._3d),this.computedirection()}computedirection(){let r=this.points,i=F.angle(r[0],r[this.order],r[1]);this.clockwise=i>0}length(){return F.length(this.derivative.bind(this))}static getABC(r=2,i,o,a,n=.5){let s=F.projectionratio(n,r),l=1-s,u={x:s*i.x+l*a.x,y:s*i.y+l*a.y},c=F.abcratio(n,r);return{A:{x:o.x+(o.x-u.x)/c,y:o.y+(o.y-u.y)/c},B:o,C:u,S:i,E:a}}getABC(r,i){i||=this.get(r);let o=this.points[0],a=this.points[this.order];return he.getABC(this.order,o,i,a,r)}getLUT(r){if(this.verify(),r||=100,this._lut.length===r+1)return this._lut;this._lut=[],r++,this._lut=[];for(let i=0,o,a;i<r;i++)a=i/(r-1),o=this.compute(a),o.t=a,this._lut.push(o);return this._lut}on(r,i){i||=5;let o=this.getLUT(),a=[];for(let n=0,s,l=0;n<o.length;n++)s=o[n],F.dist(s,r)<i&&(a.push(s),l+=n/o.length);return a.length?t/=a.length:!1}project(r){let i=this.getLUT(),o=i.length-1,a=F.closest(i,r),n=a.mpos,s=(n-1)/o,l=(n+1)/o,u=.1/o,c=a.mdist,f=s,d=f,h;c+=1;for(let p;f<l+u;f+=u)h=this.compute(f),p=F.dist(r,h),p<c&&(c=p,d=f);return d=d<0?0:d>1?1:d,h=this.compute(d),h.t=d,h.d=c,h}get(r){return this.compute(r)}point(r){return this.points[r]}compute(r){return this.ratios?F.computeWithRatios(r,this.points,this.ratios,this._3d):F.compute(r,this.points,this._3d,this.ratios)}raise(){let r=this.points,i=[r[0]],o=r.length;for(let a=1,n,s;a<o;a++)n=r[a],s=r[a-1],i[a]={x:(o-a)/o*n.x+a/o*s.x,y:(o-a)/o*n.y+a/o*s.y};return i[o]=r[o-1],new he(i)}derivative(r){return F.compute(r,this.dpoints[0],this._3d)}dderivative(r){return F.compute(r,this.dpoints[1],this._3d)}align(){let r=this.points;return new he(F.align(r,{p1:r[0],p2:r[r.length-1]}))}curvature(r){return F.curvature(r,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return F.inflections(this.points)}normal(r){return this._3d?this.__normal3(r):this.__normal2(r)}__normal2(r){let i=this.derivative(r),o=Gi(i.x*i.x+i.y*i.y);return{t:r,x:-i.y/o,y:i.x/o}}__normal3(r){let i=this.derivative(r),o=this.derivative(r+.01),a=Gi(i.x*i.x+i.y*i.y+i.z*i.z),n=Gi(o.x*o.x+o.y*o.y+o.z*o.z);i.x/=a,i.y/=a,i.z/=a,o.x/=n,o.y/=n,o.z/=n;let s={x:o.y*i.z-o.z*i.y,y:o.z*i.x-o.x*i.z,z:o.x*i.y-o.y*i.x},l=Gi(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=l,s.y/=l,s.z/=l;let u=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{t:r,x:u[0]*i.x+u[1]*i.y+u[2]*i.z,y:u[3]*i.x+u[4]*i.y+u[5]*i.z,z:u[6]*i.x+u[7]*i.y+u[8]*i.z}}hull(r){let i=this.points,o=[],a=[],n=0;for(a[n++]=i[0],a[n++]=i[1],a[n++]=i[2],this.order===3&&(a[n++]=i[3]);i.length>1;){o=[];for(let s=0,l,u=i.length-1;s<u;s++)l=F.lerp(r,i[s],i[s+1]),a[n++]=l,o.push(l);i=o}return a}split(r,i){if(r===0&&i)return this.split(i).left;if(i===1)return this.split(r).right;let o=this.hull(r),a={left:this.order===2?new he([o[0],o[3],o[5]]):new he([o[0],o[4],o[7],o[9]]),right:this.order===2?new he([o[5],o[4],o[2]]):new he([o[9],o[8],o[6],o[3]]),span:o};return a.left._t1=F.map(0,0,1,this._t1,this._t2),a.left._t2=F.map(r,0,1,this._t1,this._t2),a.right._t1=F.map(r,0,1,this._t1,this._t2),a.right._t2=F.map(1,0,1,this._t1,this._t2),i?(i=F.map(i,r,1,0,1),a.right.split(i).left):a}extrema(){let r={},i=[];return this.dims.forEach((function(o){let a=function(s){return s[o]},n=this.dpoints[0].map(a);r[o]=F.droots(n),this.order===3&&(n=this.dpoints[1].map(a),r[o]=r[o].concat(F.droots(n))),r[o]=r[o].filter(function(s){return s>=0&&s<=1}),i=i.concat(r[o].sort(F.numberSort))}).bind(this)),r.values=i.sort(F.numberSort).filter(function(o,a){return i.indexOf(o)===a}),r}bbox(){let r=this.extrema(),i={};return this.dims.forEach((function(o){i[o]=F.getminmax(this,o,r[o])}).bind(this)),i}overlaps(r){let i=this.bbox(),o=r.bbox();return F.bboxoverlap(i,o)}offset(r,i){if(i!==void 0){let o=this.get(r),a=this.normal(r),n={c:o,n:a,x:o.x+a.x*i,y:o.y+a.y*i};return this._3d&&(n.z=o.z+a.z*i),n}if(this._linear){let o=this.normal(0),a=this.points.map(function(n){let s={x:n.x+r*o.x,y:n.y+r*o.y};return n.z&&o.z&&(s.z=n.z+r*o.z),s});return[new he(a)]}return this.reduce().map(function(o){return o._linear?o.offset(r)[0]:o.scale(r)})}simple(){if(this.order===3){let a=F.angle(this.points[0],this.points[3],this.points[1]),n=F.angle(this.points[0],this.points[3],this.points[2]);if(a>0&&n<0||a<0&&n>0)return!1}let r=this.normal(0),i=this.normal(1),o=r.x*i.x+r.y*i.y;return this._3d&&(o+=r.z*i.z),Wi(nk(o))<sk/3}reduce(){let r,i=0,o=0,a=.01,n,s=[],l=[],u=this.extrema().values;for(u.indexOf(0)===-1&&(u=[0].concat(u)),u.indexOf(1)===-1&&u.push(1),i=u[0],r=1;r<u.length;r++)o=u[r],n=this.split(i,o),n._t1=i,n._t2=o,s.push(n),i=o;return s.forEach(function(c){for(i=0,o=0;o<=1;)for(o=i+a;o<=1+a;o+=a)if(n=c.split(i,o),!n.simple()){if(o-=a,Wi(i-o)<a)return[];n=c.split(i,o),n._t1=F.map(i,0,1,c._t1,c._t2),n._t2=F.map(o,0,1,c._t1,c._t2),l.push(n),i=o;break}i<1&&(n=c.split(i,1),n._t1=F.map(i,0,1,c._t1,c._t2),n._t2=c._t2,l.push(n))}),l}translate(r,i,o){o=typeof o=="number"?o:i;let a=this.order,n=this.points.map((s,l)=>(1-l/a)*i+l/a*o);return new he(this.points.map((s,l)=>({x:s.x+r.x*n[l],y:s.y+r.y*n[l]})))}scale(r){let i=this.order,o=!1;if(typeof r=="function"&&(o=r),o&&i===2)return this.raise().scale(o);let a=this.clockwise,n=this.points;if(this._linear)return this.translate(this.normal(0),o?o(0):r,o?o(1):r);let s=o?o(0):r,l=o?o(1):r,u=[this.offset(0,10),this.offset(1,10)],c=[],f=F.lli4(u[0],u[0].c,u[1],u[1].c);if(!f)throw Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(d){let h=c[d*i]=F.copy(n[d*i]);h.x+=(d?l:s)*u[d].n.x,h.y+=(d?l:s)*u[d].n.y}),o?([0,1].forEach(function(d){if(!(i===2&&d)){var h=n[d+1],p={x:h.x-f.x,y:h.y-f.y},y=o?o((d+1)/i):r;o&&!a&&(y=-y);var g=Gi(p.x*p.x+p.y*p.y);p.x/=g,p.y/=g,c[d+1]={x:h.x+y*p.x,y:h.y+y*p.y}}}),new he(c)):([0,1].forEach(d=>{if(i===2&&d)return;let h=c[d*i],p=this.derivative(d),y={x:h.x+p.x,y:h.y+p.y};c[d+1]=F.lli4(h,y,f,n[d+1])}),new he(c))}outline(r,i,o,a){if(i=i===void 0?r:i,this._linear){let x=this.normal(0),k=this.points[0],M=this.points[this.points.length-1],P,$,te;o===void 0&&(o=r,a=i),P={x:k.x+x.x*r,y:k.y+x.y*r},te={x:M.x+x.x*o,y:M.y+x.y*o},$={x:(P.x+te.x)/2,y:(P.y+te.y)/2};let le=[P,$,te];P={x:k.x-x.x*i,y:k.y-x.y*i},te={x:M.x-x.x*a,y:M.y-x.y*a},$={x:(P.x+te.x)/2,y:(P.y+te.y)/2};let be=[te,$,P],Ue=F.makeline(be[2],le[0]),J=F.makeline(le[2],be[0]),Te=[Ue,new he(le),J,new he(be)];return new os(Te)}let n=this.reduce(),s=n.length,l=[],u=[],c,f=0,d=this.length(),h=o!==void 0&&a!==void 0;function p(x,k,M,P,$){return function(te){let le=P/M,be=(P+$)/M,Ue=k-x;return F.map(te,0,1,x+le*Ue,x+be*Ue)}}n.forEach(function(x){let k=x.length();h?(l.push(x.scale(p(r,o,d,f,k))),u.push(x.scale(p(-i,-a,d,f,k)))):(l.push(x.scale(r)),u.push(x.scale(-i))),f+=k}),u=u.map(function(x){return c=x.points,c[3]?x.points=[c[3],c[2],c[1],c[0]]:x.points=[c[2],c[1],c[0]],x}).reverse();let y=l[0].points[0],g=l[s-1].points[l[s-1].points.length-1],m=u[s-1].points[u[s-1].points.length-1],v=u[0].points[0],D=F.makeline(m,y),B=F.makeline(g,v),V=[D].concat(l,[B],u);return new os(V)}outlineshapes(r,i,o){i||=r;let a=this.outline(r,i).curves,n=[];for(let s=1,l=a.length;s<l/2;s++){let u=F.makeshape(a[s],a[l-s],o);u.startcap.virtual=s>1,u.endcap.virtual=s<l/2-1,n.push(u)}return n}intersects(r,i){return r?r.p1&&r.p2?this.lineIntersects(r):(r instanceof he&&(r=r.reduce()),this.curveintersects(this.reduce(),r,i)):this.selfintersects(i)}lineIntersects(r){let i=Hf(r.p1.x,r.p2.x),o=Hf(r.p1.y,r.p2.y),a=Kf(r.p1.x,r.p2.x),n=Kf(r.p1.y,r.p2.y);return F.roots(this.points,r).filter(s=>{var l=this.get(s);return F.between(l.x,i,a)&&F.between(l.y,o,n)})}selfintersects(r){let i=this.reduce(),o=i.length-2,a=[];for(let n=0,s,l,u;n<o;n++)l=i.slice(n,n+1),u=i.slice(n+2),s=this.curveintersects(l,u,r),a.push(...s);return a}curveintersects(r,i,o){let a=[];r.forEach(function(s){i.forEach(function(l){s.overlaps(l)&&a.push({left:s,right:l})})});let n=[];return a.forEach(function(s){let l=F.pairiteration(s.left,s.right,o);l.length>0&&(n=n.concat(l))}),n}arcs(r){return r||=.5,this._iterate(r,[])}_error(r,i,o,a){let n=(a-o)/4,s=this.get(o+n),l=this.get(a-n),u=F.dist(r,i),c=F.dist(r,s),f=F.dist(r,l);return Wi(c-u)+Wi(f-u)}_iterate(r,i){let o=0,a=1,n;do{n=0,a=1;let s=this.get(o),l,u,c,f,d=!1,h=!1,p,y=a,g=1;do if(h=d,f=c,y=(o+a)/2,l=this.get(y),u=this.get(a),c=F.getccenter(s,l,u),c.interval={start:o,end:a},d=this._error(c,s,o,a)<=r,p=h&&!d,p||(g=a),d){if(a>=1){if(c.interval.end=g=1,f=c,a>1){let v={x:c.x+c.r*ok(c.e),y:c.y+c.r*ak(c.e)};c.e+=F.angle({x:c.x,y:c.y},v,this.get(1))}break}a+=(a-o)/2}else a=y;while(!p&&n++<100);if(n>=100)break;f||=c,i.push(f),o=g}while(a<1);return i}},lb={};A(lb,{cubic:()=>fb,interpolator:()=>ub,isCubicBezier:()=>yn,isQuadraticBezier:()=>Ei,quadratic:()=>db,quadraticSimple:()=>ma,quadraticToSvgString:()=>cb,toPath:()=>ba});const ma=(e,r,i=0)=>{if(Number.isNaN(i))throw Error("bend is NaN");if(i<-1||i>1)throw Error("Expects bend range of -1 to 1");let o=Nt(.5,e,r),a=o;a=r.y<e.y?i>0?{x:Math.min(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.max(e.x,r.x),y:Math.max(e.y,r.y)}:i>0?{x:Math.max(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.min(e.x,r.x),y:Math.max(e.y,r.y)};let n=Nt(Math.abs(i),o,a);return db(e,r,n)},ub=e=>{let r=yn(e)?new co(e.a.x,e.a.y,e.cubic1.x,e.cubic1.y,e.cubic2.x,e.cubic2.y,e.b.x,e.b.y):new co(e.a,e.quadratic,e.b);return i=>r.compute(i)},cb=(e,r,i)=>[`M ${e.x} ${e.y} Q ${i.x} ${i.y} ${r.x} ${r.y}`],ba=e=>{if(yn(e))return lk(e);if(Ei(e))return uk(e);throw Error("Unknown bezier type")},fb=(e,r,i,o)=>({a:Object.freeze(e),b:Object.freeze(r),cubic1:Object.freeze(i),cubic2:Object.freeze(o)}),lk=e=>{let{a:r,cubic1:i,cubic2:o,b:a}=e,n=new co(r,i,o,a);return Object.freeze({...e,length:()=>n.length(),interpolate:s=>n.compute(s),nearest:s=>{throw Error("not implemented")},bbox:()=>{let{x:s,y:l}=n.bbox(),u=s.size,c=l.size;if(u===void 0||c===void 0)throw Error("x.size not present on calculated bbox");return cr({x:s.min,y:l.min},u,c)},relativePosition:(s,l)=>{throw Error("Not implemented")},distanceToPoint:s=>{throw Error("Not implemented")},toSvgString:()=>["brrup"],kind:"bezier/cubic"})},db=(e,r,i)=>({a:Object.freeze(e),b:Object.freeze(r),quadratic:Object.freeze(i)}),uk=e=>{let{a:r,b:i,quadratic:o}=e,a=new co(r,o,i);return Object.freeze({...e,length:()=>a.length(),interpolate:n=>a.compute(n),nearest:n=>{throw Error("not implemented")},bbox:()=>{let{x:n,y:s}=a.bbox(),l=n.size,u=s.size;if(l===void 0||u===void 0)throw Error("x.size not present on calculated bbox");return cr({x:n.min,y:s.min},l,u)},distanceToPoint:n=>{throw Error("Not implemented")},relativePosition:(n,s)=>{throw Error("Not implemented")},toString:()=>a.toString(),toSvgString:()=>cb(r,i,o),kind:"bezier/quadratic"})};var hb={};A(hb,{fromDegrees:()=>ck});const ck=(e,r,i=0,o=0,a=360)=>({radiusX:e,radiusY:r,rotation:at(i),startAngle:at(o),endAngle:at(a)});var pb={};A(pb,{rdpPerpendicularDistance:()=>Ws,rdpShortestDistance:()=>_s});const _s=(e,r=.1)=>{let i=e[0],o=e.at(-1);if(e.length<3)return e;let a=-1,n=0;for(let s=1;s<e.length-1;s++){let l=dk(e[s],i,o);l>n&&(n=l,a=s)}if(n>r){let s=e.slice(0,a+1),l=e.slice(a),u=_s(s,r),c=_s(l,r);return[...u.slice(0,-1),...c]}else return[i,o]},Ws=(e,r=.1)=>{let i=e[0],o=e.at(-1);if(e.length<3)return e;let a=-1,n=0;for(let s=1;s<e.length-1;s++){let l=fk(e[s],i,o);l>n&&(n=l,a=s)}if(n>r){let s=e.slice(0,a+1),l=e.slice(a),u=Ws(s,r),c=Ws(l,r);return[...u.slice(0,-1),...c]}else return[i,o]};function fk(e,r,i){let o,a,n;return r.x==i.x?o=Math.abs(e.x-r.x):(a=(i.y-r.y)/(i.x-r.x),n=r.y-a*r.x,o=Math.abs(a*e.x-e.y+n)/Math.sqrt(a**2+1)),o}const dk=(e,r,i)=>{let o=X(r,i);if(o==0)return X(e,r);let a=((e.x-r.x)*(i.x-r.x)+(e.y-r.y)*(i.y-r.y))/o;return a<0?X(e,r):a>1?X(e,i):X(e,{x:r.x+a*(i.x-r.x),y:r.y+a*(i.y-r.y)})};var yb={};A(yb,{Direction:()=>gb,QuadTreeNode:()=>mb,quadTree:()=>hk});var gb;(function(e){e[e.Nw=0]="Nw",e[e.Ne=1]="Ne",e[e.Sw=2]="Sw",e[e.Se=3]="Se"})(gb||={});const hk=(e,r=[],i={})=>{let o={maxItems:i.maxItems??4,maxLevels:i.maxLevels??4},a=new mb(void 0,e,0,o);for(let n of r)a.add(n);return a};var mb=class bb{boundary;level;opts;#e=[];#t=[];#r;constructor(r,i,o,a){this.boundary=i,this.level=o,this.opts=a,this.#r=r}getLengthChildren(){return this.#t.length}*parents(){let r=this;for(;r.#r!==void 0;)yield r.#r,r=r.#r}getParent(){return this.#r}*children(){for(let r of this.#t)yield r}getValue(){return this.#e}getIdentity(){return this}direction(r){return this.#t[r]}add(r){if(!dm(this.boundary,r))return!1;if(this.#t.length>0){for(let i of this.#t)i.add(r);return!0}if(this.#e.push(r),this.#e.length>this.opts.maxItems&&this.level<this.opts.maxLevels){this.#t.length===0&&this.#i();for(let i of this.#e)for(let o of this.#t)o.add(i);this.#e=[]}return!0}couldHold(r){return Bo(this.boundary,r)}#i(){let r=this.boundary.width/2,i=this.boundary.height/2,o=this.boundary.x,a=this.boundary.y,n=Au(o+r,a,o,a,o,a+i,o+r,a+i),s=n.map(l=>cr(l,r,i));this.#t=s.map(l=>new bb(this,l,this.level+1,this.opts))}};const Xi=(e="both",r)=>{let i=r??gy,o=1,a=1,n={x:1,y:1},s=()=>{switch(e){case"height":return{x:a,y:a};case"width":return{x:o,y:o};case"min":return{x:Math.min(o,a),y:Math.min(o,a)};case"max":return{x:Math.max(o,a),y:Math.max(o,a)};default:return{x:o,y:a}}},l=(d,h,p,y)=>{let g=NaN,m=NaN,v=i.width,D=i.height;if(typeof d=="number")if(g=d,typeof h=="number"){if(m=h,p===void 0)return[g,m,v,D];if(ot(p))v=p.width,D=p.height;else if(typeof p=="number")if(v=p,typeof y=="number")D=y;else throw TypeError("Missing final height value");else throw Error("Missing valid output range")}else if(ot(h))v=h.width,D=h.height;else throw Error("Expected input y or output Rect to follow first number parameter");else if(j(d)){if(g=d.x,m=d.y,h===void 0)return[g,m,v,D];if(ot(h))v=h.width,D=h.height;else if(typeof h=="number")if(v=h,typeof p=="number")D=p;else throw TypeError("Expected height as third parameter after Point and output width");else throw TypeError("Expected Rect or width as second parameter when first parameter is a Point")}else throw Error("Expected input Point or x value as first parameter");return[g,m,v,D]},u=(d,h,p,y)=>{let g=l(d,h,p,y);return f(!0,...g)},c=(d,h,p,y)=>{let g=l(d,h,p,y);return f(!1,...g)},f=(d,h,p,y,g)=>{if(Number.isNaN(y))throw Error("Output width range missing");if(Number.isNaN(g))throw Error("Output height range missing");return(y!==o||g!==a)&&(o=y,a=g,n=s()),d?{x:h*n.x,y:p*n.y}:{x:h/n.x,y:p/n.y}};return{computeScale:s,rel:c,abs:u,width:i.width,height:i.height}};var vb={};A(vb,{angularSize:()=>Eb,bbox:()=>Cb,distanceCenter:()=>bk,fromCircle:()=>Db,fromCircleAmount:()=>mk,fromDegrees:()=>pk,getStartEnd:()=>yk,guard:()=>bn,interpolate:()=>hc,isArc:()=>wb,isEqual:()=>vk,isPositioned:()=>Kt,length:()=>Ab,point:()=>si,toLine:()=>xb,toPath:()=>gk,toSvg:()=>Sb});const wb=e=>e.startRadian!==void 0&&e.endRadian!==void 0&&e.clockwise!==void 0,Kt=e=>e.x!==void 0&&e.y!==void 0;function pk(e,r,i,o,a){let n={radius:e,startRadian:at(r),endRadian:at(i),clockwise:o};if(j(a)){O(a);let s={...n,x:a.x,y:a.y};return Object.freeze(s)}else return Object.freeze(n)}const xb=e=>To(si(e,e.startRadian),si(e,e.endRadian)),yk=(e,r)=>{bn(e);let i=si(e,e.startRadian,r),o=si(e,e.endRadian,r);return[i,o]},si=(e,r,i)=>(i===void 0&&(i=Kt(e)?e:{x:0,y:0}),{x:Math.cos(r)*e.radius+i.x,y:Math.sin(r)*e.radius+i.y}),bn=e=>{if(e===void 0)throw TypeError("Arc is undefined");if(Kt(e)&&O(e,"arc"),e.radius===void 0)throw TypeError(`Arc radius is undefined (${JSON.stringify(e)})`);if(typeof e.radius!="number")throw TypeError("Radius must be a number");if(Number.isNaN(e.radius))throw TypeError("Radius is NaN");if(e.radius<=0)throw TypeError("Radius must be greater than zero");if(e.startRadian===void 0||e.endRadian===void 0)throw TypeError("Arc is missing 'startRadian' field");if(Number.isNaN(e.endRadian)||Number.isNaN(e.startRadian))throw TypeError("Arc endRadian is NaN");if(e.clockwise===void 0)throw TypeError("Arc is missing 'clockwise field");if(e.startRadian>=e.endRadian)throw TypeError("startRadian is expected to be les than endRadian")},hc=(e,r,i,o)=>{if(bn(r),!(i??!1)){if(e<0)throw Error("Param 'amount' is under zero, and overflow is not allowed");if(e>1)throw Error("Param 'amount' is above 1 and overflow is not allowed")}let n=Eb(r),s=n*e,l=dn(r.startRadian,s,r.clockwise);return si(r,l,o)},Eb=e=>Lu(e.startRadian,e.endRadian,e.clockwise),gk=e=>(bn(e),Object.freeze({...e,nearest:r=>{throw Error("not implemented")},interpolate:r=>hc(r,e),bbox:()=>Cb(e),length:()=>Ab(e),toSvgString:()=>Sb(e),relativePosition:(r,i)=>{throw Error("Not implemented")},distanceToPoint:r=>{throw Error("Not implemented")},kind:"arc"})),Db=(e,r,i,o=!0)=>Object.freeze({...e,endRadian:i,startRadian:r,clockwise:o}),mk=(e,r,i,o=!0)=>{let a=dn(r,i,o);return Db(e,r,a)},Ab=e=>Ke*e.radius*((e.startRadian-e.endRadian)/Ke),Cb=e=>{if(Kt(e)){let r=hc(.5,e),i=xb(e);return jo(r,i.a,i.b)}else return{width:e.radius*2,height:e.radius*2}},Sb=(e,r,i,o,a)=>{if(wb(e))return Kt(e)?j(r)?Ui(r,e.radius,e.startRadian,e.endRadian,i):Ui(e,e.radius,e.startRadian,e.endRadian,r):j(r)?Ui(r,e.radius,e.startRadian,e.endRadian,i):Ui({x:0,y:0},e.radius,e.startRadian,e.endRadian);if(i===void 0)throw Error("startAngle undefined");if(o===void 0)throw Error("endAngle undefined");if(j(e)){if(typeof r=="number"&&typeof i=="number"&&typeof o=="number")return Ui(e,r,i,o,a);throw TypeError("Expected (point, number, number, number). Missing a number param.")}else throw Error("Expected (point, number, number, number). Missing first point.")},Ui=(e,r,i,o,a)=>{(a===void 0||typeof a!="object")&&(a={});let n=o-i===360,s=We(r,o-.01,e),l=We(r,i,e),{largeArc:u=!1,sweep:c=!1}=a,f=[`
    M ${s.x} ${s.y}
    A ${r} ${r} 0 ${u?"1":"0"} ${c?"1":"0"} ${l.x} ${l.y},
  `];return n&&f.push("z"),f},bk=(e,r)=>X(e,r),vk=(e,r)=>{if(e.radius!==r.radius||e.endRadian!==r.endRadian||e.startRadian!==r.startRadian||e.clockwise!==r.clockwise)return!1;if(Kt(e)&&Kt(r)){if(e.x!==r.x||e.y!==r.y||e.z!==r.z)return!1}else if(!(!Kt(e)&&!Kt(r)))return!1;return!0};var Fb={};A(Fb,{circleRings:()=>Sk,circleVogelSpiral:()=>Ck,sphereFibonacci:()=>Fk});const pc=Math.cos,yc=Math.sin,wk=Math.asin,gc=Math.sqrt,xk=Math.pow,mc=Math.PI,Ek=Math.PI*2,Dk=mc*(3-gc(5)),Ak=(1+gc(5))/2;function*Ck(e,r={}){let i=r.maxPoints??5e3,o=r.density??.95,a=r.rotation??0,n=tc(e??{radius:1,x:0,y:0}),s=n.radius,l=n.radius*ut(o,0,1,.3,.01);r.spacing&&(l=r.spacing);let u=0,c=0,f=0;for(;c<i&&u<s;)u=l*c**.5,f=a+c*2*mc/Ak,yield Object.freeze({x:n.x+u*pc(f),y:n.y+u*yc(f)}),c++}function*Sk(e,r={}){let i=r.rings??5,o=tc(e??{radius:1,x:0,y:0}),a=1/i,n=r.rotation??0,s=1;yield Object.freeze({x:o.x,y:o.y});for(let l=a;l<=1;l+=a){let u=Math.round(mc/wk(1/(2*s)));for(let c of gp(0,Ek,u+1))yield Object.freeze({x:o.x+l*pc(c+n)*o.radius,y:o.y+l*yc(c+n)*o.radius});s++}}function*Fk(e=100,r=0,i){let o=2/e,a=i??{x:0,y:0,z:0,radius:1};for(let n=0;n<e;n++){let s=n*o-1+o/2,l=gc(1-xk(s,2)),u=(n+1)%e*Dk+r,c=pc(u)*l,f=yc(u)*l;yield Object.freeze({x:a.x+c*a.radius,y:a.y+s*a.radius,z:a.z+f*a.radius})}}const Wo=e=>(dt(e),[Ft(e.a,e.b),Ft(e.b,e.c),Ft(e.c,e.a)]),kk=e=>(dt(e),xi(Wo(e))),vn=e=>(dt(e),zo(e.a,e.b,e.c,e.a)),kb=e=>{dt(e,"t");let r=vn(e).map(o=>Re(o)),i=(r[0]+r[1]+r[2])/2;return Math.sqrt(i*(i-r[0])*(i-r[1])*(i-r[2]))},$b=(e,r,i)=>{let o=Pe(r,i),a=(u,c,f,d)=>(f.y-d.y)*u+(d.x-f.x)*c+f.x*d.y-d.x*f.y,n=a(o.x,o.y,e.b,e.c)/a(e.a.x,e.a.y,e.b,e.c),s=a(o.x,o.y,e.c,e.a)/a(e.b.x,e.b.y,e.c,e.a),l=a(o.x,o.y,e.a,e.b)/a(e.c.x,e.c.y,e.a,e.b);return{a:n,b:s,c:l}},$k=(e,r)=>{dt(e);let{a:i,b:o,c:a}=e,n=i.x*r.a+o.x*r.b+a.x*r.c,s=i.y*r.a+o.y*r.b+a.y*r.c;if(i.z&&o.z&&a.z){let l=i.z*r.a+o.z*r.b+a.z*r.c;return Object.freeze({x:n,y:s,z:l})}else return Object.freeze({x:n,y:s})},Mb=(e,r=0)=>{let{a:i,b:o,c:a}=e,n=Math.min(i.x,o.x,a.x)-r,s=Math.max(i.x,o.x,a.x)+r,l=Math.min(i.y,o.y,a.y)-r,u=Math.max(i.y,o.y,a.y)+r;return{x:n,y:l,width:s-n,height:u-l}},Gs=e=>(dt(e),[e.a,e.b,e.c]),Mk=(e,r,i={})=>{w(C(r,"positive","radius")),O(e,"origin");let o=i.initialAngleRadian??0,a=[o,o+Ke*1/3,o+Ke*2/3],n=a.map(s=>We(r,s,e));return bc(n)},Pk=e=>{if(!Array.isArray(e))throw Error("coords expected as array");if(e.length!==6)throw Error(`coords array expected with 6 elements. Got ${e.length}`);return bc(Au(...e))},bc=e=>{if(!Array.isArray(e))throw Error("points expected as array");if(e.length!==3)throw Error(`points array expected with 3 elements. Got ${e.length}`);return{a:e[0],b:e[1],c:e[2]}},Pb=e=>(dt(e),vn(e).reduce((r,i)=>r+Re(i),0)),Nk=e=>{let r=Lo(e),i=Pb(e)/2;return{radius:kb(e)/i,...r}},Bk=(e,r,i)=>{let o=Mb(e),a=Pe(r,i);if(!Bo(o,a))return!1;let n=$b(e,a);return 0<=n.a&&n.a<=1&&0<=n.b&&n.b<=1&&0<=n.c&&n.c<=1},vc=e=>(dt(e),[X(e.a,e.b),X(e.b,e.c),X(e.c,e.a)]),Tk=e=>{dt(e);let[r,i,o]=vc(e);return r===i&&i===o},zk=e=>{let[r,i,o]=vc(e);return r===i||i===o||o===r},Nb=e=>Wo(e).includes(Math.PI/2),Ok=e=>!Nb(e),jk=e=>!Wo(e).some(r=>r>=Math.PI/2),Rk=e=>Wo(e).some(r=>r>Math.PI/2),Vk=(e,r)=>Object.freeze({...e,a:r(e.a,"a"),b:r(e.b,"b"),c:r(e.c,"c")}),Lk=e=>{let[r,i,o]=vn(e).map(s=>Re(s)),a=Lo(e);return{radius:r*i*o/Math.sqrt((r+i+o)*(-r+i+o)*(r-i+o)*(r+i-o)),...a}},Ik=(e,r,i)=>r===void 0||r===0?e:(i===void 0&&(i=Lo(e)),Object.freeze({...e,a:kt(e.a,r,i),b:kt(e.b,r,i),c:kt(e.c,r,i)})),qk=(e,r,i="b")=>{let o=i==="a"?e.a:i==="b"?e.b:e.c;return Object.freeze({a:kt(e.a,r,o),b:kt(e.b,r,o),c:kt(e.c,r,o)})},_k=e=>(dt(e),[e.a.x,e.a.y,e.b.x,e.b.y,e.c.x,e.c.y]);var Bb={};A(Bb,{area:()=>Qk,centerFromA:()=>Gk,centerFromB:()=>Uk,centerFromC:()=>Jk,circumcircle:()=>Zk,fromCenter:()=>Wk,height:()=>Hk,incircle:()=>wn,perimeter:()=>Kk});const Qf=Math.PI*4/3,Zf=Math.PI*2/3,gr=e=>typeof e=="number"?e:e.length,Wk=(e,r,i)=>{r||=Object.freeze({x:0,y:0});let o=gr(e)/Math.sqrt(3),a=i??Math.PI*1.5,n={x:o*Math.cos(a)+r.x,y:o*Math.sin(a)+r.y},s={x:o*Math.cos(a+Qf)+r.x,y:o*Math.sin(a+Qf)+r.y},l={x:o*Math.cos(a+Zf)+r.x,y:o*Math.sin(a+Zf)+r.y};return Object.freeze({a:s,b:n,c:l})},Gk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=gr(e),{radius:o}=wn(e);return{x:r.x+i/2,y:r.y-o}},Uk=(e,r)=>{r||=Object.freeze({x:0,y:0});let{radius:i}=wn(e);return{x:r.x,y:r.y+i*2}},Jk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=gr(e),{radius:o}=wn(e);return{x:r.x-i/2,y:r.y-o}},Hk=e=>Math.sqrt(3)/2*gr(e),Kk=e=>gr(e)*3,Qk=e=>gr(e)**2*Math.sqrt(3)/4,Zk=e=>({radius:Math.sqrt(3)/3*gr(e)}),wn=e=>({radius:Math.sqrt(3)/6*gr(e)});var Tb={};A(Tb,{adjacentFromHypotenuse:()=>c3,adjacentFromOpposite:()=>f3,angleAtPointA:()=>i3,angleAtPointB:()=>o3,area:()=>r3,circumcircle:()=>n3,fromA:()=>Xk,fromB:()=>Yk,fromC:()=>e3,height:()=>xn,hypotenuseFromAdjacent:()=>h3,hypotenuseFromOpposite:()=>d3,hypotenuseSegments:()=>En,incircle:()=>s3,medians:()=>a3,oppositeFromAdjacent:()=>l3,oppositeFromHypotenuse:()=>u3,perimeter:()=>t3,resolveLengths:()=>ht});const Xk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=ht(e),o=En(e),a=xn(e),n={x:r.x,y:r.y},s={x:r.x+i.hypotenuse,y:r.y},l={x:r.x+o[1],y:r.y-a};return{a:n,b:s,c:l}},Yk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=ht(e),o=En(e),a=xn(e),n={x:r.x,y:r.y},s={x:r.x-i.hypotenuse,y:r.y},l={x:r.x-o[0],y:r.y-a};return{a:s,b:n,c:l}},e3=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=En(e),o=xn(e),a={x:r.x,y:r.y},n={x:r.x-i[1],y:r.y+o},s={x:r.x+i[0],y:r.y+o};return{a:n,b:s,c:a}},ht=e=>{let r=e.adjacent,i=e.opposite,o=e.hypotenuse;if(r!==void 0&&i!==void 0)return{...e,adjacent:r,opposite:i,hypotenuse:Math.hypot(r,i)};if(r&&o)return{...e,adjacent:r,hypotenuse:o,opposite:o*o-r*r};if(i&&o)return{...e,hypotenuse:o,opposite:i,adjacent:o*o-i*i};if(e.opposite&&e.hypotenuse&&e.adjacent)return e;throw Error("Missing at least two edges")},xn=e=>{let r=ht(e),i=r.opposite*r.opposite/r.hypotenuse,o=r.adjacent*r.adjacent/r.hypotenuse;return Math.sqrt(i*o)},En=e=>{let r=ht(e),i=r.opposite*r.opposite/r.hypotenuse,o=r.adjacent*r.adjacent/r.hypotenuse;return[i,o]},t3=e=>{let r=ht(e);return r.adjacent+r.hypotenuse+r.opposite},r3=e=>{let r=ht(e);return r.opposite*r.adjacent/2},i3=e=>{let r=ht(e);return Math.acos((r.adjacent*r.adjacent+r.hypotenuse*r.hypotenuse-r.opposite*r.opposite)/(2*r.adjacent*r.hypotenuse))},o3=e=>{let r=ht(e);return Math.acos((r.opposite*r.opposite+r.hypotenuse*r.hypotenuse-r.adjacent*r.adjacent)/(2*r.opposite*r.hypotenuse))},a3=e=>{let r=ht(e),i=r.adjacent*r.adjacent,o=r.hypotenuse*r.hypotenuse,a=r.opposite*r.opposite;return[Math.sqrt(2*(i+o)-a)/2,Math.sqrt(2*(o+a)-i)/2,Math.sqrt(2*(a+i)-o)/2]},n3=e=>({radius:ht(e).hypotenuse/2}),s3=e=>{let r=ht(e);return{radius:(r.adjacent+r.opposite-r.hypotenuse)/2}},l3=(e,r)=>Math.tan(e)*r,u3=(e,r)=>Math.sin(e)*r,c3=(e,r)=>Math.cos(e)*r,f3=(e,r)=>r/Math.tan(e),d3=(e,r)=>r/Math.sin(e),h3=(e,r)=>r/Math.cos(e);var zb={};A(zb,{apexAngle:()=>p3,area:()=>m3,baseAngle:()=>Ob,circumcircle:()=>b3,fromA:()=>x3,fromB:()=>E3,fromC:()=>D3,fromCenter:()=>w3,height:()=>mr,incircle:()=>jb,legHeights:()=>y3,medians:()=>v3,perimeter:()=>g3});const Ob=e=>Math.acos(e.base/(2*e.legs)),p3=e=>{let r=e.legs*e.legs,i=e.base*e.base;return Math.acos((2*r-i)/(2*r))},mr=e=>{let r=e.legs*e.legs,i=e.base*e.base;return Math.sqrt((4*r-i)/4)},y3=e=>{let r=Ob(e);return e.base*Math.sin(r)},g3=e=>2*e.legs+e.base,m3=e=>mr(e)*e.base/2,b3=e=>{let r=mr(e),i=r*r,o=e.base*e.base;return{radius:(4*i+o)/(8*r)}},jb=e=>{let r=mr(e);return{radius:e.base*r/(2*e.legs+e.base)}},v3=e=>{let r=e.legs*e.legs,i=e.base*e.base,o=Math.sqrt(r+2*i)/2,a=Math.sqrt(4*r-i)/2;return[o,o,a]},w3=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=mr(e),o=jb(e).radius,a=i-o,n={x:r.x-e.base/2,y:r.y+o},s={x:r.x+e.base/2,y:r.y+o},l={x:r.x,y:r.y-a};return{a:n,b:s,c:l}},x3=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=mr(e),o={x:r.x,y:r.y},a={x:r.x+e.base,y:r.y},n={x:r.x+e.base/2,y:r.y-i};return{a:o,b:a,c:n}},E3=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=mr(e),o={x:r.x,y:r.y},a={x:r.x-e.base,y:r.y},n={x:r.x-e.base/2,y:r.y-i};return{a,b:o,c:n}},D3=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=mr(e),o={x:r.x,y:r.y},a={x:r.x-e.base/2,y:r.y+i},n={x:r.x+e.base/2,y:r.y+i};return{a,b:n,c:o}};var Rb={};A(Rb,{Empty:()=>gF,Equilateral:()=>Bb,Isosceles:()=>zb,Placeholder:()=>mF,Right:()=>Tb,angles:()=>Wo,anglesDegrees:()=>kk,apply:()=>Vk,area:()=>kb,barycentricCoord:()=>$b,barycentricToCartestian:()=>$k,bbox:()=>Mb,centroid:()=>Lo,corners:()=>Gs,edges:()=>vn,equilateralFromVertex:()=>ga,fromFlatArray:()=>Pk,fromPoints:()=>bc,fromRadius:()=>Mk,guard:()=>dt,innerCircle:()=>Nk,intersectsPoint:()=>Bk,isAcute:()=>jk,isEmpty:()=>vF,isEqual:()=>xF,isEquilateral:()=>Tk,isIsosceles:()=>zk,isOblique:()=>Ok,isObtuse:()=>Rk,isPlaceholder:()=>wF,isRightAngle:()=>Nb,isTriangle:()=>um,lengths:()=>vc,outerCircle:()=>Lk,perimeter:()=>Pb,rotate:()=>Ik,rotateByVertex:()=>qk,toFlatArray:()=>_k});var A3={};A(A3,{Arcs:()=>vb,Beziers:()=>lb,Circles:()=>xm,Compound:()=>Dm,CurveSimplification:()=>pb,Ellipses:()=>hb,Grids:()=>ab,Layouts:()=>ym,Lines:()=>Gg,Paths:()=>Cm,PointTracker:()=>Gu,Points:()=>Yg,PointsTracker:()=>Uu,Polar:()=>Cg,QuadTree:()=>yb,Rects:()=>Py,Shapes:()=>hm,SurfacePoints:()=>Fb,Triangles:()=>Rb,Vectors:()=>Sg,Waypoints:()=>am,angleConvert:()=>Iu,angleParse:()=>hn,degreeArc:()=>iS,degreeToGradian:()=>pg,degreeToRadian:()=>at,degreeToTurn:()=>mg,degreesSum:()=>rS,gradianToDegree:()=>yg,gradianToRadian:()=>js,radianArc:()=>Lu,radianInvert:()=>hg,radianToDegree:()=>xi,radianToGradian:()=>ha,radianToTurn:()=>Vs,radiansFromAxisX:()=>tS,radiansSum:()=>dn,scaler:()=>Xi,turnToDegree:()=>gg,turnToRadian:()=>Rs});var fo=class Us{#e;#t;#r;#i;#o;#a;#n;#l;#s=!1;#c;constructor(r,i){this.#n=U(r),this.#l=i.containerEl?U(i.containerEl):this.#n.parentElement,this.#e=i.stretch??"none",this.#a=i.onSetSize,this.#t=nn;let o=i.naturalSize;o===void 0&&(o=this.#n.getBoundingClientRect()),this.#i=1,this.#r=o,this.setNaturalSize(o),this.#o=sn,this.#l===document.body?this.#d():this.#u()}dispose(r){this.#s||(this.#s=!0,this.#c&&(this.#c.disconnect(),this.#c=void 0))}static canvasParent(r,i){let o=U(r);return new Us(o,{...i,onSetSize(n,s){s.width=n.width,s.height=n.height,i.onSetSize&&i.onSetSize(n,s)}})}static canvasViewport(r,i){let o=U(r);o.style.position="absolute",o.style.zIndex=(i.zIndex??0).toString(),o.style.left="0px",o.style.top="0px";let a={...i,containerEl:document.body};return this.canvasParent(r,a)}static svgViewport(r,i){return new Us(r,{containerEl:document.body,stretch:"both",onSetSize(a){r.setAttribute("width",a.width.toString()),r.setAttribute("height",a.height.toString()),i&&i(a)}})}#u(){let r=this.#l;if(!r)throw Error("No container element");let i=new ResizeObserver(a=>{this.#f(a)});i.observe(r);let o=this.#y(r.getBoundingClientRect());this.size=o,this.#c=i}#d(){let r=new ResizeObserver(i=>{this.#h()});r.observe(document.documentElement),this.#c=r,this.#h()}#h(){this.size={width:window.innerWidth,height:window.innerHeight},this.#o={x:0,y:0,...this.size}}setNaturalSize(r){this.#r=r,this.#i=r.width/r.height}get naturalSize(){return this.#r}get viewport(){return this.#o}#y(r){let{width:i,height:o}=r,a=this.#e;if(a==="min"?a=i<o?"width":"height":a==="max"&&(a=i>o?"width":"height"),a==="width"?o=i/this.#i:a==="height"&&(i=o*this.#i),this.#n instanceof HTMLElement){let n=Ju(this.#n,"borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth");i-=n.borderLeftWidth+n.borderRightWidth,o-=n.borderTopWidth+n.borderBottomWidth}return{width:i,height:o}}#f(r){let i=r[0].contentBoxSize[0],o={width:i.inlineSize,height:i.blockSize};this.size=this.#y(o),this.#o={x:0,y:0,width:o.width,height:o.height}}set size(r){ft(r,"size"),this.#t=r,this.#a(r,this.#n)}get size(){return this.#t}};const C3=()=>{let e=!0,r=document.createElement("div");r.style.color="black",r.style.border="2px solid red",r.style.backgroundColor="hsl(0, 80%, 90%)",r.style.padding="1em",r.style.display="none",r.style.top="1em",r.style.left="1em",r.style.position="absolute",r.style.fontFamily="monospace";let i=document.createElement("div");i.style.maxWidth="50vw",i.style.maxHeight="50vh",i.style.overflowY="scroll",r.innerHTML="<h1>Error</h1>",r.append(i);let o=u=>{u.style.padding="0.3em",u.style.marginTop="1em"},a=document.createElement("button");a.textContent="Close",a.addEventListener("click",()=>{l()});let n=document.createElement("button");n.textContent="Stop displaying errors",n.addEventListener("click",()=>{e=!1,l()}),o(a),o(n),r.append(a),r.append(n),document.body.append(r);let s=u=>{r.style.display="inline",i.innerHTML+=u.stack?`<pre>${u.stack}</pre>`:`<p>${st(u)}</p>`},l=()=>{r.style.display="none"};return window.onerror=(u,c,f,d,h)=>{e&&(h?(console.log(h),s(h)):(console.log(u),s(u)))},window.addEventListener("unhandledrejection",u=>{console.log(u.reason),e&&s(u.reason)}),{show:s,hide:l}},Vb=(e,r)=>{let i=document.createElement("style");i.textContent=r;let o;return e.shadowRoot?(o=e.shadowRoot,o.innerHTML=""):o=e.attachShadow({mode:"open"}),o.append(i),o},Lb=(e,r={})=>{let{capacity:i=0,monospaced:o=!0,timestamp:a=!1,collapseDuplicates:n=!0,css:s=""}=r,l=0,u,c=0,f=U(e),d=o?'Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", Monaco, "Courier New", Courier, monospace':"normal",h=Vb(f,`
  .log {
    font-family: ${d};
    background-color: var(--code-background-color);
    padding: var(--padding1, 0.2em);
    overflow-y: auto;
    height:100%;
  }
  .timestamp {
    margin-right: 0.5em;
    opacity: 0.5;
    font-size: 70%;
    align-self: center;
  }
  .line {
    display: flex;
    padding-bottom: 0.1em;
    padding-top: 0.1em;
  }
  .line:hover {
  
  }
  .error {
    color: red;
  }
  .badge {
    border: 1px solid currentColor;
    align-self: center;
    font-size: 70%;
    padding-left: 0.2em;
    padding-right: 0.2em;
    border-radius: 1em;
    margin-left: 0.5em;
    margin-right: 0.5em;
  }
  .msg {
    flex: 1;
    word-break: break-word;
  }
  ${s}
  `),p=document.createElement("div");p.className="log",h.append(p);let y=x=>{let k=document.createElement("div");if(typeof x=="string")k.innerHTML=x;else if(x instanceof Error){let M=x.stack;k.innerHTML=M===void 0?x.toString():M.toString()}else k.innerHTML=x;k.classList.add("error"),D(k),u=void 0,c=0},g=0,m=(x="")=>{let k=v(x);return k&&(k.classList.add("warning"),k)},v=(x="")=>{let k,M=window.performance.now()-g;if(!(r.minIntervalMs&&M<r.minIntervalMs))if(g=window.performance.now(),typeof x=="object"?k=JSON.stringify(x):x===void 0?k="(undefined)":x===null?k="(null)":typeof x=="number"?(Number.isNaN(k)&&(k="(NaN)"),k=x.toString()):k=x,k.length===0){let P=document.createElement("hr");u=void 0,D(P)}else if(k===u&&n){let P=p.firstElementChild,$=P.querySelector(".badge");return $===null&&($=document.createElement("div"),$.className="badge",P.insertAdjacentElement("beforeend",$)),P!==null&&($.textContent=(++c).toString()),P}else{let P=document.createElement("div");return P.textContent=k,D(P),u=k,P}},D=x=>{if(a){let k=document.createElement("div"),M=document.createElement("div");M.className="timestamp",M.textContent=new Date().toLocaleTimeString(),k.append(M,x),x.classList.add("msg"),k.classList.add("line"),x=k}else x.classList.add("line","msg");if(r.reverse?p.append(x):p.insertBefore(x,p.firstChild),i>0&&++l>i*2)for(;l>i;)p.lastChild?.remove(),l--;r.reverse&&(p.scrollTop=p.scrollHeight),c=0};return{error:y,log:v,warn:m,append:D,clear:()=>{p.innerHTML="",u=void 0,c=0,l=0},dispose:()=>{p.remove()},get isEmpty(){return l===0}}},S3=(e={})=>{let r={log:console.log,error:console.error,warn:console.warn},i=e.witholdCss??!1,o=e.insertIntoEl,a;o?a=U(o):(a=document.createElement("DIV"),a.id="ixfx-log",document.body.prepend(a)),i||(a.style.position="fixed",a.style.left="0px",a.style.top="0px",a.style.pointerEvents="none",a.style.display="none");let n=Lb(a,e),s=l=>{a.style.display="block"};console.error=(l,...u)=>{n.error(l),u.length>0&&n.error(u),r.error(l,...u),s()},console.warn=(l,...u)=>{n.warn(l),u.length>0&&n.warn(u),s()},console.log=(l,...u)=>{n.log(l),u.length>0&&n.log(u),r.log(l,...u),s()},window.onerror=(l,u,c,f,d)=>{let h=u===void 0?"":Ka(u,"/",{fromEnd:!0}),p=st(d);n.error(p+` (${h}:${c})`),s()},window.addEventListener("unhandledrejection",function(l){n.error(l.reason),s()})};async function*Ib(e,r={}){if(typeof e=="string"||typeof e=="object"&&"nodeName"in e)return Ib([e],r);let i=r??!1,o=i?U1():a=>!0;if(Array.isArray(e))for(let a of e)if(typeof a=="string")for(let n of document.querySelectorAll(a)){let s=n;o(s)&&(yield s)}else o(a)&&(yield a);else for await(let a of e)if(typeof a=="string")for(let n of document.querySelectorAll(a))o(n)&&(yield n);else o(a)&&(yield a)}const F3=e=>{let r=e.panels,i=e.preselectId??r[0].id,o=`tabset-${wu()}`,a=U(e.parent),n=`
  <div class="ixfx-tabset" id="${o}">
    <fieldset class="ixfx-tabset-controls">
    ${r.map(h=>{let p=`${o}-${h.id}-select`;return`<input type="radio" name="${o}-tabs" id="${p}" data-tabset="${h.id}"><label for="${p}">${h.label}</label>`}).join("")}
    </fieldset>
    <div class="ixfx-tabset-host" id="${o}-host"></div>
  </div>
  `;a.innerHTML=n;let s=document.getElementById(`${o}-host`),l=document.getElementById(o);l.querySelector("fieldset")?.addEventListener("change",h=>{let p=h.target;c(p.getAttribute("data-tabset"))});let u,c=h=>{let p=r.find(g=>g.id===h),y=u;if(e.onPanelChanging){let g=e.onPanelChanging(y,p);if(typeof g=="boolean"&&!g)return}if(y&&y.dismount(),u=p,p){p.mount(s);let g=`#${o}-${h}-select`,m=l.querySelector(g);m?m.checked=!0:console.warn(`Could not find INPUT element for panel id: ${h} (${g})`)}e.onPanelChange&&e.onPanelChange(y,p)};c(i);let f=!1;return{select:c,panels:r,hostEl:s,tabSetEl:l,notify:(h,p)=>{u&&(u.notify?u.notify(h,p):f||(f=!0,console.warn(`TabbedPanel.notify dropping notification '${h}'. Panel implementation is missing 'notify' function`)))}}};var k3=id(Qp());const qb=(e="viewport")=>{switch(e){case"viewport":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x/window.innerWidth,y:o.y/window.innerHeight})};case"screen":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x/screen.width,y:o.y/screen.height})};case"document":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x/document.body.scrollWidth,y:o.y/document.body.scrollHeight})};default:throw Error(`Unknown 'reference' parameter: ${JSON.stringify(e)}`)}},_b=(e,r={})=>{let i=r.target??"viewport",o=r.relative??!1,a=r.anchor??"nw",n=U(e),s=Wb(i);if(o){let l=qb(i);return()=>l(s(Ma(n.getBoundingClientRect(),a)))}else return()=>s(Ma(n.getBoundingClientRect(),a))},$3=(e,r="nw")=>{let i=U(e);return Ma(i.getBoundingClientRect(),r)},M3=(e,r="viewport")=>_b(e,{relative:!0,target:r})(),Wb=(e="viewport")=>{switch(e){case"screen":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x+window.screenX,y:o.y+window.screenY})};case"document":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x+window.scrollX,y:o.y+window.scrollY})};case"viewport":return(r,i)=>{let o=Pe(r,i);return Object.freeze({x:o.x,y:o.y})};default:throw Error(`Unexpected target coordinate space: ${e}. Expected: viewport, document or screen`)}},P3=(e,r,i="window")=>{if(!e)throw Error("domQueryOrEl is null or undefined");let o=U(e),a=hr(r,window.innerWidth,window.innerHeight),n=o.getBoundingClientRect(),s=De(a,n.width/2,n.height/2);o.style.transform=`translate(${s.x}px, ${s.y}px)`},N3=(e,r)=>{if(!(e===null||!e)){if(!Array.isArray(r))throw TypeError("List should be an array of strings");for(let i=0;i<r.length;i++)if(e.classList.contains(r[i])){e.classList.remove(r[i]),i+1<r.length?e.classList.add(r[i+1]):e.classList.add(r[0]);return}e.classList.add(r[0])}},B3=e=>{let r=U(e),i=window.getComputedStyle(r),o=i.transform;if(o==="none"||o===void 0)return{x:0,y:0,z:0};let a=o.includes("3d")?"3d":"2d",n=/matrix.*\((.+)\)/.exec(o)[1].split(", ");return a==="2d"?{x:Number.parseFloat(n[4]),y:Number.parseFloat(n[5]),z:0}:a==="3d"?{x:Number.parseFloat(n[12]),y:Number.parseFloat(n[13]),z:Number.parseFloat(n[14])}:{x:0,y:0,z:0}},T3=(e,r)=>{let i=document.createElement(r);return e.parentElement?.insertBefore(i,e.nextSibling),i},z3=(e,r)=>{let i=document.createElement(r);return e.append(i),i},O3=e=>{let r=e.lastElementChild;for(;r;)r.remove(),r=e.lastElementChild},j3=e=>new Promise((i,o)=>{let a=k3.default.stringify(e);navigator.clipboard.writeText(JSON.stringify(a)).then(()=>{i(!0)},n=>{console.warn("Could not copy to clipboard"),console.log(a),o(Error(n))})}),R3=(e,r)=>{let i=r.getAttribute("data-sort")??"",o,a;for(let n of e.children){let s=n.getAttribute("data-sort")??"";if(i>=s&&(o=n),i<=s&&(a=n),o!==void 0&&a!==void 0)break}o===void 0?a===void 0?e.append(r):a.insertAdjacentElement("beforebegin",r):o.insertAdjacentElement("afterend",r)},V3=(e,r,i)=>{if(e===void 0)throw Error("Param 'parentEl' is undefined");if(e===null)throw Error("Param 'parentEl' is null");let o=new Set;for(let[n,s]of r){let l=`c-${n}`,u=e.querySelector(`#${l}`),c=i(s,u);u!==c&&(c.id=l,e.append(c)),o.add(l)}let a=[];for(let n of e.children)o.has(n.id)||a.push(n);for(let n of a)n.remove()},L3=e=>{let r=document.getElementById(e);if(r===null)throw Error(`HTML element with id '${e}' not found`);return r};var ti={};A(ti,{DataDisplay:()=>dF,DataTable:()=>Zp,DragDrop:()=>em,ElementSizer:()=>fo,Forms:()=>tm,addShadowCss:()=>Vb,byId:()=>L3,cardinalPosition:()=>$3,clear:()=>O3,copyToClipboard:()=>j3,createAfter:()=>T3,createIn:()=>z3,cycleCssClass:()=>N3,defaultErrorHandler:()=>C3,el:()=>hF,elRequery:()=>pF,getBoundingClientRectWithBorder:()=>fF,getComputedPixels:()=>Ju,getCssVariable:()=>uF,getCssVariablesFromStyles:()=>om,getCssVariablesWithFallback:()=>lF,getTranslation:()=>B3,inlineConsole:()=>S3,insertSorted:()=>R3,log:()=>Lb,parseCssVariablesAsAttributes:()=>nF,pointScaler:()=>qb,positionFn:()=>_b,positionFromMiddle:()=>P3,positionRelative:()=>M3,query:()=>Ib,reconcileChildren:()=>V3,resolveEl:()=>U,resolveElementTry:()=>fu,resolveEls:()=>qr,setCssClass:()=>Hu,setCssDisplay:()=>Qu,setCssToggle:()=>Ku,setCssVariables:()=>cF,setFromCssVariables:()=>sF,setHtml:()=>Xu,setProperty:()=>pn,setText:()=>Zu,tabSet:()=>F3,viewportToSpace:()=>Wb});var wc=class{enc=new TextEncoder;dec=new TextDecoder("utf-8");toBuffer(e){return this.enc.encode(e)}fromBuffer(e){return this.dec.decode(e)}},xc=class{onData;separator;buffer="";stream;constructor(e,r=`
`){this.onData=e,this.separator=r}async close(){let e=this.stream;e&&(await e.abort(),await e.close())}clear(){this.buffer=""}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){let e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}addImpl(e){let r=e.indexOf(this.separator);if(r<0)return this.buffer+=e,"";let i=e.substring(0,r);try{this.onData(this.buffer+i),e=e.substring(i.length+this.separator.length)}catch(o){console.warn(o)}return this.buffer="",e}add(e){for(;e.length>0;)e=this.addImpl(e)}},Ec=class{dataHandler;paused=!1;queue=new lt;writer;stream;closed=!1;chunkSize;constructor(e,r={}){this.dataHandler=e,this.chunkSize=r.chunkSize??-1,this.writer=Yt(async()=>{await this.onWrite()},r.interval??10)}async close(){if(this.closed)return;let e=this.stream?.getWriter();e?.releaseLock(),await e?.close(),this.closed=!0}clear(){if(this.closed)throw Error("Buffer closed");this.queue=new lt}writable(){if(this.closed)throw Error("Buffer closed");return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){let e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}async onWrite(){if(this.queue.isEmpty)return!1;if(this.paused)return console.warn("WriteBuffer.onWrite: paused..."),!0;let e=this.queue.dequeue();return e===void 0?!1:(await this.dataHandler(e),!0)}get isClosed(){return this.closed}add(e){if(this.closed)throw Error("Buffer closed");this.chunkSize>0?this.queue.enqueue(...I1(e,this.chunkSize)):this.queue.enqueue(e),this.writer.start()}};const Dc=Object.freeze({ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"});var I3=class extends Ze{device;config;states;codec;rx;tx;gatt;verboseLogging=!1;rxBuffer;txBuffer;constructor(e,r){super(),this.device=e,this.config=r,this.verboseLogging=r.debug,this.txBuffer=new Ec(async i=>{await this.writeInternal(i)},r),this.rxBuffer=new xc(i=>{this.fireEvent("data",{data:i})}),this.codec=new wc,this.states=new fn(Dc,{initial:"ready"}),this.states.addEventListener("change",i=>{this.fireEvent("change",i),this.verbose(`${i.priorState} -> ${i.newState}`),i.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())}),e.addEventListener("gattserverdisconnected",()=>{this.isClosed||(this.verbose("GATT server disconnected"),this.states.state="closed")}),this.verbose(`ctor ${e.name} ${e.id}`)}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async writeInternal(e){this.verbose(`writeInternal ${e}`);let r=this.tx;if(r===void 0)throw Error("Unexpectedly without tx characteristic");try{await r.writeValue(this.codec.toBuffer(e))}catch(i){this.warn(i)}}disconnect(){this.states.state==="connected"&&this.gatt?.disconnect()}async connect(){let e=this.config.connectAttempts??3;this.states.state="connecting",this.verbose("connect");let r=this.device.gatt;if(r===void 0)throw Error("Gatt not available on device");await Nu(async()=>{this.verbose("connect.retry");let i=await r.connect();this.verbose("Getting primary service");let o=await i.getPrimaryService(this.config.service);this.verbose("Getting characteristics");let a=await o.getCharacteristic(this.config.rxGattCharacteristic),n=await o.getCharacteristic(this.config.txGattCharacteristic);return a.addEventListener("characteristicvaluechanged",s=>{this.onRx(s)}),this.rx=a,this.tx=n,this.gatt=r,this.states.state="connected",await a.startNotifications(),!0},{limitAttempts:e,startAt:200})}onRx(e){if(this.rx===void 0)return;let i=e.target.value;if(i===void 0)return;let o=this.codec.fromBuffer(i.buffer),a=Da(o,19),n=Da(o,17);n&&a<n&&(this.verbose("Tx plz start"),o=Aa(o,n,1),this.txBuffer.paused=!1),a&&a>n&&(this.verbose("Tx plz stop"),o=Aa(o,a,1),this.txBuffer.paused=!0),this.rxBuffer.add(o)}verbose(e){this.verboseLogging&&console.info(this.config.name,e)}log(e){console.log(this.config.name,e)}warn(e){console.warn(this.config.name,e)}},Gb={};A(Gb,{NordicBleDevice:()=>Ub,defaultOpts:()=>Go});const Go={chunkSize:20,service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",txGattCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rxGattCharacteristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",name:"NordicDevice",connectAttempts:5,debug:!1};var Ub=class extends I3{constructor(e,r={}){super(e,{...Go,...r})}},Jb=class{freqMaxRange=200;audio;parent;lastPointer={x:0,y:0};pointerDown=!1;pointerClicking=!1;pointerClickDelayMs=100;pointerDelaying=!1;waveTracker;freqTracker;el;constructor(e,r){this.audio=r,this.parent=e,this.waveTracker=da(),this.freqTracker=da(),e.innerHTML=`
    <section>
      <button id="rendererComponentToggle">🔼</button>
      <div>
        <h1>Visualiser</h1>
        <div style="display:flex; flex-wrap: wrap">
          <div class="visPanel">
            <h2>Frequency distribution</h2>
            <br />
            <canvas id="rendererComponentFreqData" height="200" width="400"></canvas>
          </div>
          <div class="visPanel">
            <h2>Waveform</h2>
            <button id="rendererComponentWaveReset">Reset</button>
            <div>
              Press and hold on wave to measure
            </div>
            <br />
            <canvas id="rendererComponentWaveData" height="200" width="400"></canvas>
          </div>
        </div>
      </div>
    </section>
    `,this.el=e.children[0],document.getElementById("rendererComponentToggle")?.addEventListener("click",()=>{this.setExpanded(!this.isExpanded())}),this.el.addEventListener("pointermove",i=>{this.onPointer(i)}),this.el.addEventListener("pointerup",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),this.el.addEventListener("pointerdown",()=>{this.pointerDelaying=!0,setTimeout(()=>{this.pointerDelaying&&(this.pointerDelaying=!1,this.pointerDown=!0)},this.pointerClickDelayMs)}),this.el.addEventListener("pointerleave",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),document.getElementById("rendererComponentWaveReset")?.addEventListener("click",()=>{this.clear()})}renderFreq(e){if(!this.isExpanded()||!e)return;let r=document.getElementById("rendererComponentFreqData");if(r===null)throw Error("Cannot find canvas element");let i=r.getContext("2d");if(i===null)throw Error("Cannot create drawing context");let o=e.length,a=r.clientWidth,n=r.clientHeight;i.clearRect(0,0,a,n);let s=this.getPointerRelativeTo(r),l=a/o,u=$o(e);for(let c=0;c<o;c++){if(!Number.isFinite(e[c]))continue;let f=e[c]-u.min,d=f/this.freqMaxRange,h=Math.abs(n*d),p=n-h,y=c/o*360,g=c*l;if(i.fillStyle=`hsl(${y}, 100%, 50%)`,s.y>0&&s.y<=n&&s.x>=g&&s.x<=g+l){this.freqTracker.id!==c.toString()&&(this.freqTracker=da({id:c.toString()})),this.freqTracker.seen(e[c]);let m=this.freqTracker.getMinMaxAvg();i.fillStyle="black",this.audio&&i.fillText(`Frequency (${c}) at pointer: ${this.audio.getFrequencyAtIndex(c).toLocaleString("en")} - ${this.audio.getFrequencyAtIndex(c+1).toLocaleString("en")}`,2,10),i.fillText(`Raw value: ${e[c].toFixed(2)}`,2,20),i.fillText(`Min: ${m.min.toFixed(2)}`,2,40),i.fillText(`Max: ${m.max.toFixed(2)}`,60,40),i.fillText(`Avg: ${m.avg.toFixed(2)}`,120,40)}i.fillRect(g,p,l,h)}}isExpanded(){let e=this.el.querySelector("div");if(e===null)throw Error("contents div not found");return e.style.display===""}setExpanded(e){let r=this.el.querySelector("div"),i=this.el.querySelector("button");if(i===null)throw Error("Button element not found");if(r===null)throw Error("Contents element not found");e?(r.style.display="",i.innerText="🔼"):(r.style.display="none",i.innerText="🔽")}clear(){this.clearCanvas(document.getElementById("rendererComponentFreqData")),this.clearCanvas(document.getElementById("rendererComponentWaveData"))}clearCanvas(e){if(e===null)throw Error("Canvas is null");let r=e.getContext("2d");if(r===null)throw Error("Cannot create drawing context");r.fillStyle="white",r.fillRect(0,0,e.clientWidth,e.clientHeight)}renderWave(e,r=!0){if(!this.isExpanded()||!e)return;let i=document.getElementById("rendererComponentWaveData");if(i===null)throw Error("Cannot find wave canvas");let o=i.getContext("2d");if(o===null)throw Error("Cannot create drawing context for wave");let a=i.clientWidth,n=i.clientHeight,s=this.getPointerRelativeTo(i),l=20,u=60,c=e.length;o.fillStyle="white",o.fillRect(0,0,u,l);let f=a/c;o.fillStyle="rgba(255, 255, 255, 0.03)",o.fillRect(0,20,a,n),o.fillStyle="red",r?o.fillRect(0,n/2,a,1):o.fillRect(0,n-1,a,1),o.lineWidth=1,o.strokeStyle="black",o.beginPath();let d=0;for(let h=0;h<c;h++){let p=e[h]*n,y=r?n/2-p:n-p;h===0?o.moveTo(d,y):o.lineTo(d,y),d+=f,this.pointerDown&&this.waveTracker.seen(e[h])}if(o.lineTo(a,r?n/2:n),o.stroke(),this.pointerDown){let h=this.waveTracker.getMinMaxAvg();o.fillStyle="rgba(255,255,0,1)",o.fillRect(u,0,150,20),o.fillStyle="black",o.fillText("Min: "+h.min.toFixed(2),60,10),o.fillText("Max: "+h.max.toFixed(2),110,10),o.fillText("Avg: "+h.avg.toFixed(2),160,10)}else this.waveTracker.reset();s.y>0&&s.y<=n&&s.x>=0&&s.x<=a&&(o.fillStyle="black",o.fillText("Level: "+(1-s.y/n).toFixed(2),2,10))}getPointerRelativeTo(e){let r=e.getBoundingClientRect();return{x:this.lastPointer.x-r.left-window.scrollX,y:this.lastPointer.y-r.top-window.scrollY}}onPointer(e){this.lastPointer={x:e.pageX,y:e.pageY},e.preventDefault()}};const q3=(e,r={})=>new Dn((i,o)=>{let a=new Float32Array(i.frequencyBinCount),n=new Float32Array(i.fftSize);i.getFloatFrequencyData(a),i.getFloatTimeDomainData(n),e(a,n,o)},r),_3=(e,r={})=>new Dn((i,o)=>{let a=new Float32Array(i.frequencyBinCount);i.getFloatFrequencyData(a),e(a,o)},r),W3=(e,r={})=>new Dn((i,o)=>{let a=new Float32Array(i.fftSize);i.getFloatTimeDomainData(a),e(iu(a),o)},r);var Dn=class{showVis;fftSize;smoothingTimeConstant;#e=!1;debug;#t=!1;visualiser;audioCtx;analyserNode;analyse;constructor(e,r={}){if(this.showVis=r.showVis??!1,this.fftSize=r.fftSize??1024,this.debug=r.debug??!1,this.smoothingTimeConstant=r.smoothingTimeConstant??.8,w(G(this.fftSize,"positive","opts.fftSize"),C(this.smoothingTimeConstant,"percentage","opts.smoothingTimeConstant")),!nd(this.fftSize))throw Error(`fftSize must be a power of two from 32 to 32768 (${this.fftSize})`);if(this.fftSize<32)throw Error("fftSize must be at least 32");if(this.fftSize>32768)throw Error("fftSize must be no greater than 32768");this.analyse=e,this.paused=!1,this.init();let i=document.querySelector("#audio-visualiser");if(i){let o=new Jb(i,this);o.setExpanded(this.showVis),this.visualiser=o}}init(){if(this.#t){this.debug&&console.debug("Init already in progress");return}this.#t=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.onMicSuccess(e)}).catch(e=>{this.#t=!1,console.error(e)})}get paused(){return this.#e}set paused(e){e!==this.#e&&(this.#e=e,e?this.debug&&console.log("Paused"):(this.debug&&console.log("Unpaused"),window.requestAnimationFrame(this.analyseLoop.bind(this))))}setup(e,r){let i=e.createAnalyser();return i.fftSize=this.fftSize,i.smoothingTimeConstant=this.smoothingTimeConstant,e.createMediaStreamSource(r).connect(i),i}onMicSuccess(e){try{let r=new AudioContext;r.addEventListener("statechange",()=>{this.debug&&console.log(`Audio context state: ${r.state}`)}),this.audioCtx=r,this.analyserNode=this.setup(r,e),window.requestAnimationFrame(this.analyseLoop.bind(this))}catch(r){this.#t=!1,console.error(r)}}analyseLoop(){if(this.paused){this.debug&&console.log("Paused");return}let e=this.analyserNode;if(e===void 0){console.warn("Analyser undefined");return}try{this.analyse(e,this)}catch(r){console.error(r)}window.requestAnimationFrame(this.analyseLoop.bind(this))}getFrequencyRangeMax(e,r,i){let o=this.sliceByFrequency(e,r,i);return op(o)}sliceByFrequency(e,r,i){let o=this.getIndexForFrequency(e),a=this.getIndexForFrequency(r);return i.slice(o,a)}getFrequencyAtIndex(e){let r=this.analyserNode,i=this.audioCtx;if(r===void 0)throw Error("Analyser not available");if(i===void 0)throw Error("Audio context not available");if(w(G(e,"positive","index")),e>r.frequencyBinCount)throw Error(`Index ${e} exceeds frequency bin count ${r.frequencyBinCount}`);return e*i.sampleRate/(r.frequencyBinCount*2)}getIndexForFrequency(e){let r=this.analyserNode;if(r===void 0)throw Error("Analyser not available");let i=r.context.sampleRate/2,o=Math.round(e/i*r.frequencyBinCount);return o<0?0:o>=r.frequencyBinCount?r.frequencyBinCount-1:o}},G3=class{#e=!1;#t=new Map;filterType="lowpass";constructor(){}init(){if(!this.#e){this.#e=!0;for(let e of document.querySelectorAll("audio"))this.#t.set(e.id,Hb(e,this.filterType))}}get(e){return this.init(),this.#t.get(e)}};function Hb(e,r="lowpass"){let i=U(e),o=new AudioContext,a=o.createMediaElementSource(i),n=o.createStereoPanner(),s=o.createGain(),l=o.createBiquadFilter();return l.type=r,a.connect(s),s.connect(n),n.connect(l),l.connect(o.destination),{pan:n,gain:s,filter:l,id:i.id,ctx:o,el:i}}function U3(e={}){let r=new AudioContext,i=e.type??"sawtooth",o=e.frequency??440,a=e.id??wu(),n=r.createOscillator();n.type=i,n.frequency.setValueAtTime(o,r.currentTime);let s=r.createStereoPanner(),l=r.createGain(),u=r.createBiquadFilter();return n.connect(l),l.connect(s),s.connect(u),u.connect(r.destination),{pan:s,gain:l,filter:u,ctx:r,osc:n,id:a}}var Kb={};A(Kb,{AudioAnalyser:()=>Dn,AudioElements:()=>G3,AudioVisualiser:()=>Jb,analyserBasic:()=>q3,analyserFrequency:()=>_3,analyserPeakLevel:()=>W3,createFromAudioElement:()=>Hb,createOscillator:()=>U3});var An=class extends Ub{evalTimeoutMs;evalReplyBluetooth=!0;constructor(e,r={}){super(e,r),this.evalTimeoutMs=r.evalTimeoutMs??5*1e3}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},i){let o=r.debug??!1;return Cc(e,r,this,"Bluetooth.println",o,i??(n=>{this.warn(n)}))}},J3=class extends Ze{states;codec;verboseLogging=!1;name;connectAttempts;chunkSize;rxBuffer;txBuffer;constructor(e={}){super(),this.verboseLogging=e.debug??!1,this.chunkSize=e.chunkSize??1024,this.connectAttempts=e.connectAttempts??3,this.name=e.name??"JsonDevice",this.txBuffer=new Ec(async r=>{await this.writeInternal(r)},e),this.rxBuffer=new xc(r=>{this.fireEvent("data",{data:r})}),this.codec=new wc,this.states=new fn(Dc,{initial:"ready"}),this.states.addEventListener("change",r=>{this.fireEvent("change",r),this.verbose(`${r.priorState} -> ${r.newState}`),r.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())})}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async close(){this.states.state==="connected"&&this.onClosed()}async connect(){let e=this.connectAttempts;this.states.state="connecting",await this.onPreConnect(),await Nu(async()=>(await this.onConnectAttempt(),this.states.state="connected",!0),{limitAttempts:e,startAt:200})}onRx(e){let r=e.target.value;if(r===void 0)return;let i=this.codec.fromBuffer(r.buffer),o=Da(i,19),a=Da(i,17);a&&o<a&&(this.verbose("Tx plz start"),i=Aa(i,a,1),this.txBuffer.paused=!1),o&&o>a&&(this.verbose("Tx plz stop"),i=Aa(i,o,1),this.txBuffer.paused=!0),this.rxBuffer.add(i)}verbose(e){this.verboseLogging&&console.info(this.name,e)}log(e){console.log(this.name,e)}warn(e){console.warn(this.name,e)}},Qb={};A(Qb,{Device:()=>Zb});var Zb=class extends J3{config;port;tx;abort;baudRate;constructor(e={}){super(e),this.config=e,this.abort=new AbortController;let r=e.eol??`\r
`;this.baudRate=e.baudRate??9600,e.name===void 0&&(this.name="Serial.Device"),this.rxBuffer.separator=r}async writeInternal(e){if(this.tx===void 0)throw Error("tx not ready");try{this.tx.write(e)}catch(r){this.warn(r)}}onClosed(){this.tx?.releaseLock(),this.abort.abort("closing port"),this.states.state="closed"}onPreConnect(){return Promise.resolve()}async onConnectAttempt(){let e={filters:[]},r={baudRate:this.baudRate};this.config.filters&&(e={filters:[...this.config.filters]}),this.port=await navigator.serial.requestPort(e),this.port.addEventListener("disconnect",s=>{this.close()}),await this.port.open(r);let i=this.port.writable,o=new TextEncoderStream;i!==null&&(o.readable.pipeTo(i,{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt txText pipe:"),console.log(s)}),this.tx=o.writable.getWriter());let a=this.port.readable,n=new TextDecoderStream;a!==null&&(a.pipeTo(n.writable,{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt rxR pipe:"),console.log(s)}),n.readable.pipeTo(this.rxBuffer.writable(),{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt rxText pipe:"),console.log(s);try{this.port?.close()}catch(l){console.log(l)}}))}},Xb=class extends Zb{evalTimeoutMs;evalReplyBluetooth=!1;constructor(e){super(e),e===void 0&&(e={}),this.evalTimeoutMs=e.evalTimeoutMs??5*1e3}async disconnect(){return super.close()}writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},i){let o=r.debug??!1;return Cc(e,r,this,"USB.println",o,i??(n=>{this.warn(n)}))}},Yb={};A(Yb,{EspruinoBleDevice:()=>An,EspruinoSerialDevice:()=>Xb,bangle:()=>K3,connectBle:()=>Z3,deviceEval:()=>Cc,puck:()=>H3,serial:()=>Q3});const H3=async(e={})=>{let r=e.name??"Puck",i=e.debug??!1,o=await navigator.bluetooth.requestDevice({filters:Ac(e,"Puck.js"),optionalServices:[Go.service]});e.debug&&console.info(`Espruino.puck device name: ${o.name}`);let a=new An(o,{name:r,debug:i});return await a.connect(),a},K3=async(e={})=>{let r=e.name??"Bangle",i=e.debug??!1,o=await navigator.bluetooth.requestDevice({filters:Ac(e,"Bangle.js"),optionalServices:[Go.service]});e.debug&&console.info(`Espruino.bangle device name: ${o.name}`);let a=new An(o,{name:r,debug:i});return await a.connect(),a},Q3=async(e={})=>{let r=new Xb(e);return await r.connect(),r},Ac=(e,r)=>{let i=[];return e.filters?i.push(...e.filters):e.name?(i.push({name:e.name}),console.info(`Filtering Bluetooth devices by name '${e.name}'`)):i.push({namePrefix:r}),i},Z3=async(e={})=>{let r=await navigator.bluetooth.requestDevice({filters:Ac(e,"Puck.js"),optionalServices:[Go.service]}),i=new An(r,{name:"Espruino",...e});return await i.connect(),i},Cc=async(e,r={},i,o,a,n)=>{let s=r.timeoutMs??i.evalTimeoutMs,l=r.assumeExclusive??!0;if(typeof e!="string")throw TypeError(`Param 'code' should be a string. Got: ${typeof e}`);return new Promise((u,c)=>{let f=Ay(5),d=g=>{try{let m=g.data.trim();m.startsWith(">{")&&m.endsWith("}")&&(m=m.slice(1));let v=JSON.parse(m);"reply"in v?v.reply===f?(p(),"result"in v&&u(v.result)):n(`Expected reply ${f}, got ${v.reply}`):n(`Expected packet, missing 'reply' field. Got: ${g.data}`)}catch(m){l?p(`Unexpected reply: ${g.data}. Error: ${st(m)}`):n(st(m))}},h=g=>{g.newState!=="connected"&&p(`State changed to '${g.newState}', aborting`)};i.addEventListener("data",d),i.addEventListener("change",h);let p=ju(s,g=>{c(Error(g))},g=>{i.removeEventListener("data",d),i.removeEventListener("change",h)}),y=`${o}(JSON.stringify({reply:"${f}", result:JSON.stringify(${e})}))
`;a&&n(y),i.write(y)})};var ev={};A(ev,{dumpDevices:()=>Y3,start:()=>tv});const X3=1e4,Y3=async(e="videoinput")=>{let r=await navigator.mediaDevices.enumerateDevices();for(let i of r)i.kind===e&&(console.log(i.label),console.log(` Kind: ${i.kind}`),console.log(` Device id: ${i.deviceId}`))},tv=async(e={})=>{let r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-camera"),document.body.append(r);let i=()=>{},o=()=>{try{i()}catch{}r.remove()};try{return i=(await e5(r,e)).dispose,{videoEl:r,dispose:o}}catch(a){throw console.error(a),o(),a}},e5=async(e,r={})=>{if(e===void 0)throw Error("videoEl undefined");if(e===null)throw Error("videoEl null");let i=r.max,o=r.min,a=r.ideal,n={audio:!1,video:{width:{},height:{}}};r.facingMode==="front"&&(r={...r,facingMode:"user"}),r.facingMode==="back"&&(r={...r,facingMode:"environment"}),r.facingMode&&(n.video.facingMode=r.facingMode),r.deviceId&&(n.video.deviceId=r.deviceId),a&&(n.video.width={...n.video.width,ideal:a.width},n.video.height={...n.video.height,ideal:a.height}),i&&(n.video.width={...n.video.width,max:i.width},n.video.height={...n.video.height,max:i.height}),o&&(n.video.width={...n.video.width,min:o.width},n.video.height={...n.video.height,min:o.height});let s=ju(r.startTimeoutMs??X3,l=>{throw Error(`Camera getUserMedia failed: ${l}`)});try{let l=await navigator.mediaDevices.getUserMedia(n),u=()=>{e.pause();let d=l.getTracks();for(let h of d)h.stop()};e.srcObject=l,s();let c={videoEl:e,dispose:u};return new Promise((d,h)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{d(c)}).catch(p=>{h(p)})})})}catch(l){throw s(st(l)),l}};var rv={};A(rv,{start:()=>iv});const iv=async e=>{let r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-video"),document.body.appendChild(r);let i=()=>{},o=()=>{try{i()}catch{}r.remove()};try{return i=(await t5(r,e)).dispose,{videoEl:r,dispose:o}}catch(a){throw console.error(a),o(),a}},t5=async(e,r)=>{if(e===void 0)throw Error("videoEl undefined");if(e===null)throw Error("videoEl null");let i=URL.createObjectURL(r);e.src=i,e.loop=!0;let o=()=>{e.pause()},a={videoEl:e,dispose:o};return new Promise((s,l)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{s(a)}).catch(u=>{l(u)})})})};var ov={};A(ov,{arc:()=>lv,bezier:()=>cv,circle:()=>za,connectedPoints:()=>Cn,copyToImg:()=>s5,dot:()=>bt,drawingStack:()=>ri,ellipse:()=>a5,getContext:()=>nv,line:()=>Fc,lineThroughPoints:()=>o5,makeHelper:()=>sv,paths:()=>uv,pointLabels:()=>Sn,rect:()=>Oa,textBlock:()=>dv,textBlockAligned:()=>d5,textHeight:()=>f5,textRect:()=>kc,textWidth:()=>c5,translatePoint:()=>n5,triangle:()=>u5});const av=Math.PI*2,nv=e=>{if(e===null)throw Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");let r=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?U(e).getContext("2d"):e;if(r===null)throw Error("Could not create 2d context for canvas");return r},sv=(e,r)=>{let i=nv(e);return{ctx:i,paths(o,a){uv(i,o,a)},line(o,a){Fc(i,o,a)},rect(o,a){Oa(i,o,a)},bezier(o,a){cv(i,o,a)},connectedPoints(o,a){Cn(i,o,a)},pointLabels(o,a){Sn(i,o,a)},dot(o,a){bt(i,o,a)},circle(o,a){za(i,o,a)},arc(o,a){lv(i,o,a)},textBlock(o,a){a.bounds===void 0&&r!==void 0&&(a={...a,bounds:{...r,x:0,y:0}}),dv(i,o,a)}}},Sc=e=>r5(e.strokeStyle,e.fillStyle),Ge=(e,r={},...i)=>{if(e===void 0)throw Error("ctx undefined");let o=ri(e).push(Sc(r),...i);return o.apply(),o},lv=(e,r,i={})=>{Ge(e,i);let o=n=>{e.beginPath(),e.arc(n.x,n.y,n.radius,n.startRadian,n.endRadian),e.stroke()},a=Array.isArray(r)?r:[r];for(let n of a)o(n)},r5=(e,r)=>o=>{r&&(o.fillStyle=r),e&&(o.strokeStyle=e)},i5=(e,r,i)=>a=>{e&&(a.lineWidth=e),r&&(a.lineJoin=r),i&&(a.lineCap=i)},ri=(e,r)=>(r??=new ao,{push:(...n)=>{r??=new ao;let s=r.push(...n);for(let l of n)l(e);return ri(e,s)},pop:()=>{let n=r?.pop();return ri(e,n)},apply:()=>{if(r===void 0)return ri(e);for(let n of r.data)n(e);return ri(e,r)}}),o5=(e,r,i)=>{Ge(e,i),e.moveTo(r[0].x,r[0].y);for(let[o,a]of r.entries()){if(o+2>=r.length)continue;let n=r[o+1],s={x:(a.x+n.x)/2,y:(a.y+n.y)/2},l=(s.x+a.x)/2,u=(s.x+n.x)/2;e.quadraticCurveTo(l,n.y,s.x,s.y),e.quadraticCurveTo(u,n.y,n.x,n.y)}},za=(e,r,i={})=>{Ge(e,i);let o=a=>{e.beginPath(),e.arc(a.x,a.y,a.radius,0,av),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()};if(Array.isArray(r))for(let a of r)o(a);else o(r)},a5=(e,r,i={})=>{Ge(e,i);let o=n=>{e.beginPath();let s=n.rotation??0,l=n.startAngle??0,u=n.endAngle??av;e.ellipse(n.x,n.y,n.radiusX,n.radiusY,s,l,u),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()},a=Array.isArray(r)?r:[r];for(let n of a)o(n)},uv=(e,r,i={})=>{Ge(e,i);let o=a=>{if(Ei(a))fv(e,a,i);else if(Tt(a))Fc(e,a,i);else throw Error(`Unknown path type ${JSON.stringify(a)}`)};if(Array.isArray(r))for(let a of r)o(a);else o(r)},Cn=(e,r,i={})=>{let o=i.loop??!1;if(w(Ve(r,"pts")),r.length!==0){for(let[a,n]of r.entries())O(n,`Index ${a}`);Ge(e,i),i.lineWidth&&(e.lineWidth=i.lineWidth),e.beginPath(),e.moveTo(r[0].x,r[0].y);for(let a of r)e.lineTo(a.x,a.y);o&&e.lineTo(r[0].x,r[0].y),(i.strokeStyle||i.strokeStyle===void 0&&i.fillStyle===void 0)&&e.stroke(),i.fillStyle&&e.fill()}},Sn=(e,r,i={},o)=>{if(r.length!==0){for(let[a,n]of r.entries())O(n,`Index ${a}`);Ge(e,i);for(let[a,n]of r.entries()){let s=o!==void 0&&a<o.length?o[a]:a.toString();e.fillText(s.toString(),n.x,n.y)}}},n5=(e,r)=>{let i=e.getTransform();return{x:r.x*i.a+r.y*i.c+i.e,y:r.x*i.b+r.y*i.d+i.f}},s5=e=>{let r=document.createElement("img");return r.src=e.toDataURL("image/jpeg"),r},bt=(e,r,i)=>{i??={};let o=i.radius??10,a=Array.isArray(r)?r:[r],n=i.stroke?i.stroke:i.strokeStyle!==void 0,s=i.filled?i.filled:i.fillStyle!==void 0;!n&&!s&&(s=!0),Ge(e,i);for(let l of a)e.beginPath(),"radius"in l?e.arc(l.x,l.y,l.radius,0,2*Math.PI):e.arc(l.x,l.y,o,0,2*Math.PI),s&&e.fill(),n&&e.stroke()},cv=(e,r,i)=>{Ei(r)?fv(e,r,i):yn(r)&&l5(e,r,i)},l5=(e,r,i={})=>{let o=Ge(e,i),{a,b:n,cubic1:s,cubic2:l}=r,u=i.debug??!1;e.beginPath(),e.moveTo(a.x,a.y),e.bezierCurveTo(s.x,s.y,l.x,l.y,n.x,n.y),e.stroke(),u&&(o=o.push(Sc({...i,strokeStyle:fi(i.strokeStyle??"silver",.6),fillStyle:fi(i.fillStyle??"yellow",.4)})),o.apply(),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.stroke(),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y),e.stroke(),e.fillText("a",a.x+5,a.y),e.fillText("b",n.x+5,n.y),e.fillText("c1",s.x+5,s.y),e.fillText("c2",l.x+5,l.y),bt(e,s,{radius:3}),bt(e,l,{radius:3}),bt(e,a,{radius:3}),bt(e,n,{radius:3}),o=o.pop(),o.apply())},fv=(e,r,i={})=>{let{a:o,b:a,quadratic:n}=r,s=i.debug??!1,l=Ge(e,i);e.beginPath(),e.moveTo(o.x,o.y),e.quadraticCurveTo(n.x,n.y,a.x,a.y),e.stroke(),s&&(l=l.push(Sc({...i,strokeStyle:fi(i.strokeStyle??"silver",.6),fillStyle:fi(i.fillStyle??"yellow",.4)})),Cn(e,[o,n,a]),e.fillText("a",o.x+5,o.y),e.fillText("b",a.x+5,a.y),e.fillText("h",n.x+5,n.y),bt(e,n,{radius:3}),bt(e,o,{radius:3}),bt(e,a,{radius:3}),l=l.pop(),l.apply())},Fc=(e,r,i={})=>{let o=i.debug??!1,a=i5(i.lineWidth,i.lineJoin,i.lineCap);Ge(e,i,a);let n=s=>{let{a:l,b:u}=s;e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(u.x,u.y),o&&(e.fillText("a",l.x,l.y),e.fillText("b",u.x,u.y),bt(e,l,{radius:5,strokeStyle:"black"}),bt(e,u,{radius:5,strokeStyle:"black"})),e.stroke()};if(Array.isArray(r))for(let s of r)n(s);else n(r)},u5=(e,r,i={})=>{Ge(e,i);let o=a=>{Cn(e,Gs(a),{...i,loop:!0}),i.debug&&Sn(e,Gs(a),void 0,["a","b","c"])};if(Array.isArray(r))for(let a of r)o(a);else o(r)},Oa=(e,r,i={})=>{Ge(e,i);let o=i.filled??i.fillStyle!==void 0,a=i.stroke??i.strokeStyle!==void 0,n=s=>{let l="x"in s?s.x:0,u="y"in s?s.y:0;o&&e.fillRect(l,u,s.width,s.height),a&&(i.strokeWidth&&(e.lineWidth=i.strokeWidth),e.strokeRect(l,u,s.width,s.height)),i.crossed&&(e.beginPath(),e.moveTo(l,u),e.lineTo(s.width,s.height),e.stroke(),e.moveTo(0,s.height),e.lineTo(s.width,0),e.stroke()),i.debug&&Sn(e,Pr(s),void 0,["NW","NE","SE","SW"])};if(Array.isArray(r))for(let s of r)n(s);else n(r)},c5=(e,r,i=0,o)=>kc(e,r,i,o).width,kc=(e,r,i=0,o)=>{if(r==null||r.length===0)return nn;let a=e.measureText(r);return{width:o?Sr(a.width,o)+i:a.width+i,height:a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i+i}},f5=(e,r,i=0)=>kc(e,r,i).height,dv=(e,r,i)=>{Ge(e,i);let o=i.anchorPadding??0,a=i.align??"top",n=i.anchor,s=i.bounds??{x:0,y:0,width:1e6,height:1e6},l=r.map(y=>e.measureText(y)),u=l.map(y=>y.width),c=l.map(y=>y.actualBoundingBoxAscent+y.actualBoundingBoxDescent+3),f=Math.max(...u),d=c.reduce((y,g)=>y+g,0),{x:h,y:p}=n;n.x+f>s.width?h=s.width-(f+o):h-=o,h<s.x&&(h=s.x+o),n.y+d>s.height?p=s.height-(d+o):p-=o,p<s.y&&(p=s.y+o),a==="top"?e.textBaseline="top":e.textBaseline="middle";for(let[y,g]of r.entries())e.fillText(g,h,p),p+=c[y]},d5=(e,r,i)=>{let{bounds:o}=i,{horiz:a="left",vert:n="top"}=i,s=typeof r=="string"?[r]:r;Ge(e,i),e.save(),e.translate(o.x,o.y),e.textAlign="left",e.textBaseline="top";let l=o.width/2,u=o.height/2,c=s.map(p=>e.measureText(p)),f=c.map(p=>p.actualBoundingBoxAscent+p.actualBoundingBoxDescent),d=f.reduce((p,y)=>p+y,0),h=0;n==="center"?h=u-d/2:n==="bottom"&&(h=o.height-d);for(let[p,y]of s.entries()){let g=0;a==="center"?g=l-c[p].width/2:a==="right"&&(g=o.width-c[p].width),e.fillText(y,g,h),h+=f[p]}e.restore()};var hv=Object.defineProperty,h5=(e,r,i)=>r in e?hv(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i,p5=(e,r)=>{for(var i in r)hv(e,i,{get:r[i],enumerable:!0})},Cr=(e,r,i)=>h5(e,typeof r=="symbol"?r:r+"",i);function T(e,r){if(e)return;let i=Error(r||"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");throw i.name="colorizr",i}var $t={hsl:["h","s","l"],oklab:["l","a","b"],oklch:["l","c","h"],rgb:["r","g","b"]},y5=["hsl","oklab","oklch","rgb"],Xf=Math.PI/180,Zr={l:[.3963377773761749,.2158037573099136],m:[-.1055613458156586,-.0638541728258133],s:[-.0894841775298119,-1.2914855480194092]},qt={l:[.4122214708,.5363325363,.0514459929],m:[.2119034982,.6806995451,.1073969566],s:[.0883024619,.2817188376,.6299787005]},_t={l:[.2104542553,.793617785,.0040720468],a:[1.9779984951,2.428592205,.4505937099],b:[.0259040371,.7827717662,.808675766]},Wt={r:[4.076741636075958,-3.307711539258063,.2309699031821043],g:[-1.2684379732850315,2.609757349287688,-.341319376002657],b:[-.0041960761386756,-.7034186179359362,1.7076146940746117]},ur=5,g5=180/Math.PI,_={alpha:"amount must be a number between 0 and 1",input:"input is required",inputHex:"input is required and must be a hex",inputNumber:"input is required and must be a number",inputString:"input is required and must be a string",invalid:"invalid input",invalidCSS:"invalid CSS string",left:"left is required and must be a string",right:"right is required and must be a string",threshold:"threshold must be a number between 0 and 255"},Fn={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function m5(e){return Array.isArray(e)&&e.length===6}function Gr(e){return de(e)&&Object.keys(Fn).includes(e.toLowerCase())}function nt(e){return typeof e=="number"&&!Number.isNaN(e)}function Si(e){if(!e)return!1;let{toString:r}=Object.prototype,i=Object.getPrototypeOf(e);return r.call(e)==="[object Object]"&&(i===null||i===Object.getPrototypeOf({}))}function de(e,r=!0){let i=typeof e=="string";return r?i&&!!e.trim().length:i}function pv(e){return kn(e)||Pn(e)||$n(e)||Mn(e)}function ve(e){return de(e)?/^#([\da-f]{3,4}|[\da-f]{6,8})$/i.test(e):!1}function kn(e){if(!Si(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="h"?o>=0&&o<=360:i==="alpha"?o>=0&&o<=1:$t.hsl.includes(i)&&o>=0&&o<=100)}function $n(e){if(!Si(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="l"?o>=0&&o<=100:i==="alpha"?o>=0&&o<=1:$t.oklab.includes(i)&&o>=-1&&o<=1)}function Mn(e){if(!Si(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="l"?o>=0&&o<=100:i==="alpha"?o>=0&&o<=1:$t.oklch.includes(i)&&o>=0&&o<=(i==="h"?360:1))}function Pn(e){if(!Si(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="alpha"?o>=0&&o<=1:$t.rgb.includes(i)&&o>=0&&o<=255)}function je(e,r){T(pv(e),_.invalid);let i=r;return!i||(i>1&&(i/=100),i===1)?e:{...e,alpha:i}}function fr(e,r=0,i=100){return Math.min(Math.max(e,r),i)}function b5(e,r){T(nt(e),_.inputNumber);let i=e+r;return i>360&&(i%=360),i<0&&(i+=360),Math.abs(i)}function Jt(e,r,i){switch(T(nt(e),"Input is not a number"),T(y5.includes(r),`Invalid model${r?`: ${r}`:""}`),T($t[r].includes(i),`Invalid key${i?`: ${i}`:""}`),r){case"hsl":return T($t.hsl.includes(i),"Invalid key"),["s","l"].includes(i)?fr(e):fr(e,0,360);case"rgb":return T($t.rgb.includes(i),"Invalid key"),fr(e,0,255);default:throw Error("Invalid inputs")}}function Le(e,r){let i=$t[r],o={hsl:kn,oklab:$n,oklch:Mn,rgb:Pn};T(Si(e)||Array.isArray(e),_.invalid);let a=Array.isArray(e)?{[i[0]]:e[0],[i[1]]:e[1],[i[2]]:e[2]}:e;return T(o[r](a),`invalid ${r} color`),a}function li(e,r=ur,i=!0){let o=new Map(Object.entries(e));for(let[a,n]of o.entries())o.set(a,ye(n,r,i));return Object.fromEntries(o)}function ye(e,r=2,i=!0){if(!nt(e)||e===0)return 0;if(i){let l=10**r;return Math.round(e*l)/l}let o=Math.abs(e),a=Math.abs(Math.ceil(Math.log(o)/Math.LN10));a===0?a=2:a>r&&(a=r);let n=r-(a<0?0:a);n<=1&&r>1?n=2:(n>r||n===0)&&(n=r);let s=10**n;return Math.round(e*s)/s}function Yf(e,r){return T(ve(e),_.inputHex),T(nt(r),_.inputNumber),r>=1?Ra(e):`${Ra(e)}${ja(r)}`}function ja(e){T(nt(e),_.inputNumber);let r=e;return e>1&&(r/=100),Math.round(r*255).toString(16).padStart(2,"0")}function $c(e){T(ve(e),_.inputString);let r=e.substring(7,9);return r?ye(parseInt(r,16)/255):1}function Ra(e){return T(ve(e),_.inputHex),e.length===5?e.substring(0,4):e.substring(0,7)}var Fr={};p5(Fr,{hex2hsl:()=>Mc,hex2oklab:()=>yv,hex2oklch:()=>Nc,hex2rgb:()=>br,hsl2hex:()=>gv,hsl2oklab:()=>mv,hsl2oklch:()=>bv,hsl2rgb:()=>ki,oklab2hex:()=>A5,oklab2hsl:()=>vv,oklab2oklch:()=>Pc,oklab2rgb:()=>$i,oklch2hex:()=>F5,oklch2hsl:()=>wv,oklch2oklab:()=>Bc,oklch2rgb:()=>Bn,rgb2hex:()=>Nn,rgb2hsl:()=>Fi,rgb2oklab:()=>Uo,rgb2oklch:()=>Jo});function v5(e){T(ve(e),_.inputHex);let r=e.replace("#","");if(r.length===3||r.length===4){let o=[...r];r="",o.forEach(a=>{r+=`${a}${a}`})}let i=`#${r}`;return T(ve(i),"invalid hex"),i}function br(e){T(ve(e),_.inputHex);let r=v5(e).slice(1);return{r:parseInt(r.charAt(0)+r.charAt(1),16),g:parseInt(r.charAt(2)+r.charAt(3),16),b:parseInt(r.charAt(4)+r.charAt(5),16)}}function Fi(e){let r=Le(e,"rgb"),i=Jt(r.r,"rgb","r")/255,o=Jt(r.g,"rgb","g")/255,a=Jt(r.b,"rgb","b")/255,n=Math.min(i,o,a),s=Math.max(i,o,a),l=s-n,u=0,c,f=(s+n)/2,d;switch(s){case i:d=l?(o-a)/l:0,u=60*d;break;case o:d=(a-i)/l,u=60*d+120;break;case a:d=(i-o)/l,u=60*d+240;break}return u<0&&(u=360+u),c=n===s?0:f<.5?l/(2*f):l/(2-2*f),{h:Math.abs(+(u%360).toFixed(2)),s:+(c*100).toFixed(2),l:+(f*100).toFixed(2)}}function Mc(e){return T(ve(e),_.inputHex),Fi(br(e))}var{cbrt:as,sign:w5}=Math;function ns(e){let r=Math.abs(e);return r<.04045?e/12.92:(w5(e)||1)*((r+.055)/1.055)**2.4}function Uo(e,r=ur){let i=Le(e,"rgb"),[o,a,n]=[ns(i.r/255),ns(i.g/255),ns(i.b/255)],s=as(qt.l[0]*o+qt.l[1]*a+qt.l[2]*n),l=as(qt.m[0]*o+qt.m[1]*a+qt.m[2]*n),u=as(qt.s[0]*o+qt.s[1]*a+qt.s[2]*n),c={l:_t.l[0]*s+_t.l[1]*l-_t.l[2]*u,a:_t.a[0]*s-_t.a[1]*l+_t.a[2]*u,b:_t.b[0]*s+_t.b[1]*l-_t.b[2]*u};return li(c,r)}function yv(e,r){return T(ve(e),_.inputHex),Uo(br(e),r)}var{atan2:x5,sqrt:E5}=Math;function Pc(e,r){let{l:i,a:o,b:a}=li(Le(e,"oklab")),n=E5(o**2+a**2),s=(x5(a,o)*g5+360)%360;return ye(n*1e4)===0&&(s=0),li({l:i,c:n,h:s},r)}function Jo(e,r){let i=Le(e,"rgb");return Pc(Uo(i,r),r)}function Nc(e,r){return T(ve(e),_.inputHex),Jo(br(e),r)}function ss(e,r,i){T(nt(e)&&nt(r)&&nt(i),"point, chroma and h are required");let o=i;return o<0&&(o+=1),o>1&&--o,ye(o<1/6?e+(r-e)*6*o:o<1/2?r:o<2/3?e+(r-e)*(2/3-o)*6:e,4)}function ki(e){let r=Le(e,"hsl"),i=ye(r.h)/360,o=ye(r.s)/100,a=ye(r.l)/100,n,s,l,u,c;return o===0?(n=a,s=a,l=a):(c=a<.5?a*(1+o):a+o-a*o,u=2*a-c,n=ss(u,c,i+1/3),s=ss(u,c,i),l=ss(u,c,i-1/3)),{r:Math.round(n*255),g:Math.round(s*255),b:Math.round(l*255)}}function Nn(e){let r=Le(e,"rgb");return`#${Object.values(r).map(i=>`0${Math.floor(i).toString(16)}`.slice(-2)).join("")}`}function gv(e){let r=Le(e,"hsl");return Nn(ki(r))}function mv(e,r){let i=Le(e,"hsl");return Uo(ki(i),r)}function bv(e,r){let i=Le(e,"hsl");return Jo(ki(i),r)}var{abs:D5}=Math;function ls(e){let r=D5(e),i=e<0?-1:1;return r>.0031308?i*(r**(1/2.4)*1.055-.055):e*12.92}function $i(e,r=0){let{l:i,a:o,b:a}=Le(e,"oklab"),n=(i+Zr.l[0]*o+Zr.l[1]*a)**3,s=(i+Zr.m[0]*o+Zr.m[1]*a)**3,l=(i+Zr.s[0]*o+Zr.s[1]*a)**3,u=255*ls(Wt.r[0]*n+Wt.r[1]*s+Wt.r[2]*l),c=255*ls(Wt.g[0]*n+Wt.g[1]*s+Wt.g[2]*l),f=255*ls(Wt.b[0]*n+Wt.b[1]*s+Wt.b[2]*l);return{r:fr(ye(u,r),0,255),g:fr(ye(c,r),0,255),b:fr(ye(f,r),0,255)}}function A5(e){let r=Le(e,"oklab");return Nn($i(r))}function vv(e){let r=Le(e,"oklab");return Fi($i(r))}var{sin:C5,cos:S5}=Math;function Bc(e,r){let{l:i,c:o,h:a}=Le(e,"oklch");return(Number.isNaN(a)||a<0)&&(a=0),li({l:i,a:o*S5(a*Xf),b:o*C5(a*Xf)},r)}function Bn(e,r=0){let i=Le(e,"oklch");return $i(Bc(i),r)}function F5(e){let r=Le(e,"oklch");return Nn(Bn(r))}function wv(e){let r=Le(e,"oklch");return Fi(Bn(r))}function He(e){if(T(de(e),_.inputString),ve(e)){let s=$t.rgb,{r:l,g:u,b:c}=br(e),f=$c(e);return{model:"rgb",[s[0]]:l,[s[1]]:u,[s[2]]:c,alpha:f<1?f:void 0}}let r=/(?:(rgb|hsl|oklab|oklch)a?\s*\(\s*([\d%.-]+)\s*[ ,/]\s*([\d%.-]+)\s*[ ,/]\s*([\d%.-]+)(?:\s*[ ,/]\s*([\d%.-]+))?\s*\))/i,i=r.exec(e);T(m5(i),_.invalidCSS);let o=i[1],a=$t[o],n=i[5]?parseFloat(i[5]):1;return n>1&&(n/=100),{model:o,[a[0]]:parseFloat(i[2]),[a[1]]:parseFloat(i[3]),[a[2]]:parseFloat(i[4]),alpha:n<1?n:void 0}}function Ce(e,r){T(de(e),_.inputString);let i,o=Gr(e)?Fn[e.toLowerCase()]:e,a=r??(ve(o)?"hex":He(o).model),n=s=>Object.values(s);if(ve(o)){let s=$c(o);switch(a){case"hsl":i=je(Mc(o),s);break;case"oklab":i=je(yv(o),s);break;case"oklch":i=je(Nc(o),s);break;case"rgb":i=je(br(o),s);break;default:i=`${Ra(o)}${s===1?"":ja(s)}`;break}return i}switch(a){case"hsl":{let{alpha:s,model:l,...u}=He(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ye(u.l/100,ur)),i=je(l==="hsl"?u:Fr[`${l}2hsl`](n(u)),s);break}case"oklab":{let{alpha:s,model:l,...u}=He(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ye(u.l/100,ur)),i=je(l==="oklab"?u:Fr[`${l}2oklab`](n(u)),s);break}case"oklch":{let{alpha:s,model:l,...u}=He(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ye(u.l/100,ur)),i=je(l==="oklch"?u:Fr[`${l}2oklch`](n(u)),s);break}case"rgb":{let{alpha:s,model:l,...u}=He(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l/=100),i=je(l==="rgb"?u:Fr[`${l}2rgb`](n(u)),s);break}case"hex":default:{let{alpha:s,model:l,...u}=He(o),c="";["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ye(u.l/100,ur)),s&&(c=ja(s)),i=`${Fr[`${l}2hex`](n(u))}${c}`;break}}return i}function k5(e){T(!!e,_.input);let r={};if(de(e)){let{alpha:i=1}=He(e),o=ve(e)?"hex":He(e).model;r.hex=Yf(Ce(e,"hex"),i),r.hsl=je(Ce(e,"hsl"),i),r.oklab=je(Ce(e,"oklab"),i),r.oklch=je(Ce(e,"oklch"),i),r.rgb=je(Ce(e,"rgb"),i),r.alpha=i,r.type=o}else if(Si(e)){let{alpha:i=1}=e;if(kn(e))r.hsl={h:Jt(e.h,"hsl","h"),s:Jt(e.s,"hsl","s"),l:Jt(e.l,"hsl","l")},r.rgb=ki(r.hsl),r.oklab=mv(r.hsl),r.oklch=bv(r.hsl),r.type="hsl";else if($n(e))r.hsl=vv(e),r.oklab=e,r.oklch=Pc(e),r.rgb=$i(e),r.type="oklab";else if(Mn(e))r.hsl=wv(e),r.oklab=Bc(e),r.oklch=e,r.rgb=Bn(e),r.type="oklch";else if(Pn(e))r.rgb={r:Jt(e.r,"rgb","r"),g:Jt(e.g,"rgb","g"),b:Jt(e.b,"rgb","b")},r.hsl=Fi(r.rgb),r.oklab=Uo(r.rgb),r.oklch=Jo(r.rgb),r.type="rgb";else throw Error("invalid color");r.hex=Yf(gv(r.hsl),i),r.hsl=je(r.hsl,i),r.oklab=je(r.oklab,i),r.oklch=je(r.oklch,i),r.rgb=je(r.rgb,i),r.alpha=i}else throw Error(_.input);return r}function xv(e,r,i=ur){T(de(e),_.left),T(de(r),_.right);let o=Ce(e,"rgb"),a=Ce(r,"rgb"),n=(o.r*299+o.g*587+o.b*114)/1e3,s=(a.r*299+a.g*587+a.b*114)/1e3;return ye(Math.abs(s-n),i)}function $5(e){T(de(e),_.inputString);let{r,g:i,b:o}=Ce(e,"rgb"),a=Math.max(r,i,o),n=Math.min(r,i,o);return ye((a-n)/255,4)}function Ev(e,r){T(de(e),_.left),T(de(r),_.right);let i=Ce(e,"rgb"),o=Ce(r,"rgb");return Math.max(i.r,o.r)-Math.min(i.r,o.r)+(Math.max(i.g,o.g)-Math.min(i.g,o.g))+(Math.max(i.b,o.b)-Math.min(i.b,o.b))}function Js(e){T(de(e),_.inputString);let{r,g:i,b:o}=Ce(e,"rgb"),a=[r/255,i/255,o/255];for(let n=0;n<a.length;n++)a[n]<=.03928?a[n]/=12.92:a[n]=((a[n]+.055)/1.055)**2.4;return ye(.2126*a[0]+.7152*a[1]+.0722*a[2],4)}function Dv(e,r){T(de(e),_.left),T(de(r),_.right);let i=Js(e),o=Js(r);return ye(i>=o?(i+.05)/(o+.05):(o+.05)/(i+.05))}function M5(e,r){T(de(e),_.left),T(de(r),_.right);let i=500,o=125,a=Ev(e,r),n=Dv(e,r),s=xv(e,r),l=s>=o,u=a>=i,c=0;return l&&u?c=2:(l||u)&&(c=1),{brightnessDifference:s,colorDifference:a,compliant:c,contrast:n,largeAA:n>=3,largeAAA:n>=4.5,normalAA:n>=4.5,normalAAA:n>=7}}function P5(e){if(ve(e)||Gr(e))return"hex";if(de(e))return He(e).model;if(kn(e))return"hsl";if($n(e))return"oklab";if(Mn(e))return"oklch";if(Pn(e))return"rgb";throw Error(_.invalid)}function Ji(e,r){let i=Gr(e)?Fn[e.toLowerCase()]:e,o=P5(i);if(o===r)return i;let a=`${o}2${r}`,n=Fr[a];if(!n)throw Error(`Converter not found for ${o} to ${r}`);switch(o){case"hex":return r==="hex"?i:n(i);case"hsl":return r==="hsl"?i:n(i);case"oklab":return r==="oklab"?i:n(i);case"oklch":return r==="oklch"?i:n(i);default:return r==="rgb"?i:n(i)}}function pr(e,r={}){T(ve(e)||pv(e),_.invalid);let{alpha:i,format:o="hex",precision:a=ur,separator:n=" "}=r,s=i&&i!==1?`${ye(i*100)}%`:null,l=[],u=n;switch(o){case"hsl":{let{h:c,s:f,l:d}=Ji(e,"hsl");l=[c,`${f}%`,`${d}%`];break}case"oklab":{u=" ";let{l:c,a:f,b:d}=li(Ji(e,"oklab"),a);l=[`${ye(c*100,a)}%`,f,d];break}case"oklch":{u=" ";let{l:c,c:f,h:d}=li(Ji(e,"oklch"),a);l=[`${ye(c*100,a)}%`,f,d];break}case"rgb":{let{r:c,g:f,b:d}=Ji(e,"rgb");l=[c,f,d];break}default:{let c=Ra(Ji(e,"hex"));return i&&i!==1?`${c}${ja(i)}`:c}}return`${o}(${l.join(u)}${s?` / ${s}`:""})`}function Tn(e,r,i){return(o,a)=>{T(de(o),_.inputString),T(nt(a),_.alpha);let n=Ce(o,"hsl"),s=ve(o)||Gr(o)?"hex":He(o).model;return pr({...n,[e]:fr(n[e]+(r==="+"?a:-a),0,100)},{format:s})}}function N5(e,r,i){return Tn("l","-")(e,r)}function B5(e,r,i){return Tn("s","-")(e,r)}function Av(e,r,i){T(de(e),_.inputString),T(nt(r),"degrees must be a number");let o=Ce(e,"hsl"),a=ve(e)||Gr(e)?"hex":He(e).model;return pr({...o,h:b5(o.h,r)},{format:a})}function T5(e){T(de(e),_.inputString);let r=ve(e)||Gr(e)?"hex":He(e).model,i=Ce(e,"hex");return pr(Av(i,180),{format:r})}function z5(e,r,i){return Tn("l","+")(e,r)}function O5(e,r,i){T(de(e),_.inputString),T(nt(r),_.alpha);let o=ve(e)||Gr(e)?"hex":He(e).model,a=Ce(e,"rgb");return pr(a,{format:i??o,alpha:r})}function Cv(e){if(T(de(e),_.inputString),ve(e))return $c(e);if(Object.keys(Fn).includes(e))return 1;let{alpha:r}=He(e);return r||1}function j5(e,r,i){return Tn("s","+")(e,r)}function R5(e,r={}){let{darkColor:i="#000000",lightColor:o="#ffffff",threshold:a=128}=r;T(de(e),_.inputString),T(a>=0&&a<=255,_.threshold);try{let{r:n,g:s,b:l}=br(Ce(e,"hex"));return(n*299+s*587+l*114)/1e3>=a?i:o}catch(n){return console.warn(`Invalid color input: ${e}`),console.warn(n),i}}function V5(e,r,i){T(de(e),_.inputString),T(nt(r),_.alpha),T(r>=-1&&r<=1,_.alpha);let o=Ce(e,"oklab"),a=ye(fr(Cv(e)-r,0,1));return pr(o,{format:i,alpha:a})}var L5=class{constructor(e,r={}){Cr(this,"alpha"),Cr(this,"hex"),Cr(this,"hsl"),Cr(this,"oklab"),Cr(this,"oklch"),Cr(this,"rgb"),Cr(this,"type"),T(!!e,"color is required");let{alpha:i,hex:o,hsl:a,oklab:n,oklch:s,rgb:l,type:u}=k5(e);this.hex=o,this.hsl=a,this.oklab=n,this.oklch=s,this.rgb=l,this.alpha=i,this.type=r.format??u}get css(){return this.selectedColor}get red(){return Number(this.rgb.r)}get green(){return Number(this.rgb.g)}get blue(){return Number(this.rgb.b)}get hue(){return Number(this.hsl.h)}get saturation(){return Number(this.hsl.s)}get lightness(){return Number(this.hsl.l)}get luminance(){return Js(this.selectedColor)}get chroma(){return $5(this.selectedColor)}get opacity(){return Cv(this.selectedColor)}get textColor(){return R5(this.selectedColor)}get selectedColor(){return pr(this[this.type],{format:this.type,alpha:this.alpha})}brightnessDifference(e){return xv(this.selectedColor,e)}colorDifference(e){return Ev(this.selectedColor,e)}compare(e){return M5(this.selectedColor,e)}contrast(e){return Dv(this.selectedColor,e)}format(e,r){return pr(this.rgb,{alpha:this.alpha,format:e,precision:r})}lighten(e){return z5(this.selectedColor,e)}darken(e){return N5(this.selectedColor,e)}saturate(e){return j5(this.selectedColor,e)}desaturate(e){return B5(this.selectedColor,e)}invert(){return T5(this.selectedColor)}opacify(e=.9){return O5(this.selectedColor,e,this.type)}rotate(e){return Av(this.selectedColor,e)}transparentize(e=.1){return V5(this.selectedColor,e,this.type)}};function Tc(e,r){let i=Ce(e,r);return pr(i,{format:r})}var zn=L5;const jr=e=>!(typeof e!="object"||!("h"in e)||!("s"in e)||!("l"in e)||!("unit"in e)||!("space"in e)||e.space!=="hsl"),dr=e=>typeof e!="object"||!("r"in e)||!("g"in e)||!("b"in e)||!("space"in e)||!("unit"in e)?!1:e.space==="srgb",Sv=e=>{if("r"in e&&"g"in e&&"b"in e){if(!("unit"in e))if(e.r<=1&&e.g<=1&&e.b<=1)e.unit="scalar";else{if(e.r>255&&e.g<=255&&e.b<=255)return;e.unit="8bit"}return"space"in e||(e.space="srgb"),e}},Fv=e=>{if("h"in e&&"s"in e&&"l"in e){if(!("unit"in e))if(e.r<=1&&e.g<=1&&e.b<=1)e.unit="scalar";else{if(e.s>100&&e.l<=100)return;e.unit="absolute"}return"space"in e||(e.space="hsl"),e}},ho=e=>typeof e!="object"||!("l"in e)||!("c"in e)||!("h"in e)||!("unit"in e)||!("space"in e)?!1:e.space==="lch"||e.space==="oklch",kv=e=>typeof e=="string"?!0:typeof e=="object"?!!(jr(e)||ho(e)||dr(e)):!1;function $v(e,r,i=1){let o=-1,a=-1;r<e?(o=r-e,a=i-(e-r)):(o=r-e,a=o-i);let n=a>0?a:o,s=a>0?o:a;if(Math.abs(o)<Math.abs(a)){let l=a;a=o,o=l}return{long:o,short:a,forward:n,backward:s}}function Mv(e){return e%=1,e<0?(1-Math.abs(e))%1:e}var Pv={};A(Pv,{absolute:()=>yo,changeLightness:()=>I5,fromCss:()=>Rr,fromHexString:()=>Hs,generateScalar:()=>W5,guard:()=>Pi,interpolator:()=>zc,parseCssHslFunction:()=>Bv,scalar:()=>Vr,toAbsolute:()=>Mi,toCssString:()=>po,toLibraryRgb:()=>Ho,toScalar:()=>ui,withOpacity:()=>Nv});const Nv=(e,r)=>{switch(e.unit){case"absolute":return{...e,opacity:r((e.opacity??100)/100,e)*100};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}},I5=(e,r)=>{let i=0;if(r.pdelta!==void 0)i=e.l+e.l*r.pdelta;else if(r.delta!==void 0)i=r.delta+e.l;else if(r.fixed!==void 0){if(r.fixed<0)throw TypeError("Cannot use negative value with 'fixed'");i=r.fixed}else throw TypeError("Parameter 'amount' is missing 'delta/pdelta/fixed' properties");return{...e,l:q5(e,i)}},q5=(e,r,i)=>(e.unit==="scalar"?r>1?r=1:r<0&&(r=0):r>100?r=100:r<0&&(r=0),r),_5=Object.freeze({h:0,s:0,l:0,opacity:0,unit:"absolute",space:"hsl"});function Hs(e,r={}){return On(Mc(e),r)}function Rr(e,r={}){if(e=e.toLowerCase(),e.startsWith("hsla("))throw Error("hsla() not supported");if(e.startsWith("rgba("))throw Error("rgba() not supported");if(e.startsWith("#"))return Hs(e,r);if(e.startsWith("--"))try{e=Lc(e)}catch(i){if(r.fallbackString!==void 0&&(e=r.fallbackString),r.fallbackColour!==void 0)return r.fallbackColour;throw i}if(e==="transparent")return _5;if(xt[e]!==void 0)return Hs(xt[e],r);if(e.startsWith("rgb(")){let i=Qo(e);return On(i,r)}if(!e.startsWith("hsl("))try{e=Tc(e,"hsl")}catch(i){if(r.fallbackString)e=r.fallbackString;else throw i}try{let i=Bv(e);return r.scalar?ui(i):Mi(i)}catch(i){if(r.fallbackColour)return r.fallbackColour;throw i}}const po=e=>{let r=Mi(e),i=`hsl(${r.h}deg ${r.s}% ${r.l}%`;return"opacity"in r&&r.opacity!==void 0&&r.opacity<100&&(i+=` / ${r.opacity}%`),i+=")",i};function On(e,r={}){if(e==null&&r.fallbackColour)return r.fallbackColour;let i=r.scalar??!0;return w(_e(e.h,0,360,"h"),_e(e.s,0,100,"s"),_e(e.l,0,100,"l"),tt(e.alpha??1,"alpha")),i?Vr(e.h/360,e.s/100,e.l/100,e.alpha??1):yo(e.h,e.s,e.l,(e.alpha??1)*100)}const Mi=e=>{if(typeof e=="string")return Rr(e,{scalar:!1});if(dr(e))return Mi(On(Qo(e),{scalar:!1}));let r=e;return Pi(r),r.unit==="absolute"?r:{h:r.h*360,s:r.s*100,l:r.l*100,opacity:(r.opacity??1)*100,unit:"absolute",space:"hsl"}},W5=(e,r=1,i=.5,o=1)=>{typeof e=="string"&&e.startsWith("--")&&(e=getComputedStyle(document.body).getPropertyValue(e).trim());let a=hn(e);if(r>1)throw TypeError("Param 'saturation' must be between 0..1");if(i>1)throw TypeError("Param 'lightness' must be between 0..1");if(o>1)throw TypeError("Param 'opacity' must be between 0..1");return{h:Iu(a,"deg").value/360,s:r,l:i,opacity:o,unit:"scalar",space:"hsl"}},ui=e=>{if(typeof e=="string")return Rr(e,{scalar:!0});if(dr(e))return ui(On(Qo(e),{scalar:!0}));let r=e;return Pi(r),r.unit==="scalar"?r:{h:r.h/360,s:r.s/100,l:r.l/100,opacity:(r.opacity??1)/100,unit:"scalar",space:"hsl"}},Pi=e=>{let{h:r,s:i,l:o,opacity:a,space:n,unit:s}=e;if(n!=="hsl")throw Error(`Space is expected to be 'hsl'. Got: ${n}`);if(s==="absolute")w(C(r,"finite","h"),_e(i,0,100,"s"),_e(o,0,100,"l"),()=>{if(typeof a=="number")return _e(a,0,100,"opacity")});else if(s==="scalar")w(C(r,"percentage","h"),C(i,"percentage","s"),C(o,"percentage","l"),()=>{if(typeof a=="number")return C(a,"percentage","opacity")});else throw Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${s}`)},zc=(e,r,i="shorter")=>{e=ui(e),r=ui(r);let o=e.opacity??1,a=$v(e.h,r.h,1),n=i==="longer"?a.long:a.short,s=r.s-e.s,l=r.l-e.l,u=(r.opacity??1)-o;return c=>{c=ie(c);let f=xe(c,0,Math.abs(n));f=n<0?e.h-f:e.h+f;let d=xe(c,0,s),h=xe(c,0,l),p=xe(c,0,u);return Vr(Mv(f),d+e.s,h+e.l,p+o)}};function Vr(e=.5,r=1,i=.5,o=1){let a={unit:"scalar",space:"hsl",h:e,s:r,l:i,opacity:o};return Pi(a),a}function yo(e=200,r=100,i=50,o=100){let a={unit:"absolute",space:"hsl",h:e,s:r,l:i,opacity:o};return Pi(a),a}function Bv(e){if(e.startsWith("hsla"))throw Error("hsla() is not supported");if(!e.startsWith("hsl("))throw Error("Expected hsl(..) CSS colour");let r=e.indexOf("("),i=e.indexOf(")");if(i<r)throw Error("Is hsl() not terminated? Missing ')'");let o=e.substring(r+1,i),a=o.split(/[\s,]+/);if(a.length<3)throw Error(`Expected three tokens. Got: ${a.length} length`);let n=!1;a[0].endsWith("%")&&(n=!0),a[1].endsWith("%")&&a[2].endsWith("%")&&(n=!0);let s=(u,c)=>{if(u==="none")return 0;if(u.endsWith("%"))return Number.parseFloat(u.substring(0,u.length-1))/100;u.endsWith("deg")&&c===0&&(u=u.substring(0,u.length-3));let f=Number.parseFloat(u);return c===0?f/360:c===3?f:f/100},l=(u,c)=>{if(u==="none")return 0;if(u.endsWith("%")){let d=Number.parseFloat(u.substring(0,u.length-1));return c===0?d*360:d}return u.endsWith("deg")&&c===0?Number.parseFloat(u.substring(0,u.length-3)):Number.parseFloat(u)};return a.length>3&&a[3]==="/"&&(a=[a[0],a[1],a[2],a[4]]),n?Vr(s(a[0],0),s(a[1],1),s(a[2],2),s(a[3]??"100%",3)):yo(l(a[0],0),l(a[1],1),l(a[2],2),l(a[3]??"100%",3))}function Ho(e){if(typeof e=="string"){let i=Rr(e,{scalar:!1});return Ho(i)}return e=Mi(e),{...ki({h:e.h,s:e.s,l:e.l}),alpha:(e.opacity??100)/100*255}}var Tv={};A(Tv,{OKLCH_CHROMA_MAX:()=>Ni,absolute:()=>jv,fromCss:()=>jn,fromHexString:()=>Ks,fromLibrary:()=>Va,generateScalar:()=>U5,guard:()=>Ur,interpolator:()=>jc,scalar:()=>Rc,toAbsolute:()=>Oc,toCssString:()=>zv,toScalar:()=>go,withOpacity:()=>Ov});const Ni=.4,Ur=e=>{let{l:r,c:i,h:o,opacity:a,space:n,unit:s}=e;if(n!=="oklch")throw Error(`Space is expected to be 'oklch'. Got: ${n}`);if(s==="absolute")w(tt(r,"l"),()=>{if(typeof i=="number")return _e(i,0,Ni,"c")},()=>{if(typeof o=="number")return _e(i,0,360,"h")},tt(a??1,"opacity"));else if(s==="scalar")w(tt(r,"l"),tt(i,"c"),tt(o,"h"),tt(e.opacity??1,"opacity"));else throw Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${s}`)};function Va(e,r={}){if(e==null&&r.fallbackColour)return r.fallbackColour;let i=r.scalar??!0;return w(tt(e.l,"l"),tt(e.c,"c"),_e(e.h,0,360,"h"),tt(e.alpha??1,"alpha")),i?Rc(e.l,e.c/Ni,e.h/360,e.alpha??1):jv(e.l,e.c,e.h,e.alpha??1)}const Ks=(e,r={})=>Va(Nc(e),r),G5=Object.freeze({l:0,c:0,h:0,opacity:0,unit:"absolute",space:"oklch"});function jn(e,r={}){if(e=e.toLowerCase(),e.startsWith("#"))return Ks(e,r);if(e==="transparent")return G5;if(xt[e]!==void 0)return Ks(xt[e],r);if(e.startsWith("rgb(")){let a=Jr(qc(e)),n=Jo({r:a.r,g:a.g,b:a.b});return Va(n,r)}if(!e.startsWith("hsl(")&&!e.startsWith("oklch("))try{e=Tc(e,"oklch")}catch(a){if(r.fallbackString)e=r.fallbackString;else throw a}let i=new zn(e),o=i.oklch;return Va(o,r)}const Oc=e=>typeof e=="string"?Oc(jn(e,{scalar:!0})):(Ur(e),e.unit==="absolute"?e:{space:"oklch",unit:"absolute",l:e.l,c:e.c*Ni,h:e.h*360,opacity:e.opacity}),go=e=>{if(typeof e=="string")return go(jn(e,{scalar:!0}));let r=e;return Ur(r),r.unit==="scalar"?r:{l:r.l,c:r.c/Ni,h:r.h/360,opacity:r.opacity??1,unit:"scalar",space:"oklch"}},zv=(e,r=3)=>{Ur(e);let{l:i,c:o,h:a,opacity:n}=e,s="";switch(e.unit){case"absolute":s=`oklch(${(i*100).toFixed(r)}% ${o.toFixed(r)} ${a.toFixed(r)}`;break;case"scalar":s=`oklch(${i.toFixed(r)} ${(o*Ni).toFixed(r)} ${(a*360).toFixed(r)}`;break}return n!==void 0&&n!==1&&(s+=` / ${n.toFixed(r)}`),s+=")",s},U5=(e,r=1,i=.5,o=1)=>{if(typeof e=="string"&&e.startsWith("--")&&(e=getComputedStyle(document.body).getPropertyValue(e).trim()),i>1)throw TypeError("Param 'lightness' must be between 0..1");if(r>1)throw TypeError("Param 'chroma' must be between 0..1");let a=hn(e),n=Iu(a,"deg").value/360;if(o>1)throw TypeError("Param 'opacity' must be between 0..1");return{l:i,c:r,h:n,opacity:o,unit:"scalar",space:"oklch"}},Ov=(e,r)=>{switch(e.unit){case"absolute":return{...e,opacity:r((e.opacity??100)/100,e)*100};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}},jc=(e,r,i="shorter")=>{e=go(e),r=go(r);let o=e.opacity??1,a=$v(e.h,r.h,1),n=i==="longer"?a.long:a.short,s=r.c-e.c,l=r.l-e.l,u=(r.opacity??1)-o;return c=>{c=ie(c);let f=xe(c,0,Math.abs(n));f=n<0?e.h-f:e.h+f;let d=xe(c,0,s),h=xe(c,0,l),p=xe(c,0,u);return Rc(h+e.l,d+e.c,Mv(f),p+o)}};function Rc(e=.7,r=.1,i=.5,o=1){let a={unit:"scalar",space:"oklch",l:e,c:r,h:i,opacity:o};return Ur(a),a}const jv=(e,r,i,o=1)=>{let a={space:"oklch",unit:"absolute",opacity:o,l:e,c:r,h:i};return Ur(a),a},Vc=e=>{if(e.startsWith("#"))return mo(e,!0);if(xt[e]!==void 0)return mo(xt[e],!0);if(e.startsWith("--")){let r=getComputedStyle(document.body).getPropertyValue(e).trim();if(r.length===0||r===null)throw Error(`Variable missing: ${e}`);return Vc(r)}if(e=e.toLowerCase(),e.startsWith("hsl("))return Rr(e,{scalar:!0});if(e.startsWith("rgb("))return Bi(e,{scalar:!0});if(e.startsWith("oklch("))return jn(e,{scalar:!0});throw Error(`String colour is not a hex colour, CSS variable nor well-defined colour. Input: '${e}'`)},Lc=(e,r)=>{if(e.startsWith("--")){let i=getComputedStyle(document.body).getPropertyValue(e).trim();if(i.length===0||i===null){if(r!==void 0)return r;throw Error(`CSS variable missing: '${e}'`)}return Lc(i)}return xt[e]===void 0?e:xt[e]},xt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"#00000000"};var Rv={};A(Rv,{changeLightness:()=>H5,eightBit:()=>Lv,fromCss:()=>Bi,fromHexString:()=>mo,guard:()=>Hr,interpolator:()=>_c,lightness:()=>K5,parseCssRgbFunction:()=>qc,scalar:()=>Ic,to8bit:()=>Jr,toCssString:()=>bo,toLibraryHsl:()=>Qo,toScalar:()=>ci,withOpacity:()=>Vv});const Vv=(e,r)=>{switch(e.unit){case"8bit":return{...e,opacity:r((e.opacity??255)/255,e)*255};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}};function mo(e,r=!0){return Ko(br(e),{scalar:r})}const J5=Object.freeze({r:0,g:0,b:0,opacity:0,unit:"8bit",space:"srgb"});function Bi(e,r={}){if(e=e.toLowerCase(),e.startsWith("hsla("))throw Error("hsla() not supported");if(e.startsWith("rgba("))throw Error("rgba() not supported");let i=r.scalar??!0;if(e.startsWith("#"))return mo(e,i);if(e==="transparent")return J5;if(xt[e]!==void 0&&mo(xt[e],i),e.startsWith("hsl(")){let o=Ho(e);return Ko(o,r)}if(!e.startsWith("rgb("))try{e=Tc(e,"rgb")}catch(o){if(r.fallbackString)e=r.fallbackString;else throw o}try{let o=qc(e);return i?ci(o):Jr(o)}catch(o){if(r.fallbackColour)return r.fallbackColour;throw o}}const bo=e=>{switch(Hr(e),e.unit){case"8bit":return e.opacity===void 0||e.opacity===255?`rgb(${e.r} ${e.g} ${e.b})`:`rgb(${e.r} ${e.g} ${e.b} / ${(e.opacity??255)/255})`;case"scalar":return e.opacity===void 0||e.opacity===1?`rgb(${e.r*100}% ${e.g*100}% ${e.b*100}%)`:`rgb(${e.r*100}% ${e.g*100}% ${e.b*100}% / ${(e.opacity??1)*100}%)`;default:throw Error(`Unknown unit: ${e.unit}`)}};function Ko(e,r={}){return r.scalar?{r:e.r/255,g:e.g/255,b:e.b/255,opacity:e.alpha??1,unit:"scalar",space:"srgb"}:{r:e.r,g:e.g,b:e.b,opacity:e.alpha??255,unit:"8bit",space:"srgb"}}const Jr=e=>typeof e=="string"?Bi(e,{scalar:!1}):jr(e)?Jr(Ko(Ho(e),{scalar:!1})):(Hr(e),e.unit==="8bit"?e:{r:e.r*255,g:e.g*255,b:e.b*255,opacity:(e.opacity??1)*255,unit:"8bit",space:"srgb"}),ci=e=>typeof e=="string"?Bi(e,{scalar:!0}):jr(e)?ci(Ko(Ho(e),{scalar:!0})):(Hr(e),e.unit==="scalar"?e:{r:e.r/255,g:e.g/255,b:e.b/255,opacity:(e.opacity??1)/255,unit:"scalar",space:"srgb"}),Hr=e=>{let{r,g:i,b:o,opacity:a,space:n,unit:s}=e;if(n!=="srgb")throw Error(`Space is expected to be 'srgb'. Got: ${n}`);if(s==="8bit")w(_e(r,0,255,"r"),_e(i,0,255,"g"),_e(o,0,255,"b"),()=>{if(typeof a=="number")return _e(a,0,255,"opacity")});else if(s==="scalar")w(C(r,"percentage","r"),C(i,"percentage","g"),C(o,"percentage","b"),()=>{if(typeof a=="number")return C(a,"percentage","opacity")});else throw Error(`Unit is expected to be '8bit' or 'scalar'. Got: ${s}`)},H5=(e,r)=>{let i=0,o=new zn(bo(e)),a=e.unit==="scalar";if(r.pdelta!==void 0)i=o.oklab.l+o.oklab.l*r.pdelta;else if(r.delta!==void 0)i=o.oklab.l+r.delta;else if(r.fixed!==void 0){if(r.fixed<0)throw TypeError("Amount cannot be negative when using 'fixed'");i=r.fixed}else throw TypeError("Parameter 'amount' is missing 'pdelta/delta/fixed' properties");i<0?i=0:i>1&&(i=1);let n=$i({a:o.oklab.a,b:o.oklab.b,l:i,alpha:o.oklab.alpha});return Ko(n,{scalar:a})};function K5(e){return new zn(bo(e)).oklab.l}function Lv(e=100,r=100,i=100,o=255){let a={unit:"8bit",space:"srgb",r:e,g:r,b:i,opacity:o};return Hr(a),a}function Ic(e=.5,r=.5,i=.5,o=1){let a={unit:"scalar",space:"srgb",r:e,g:r,b:i,opacity:o};return Hr(a),a}function qc(e){if(e.startsWith("rgba"))throw Error("RGBA is not supported");if(!e.startsWith("rgb("))throw Error("Expected rgb(..) CSS colour");let r=e.indexOf("("),i=e.indexOf(")");if(i<r)throw Error("Is rgb() not terminated? Missing ')'");let o=e.substring(r+1,i),a=o.split(/[\s,]+/);if(a.length<3)throw Error(`Expected three tokens. Got: ${a.length} length`);let n=0;for(let u of a)u.endsWith("%")&&n++;let s=(u,c)=>u.endsWith("%")?Number.parseFloat(u.substring(0,u.length-1))/100:c<3?Number.parseFloat(u)/255:Number.parseFloat(u),l=(u,c)=>u.endsWith("%")?Number.parseFloat(u.substring(0,u.length-1))/100*255:c<3?Number.parseFloat(u):Number.parseFloat(u)*255;return a.length>3&&a[3]==="/"&&(a=[a[0],a[1],a[2],a[4]]),n>1?Ic(s(a[0],0),s(a[1],1),s(a[2],2),s(a[3]??"1",3)):Lv(l(a[0],0),l(a[1],1),l(a[2],2),l(a[3]??"1",3))}const _c=(e,r)=>{let i=ci(e),o=ci(r),a=i.opacity??1,n=(o.opacity??1)-a,s=o.r-i.r,l=o.g-i.g,u=o.b-i.b;return c=>(c=ie(c),Ic(i.r+xe(c,0,s),i.g+xe(c,0,l),i.b+xe(c,0,u),a+xe(c,0,n)))};function Qo(e){if(typeof e=="string"){let i=Bi(e,{scalar:!1});return Qo(i)}return e=Jr(e),{...Fi({r:e.r,g:e.g,b:e.b}),alpha:(e.opacity??255)/255}}var Iv={};A(Iv,{accessor:()=>Zo,byColumn:()=>X5,byRow:()=>Z5,grid:()=>Kr,setter:()=>Wc,wrap:()=>Q5});const Kr=e=>({rows:e.width,cols:e.height}),Q5=e=>({...Kr(e),get:Zo(e),set:Wc(e)}),Zo=e=>{let r=Kr(e),i=e.data;return(a,n="undefined")=>{let s=Ci(r,a,n);if(s===void 0)return;let l=s*4;return{r:i[l],g:i[l+1],b:i[l+2],opacity:i[l+3],unit:"8bit",space:"srgb"}}},Wc=e=>{let r=Kr(e),i=e.data;return(a,n,s="undefined")=>{let l=Ci(r,n,s);if(l===void 0)throw Error(`Cell out of range. ${n.x},${n.y}`);let u=Jr(a),c=l*4;i[c]=u.r,i[c+1]=u.g,i[c+2]=u.b,i[c+3]=u.opacity??255}};function*Z5(e){let r=Zo(e),i=Kr(e),o=_m(i,{x:0,y:0});for(let a of o)yield a.map(s=>r(s,"undefined"))}function*X5(e){let r=Zo(e),i=Kr(e);for(let o=0;o<i.cols;o++){let a=[];for(let n=0;n<i.rows;n++){let s=r({x:o,y:n},"undefined");s&&a.push(s)}yield a}}var Y5=class extends Ze{el;opts;#e;#t;#r=sn;#i=nn;#o;#a;#n;#l=!1;constructor(e,r={}){if(super(),!e)throw Error("Param 'domQueryOrEl' is null or undefined");if(this.el=U(e),this.el.nodeName!=="CANVAS")throw Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);let i=this.el.getBoundingClientRect();this.opts={resizeLogic:r.resizeLogic??"none",disablePointerEvents:r.disablePointerEvents??!1,pixelZoom:r.pixelZoom??(window.devicePixelRatio||1),height:r.height??i.height,width:r.width??i.width,zIndex:r.zIndex??-1,coordinateScale:r.coordinateScale??"both",onResize:r.onResize,clearOnResize:r.clearOnResize??!0,draw:r.draw,skipCss:r.skipCss??!1,colourSpace:"srgb"},this.#e=Xi("both"),this.#t=Xi("both",i),this.#c()}getRectangle(){return{x:0,y:0,...this.#i}}dispose(e){this.#l||(this.#l=!0,this.#n&&(this.#n.dispose(`CanvasHelper disposing ${e}`.trim()),this.#n=void 0))}#s(e=!1){if(this.#o===void 0||e){let r=this.ratio,i=this.el.getContext("2d");if(i===null)throw Error("Could not create drawing context");this.#o=i,i.setTransform(1,0,0,1,0,0),i.scale(r,r)}return this.#o}getPhysicalSize(){return{width:this.width*this.ratio,height:this.height*this.ratio}}getDrawHelper(){this.#a||=sv(this.#s(),{width:this.width,height:this.height})}setLogicalSize(e){ft(e,"logicalSize");let r=oy(n=>Math.floor(n),e),i=this.opts.pixelZoom;this.#e=Xi(this.opts.coordinateScale,e),this.#t=Xi("both",e);let o=yy(e,i);this.el.width=o.width,this.el.height=o.height,this.el.style.width=r.width.toString()+"px",this.el.style.height=r.height.toString()+"px",this.#s(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#i=r;let a=this.opts.onResize;a&&setTimeout(()=>{a(this.ctx,this.size,this)},100),this.fireEvent("resize",{ctx:this.ctx,size:this.#i,helper:this})}#c(){let e=this.opts.draw;if(e){let i=()=>{e(this.ctx,this.#i,this),requestAnimationFrame(i)};setTimeout(()=>{i()},100)}if(this.opts.disablePointerEvents||this.#u(),(this.opts.resizeLogic??"none")==="none")this.setLogicalSize({width:this.opts.width,height:this.opts.height});else{let i={onSetSize:o=>{dy(this.#i,o)||this.setLogicalSize(o)},naturalSize:{width:this.opts.width,height:this.opts.height},stretch:this.opts.resizeLogic??"none"};this.#n=new fo(this.el,i)}this.#s()}#u(){let e=r=>{let{offsetX:i,offsetY:o}=r,a=i*this.ratio,n=o*this.ratio;r=wd(r);let s={physicalX:a,physicalY:n,...r};switch(r.type){case"pointerup":this.fireEvent("pointerup",s);break;case"pointermove":this.fireEvent("pointermove",s);break;case"pointerdown":this.fireEvent("pointerup",s);break}};this.el.addEventListener("pointermove",e),this.el.addEventListener("pointerdown",e),this.el.addEventListener("pointerup",e)}clear(){this.#o&&this.#o.clearRect(0,0,this.width,this.height)}fill(e){this.#o&&(e&&(this.#o.fillStyle=e),this.#o.fillRect(0,0,this.width,this.height))}get ctx(){if(this.#o===void 0)throw Error("Context not available");return this.#s()}get viewport(){return this.#r}get width(){return this.#i.width}get height(){return this.#i.height}get size(){return this.#i}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}drawBounds(e="green"){let r=this.#s();Oa(r,{x:0,y:0,width:this.width,height:this.height},{crossed:!0,strokeStyle:e,strokeWidth:1}),Oa(r,this.#r,{crossed:!0,strokeStyle:"silver",strokeWidth:3})}get toRelative(){return this.#e.rel}get toAbsoluteFixed(){return this.#t.abs}get toRelativeFixed(){return this.#t.rel}get logicalCenter(){return{x:this.#i.width/2,y:this.#i.height/2}}get toAbsolute(){return this.#e.abs}get center(){return{x:this.width/2,y:this.height/2}}getImageData(){let e=this.getPhysicalSize(),r=this.ctx.getImageData(0,0,e.width,e.height,{colorSpace:this.opts.colourSpace});if(r==null)throw Error("Could not get image data from context");return r}getWritableBuffer(){let e=this.ctx,r=this.getImageData(),i=Kr(r),o=Zo(r),a=Wc(r);return{grid:i,get:o,set:a,flip:()=>{e.putImageData(r,0,0)}}}};const e$=(e,r)=>{r.fillStyle&&e.setAttributeNS(null,"fill",r.fillStyle),r.opacity&&e.setAttributeNS(null,"opacity",r.opacity.toString())},t$=(e,r,i,o)=>{let a=null;if(i!==void 0&&(a=typeof i=="string"?e.querySelector(i):i),a===null){let n=document.createElementNS("http://www.w3.org/2000/svg",r);return e.append(n),i&&typeof i=="string"&&i.startsWith("#")&&(n.id=i.slice(1)),n}return a},qv=(e,r=.5,i=.75,o=1)=>{w(C(e,"positive","index"),C(r,"percentage","saturation"),C(i,"percentage","lightness"),C(o,"percentage","alpha"));let a=e*137.508,n=a%360/360;return po(Vr(n,r,i,o))},r$=(e=Math.random)=>e()*360;function fi(e,r){return _v(e,i=>ie(i*r))}function _v(e,r){let i=Xo(e),o;switch(i.space){case"hsl":o=Nv(i,r);break;case"srgb":o=Vv(i,r);break;case"oklch":o=Ov(i,r);break;default:throw Error(`Unknown space: '${i.space}'. Expected hsl, srgb, oklch`)}if(!o)throw Error("Is colour in correct form?");return typeof e=="string"?Me(o):o}function i$(e,r){let i=Xo(e);return i.opacity=r,typeof e=="string"?Me(i):i}function o$(e,r="hsl"){if(!Array.isArray(e))throw Error(`Param 'colours' is not an array as expected. Got: ${typeof e}`);if(e.length<2)throw Error(`Param 'colours' should be at least two in length. Got: ${e.length}`);let i=e.map(o=>La(o,r));return[...pd(i)]}const a$=e=>`linear-gradient(to right, ${e.map(i=>Me(i)).join(", ")})`,n$=(e,r,i={})=>{let o=i.space??"oklch",a=i.direction??"shorter",n;switch(o){case"hsl":n=zc(rt(e,"hsl-scalar"),rt(r,"hsl-scalar"),a);break;case"srgb":n=_c(rt(e,"srgb-scalar"),rt(r,"srgb-scalar"));break;default:n=jc(rt(e,"oklch-scalar"),rt(r,"oklch-scalar"),a)}return s=>Me(n(s))},s$=(e,r={})=>{let i=r.direction??"shorter",o=r.space??"oklch",a=o$(e,o),n=0;if(typeof r.stepsBetween=="number"){if(n=r.stepsBetween,n<1)throw Error("Param 'stepsBetween' must be at least 1")}else if(typeof r.stepsTotal=="number"){if(r.stepsTotal<=e.length)throw Error(`Param 'stepsTotal' must be greater than number of provided colour stops (${e.length}) +1 per stop`);let u=r.stepsTotal-e.length;n=Math.floor(u/a.length)}let s=a.map(u=>{let c=Wv(u[0],u[1],{steps:n,space:o,direction:i,exclusive:!0});return c.push(u[1]),c}),l=a[0];return s.unshift([l[0]]),s.flat().map(u=>Me(u))};function Wv(e,r,i={}){let o=i.exclusive??!1,a=i.steps??5,n=i.space??"oklch",s=i.direction??"shorter";if(!o&&a<2)throw Error("Param 'steps' should be at least 2 when 'exclusive' is false");if(o&&a<1)throw Error("Param 'steps' should be at least 1 when 'exlusive' is true");let l=La(e,n),u=La(r,n),c;switch(n){case"hsl":c=zc(l,u,s);break;case"oklch":c=jc(l,u,s);break;case"srgb":c=_c(l,u);break;default:throw Error(`Colour space '${n}' not supported for interpolation.`)}if(!c)throw Error(`Could not create interpolator for space: ${n}`);let f=0,d=0,h=1;o?(f=1/(a+1),d=f,h=1-f):f=1/(a-1);let p=[];for(let y=d;y<=h;y+=f)p.push(c(y));return p}var Gc={};A(Gc,{HslSpace:()=>Pv,OklchSpace:()=>Tv,SrgbSpace:()=>Rv,convert:()=>rt,convertScalar:()=>La,convertToString:()=>l$,createSteps:()=>Wv,cssDefinedHexColours:()=>xt,cssLinearGradient:()=>a$,fromCssColour:()=>Vc,goldenAngleColour:()=>qv,guard:()=>Gv,interpolator:()=>n$,isColourish:()=>kv,isHsl:()=>jr,isOkLch:()=>ho,isRgb:()=>dr,multiplyOpacity:()=>fi,randomHue:()=>r$,resolveCss:()=>Lc,rgbToHsl:()=>c$,scale:()=>s$,setOpacity:()=>i$,toColour:()=>Xo,toCssColour:()=>Me,toLibraryColour:()=>u$,toStringFirst:()=>ei,tryParseObjectToHsl:()=>Fv,tryParseObjectToRgb:()=>Sv,withOpacity:()=>_v});function rt(e,r){if(r==="hsl-scalar"){if(typeof e=="string"||jr(e)||dr(e))return ui(e)}else if(r==="hsl-absolute"){if(typeof e=="string"||jr(e))return Mi(e)}else if(r==="oklch-scalar"){if(typeof e=="string"||ho(e))return go(e)}else if(r==="oklch-absolute"){if(typeof e=="string"||ho(e))return Oc(e)}else if(r==="srgb-8bit"){if(typeof e=="string"||dr(e))return Jr(e)}else if(r==="srgb-scalar"){if(typeof e=="string"||dr(e))return ci(e)}else throw Error(`Destination '${r}' not supported for input: ${JSON.stringify(e)}`);return rt(Me(e),r)}function l$(e,r){let i=rt(e,r);return Me(i)}function La(e,r){if(r==="oklch")return rt(e,"oklch-scalar");if(r==="srgb")return rt(e,"srgb-scalar");if(r==="hsl")return rt(e,"hsl-scalar");throw Error(`Unknown destination: '${r}'`)}const Me=e=>{if(typeof e=="string")return e;if(jr(e))return po(e);if(dr(e))return bo(e);if(ho(e))return zv(e);let r=Sv(e);if(r)return bo(r);let i=Fv(e);if(i)return po(i);throw Error(`Unknown colour format: '${JSON.stringify(e)}'`)},u$=e=>{let r=Me(e);return new zn(r)},Gv=e=>{switch(e.space){case"hsl":Pi(e);break;case"srgb":Hr(e);break;case"oklch":Ur(e);break;default:throw Error(`Unsupported colour space: '${e.space}'`)}},Xo=e=>{if(!kv(e))throw Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc. Got: ${JSON.stringify(e)}`);let r;if(r=typeof e=="string"?Vc(e):e,r===void 0)throw Error("Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc.");return Gv(r),r},ei=(...e)=>{for(let r of e)if(r!=null)try{let i=Xo(r);return Me(i)}catch{}return"rebeccapurple"};function c$(e,r){let{r:i,g:o,b:a}=e,n=e.opacity??1;e.unit==="8bit"&&(i/=255,o/=255,a/=255);let s=Math.max(i,o,a),l=Math.min(i,o,a),u=(s+l)/2,c=u,f=u;if(s===l)return r?Vr(0,0,0,n):yo(0,0,0,n);let d=s-l;switch(c=f>=.5?d/(2-(s+l)):d/(s+l),s){case i:u=((o-a)/d+0)*60;break;case o:u=((a-i)/d+2)*60;break;case a:u=((i-o)/d+4)*60;break}return r?Vr(u/360,c,f,n):yo(u,c*100,f*100,n)}const f$=(e,r)=>{r.strokeStyle&&e.setAttributeNS(null,"stroke",r.strokeStyle),r.strokeWidth&&e.setAttributeNS(null,"stroke-width",r.strokeWidth.toString()),r.strokeDash&&e.setAttribute("stroke-dasharray",r.strokeDash),r.strokeLineCap&&e.setAttribute("stroke-linecap",r.strokeLineCap)},d$=(e,r,i)=>(e.setAttributeNS(null,"cx",r.x.toString()),e.setAttributeNS(null,"cy",r.y.toString()),e.setAttributeNS(null,"r",r.radius.toString()),i&&e$(e,i),i&&f$(e,i),e),ed=(e,r,i,o)=>{let a=t$(r,"circle",o);return d$(a,e,i)},h$=(e,r={})=>{let i=r.touchRadius??45,o=r.touchRadius??20,a=r.trace??!1,n=r.hue??100,s=`hsla(${n}, 100%, 10%, 10%)`,l=n,u=U(e),c=new Uu({storeIntermediate:a}),f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.id="pointerVis",f.style.zIndex="-1000",f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.width="100%",f.style.height="100%",f.style.boxSizing="border-box",f.style.border="3px solid red",f.style.pointerEvents="none",f.style.touchAction="none",fo.svgViewport(f);let d=0,h=y=>{let g=y.pointerId.toString();c.delete(g),l=n,f.querySelector(`#pv-start-${g}`)?.remove();for(let m=0;m<d+10;m++)f.querySelector(`#pv-progress-${g}-${m}`)?.remove();d=0},p=async y=>{let g=y.pointerId.toString(),m={x:y.x,y:y.y},v=y.pointerType;if(y.type==="pointermove"&&!c.has(g))return;let D=await c.seen(y.pointerId.toString(),{x:y.clientX,y:y.clientY});if(D.values.length===1){let x=ed({...D.values[0],radius:v==="touch"?i:o},f,{fillStyle:s},`#pv-start-${g}`);x.style.pointerEvents="none",x.style.touchAction="none"}let B=`hsla(${l}, 100%, 50%, 50%)`,V=ed({...m,radius:v==="touch"?i:o},f,{fillStyle:B},`#pv-progress-${g}-${D.values.length}`);V.style.pointerEvents="none",V.style.touchAction="none",l+=1,d=D.values.length};document.body.append(f),u.addEventListener("pointerdown",p),u.addEventListener("pointermove",p),u.addEventListener("pointerup",h),u.addEventListener("pointerleave",h),u.addEventListener("contextmenu",y=>{y.preventDefault()})};var Uv={};A(Uv,{create:()=>p$});const p$=e=>new y$(e);var y$=class{#e=new Map;#t=new Map;fallbacks;#r=0;#i;constructor(e){e===void 0?this.fallbacks=["red","blue","green","orange"]:this.fallbacks=e,this.#i=document.body}setElementBase(e){this.#i=e}add(e,r){this.#e.set(e,r)}alias(e,r){this.#t.set(e,r)}get(e,r){let i=this.#t.get(e);i!==void 0&&(e=i);let o=this.#e.get(e);if(o!==void 0)return o;let a="--"+e,n=getComputedStyle(this.#i).getPropertyValue(a).trim();if(n===void 0||n.length===0){if(r!==void 0)return r;n=this.fallbacks[this.#r],this.#r++,this.#r===this.fallbacks.length&&(this.#r=0)}return n}getOrAdd(e,r){if(this.has(e))return this.get(e);let i=this.get(e,r);return this.add(e,i),i}has(e){return this.#e.has(e)}},Uc={};A(Uc,{capture:()=>m$,frames:()=>g$,manualCapture:()=>Jv});async function*g$(e,r={}){let i=r.maxIntervalMs??0,o=r.showCanvas??!1,a=r.canvasEl,n,s;n=s=0,a===void 0&&(a=document.createElement("CANVAS"),a.classList.add("ixfx-frames"),o||(a.style.display="none"),document.body.appendChild(a));let l=()=>{a!==void 0&&(n=e.videoWidth,s=e.videoHeight,a.width=n,a.height=s)},u=null,c=Wy(i);for await(let f of c){if((n===0||s===0)&&l(),n===0||s===0)continue;if(u??=a.getContext("2d"),u===null)return;u.drawImage(e,0,0,n,s),yield u.getImageData(0,0,n,s)}}const m$=(e,r={})=>{let i=r.maxIntervalMs??0,o=r.showCanvas??!1,a=r.onFrame,n=e.videoWidth,s=e.videoHeight,l=document.createElement("CANVAS");l.classList.add("ixfx-capture"),o||(l.style.display="none"),l.width=n,l.height=s;let u=null,c;r.workerScript&&(c=new Worker(r.workerScript));let f=c||a;!f&&!o&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");let d=Yt(()=>{if(u===null&&(u=l.getContext("2d")),u===null)return;u.drawImage(e,0,0,n,s);let h;if(f&&(h=u.getImageData(0,0,n,s)),c&&c.postMessage({pixels:h.data.buffer,width:n,height:s,channels:4},[h.data.buffer]),a)try{a(h)}catch(p){console.error(p)}},i);return{start:()=>{d.start()},cancel:()=>{d.cancel()},canvasEl:l}},Jv=(e,r={})=>{let i=r.showCanvas??!1,o=e.videoWidth,a=e.videoHeight,n=r.canvasEl!==void 0,s=r.canvasEl;return s||(s=document.createElement("CANVAS"),s.classList.add("ixfx-capture"),document.body.append(s),i||(s.style.display="none")),s.width=o,s.height=a,{canvasEl:s,capture:()=>{let f;if(f||=s.getContext("2d",{willReadFrequently:!0}),!f)throw Error("Could not create graphics context");f.drawImage(e,0,0,o,a);let d=f.getImageData(0,0,o,a);return d.currentTime=e.currentTime,r.postCaptureDraw&&r.postCaptureDraw(f,o,a),d},dispose:()=>{if(!n)try{s.remove()}catch{}}}};var Hv={};A(Hv,{init:()=>b$});function td(e,r,i){let o=e.getAttribute(r);return o===null?i:Number.parseInt(o)}const b$=(e,r={})=>{let i=document.querySelector(e);if(!i)throw Error(`Element query could not be found (${e})`);let o=r.labels??["x","y"],a=r.labelPrecision??2,n=r.asPercentages??!1,s=r.displayLastValues??0,l=r.showWhiskers??!0,u=r.showDot??!0,c=r.showLabels??!0,f=r.yAxisBottomNegative??!0,d=ei(r.axisColour,"silver"),h=ei(r.bgColour,"white"),p=ei(r.whiskerColour,"black"),y=ei(r.dotColour,r.whiskerColour,"black"),g=ei(r.labelColour,r.axisColour,"silver"),m=r.axisWidth??1*window.devicePixelRatio,v=r.dotRadius??5*window.devicePixelRatio,D=r.padding??10*window.devicePixelRatio,B=r.whiskerSize??5*window.devicePixelRatio,V=r.width??td(i,"width",200)*window.devicePixelRatio,x=r.height??td(i,"height",200)*window.devicePixelRatio,k;s>0&&(k=new tn({capacity:s,discardPolicy:"older"})),i.width=V,i.height=x,i.style.width=`${V/window.devicePixelRatio}px`,i.style.height=`${x/window.devicePixelRatio}px`;let M=x/2,P=V/2,$=i.getContext("2d");if(!$)throw Error("Could not create drawing context");window.devicePixelRatio>=2&&($.font="20px sans-serif");let te=J=>`${Math.round(J*100)}%`,le=J=>J.toFixed(a),be=n?te:le;c?(o[0]+=":",o[1]+=":"):(o[0]="",o[1]="");let Ue=r.renderBackground??((J,Te,tr)=>{r.bgColour==="transparent"?J.clearRect(0,0,Te,tr):(J.fillStyle=h,J.fillRect(0,0,Te,tr))});return(J,Te)=>{J=$r(J),Te=$r(Te),Ue($,V,x),$.fillStyle=g,$.textBaseline="top",$.save(),$.translate(P,M),$.rotate(-Math.PI/2),$.fillText((o[1]+" "+be(Te)).trim(),-P+D,1),$.restore(),$.fillText((o[0]+" "+be(J)).trim(),D,P+2),f||(Te*=-1),$.strokeStyle=d,$.lineWidth=m,$.beginPath(),$.moveTo(D,M),$.lineTo(V-D,M),$.moveTo(P,D),$.lineTo(P,x-D),$.stroke(),$.closePath();let tr=(x-D-D)/2*-Te,Oi=(V-D-D)/2*J,ji={x:Oi,y:tr,radius:v};if(k&&=k.enqueue(ji),$.save(),$.translate(P,M),u)if(k){let Gn=1/k.length,ra=1;k.forEach(Un=>{let Jn=fi(y,ra);za($,Un,{fillStyle:Jn}),ra-=Gn})}else za($,ji,{fillStyle:y});l&&($.strokeStyle=p,$.beginPath(),$.moveTo(0,tr-B),$.lineTo(0,tr+B),$.moveTo(Oi-B,0),$.lineTo(Oi+B,0),$.stroke(),$.closePath()),$.restore()}},Qs=e=>{let r=e.map(c=>c.x),i=e.map(c=>c.y),o=Math.min(...r),a=Math.max(...r),n=Math.min(...i),s=Math.max(...i),l=a-o,u=s-n;return{min:{x:o,y:n},max:{x:a,y:s},width:l,height:u,minDim:Math.min(l,u),maxDim:Math.max(l,u)}},Kv=e=>{if(!Number.isFinite(e.height))return o=>o;let r=Pt(e.min.x,e.max.x),i=Pt(e.min.y,e.max.y);return o=>({x:r(o.x),y:i(o.y)})},Qv=e=>{let r=Pt(0,1,e.min.x,e.max.x),i=Pt(0,1,e.min.y,e.max.y);return o=>({x:r(o.x),y:i(o.y)})},Zv=(e,r,i)=>{let o=[],a=0;for(let s=e.min.x;s<e.max.x;s+=r){let l=a%i===0;o.push({x:s,y:0,major:l}),a++}a=0;let n=[];for(let s=e.min.y;s<e.max.y;s+=r){let l=a%i===0;n.push({x:0,y:s,major:l}),a++}return{x:o,y:n}};var Xv=class{#e;#t;lastChange;constructor(){this.lastChange=performance.now(),this.#e=new nu,this.#t=new Map}get metaCount(){return this.#t.size}clear(){this.#e.clear(),this.lastChange=performance.now()}set(e,r){this.#e.setValues(e,r)}deleteBySeries(e){let r=this.#e.delete(e);return r&&(this.lastChange=performance.now()),r}setMeta(e,r){this.#t.set(e,r)}hasMeta(e){return this.#t.has(e)}getMeta(e){return this.#t.get(e)}*getValues(){yield*this.#e.valuesFlat()}*getEntries(){yield*this.#e.entries()}*getSeries(){yield*this.#e.values()}add(e,r="default"){this.#e.addKeyedValues(r,e),this.lastChange=performance.now()}};const v$=Math.PI*2;var w$=class{#e;#t;#r;#i;#o;#a;#n=[];constructor(e,r="min"){this.#e=U(e),this.#r=r,this.#a=window.devicePixelRatio||1,this.#i=this.#l(),this.#o=this.setLogicalSize({width:this.#e.width,height:this.#e.height})}setLogicalSize(e){this.#o=e;let r=this.#e;return r.width=e.width*this.#a,r.height=e.height*this.#a,r.style.width=`${e.width.toString()}px`,r.style.height=`${e.height.toString()}px`,this.#i=this.#l(),this.invalidateContext(),e}#l(){let e=1;switch(this.#r){case"min":e=Math.min(this.#e.width,this.#e.height);break;case"max":e=Math.max(this.#e.width,this.#e.height);break}let r=bp(0,e,0,1);return{abs:r.in,rel:r.out}}invalidateContext(){this.#t=void 0}#s(e){if(!e)throw Error("Param 'region' is undefined/null");if(this.#n.includes(e))throw Error("Region already exists");return this.#n.push(e),e}toAbsPoint(e,r="independent"){let{x:i,y:o}=e;switch(r){case"independent":i*=this.width,o*=this.height}return{x:i,y:o}}get offset(){let e=this.#e.getBoundingClientRect();return{x:e.left,y:e.top}}toRelPoint(e,r,i="independent",o=!0){let{x:a,y:n}=e;if(r==="screen"){let s=this.#e.getBoundingClientRect();a-=s.x,n-=s.y}switch(i){case"independent":a/=this.width,n/=this.height;break}return o&&(a=ie(a),n=ie(n)),{x:a,y:n}}toAbsRect(e,r="independent"){let{width:i,height:o}=e;switch(r){case"independent":if(i*=this.width,o*=this.height,vt(e))return{...this.toAbsPoint(e),width:i,height:o}}return{width:i,height:o}}createRegion(e){let r=e.marginPx??0,i=r*2;if("absPositioned"in e){let o=My(e.absPositioned,r,r);return this.#s(new ua(this,()=>o))}if("relativePositioned"in e){let o,a=e.relativePositioned;switch(e.scale){case"independent":o=n=>({x:a.x*n.width+r,y:a.y*n.height+r,width:a.width*n.width-i,height:a.height*n.height-i});break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#s(new ua(this,o))}if("relativeSize"in e){let o,a=e.relativeSize,n=e.position;switch(e.scale){case"independent":o=s=>{let l=a.width*s.width-i,u=a.height*s.height-i,c=s.width/2-l/2,f=s.height/2-u/2;switch(n){case"n":f=0;break;case"s":f=s.height-u;break}return c+=r,f+=r,{width:l,height:u,x:c,y:f}};break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#s(new ua(this,o))}if("match"in e){let o=fu(e.match);if(!o.success)throw Error(`Could not resolve match element. ${el(o)}`);let a=n=>{let s=o.value.getBoundingClientRect();return{x:s.x+r,y:s.y+r,width:s.width-i,height:s.height-i}};return this.#s(new ua(this,a))}throw Error("Spec doesn't seem valid")}clear(){this.context.clearRect(0,0,this.width,this.height)}get context(){if(this.#t)return this.#t;let e=this.#e.getContext("2d");if(!e)throw Error("Could not create 2d context");e.setTransform(1,0,0,1,0,0),e.scale(this.#a,this.#a),this.#t=e;for(let r of this.#n)r.recomputeRegion();return this.#t}get sizeScaler(){return this.#i}get width(){return this.#o.width}get height(){return this.#o.height}},ua=class{source;#e;#t;constructor(e,r){this.source=e,this.#e=r,this.#t=r(e)}recomputeRegion(){this.#t=this.#e(this.source)}toAbsRegion(e,r="both"){switch(r){case"both":return{x:e.x*this.#t.width,y:e.y*this.#t.height}}}applyRegionOffset(e){return{x:e.x+this.#t.x,y:e.y+this.#t.y}}drawConnectedPointsRelative(e,r,i=1){let o=e.map(a=>this.toAbsRegion(a));this.drawConnectedPoints(o,r,i)}drawConnectedPoints(e,r,i=1){let o=this.context;o.save(),o.translate(this.#t.x,this.#t.y),o.beginPath(),o.strokeStyle=r,o.lineWidth=i;for(let a=0;a<e.length;a++)a===0?o.moveTo(e[a].x,e[a].y):o.lineTo(e[a].x,e[a].y);o.stroke(),o.restore()}fillTextRelative(e,r,i="black",o,a="alphabetic",n="start"){let s=this.toAbsRegion(r);this.fillTextRelative(e,s,i,o,a,n)}fillText(e,r,i="black",o,a="alphabetic",n="start"){let s=this.context;s.save(),s.translate(this.#t.x,this.#t.y),o.length>0&&(s.font=o),s.textBaseline=a,s.textAlign=n,s.fillStyle=i,s.fillText(e,r.x,r.y),s.restore()}drawCircles(e,r,i="",o=1){let a=e.map(s=>({...this.toAbsRegion(s),radius:this.source.sizeScaler.abs(s.radius)})),n=this.context;n.save(),n.translate(this.#t.x,this.#t.y),n.fillStyle=r,n.strokeStyle=i,n.lineWidth=o;for(let s of a)n.beginPath(),n.arc(s.x,s.y,s.radius,0,v$),n.closePath(),r.length>0&&n.fill(),i.length>0&&n.stroke();n.restore()}clear(){this.context.clearRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}fill(e="white"){let r=this.context;r.fillStyle=e,r.fillRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}drawBounds(e,r=1){this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}],e,r),this.drawConnectedPointsRelative([{x:0,y:1},{x:1,y:0}],e,r),this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:1}],e,r)}toRelPoint(e,r="screen",i="independent",o=!0){e=this.source.toRelPoint(e,r,"skip",!1);let{x:a,y:n}=e;switch(a-=this.x,n-=this.y,i){case"independent":a/=this.width,n/=this.height}return o&&(a=ie(a),n=ie(n)),{x:a,y:n}}absToRegionPoint(e,r,i){r==="screen"&&(e=De(e,this.source.offset));let{x:o,y:a}=e;return o-=this.x,a-=this.y,i&&(o<0&&(o=0),a<0&&(a=0),o>this.width+this.x&&(o=this.x+this.width),a>this.height+this.y&&(a=this.y+this.height)),{x:o,y:a}}get center(){return an(this.#t)}get context(){return this.source.context}set region(e){this.#t=e}get region(){return this.#t}get width(){return this.#t.width}get height(){return this.#t.height}get x(){return this.#t.x}get y(){return this.#t.y}get dimensionMin(){return Math.min(this.#t.width,this.#t.height)}};const x$=(e,r={})=>{let i=e.parent===void 0?document.body:U(e.parent),o=document.createElement("canvas");i.prepend(o);let a=new Xv,n=new w$(o,"min"),s=e.region??{relativePositioned:{x:0,y:0,width:1,height:1}},l=n.createRegion(s),u=new Yv(l,a,r);return e.canvasResizeTo==="viewport"?fo.canvasViewport(o,{onSetSize:(c,f)=>{n.setLogicalSize(c),u.invalidateRange(),u.draw()}}):fo.canvasParent(o,{onSetSize:(c,f)=>{n.setLogicalSize(c),u.invalidateRange(),u.draw()}}),u};var Yv=class{#e;#t;#r;actualDataRange=sn;visibleRange=vu;show;whiskerLength;axisRounder=ni(1,!0);onInvalidated;overlayLines=[];#i;#o;#a;#n;#l;#s;#c;#u;#d;#h;constructor(e,r,i={}){if(!r)throw TypeError("Param 'data' is undefined");if(typeof r!="object")throw TypeError(`Param 'data' is not an object. Got: ${typeof r}`);this.onInvalidated=i.onInvalidated,this.#e=r,this.#r=e,this.#t=0,this.#h=i.clear??"region",this.#o=i.range??"auto",this.#l=i.valueStyle??"dot",this.#s=i.connectStyle??"",this.whiskerLength=i.whiskerLength??5,this.#d=i.visualPadding??20,this.show={axes:!0,axisValues:!0,grid:!0,whiskers:!0,...i.show},this.#n={colour:"black",width:2,...i.axisStyle},this.#u={colour:"black",size:"1em",font:"system-ui",...i.textStyle},this.#i={increments:.1,major:5,colour:"whitesmoke",width:1,...i.grid}}getCurrentRange(){if(this.#e.lastChange===this.#t&&this.#a)return this.#a;this.#t=this.#e.lastChange;let e=this.#y();return this.#a=e,this.onInvalidated&&this.onInvalidated(),e}invalidateRange(){this.#a=void 0}#y(){let e=this.getDataRange(),r=Kv(e),i=Qv(e),o=this.#r,a=this.#d,n=o.x+a,s=o.y+a,l=o.height-a*2,u=o.width-a*2,c=Math.min(l,u);return u>=l?n+=u/2-c/2:s+=l/2-c/2,{absDataToRelative:r,relDataToCanvas:p=>{let{x:y,y:g}=p;return y===-1/0?y=0:y===1/0&&(y=1),g===-1/0?g=0:g===1/0&&(g=1),y*=c,g=(1-g)*c,y+=n,g+=s,{x:y,y:g}},canvasToRelData:p=>{let{x:y,y:g}=p;return y-=n,g-=s,y/=c,g=1-g/c,{x:y,y:g}},regionSpaceToRelative:p=>{let{x:y,y:g}=p;return y=y-o.x+this.#d,g=c+this.#d-g,y/=c,g/=c,{x:y,y:g}},relDataToAbs:i,range:e}}positionElementAt(e,r,i="middle",o){let a=U(r),{x:n,y:s}=this.valueToScreenSpace(e);if(i==="middle"){let l=a.getBoundingClientRect();n-=l.width/2,s-=l.height/2}else if(i!=="top-left")throw Error("Param 'by' expected to be 'middle' or 'top-left'.");if(o){let l=U(o),u=l.getBoundingClientRect();n-=u.x,s-=u.y}a.style.left=`${n}px`,a.style.top=`${s}px`}getDataRange(){return this.#o==="auto"?Qs([...this.#e.getValues()]):(this.#c||=Qs([this.#o.max,this.#o.min]),this.#c)}valueToScreenSpace(e){let r=this.valueToRegionSpace(e),i=this.canvasSource.offset;return{x:r.x+i.x,y:r.y+i.y}}valueToRegionSpace(e,r=!1){let i=this.getCurrentRange(),o=i.absDataToRelative(e),a=i.relDataToCanvas(o);return r&&console.log(`orig: ${e.x}x${e.y} rel: ${o.x}x${o.y} region: ${a.x}x${a.y}`),{...e,x:a.x,y:a.y}}pointToValue(e,r){let i=this.getCurrentRange(),o=De(e,this.canvasSource.offset),a=i.canvasToRelData(o);return i.relDataToAbs(a)}#f(e,r,i=!1){return e=this.valueToRegionSpace(e,i),r=this.valueToRegionSpace(r,i),{a:e,b:r}}getDefaultMeta(){return{colour:qv(this.#e.metaCount),lineWidth:2,dotRadius:5}}draw(){this.#h==="region"?this.#r.clear():this.canvasSource.clear(),this.#x(),this.show.axes&&this.#b();for(let[e,r]of this.#e.getEntries()){let i=this.#e.getMeta(e);i||(i=this.getDefaultMeta(),this.#e.setMeta(e,i)),this.#E(e,r,i)}for(let e of this.overlayLines)this.drawLine(e,e.colour,e.width)}drawLine(e,r,i){let o=this.#f(e.a,e.b);this.#p(o,r,i)}setMeta(e,r){this.#e.setMeta(e,{...this.getDefaultMeta(),...r})}#b(){let{colour:e,width:r}=this.#n,i=this.#f({x:0,y:-1/0},{x:0,y:1/0},!1),o=this.#f({x:-1/0,y:0},{x:1/0,y:0},!1);this.#p(o,e,r,!1),this.#p(i,e,r,!1)}#v(e){let r=this.#r.context;r.font=this.#u.size+" "+this.#u.font,r.fillStyle=this.#u.colour,r.textBaseline="middle";for(let i of e){if(i.x===0&&i.y===0)continue;let o=this.valueToRegionSpace(i,!1),a=this.axisRounder(i.y),n=a.toString(),s=r.measureText(n),l=o.x-s.width-this.whiskerLength/2-5,u=o.y;r.fillText(n,l,u)}}#w(e){let r=this.#r.context;r.font=this.#u.size+" "+this.#u.font,r.fillStyle=this.#u.colour,r.textBaseline="top";for(let i of e){let o=this.valueToRegionSpace(i,!1),a=this.axisRounder(i.x),n=a.toString(),s=r.measureText(n),l=o.x-s.width/2,u=o.y+s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+this.whiskerLength/2;r.fillText(n,l,u)}}#g(e,r){let i=this.whiskerLength/2,o=r?{x:e.x,y:0}:{y:e.y,x:0},a=this.valueToRegionSpace(o,!1),n=r?{a:{x:a.x,y:a.y-i},b:{x:a.x,y:a.y+i}}:{a:{y:a.y,x:a.x-i},b:{y:a.y,x:a.x+i}};this.#p(n,this.#n.colour,this.#n.width,!1)}#m(e,r){let i=r?this.#f({x:e.x,y:-1/0},{x:e.x,y:1/0}):this.#f({y:e.y,x:-1/0},{y:e.y,x:1/0},!1);this.#p(i,this.#i.colour,e.major?this.#i.width*2:this.#i.width)}#x(){let e=this.#i,r=this.show.grid,i=this.show.whiskers,o=this.show.axisValues,a=this.getCurrentRange().range,{increments:n,major:s}=e,l=Zv(a,n,s);for(let u of l.x)r&&this.#m(u,!0),i&&u.major&&this.#g(u,!0);for(let u of l.y)r&&this.#m(u,!1),i&&u.major&&this.#g(u,!1);o&&(this.#w(l.x.filter(u=>u.major)),this.#v(l.y.filter(u=>u.major)))}#E(e,r,i){if(this.#s==="line"&&this.#D(r,i.colour,i.lineWidth),this.#l==="dot")for(let o of r)this.#A(o,i.colour,i.dotRadius)}#D(e,r,i){let o=this.#r.context;o.beginPath();for(let[a,n]of e.entries()){let s=this.valueToRegionSpace(n,!1);a===0&&o.moveTo(s.x,s.y),o.lineTo(s.x,s.y)}o.strokeStyle=Me(r),o.lineWidth=i,o.stroke(),o.closePath()}#A(e,r,i){let o=Me(e.fillStyle??r),a=this.valueToRegionSpace(e),n=e.radius??i;this.#r.drawCircles([{...a,radius:n}],o)}#p(e,r,i,o=!1){o&&console.log(e);let a=this.#r.context;r=Me(r),a.beginPath(),a.moveTo(e.a.x,e.a.y),a.lineTo(e.b.x,e.b.y),a.strokeStyle=Me(r),a.lineWidth=i,a.stroke(),a.closePath()}get dataSet(){return this.#e}get canvasRegion(){return this.#r}get canvasSource(){return this.#r.source}},ew={};A(ew,{BipolarView:()=>Hv,CartesianCanvasPlot:()=>Yv,DataSet:()=>Xv,absoluteCompute:()=>Qv,computeAxisMark:()=>Zv,computeMinMax:()=>Qs,insert:()=>x$,relativeCompute:()=>Kv});var E$={};A(E$,{CanvasHelper:()=>Y5,Colour:()=>Gc,Drawing:()=>ov,ImageDataGrid:()=>Iv,Plot:()=>ew,Video:()=>Uc,pointerVisualise:()=>h$});try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{NamedColourPalette:Uv,Colour:Gc,Video:Uc}})}catch{}var D$=class{_source;_state;_teardownNeeded=!1;_cameraConstraints;_cameraStartResult;_videoSourceCapture;_videoFile;_videoStartResult;_showCanvas;_showPreview;_postCaptureDraw;_timer;_captureCanvasEl;constructor(e={}){this._state="ready",this._source="",this._timer=performance.now(),this._showCanvas=e.showCanvas??!1,this._showPreview=e.showPreview??!1,this._cameraConstraints=e.cameraConstraints??void 0,this._captureCanvasEl=e.captureCanvasEl??void 0,this._postCaptureDraw=e.postCaptureDraw}showPreview(e){if(this._state==="disposed")throw Error("Disposed");let r;switch(this._source){case"camera":r=this._cameraStartResult?.videoEl,r!==void 0&&(r.style.display=e?"block":"none");break}this._showPreview=e}showCanvas(e){if(this._state==="disposed")throw Error("Disposed");let r;if(this._source==="camera"||this._source==="video")r=this._videoSourceCapture?.canvasEl,r!==void 0&&(r.style.display=e?"block":"none");else throw Error(`Source not implemented: ${this._source}`);this._showCanvas=e}getCapturer(){if(this._state==="disposed")throw Error("Disposed");if(this._source==="camera"||this._source==="video")return this._videoSourceCapture;throw Error(`Source kind not supported ${this._source}`)}async useCamera(e){if(this._state==="disposed")throw Error("Disposed");this._source="camera",this._teardownNeeded&&this.teardown(),e&&(this._cameraConstraints=e),await this.init()}async useVideo(e){if(this._state==="disposed")throw Error("Disposed");this._source="video",this._teardownNeeded&&this.teardown(),this._videoFile=e,await this.init()}async initCamera(){let e=await tv(this._cameraConstraints);if(e===void 0)throw Error("Could not start camera");this._cameraStartResult=e,this.postInit(e)}async initVideo(){if(!this._videoFile)throw Error("Video file not defined");let e=await iv(this._videoFile);this._videoStartResult=e,this.postInit(e)}async postInit(e){return this._showPreview&&(e.videoEl.style.display="block"),this._videoSourceCapture=Jv(e.videoEl,{postCaptureDraw:this._postCaptureDraw,showCanvas:this._showCanvas,canvasEl:this._captureCanvasEl}),this._teardownNeeded=!0,this._cameraStartResult=e,Promise.resolve()}dispose(){this._state!=="disposed"&&(this.teardown(),this._state="disposed")}async init(){switch(this._timer=performance.now(),this._source){case"camera":await this.initCamera();break;case"video":await this.initVideo();break}this._state="initialised"}teardown(){if(this._teardownNeeded){switch((this._source==="camera"||this._source==="video")&&this._videoSourceCapture?.dispose(),this._source){case"camera":this._cameraStartResult?.dispose();break;case"video":this._videoStartResult?.dispose();break}this._teardownNeeded=!1}}getFrame(){if(this._state==="disposed")throw Error("Disposed");switch(this._source){case"camera":return this.getFrameCamera();case"video":return this.getFrameCamera();default:throw Error(`source type unhandled ${this._source}`)}}getTimestamp(){return performance.now()-this._timer}getFrameCamera(){return this._videoSourceCapture?.capture()}};const A$=(e,r={})=>{let i=R(r.startDelay,2e3),o=R(r.maxDelay,i*10),a=R(r.checkStateMs,5e3);if(i>o)throw Error("startDelay should be less than maxDelay");if(a<0)throw Error("Param 'checkState' should be above zero");let n=!0,s=wi({closed:"connecting",open:"closed",connecting:["closed","open"]}),l,u=m=>{r.onError?r.onError(m):(console.log("rw on error",m),console.error(` error: ${m.error}`),console.error(` type: ${m.type}`),console.error(` error msg: ${m.message}`))},c=m=>{r.onMessage&&r.onMessage(m.data)},f=async()=>{if(s.value==="connecting")throw Error("Cannot connect twice");s=$e(s,"connecting"),l!==void 0&&(l.removeEventListener("error",u),r.onMessage&&l.removeEventListener("message",c),l=void 0);let m=await Bu({async probe(D){try{let B=new WebSocket(e);return(await Gy(B,["open","error"],{timeoutMs:1e3})).type==="open"?{success:!0,value:B}:{success:!1,error:"Could not open"}}catch(B){return{success:!1,error:st(B)}}}},{predelayMs:i,limitAttempts:r.limitAttempts});l=m.value;let v=!1;return m.success&&l?(r.onMessage,v=!0,s=$e(s,"open"),r.onConnected&&r.onConnected()):s=$e(s,"closed"),v},d=m=>{if(l)l.readyState===l.OPEN?l.send(m):h();else throw Error("Not connected")},h=()=>{s.value!=="closed"&&(s.value==="open"&&(s=$e(s,"closed"),r.onDisconnected&&r.onDisconnected()),n&&s.value!=="connecting"&&(console.log("Scheduling connect"),setTimeout(()=>{f()},100)))},p=()=>l?l.readyState===l.OPEN:!1,y=()=>{n=!1,s=$e(s,"closed"),l?.close(),r.onDisconnected&&r.onDisconnected()},g=()=>(n=!0,s.value==="open"?Promise.resolve(!0):s.value==="connecting"?Promise.resolve(!1):f());return f(),setInterval(()=>{if(l)switch(l.readyState){case l.CLOSED:s.value==="open"&&h();break}},a),{send:d,isConnected:p,close:y,open:g}};var C$={};A(C$,{Audio:()=>Kb,Bluetooth:()=>Gb,Camera:()=>ev,Codec:()=>wc,Espruino:()=>Yb,FrameProcessor:()=>D$,Serial:()=>Qb,StringReceiveBuffer:()=>xc,StringWriteBuffer:()=>Ec,VideoFile:()=>rv,genericStateTransitionsInstance:()=>Dc,reconnectingWebsocket:()=>A$});function tw(e,r={}){w(G(e,"aboveZero","totalTicks"));let i=r.exclusiveStart??!1,o=r.exclusiveEnd??!1,a=r.cycleLimit??2**53-1,n=i?1:0,s=o?e-1:e,l=0,u=r.startAt??n;if(r.startAtRelative){let c=e;i&&c--,o&&c--,u=Math.round(r.startAtRelative*c)}return c=>{if(c&&(c.resetAt!==void 0&&(u=c.resetAt),c.resetAtRelative!==void 0&&(u=Math.floor(c.resetAtRelative*e))),l>=a)return 1;let f=u/e;return u++,u>s&&(l++,u=n),f}}function di(e,r={}){let i=r.cycleLimit??9007199254740991,o=1,a=r.startAt??performance.now(),n=0,s=R(e,1e3);return r.startAtRelative&&(w(C(r.startAtRelative,"percentage","startAtRelative")),a=performance.now()-s*r.startAtRelative),l=>{if(l&&(l.resetAt!==void 0&&(a=l.resetAt,a===0&&(a=performance.now())),l.resetAtRelative!==void 0&&(w(C(l.resetAtRelative,"percentage","resetAtRelative")),a=performance.now()-s*l.resetAtRelative)),n>=i)return o;let u=performance.now(),c=u-a;return c>=s&&(n+=Math.floor(c/s),a=u,n>=i)?o:c%s/s}}function rw(e,r={}){let i=6e4/e;return di(i,r)}function Jc(e,r={}){let i=1e3/e;return di(i,r)}const iw=(e,r={})=>{let i=e/1e3,o=r.min??-9007199254740991,a=r.max??2**53-1,n=r.clamp??!1;if(n&&r.max)throw Error("Use either 'max' or 'clamp', not both.");n&&(a=e);let s=performance.now();return()=>{let l=performance.now(),u=l-s;s=l;let c=i*u;return c>a?a:c<o?o:c}},S$=(e,r={})=>iw(e/60,r);var ow={};A(ow,{bpm:()=>rw,elapsed:()=>di,hertz:()=>Jc,perMinute:()=>S$,perSecond:()=>iw,ticks:()=>tw});var aw={};A(aw,{saw:()=>M$,sine:()=>F$,sineBipolar:()=>k$,square:()=>P$,triangle:()=>$$});const nw=Math.PI*2;function*F$(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=_r(e));;)yield(Math.sin(e.elapsed*nw)+1)/2}function*k$(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=_r(e));;)yield Math.sin(e.elapsed*nw)}function*$$(e){for(typeof e=="number"&&(e=_r(e));;){let r=e.elapsed;r<.5?r*=2:r=2-r*2,yield r}}function*M$(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=_r(e));;)yield e.elapsed}function*P$(e){for(typeof e=="number"&&(e=_r(e));;)yield e.elapsed<.5?0:1}const N$=Math.pow,B$=1/Math.sqrt(2*Math.PI),sw=(e=.4)=>{let r=.5;return i=>{let o=B$/e,a=-2.5,n=(i-r)/e;n*=n,a*=n;let s=o*N$(Math.E,a);return s>1?1:s<0?0:s}};var Hc={};A(Hc,{arch:()=>O$,backIn:()=>tM,backInOut:()=>oM,backOut:()=>rM,bell:()=>lM,bounceIn:()=>sM,bounceInOut:()=>cM,bounceOut:()=>qa,circIn:()=>Y$,circInOut:()=>iM,circOut:()=>eM,cubicIn:()=>G$,cubicOut:()=>U$,elasticIn:()=>aM,elasticInOut:()=>uM,elasticOut:()=>nM,expoIn:()=>K$,expoInOut:()=>X$,expoOut:()=>Q$,quadIn:()=>I$,quadInOut:()=>W$,quadOut:()=>q$,quartIn:()=>J$,quartOut:()=>H$,quintIn:()=>T$,quintInOut:()=>Z$,quintOut:()=>z$,sineIn:()=>V$,sineInOut:()=>_$,sineOut:()=>L$,smootherstep:()=>R$,smoothstep:()=>j$});const Ia=Math.sqrt,me=Math.pow,lw=Math.cos,Ti=Math.PI,vo=Math.sin,qa=e=>{let r=7.5625,i=2.75;return e<1/i?r*e*e:e<2/i?r*(e-=1.5/i)*e+.75:e<2.5/i?r*(e-=2.25/i)*e+.9375:r*(e-=2.625/i)*e+.984375},T$=e=>e*e*e*e*e,z$=e=>1-me(1-e,5),O$=e=>e*(1-e)*4,j$=e=>e*e*(3-2*e),R$=e=>(e*(e*6-15)+10)*e*e*e,V$=e=>1-lw(e*Ti/2),L$=e=>vo(e*Ti/2),I$=e=>e*e,q$=e=>1-(1-e)*(1-e),_$=e=>-(lw(Ti*e)-1)/2,W$=e=>e<.5?2*e*e:1-me(-2*e+2,2)/2,G$=e=>e*e*e,U$=e=>1-me(1-e,3),J$=e=>e*e*e*e,H$=e=>1-me(1-e,4),K$=e=>e===0?0:me(2,10*e-10),Q$=e=>e===1?1:1-me(2,-10*e),Z$=e=>e<.5?16*e*e*e*e*e:1-me(-2*e+2,5)/2,X$=e=>e===0?0:e===1?1:e<.5?me(2,20*e-10)/2:(2-me(2,-20*e+10))/2,Y$=e=>1-Ia(1-me(e,2)),eM=e=>Ia(1-me(e-1,2)),tM=e=>{let r=1.70158;return(r+1)*e*e*e-r*e*e},rM=e=>{let r=1.70158;return 1+(r+1)*me(e-1,3)+r*me(e-1,2)},iM=e=>e<.5?(1-Ia(1-me(2*e,2)))/2:(Ia(1-me(-2*e+2,2))+1)/2,oM=e=>{let r=1.70158,i=r*1.525;return e<.5?me(2*e,2)*((i+1)*2*e-i)/2:(me(2*e-2,2)*((i+1)*(e*2-2)+i)+2)/2},aM=e=>{let r=2*Ti/3;return e===0?0:e===1?1:-me(2,10*e-10)*vo((e*10-10.75)*r)},nM=e=>{let r=2*Ti/3;return e===0?0:e===1?1:me(2,-10*e)*vo((e*10-.75)*r)+1},sM=e=>1-qa(1-e),lM=sw(),uM=e=>{let r=2*Ti/4.5;return e===0?0:e===1?1:e<.5?-(me(2,20*e-10)*vo((20*e-11.125)*r))/2:me(2,-20*e+10)*vo((20*e-11.125)*r)/2+1},cM=e=>e<.5?(1-qa(1-2*e))/2:(1+qa(2*e-1))/2,fM=(e=0,r=0)=>{let i=1,o={x:ut(e,-1,1,0,i),y:ut(e,-1,1,i,0)},a=fa(Math.abs(e),ee,o);e!==0&&r>0&&(a=e>0?fa(r,a,{x:0,y:o.x*2}):fa(r,a,{x:o.y*2,y:0}));let n=fb(ee,Ry,a,o),s=ub(n);return l=>s(l)},uw=(e,r)=>{w(xo(e,"fn"));let i;return()=>(i===void 0&&(i=Tu(r,{clampValue:!0})),e(i()))},cw=(e,r)=>{w(xo(e,"fn"));let i=yr(),o=R(r);if(o===void 0)throw Error("Param 'duration' not provided");let a=vi(o,{timer:i,clampValue:!0});return Ou(e,a)},fw=(e,r)=>{w(xo(e,"fn"));let i;return()=>(i===void 0&&(i=eg(r,{clampValue:!0})),e(i()))},dw=(e,r)=>{w(xo(e,"fn"));let i=zu(),o=vi(r,{timer:i,clampValue:!0});return Ou(e,o)};var hw={};A(hw,{Named:()=>Hc,create:()=>dM,get:()=>Rn,getEasingNames:()=>yM,line:()=>fM,tickEasing:()=>pM,ticks:()=>yw,time:()=>pw,timeEasing:()=>hM});const dM=e=>{let r=Yo(e.name??"quintIn"),i=r??e.fn;if(i===void 0)throw Error("Either 'name' or 'fn' must be set");if("duration"in e)return pw(i,e.duration);if("ticks"in e)return yw(i,e.ticks);throw Error("Expected 'duration' or 'ticks' in options")},hM=(e,r)=>{let i=Yo(e);return cw(i,r)},pw=(e,r)=>{let i=Yo(e);return uw(i,r)},yw=(e,r)=>{let i=Yo(e);return fw(i,r)},pM=(e,r)=>{let i=Yo(e);return dw(i,r)},Yo=e=>{let r=typeof e=="function"?e:Rn(e);if(r===void 0)throw Error(typeof e=="string"?`Easing function not found: '${e}'`:"Easing function not found");return r};let Hi;const Rn=function(e){w(tl(e,"non-empty","easingName"));let r=gw().get(e.toLowerCase());if(r===void 0)throw Error(`Easing not found: '${e}'`);return r};function gw(){if(Hi===void 0){Hi=new Map;for(let[e,r]of Object.entries(Hc))Hi.set(e.toLowerCase(),r);return Hi}else return Hi}function*yM(){yield*gw().keys()}const mw=Object.freeze({attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null}),Yi=Object.freeze({attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1});var bw=class extends Ze{#e;#t;#r;#i;#o;#a=!1;#n=!1;attackDuration;decayDuration;releaseDuration;decayDurationTotal;shouldLoop;constructor(e={}){super(),this.attackDuration=e.attackDuration??Yi.attackDuration,this.decayDuration=e.decayDuration??Yi.decayDuration,this.releaseDuration=e.releaseDuration??Yi.releaseDuration,this.shouldLoop=e.shouldLoop??Yi.shouldLoop,this.#e=new fn(mw,{initial:"attack"}),this.#e.addEventListener("change",r=>{r.newState==="release"&&this.#o&&this.#r?.reset(),super.fireEvent("change",r)}),this.#e.addEventListener("stop",r=>{super.fireEvent("complete",r)}),this.#t=()=>yr(),this.#i=this.#o=!1,this.decayDurationTotal=this.attackDuration+this.decayDuration}dispose(){this.#a||this.#e.dispose()}get isDisposed(){return this.#a}switchStateIfNeeded(e){if(this.#r===void 0)return!1;let r=this.#r.elapsed,i=this.#o&&!this.#i,o=!1,a=this.#e.state;do switch(o=!1,a=this.#e.state,a){case"attack":(r>this.attackDuration||i)&&(this.#e.next(),o=!0);break;case"decay":(r>this.decayDurationTotal||i)&&(this.#e.next(),o=!0);break;case"sustain":(!this.#i||i)&&(r=0,this.#e.next(),this.#r.reset(),o=!0);break;case"release":r>this.releaseDuration&&(this.#e.next(),o=!0);break;case"complete":this.shouldLoop&&e&&this.trigger(this.#o)}while(o&&a!=="complete");return o}computeRaw(e=!0,r=!0){if(this.#r===void 0)return[void 0,0,this.#e.state];e&&this.switchStateIfNeeded(r);let i=this.#e.state,o=this.#r.elapsed,a=0,n=this.#e.state;switch(n){case"attack":a=o/this.attackDuration;break;case"decay":a=(o-this.attackDuration)/this.decayDuration;break;case"sustain":a=1;break;case"release":a=Math.min(o/this.releaseDuration,1);break;case"complete":return["complete",1,i];default:throw Error(`State machine in unknown state: ${n}`)}return[n,a,i]}get isDone(){return this.#e.isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),this.#n=!0,this.#e.reset(),this.#r=this.#t(),this.#i=e,this.#o=e}get hasTriggered(){return this.#n}compute(){}release(){this.isDone||!this.#o||(this.#i=!1,this.compute())}};const Gt=Object.freeze({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,retrigger:!1});var vw=class{adsr;constructor(e){this.adsr=e}next(...e){this.adsr.hasTriggered||this.adsr.trigger();let r=this.adsr.compute();return{value:r[1],done:r[0]==="complete"}}get[Symbol.toStringTag](){return"Generator"}},Kc=class extends bw{attackPath;decayPath;releasePath;initialLevel;peakLevel;releaseLevel;sustainLevel;attackBend;decayBend;releaseBend;initialLevelOverride;retrigger;releasedAt;constructor(e={}){super(e),this.retrigger=e.retrigger??Gt.retrigger,this.initialLevel=e.initialLevel??Gt.initialLevel,this.peakLevel=e.peakLevel??Gt.peakLevel,this.releaseLevel=e.releaseLevel??Gt.releaseLevel,this.sustainLevel=e.sustainLevel??Gt.sustainLevel,this.attackBend=e.attackBend??Gt.attackBend,this.releaseBend=e.releaseBend??Gt.releaseBend,this.decayBend=e.decayBend??Gt.decayBend;let r=1;this.attackPath=ba(ma({x:0,y:this.initialLevel},{x:r,y:this.peakLevel},-this.attackBend)),this.decayPath=ba(ma({x:0,y:this.peakLevel},{x:r,y:this.sustainLevel},-this.decayBend)),this.releasePath=ba(ma({x:0,y:this.sustainLevel},{x:r,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){let[e,r,i]=this.compute(!0,!1);!Number.isNaN(r)&&r>0&&(this.initialLevelOverride=r)}}[Symbol.iterator](){return new vw(this)}get value(){return this.compute(!0)[1]}compute(e=!0,r=!0){let[i,o]=super.computeRaw(e,r);if(i===void 0)return[void 0,NaN,NaN];let a;switch(i){case"attack":a=this.attackPath.interpolate(o).y,this.initialLevelOverride!==void 0&&(a=ut(a,0,1,this.initialLevelOverride,1)),this.releasedAt=a;break;case"decay":a=this.decayPath.interpolate(o).y,this.releasedAt=a;break;case"sustain":a=this.sustainLevel,this.releasedAt=a;break;case"release":a=this.releasePath.interpolate(o).y,this.releasedAt!==void 0&&(a=ut(a,0,this.sustainLevel,0,this.releasedAt));break;case"complete":a=this.releaseLevel,this.releasedAt=void 0;break;default:throw Error(`Unknown state: ${i}`)}return[i,a,o]}},ww={};A(ww,{Adsr:()=>Kc,AdsrBase:()=>bw,AdsrIterator:()=>vw,adsr:()=>gM,adsrIterable:()=>mM,adsrStateTransitions:()=>mw,defaultAdsrOpts:()=>Gt,defaultAdsrTimingOpts:()=>Yi});const gM=(e={})=>{let r=new Kc(e),i=r.releaseLevel,o=r[Symbol.iterator]();return()=>Y1(o,{overrideWithLast:!0,value:i})};async function*mM(e){let r=new Kc(e.env),i=e.sampleRateMs??100;r.trigger();let o=Zy(()=>r.value,{while:()=>!r.isDone,delay:i,signal:e.signal});for await(let a of o)yield a}var xw={};A(xw,{accelerationForce:()=>DM,angleFromAccelerationForce:()=>Aw,angleFromVelocityForce:()=>Cw,angularForce:()=>Dw,apply:()=>EM,attractionForce:()=>wM,computeAccelerationToTarget:()=>Sw,computeAttractionForce:()=>Ew,computePositionFromAngle:()=>Fw,computePositionFromVelocity:()=>Zc,computeVelocity:()=>Qc,constrainBounce:()=>vM,guard:()=>bM,magnitudeForce:()=>AM,nullForce:()=>CM,orientationForce:()=>PM,pendulumForce:()=>kM,springForce:()=>FM,targetForce:()=>xM,velocityForce:()=>SM});const bM=(e,r="t")=>{if(e===void 0)throw Error(`Parameter ${r} is undefined. Expected ForceAffected`);if(e===null)throw Error(`Parameter ${r} is null. Expected ForceAffected`);if(typeof e!="object")throw TypeError(`Parameter ${r} is type ${typeof e}. Expected object of shape ForceAffected`)},vM=(e,r=1)=>{e||={width:1,height:1};let i=ks(e,"left"),o=ks(e,"right"),a=$s(e,"top"),n=$s(e,"bottom");return s=>{let l=Zc(s.position??ee,s.velocity??ee),u=s.velocity??ee,{x:c,y:f}=l;return c>o?(c=o,u=kr(mt(u,r),"x")):c<i&&(c=i,u=kr(mt(u,r),"x")),f>n?(f=n,u=mt(kr(u,"y"),r)):l.y<a&&(f=a,u=kr(mt(u,r),"y")),Object.freeze({...s,position:{x:c,y:f},velocity:u})}},wM=(e,r,i={})=>o=>{let a=o.acceleration??ee;for(let n of e){if(n===o)continue;let s=Ew(n,o,r,i);a=Qe(a,s)}return{...o,acceleration:a}},Ew=(e,r,i,o={})=>{if(e.position===void 0)throw Error("attractor.position not set");if(r.position===void 0)throw Error("attractee.position not set");let a=o.min??.01,n=o.max??.7,s=Ro(De(e.position,r.position)),l=ie(X(s),a,n);return mt(s,i*(e.mass??1)*(r.mass??1)/(l*l))},xM=(e,r={})=>o=>{let a=Sw(e,o.position??{x:.5,y:.5},r);return{...o,acceleration:Qe(o.acceleration??ee,a)}},EM=(e,...r)=>{if(e===void 0)throw Error("t parameter is undefined");for(let n of r)n!=null&&(e=typeof n=="function"?n(e):{...e,acceleration:Qe(e.acceleration??ee,n)});let i=Qc(e.acceleration??ee,e.velocity??ee),o=Zc(e.position??ee,i);return{...e,position:o,velocity:i,acceleration:ee}},DM=(e,r="ignored")=>i=>Object.freeze({...i,acceleration:Vn(e,i,r)}),Vn=(e,r,i="ignored")=>{let o;switch(i){case"dampen":o=a=>so(e,a,a);break;case"multiply":o=a=>hr(e,a,a);break;case"ignored":o=a=>e;break;default:throw Error(`Unknown 'mass' parameter '${i}. Expected 'dampen', 'multiply' or 'ignored'`)}return Qe(r.acceleration??ee,o(r.mass??1))},AM=(e,r="ignored")=>i=>{if(i.velocity===void 0)return i;let o=X(Ro(i.velocity)),a=e*o*o,n=mt(kr(i.velocity),a);return Object.freeze({...i,acceleration:Vn(n,i,r)})},CM=e=>e,SM=(e,r)=>{let i=Su(kr,o=>mt(o,e));return o=>{if(o.velocity===void 0)return o;let a=i(o.velocity);return Object.freeze({...o,acceleration:Vn(a,o,r)})}},Dw=()=>e=>{let r=e.angularAcceleration??0,i=e.angularVelocity??0,o=e.angle??0,a=i+r,n=o+a;return Object.freeze({...e,angle:n,angularVelocity:a,angularAcceleration:0})},Aw=(e=20)=>r=>{let i=r.acceleration??ee;return Object.freeze({...r,angularAcceleration:i.x*e})},Cw=(e=1)=>r=>{let i=Ft(r.velocity??ee);return Object.freeze({...r,angle:e<1?yp(e,r.angle??0,i):i})},FM=(e,r=.5,i=2e-4,o=.999)=>a=>{let n=De(a.position??ee,e),s=X(n),l=Math.abs(r-s),u=Ly(n,Ro,h=>mt(h,-i*l)),c=Vn(u,a,"dampen"),f=Qc(c??ee,a.velocity??ee),d=hr(f,o,o);return{...a,velocity:d,acceleration:ee}},kM=(e,r={})=>i=>{e||={x:0,y:0};let o=r.length??X(e,i.position??ee),a=r.speed??.001,n=r.damping??.995,s=i.angle;s===void 0&&(s=i.position?Ft(e,i.position)-Math.PI/2:0);let l=-1*a/o*Math.sin(s),u=(i.angularVelocity??0)+l;return s+=u,Object.freeze({angularVelocity:u*n,angle:s,position:Fw(o,s+Math.PI/2,e)})},Qc=(e,r,i)=>{let o=Qe(r,e);return i===void 0?o:Cu(o,i)},Sw=(e,r,i={})=>{let o=i.diminishBy??.001,a=De(e,r);return i.range&&Ty(Ny(a),i.range)===-2?ee:mt(a,o)},Zc=(e,r)=>Qe(e,r),Fw=(e,r,i)=>We(e,r,i),$M=Dw(),MM=Aw(),PM=(e=.5)=>{let r=Cw(e);return i=>(i=$M(i),i=MM(i),i=r(i),i)},NM=(e,r)=>i=>{let o=1-i,a=o*o,n=i*i,s=n*i;return 3*e*a*i+3*r*o*n+s},BM=e=>{let r=performance.now();return{update:(a=1)=>{let n=performance.now()-r,s=e*n%1;return r=performance.now(),(a+s)%1},reset:()=>{r=performance.now()}}},rd=Math.PI*2;function Xc(e,r,i,o){let a,n="clamp",s=f=>(a&&(f=a(f)),n===void 0||n==="clamp"?f=ie(f):n==="wrap"&&(f>1?f%=1:f<0&&(f=1+f%1)),f),l=(f,d,h)=>(w(C(d,"","a"),C(h,"","b"),C(f,"","amount")),f=s(f),(1-f)*d+f*h),u=(f={})=>{if(f.easing){let d=Rn(f.easing);if(!d)throw Error(`Easing function '${f.easing}' not found`);a=d}else if(f.transform){if(typeof f.transform!="function")throw Error(`Param 'transform' is expected to be a function. Got: ${typeof f.transform}`);a=f.transform}n=f.limits??"clamp"},c=(f,d,h)=>(1-f)*d+f*h;if(typeof e!="number")throw TypeError(`First param is expected to be a number. Got: ${typeof e}`);if(typeof r=="number"){let f,d;if(i===void 0||typeof i=="object")return f=e,d=r,u(i),h=>l(h,f,d);if(typeof i=="number")return f=r,d=i,u(o),l(e,f,d);throw Error("Values for 'a' and 'b' not defined")}else if(r===void 0||typeof r=="object"){let f=s(e);return u(r),w(C(f,"","amount")),(d,h)=>c(f,d,h)}}const TM=(e,r=0,i=1,o=0,a)=>{let n=o;return(s,l)=>{if(s!==void 0&&(i=s),l!==void 0&&(r=l),n>=1)return i;let u=Xc(n,r,i,a);return n+=e,u}},zM=(e,r,i,o)=>{let a=no(i-r,0,rd);return Xc(e,r,r+(a>Math.PI?a-rd:a),o)},OM=(e,r=0,i=1,o)=>{let a=Tu(e,{clampValue:!0});return(n,s)=>{let l=a();return n!==void 0&&(i=n),s!==void 0&&(r=s),l>=1?i:Xc(l,r,i,o)}},jM=e=>{let{relative:r,absolute:i}=e,o=e.clamped??!1,a=e.source??Math.random;if(i!==void 0)return n=>{let s=a()*i*2-i,l=n+s;return o?ie(l,0,n):l};if(r!==void 0)return n=>{let s=n*r,l=a()*s*2-s,u=n+l;return o?ie(u,0,n):u};throw Error("Either absolute or relative fields expected")},RM=(e={})=>{let r=e.clamped??!0,i=a=>0;if(e.absolute!==void 0){w(C(e.absolute,r?"percentage":"bipolar","opts.absolute"));let a=un({min:-e.absolute,max:e.absolute,source:e.source});i=n=>n+a()}else{if(e.relative===void 0)throw TypeError("Either absolute or relative jitter amount is required.");{let a=e.relative??.1;w(C(a,r?"percentage":"bipolar","opts.relative")),i=n=>n+xy({min:-Math.abs(a*n),max:Math.abs(a*n),source:e.source})}}return a=>{w(C(a,r?"percentage":"bipolar","value"));let n=i(a);return r&&(n=ie(n)),n}},VM=(e,r,i)=>{let o=i*e;return(1-e)*r+r*o},kw=(e,r,i)=>o=>xe(e,r(o),i(o)),LM=(e,r)=>i=>kw(i,e,r)(i),IM=e=>e,qM=function(e=.1,r,i,o,a){return r===void 0&&(r=0),i===void 0&&(i=1),o===void 0&&(o=r),w(C(e,"bipolar","interval"),C(i,"bipolar","end"),C(o,"bipolar","offset"),C(r,"bipolar","start")),$w(e,r,i,o,a)},$w=function*(e,r,i,o,a){if(r===void 0)throw Error("Parameter 'lower' is undefined");if(e===void 0)throw Error("Parameter 'interval' is undefined");if(i===void 0)throw Error("Parameter 'upper' is undefined");if(a===void 0&&e<=1&&e>=0?a=10/e:a===void 0&&(a=1234),Number.isNaN(e))throw Error("interval parameter is NaN");if(Number.isNaN(r))throw Error("lower parameter is NaN");if(Number.isNaN(i)||Number.isNaN(o))throw Error("upper parameter is NaN");if(r>=i)throw Error("lower must be less than upper");if(e===0)throw Error("Interval cannot be zero");let n=i-r;if(Math.abs(e)>=n)throw Error(`Interval should be between -${n} and ${n}`);let s=e>0;if(i=Math.floor(i*a),r=Math.floor(r*a),e=Math.floor(Math.abs(e*a)),e===0)throw Error(`Interval is zero (rounding: ${a})`);if(o=o===void 0?r:Math.floor(o*a),o>i||o<r)throw Error(`Start (${o/a}) must be within lower (${r/a}) and upper (${i/a})`);let l=o;yield l/a;let u=!0;for(;;)l+=s?e:-e,s&&l>=i?(s=!1,l=i,l===i&&u&&(l=r,s=!0)):!s&&l<=r&&(s=!0,l=r,l===r&&u&&(l=i,s=!1)),yield l/a,u=!1};function*Mw(e={},r){r===void 0?r=yr():typeof r=="number"&&(r=_r(r));let i=Pw(e),o=e.countdown??10;for(;o>0;){let a=i(r.elapsed/1e3);yield a,a===1?o--:o=100}}function _M(e={},r){let i=Mw(e,r);return()=>{let o=i.next();return o.done?1:o.value}}const Pw=(e={})=>{let r=0,i=1,o=e.mass??1,a=e.stiffness??100,n=e.soft??!1,s=e.damping??10,l=e.velocity??.1,u=i-r;if(n||1<=s/(2*Math.sqrt(a*o))){let c=-Math.sqrt(a/o),f=-c*u-l;return d=>i-(u+d*f)*Math.E**(d*c)}else{let c=Math.sqrt(4*o*a-s**2),f=(s*u-2*o*l)/c,d=.5*c/o,h=-(.5*s)/o;return p=>i-(Math.cos(p*d)*u+Math.sin(p*d)*f)*Math.E**(p*h)}},WM=(e,r,i={})=>{switch(e){case"elapsed":return()=>di(r,i);case"bpm":return()=>rw(r,i);case"hertz":return()=>Jc(r,i);default:throw Error(`Unknown source '${e}'. Expected: 'elapsed', 'hertz' or 'bpm'`)}};function Nw(e=1){e=1/e;let r=e/2;return i=>Math.abs(i%e-r)}function Bw(e=1){e=1/e;let r=e/2;return i=>i%e<r?1:0}function Tw(e=1){return e*=Math.PI*2,r=>(Math.sin(r*e)+1)/2}function zw(e=1){return e*=Math.PI*2,r=>Math.abs(Math.sin(r*e))}function Ow(e=1){return e*=Math.PI*2,r=>Math.sin(r*e)}function GM(e){let r=e.shape??"sine",i=e.invert??!1,o=e.period??1,a;w(G(o,"aboveZero","period"));let n={...e};if(e.ticks)a=tw(e.ticks,n);else if(e.hertz)a=Jc(e.hertz,n);else if(e.millis)a=di(e.millis,n);else if(e.source)a=e.source;else{let l=e.secs??5;a=di(l*1e3,n)}let s;switch(r){case"saw":s=l=>l;break;case"sine":s=Tw(o);break;case"sine-bipolar":s=Ow(o);break;case"square":s=Bw(o);break;case"triangle":s=Nw(o);break;case"arc":s=zw(o);break;default:throw Error(`Unknown wave shape '${r}'. Expected: sine, sine-bipolar, saw, triangle, arc or square`)}return jw(a,s,i)}function jw(e,r,i=!1){return o=>{let a=e(o?.clock);return o?.override&&(a=o.override),a=r(a),i&&(a=1-a),a}}const UM=(e,r,i)=>(e*(i-1)+r)/i,JM=(e="quadIn")=>Rw(e)(),Rw=(e="quadIn")=>{let r=typeof e=="string"?{easing:e}:e,i=r.source??Math.random,o=r.easing??"quadIn",a=Rn(o);if(a===void 0)throw Error(`Easing function '${o}' not found.`);return()=>{let s=i();return a(s)}};var HM={};A(HM,{Easings:()=>hw,Envelopes:()=>ww,Forces:()=>xw,Oscillators:()=>aw,Sources:()=>ow,arcShape:()=>zw,crossfade:()=>LM,cubicBezierShape:()=>NM,drift:()=>BM,gaussian:()=>sw,interpolate:()=>xe,interpolateAngle:()=>zM,interpolatorInterval:()=>OM,interpolatorStepped:()=>TM,jitter:()=>RM,jitterAbsolute:()=>jM,mix:()=>VM,mixModulators:()=>kw,noop:()=>IM,pingPong:()=>$w,pingPongPercent:()=>qM,sineBipolarShape:()=>Ow,sineShape:()=>Tw,spring:()=>Mw,springShape:()=>Pw,springValue:()=>_M,squareShape:()=>Bw,tickModulator:()=>dw,ticks:()=>fw,time:()=>uw,timeModulator:()=>cw,timingSourceFactory:()=>WM,triangleShape:()=>Nw,wave:()=>GM,waveFromSource:()=>jw,weighted:()=>JM,weightedAverage:()=>UM,weightedSource:()=>Rw});var Yc=class extends Error{constructor(e){super(e),this.name="CancelError"}};function KM(...e){return r=>{let i=r;for(let o of e)try{i=o(i)}catch(a){if(a instanceof Yc)break;throw a}return i}}function QM(e){return r=>r===void 0?r:e(r)}function ZM(){return e=>{if(e===void 0)throw new Yc("cancel");return e}}function XM(e){return r=>r===void 0?e():r}const YM=(e,r)=>e===r,eP=e=>typeof e=="string"?e:JSON.stringify(e);function tP(e){let r;return i=>{if(i!==r)return r=i,i}}function rP(e){let r=[];return e===void 0&&(e=YM),i=>{if(i!==void 0){for(let o of r)if(e(o,i))return;return r.push(i),i}}}function iP(e){let r=new Set;return e===void 0&&(e=eP),i=>{if(i===void 0)return;let o=e(i);if(!r.has(o))return r.add(o),i}}var oP={};A(oP,{CancelError:()=>Yc,average:()=>Yl,cancelIfUndefined:()=>ZM,flow:()=>KM,ifNotUndefined:()=>QM,ifUndefined:()=>XM,max:()=>Ql,min:()=>Zl,rank:()=>tu,seenLastToUndefined:()=>tP,seenToUndefined:()=>rP,seenToUndefinedByKey:()=>iP,sum:()=>Xl,tally:()=>eu});function hi(e){return e.value===void 0?"signal"in e&&e.signal!==void 0:!1}function ct(e){return e.value===void 0?"signal"in e&&e.signal==="done":!1}function Fe(e){return e.value!==void 0}const Vw=e=>ea(e)?"ping"in e:!1,vr=e=>ea(e)?"last"in e&&e.last()!==void 0:!1,ea=e=>typeof e!="object"||!e?!1:"on"in e&&"onValue"in e,ef=e=>ea(e)?"set"in e:!1,Lw=e=>!(typeof e!="object"||!("source"in e)||!("annotate"in e)),qe=(e,...r)=>i=>e(i,...r),tf=e=>"value"in e,rf=e=>"fn"in e,of=e=>pi(e),Iw=e=>typeof e=="object"?!!(tf(e)||rf(e)||of(e)):!1;function qw(e){if(tf(e))return[e.value,!1];if(rf(e)){let r=e.fn();return r===void 0?[void 0,!0]:[r,!1]}if(of(e)){let r=e.gen.next();return r.done?[void 0,!0]:[r.value,!1]}throw Error("Invalid trigger. Missing 'value' or 'fn' fields")}function _w(e,r={}){let i=r.maximumRepeats??9007199254740991,o=r.closeOnError??!0,a=r.interval?R(r.interval):-1,n=r.manual??!1;if(r.interval===void 0&&r.manual===void 0&&(n=!0),n&&r.interval)throw Error("If option 'manual' is set, option 'interval' cannot be used");let s=R(r.predelay,0),l=r.lazy??"very",u=r.signal,c=new AbortController,f=v=>{c.abort(v)},d=0,h=!1,p=v=>{m.dispose(v),h=!1,g&&g.cancel()},y=async()=>{if(!h)return!1;if(s&&await Ee(s),d>=i)return p(`Maximum repeats reached ${i.toString()}`),!1;try{if(u?.aborted)return p(`Signal (${u.aborted})`),!1;let v=await e(f);return d++,m.set(v),!0}catch(v){return o?(p(`Function error: ${st(v)}`),!1):(m.signal("warn",st(v)),!0)}},g=n?void 0:Yt(async()=>{if(!await y())return!1;if(c.signal.aborted)return p(`callback function aborted (${c.signal.reason})`),!1},a),m=er({lazy:l,onStart(){h=!0,g&&g.start()},onStop(){h=!1,g&&g.cancel()}});return l==="never"&&g&&g.start(),{...m,ping:y}}function Zs(e,r={}){let i=r.lazy??"very",o=r.traceLifecycle?p=>{console.log(`Rx.From.iterator ${p}`)}:p=>{},a=R(r.readInterval,5),n=R(r.readTimeout,300*1e3),s=r.whenStopped??"continue",l,u,c=wi({idle:["wait_for_next"],wait_for_next:["processing_result","stopping","disposed"],processing_result:["queued","disposed","stopping"],queued:["wait_for_next","disposed","stopping"],stopping:"idle",disposed:null},"idle"),f=()=>{o("onExternalSignal"),u?.abort(r.signal?.reason)};r.signal&&r.signal.addEventListener("abort",f,{once:!0});let d=async()=>{o(`read. State: ${c.value}`),u=new AbortController;try{c=$e(c,"wait_for_next");let p=await Hl(l,{signal:u.signal,millis:n});if(c=$e(c,"processing_result"),u.abort("nextWithTimeout completed"),p.done&&(o("read v.done true"),h.dispose("Generator complete"),c=$e(c,"disposed")),c.value==="stopping"){o("read. sm.value = stopping"),c=$e(c,"idle");return}if(c.value==="disposed"){o("read. sm.value = disposed");return}h.set(p.value)}catch(p){h.dispose(`Generator error: ${p.toString()}`);return}c.value==="processing_result"?(c=$e(c,"queued"),o(`scheduling read. State: ${c.value}`),setTimeout(d,a)):c=$e(c,"idle")},h=er({...r,lazy:i,onStart(){o(`onStart state: ${c.value} whenStopped: ${s}`),c.value==="idle"&&((c.value==="idle"&&s==="reset"||l===void 0)&&(l=Z(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]()),d())},onStop(){o(`onStop state: ${c.value} whenStopped: ${s}`),c=$e(c,"stopping"),s==="reset"&&(o("onStop reiniting iterator"),l=Z(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]())},onDispose(p){o(`onDispose (${p})`),u?.abort(`Rx.From.iterator disposed (${p})`),r.signal&&r.signal.removeEventListener("abort",f)}});return h}const ce=(e,r={})=>{if(ea(e))return e;let i=r.generator??{lazy:"initial",interval:5},o=r.function??{lazy:"very"};if(Array.isArray(e))return Zs(e.values(),i);if(typeof e=="function")return _w(e,o);if(typeof e=="object"){if(Lw(e))return e.source;if(pi(e)||Z(e))return Zs(e,i)}throw TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${typeof e}`)};function af(e,r){let i=r;return e.onValue(o=>{i=o}),{...e,last(){return i},resetCachedValue(){i=void 0}}}function Be(e,r){let i=r.lazy??"initial",o=r.disposeIfSourceDone??!0,a=r.onValue??(d=>{}),n=ce(e),s,l=r.debugLabel?`[${r.debugLabel}]`:"",u=()=>{s!==void 0&&(s(),s=void 0,r.onStop&&r.onStop())},c=()=>{s===void 0&&(r.onStart&&r.onStart(),s=n.on(d=>{hi(d)?d.signal==="done"?(u(),f.signal(d.signal,d.context),o&&f.dispose(`Upstream source ${l} has completed (${d.context??""})`)):f.signal(d.signal,d.context):Fe(d)&&a(d.value)}))},f=er({...r,lazy:i,onStart:c,onStop:u});return f}function aP(e){let r=er(e);return af(r,e.initialValue)}function er(e){let r=e.lazy??"initial",i=e.onStop??(()=>{}),o=e.onStart??(()=>{});e.debugLabel&&`${e.debugLabel}`;let a=Ne({...e,onFirstSubscribe(){r!=="never"&&o()},onNoSubscribers(){r==="very"&&i()}});return r==="never"&&o(),a}function Ne(e={}){let r,i=!1,o=!1,a=!0,n=e.onFirstSubscribe??void 0,s=e.onNoSubscribers??void 0,l=e.debugLabel?`[${e.debugLabel}]`:"",u=()=>{r!==void 0&&r.isEmpty&&(a||(a=!0,o=!1,s&&s()))},c=f=>{if(i)throw Error(`Disposed, cannot subscribe ${l}`);r===void 0&&(r=new Mu);let d=r.add(f);return a=!1,o||(o=!0,n&&n()),()=>{r?.remove(d),u()}};return{dispose:f=>{i||(r?.notify({value:void 0,signal:"done",context:`Disposed: ${f}`}),i=!0,e.onDispose&&e.onDispose(f))},isDisposed:()=>i,removeAllSubscribers:()=>{r?.clear(),u()},set:f=>{if(i)throw Error(`${l} Disposed, cannot set`);r?.notify({value:f})},signal:(f,d)=>{if(i)throw Error(`${l} Disposed, cannot signal`);r?.notify({signal:f,value:void 0,context:d})},on:f=>c(f),onValue:f=>c(h=>{Fe(h)&&f(h.value)})}}const nf=(e,r)=>{let i,o;if(typeof r=="string"&&(o={query:r}),typeof r=="object"&&(o="nodeName"in r?{el:r}:r),o===void 0)throw TypeError("Missing element as second parameter or option");if("el"in o)i=o.el;else if("query"in o)i=document.querySelector(o.query);else throw TypeError("Options does not include 'el' or 'query' fields");if(i==null)throw Error("Element could not be resolved.");let a=ce(e),n=pn(o.asHtml?"innerHTML":"textContent",i);return a.onValue(l=>{n(l)})},Et=e=>({on:e.on,dispose:e.dispose,isDisposed:e.isDisposed,onValue:e.onValue});function sf(e,r,i={}){let o=Be(e,{...i,onValue(a){let n=r(a);o.set({value:a,annotation:n})}});return Et(o)}function lf(e,r){let i=ce(e),o=r(i);return _n({value:i,annotation:o})}function uf(e,r={}){let i=new lt,o=r.quantity??0,a=r.returnRemainder??!0,n={...r,onStop(){if(a&&!i.isEmpty){let c=i.toArray();i.clear(),s.set(c)}},onValue(c){i.enqueue(c),o>0&&i.length>=o&&l(),u!==void 0&&u.runState==="idle"&&u.start()}},s=Be(e,n),l=()=>{if(i.isEmpty)return;u!==void 0&&u.start();let c=i.toArray();i.clear(),setTimeout(()=>{s.set(c)})},u=r.elapsed?bi(l,r.elapsed):void 0;return Et(s)}function zt(e,r,i={}){let o=i.traceInput??!1,a=i.traceOutput??!1,n=Be(e,{lazy:"initial",...i,onValue(s){let l=r(s);o&&a?console.log(`Rx.Ops.transform input: ${JSON.stringify(s)} output: ${JSON.stringify(l)}`):o?console.log(`Rx.Ops.transform input: ${JSON.stringify(s)}`):a&&console.log(`Rx.Ops.transform output: ${JSON.stringify(l)}`),n.set(l)}});return Et(n)}const Ww=e=>zt(e,r=>{let i=[];for(let o in r){let a=r[o];Ga(a)&&i.push([o,a])}return Object.fromEntries(i)});function cf(e,r={}){let i=Ne(),o=r.onSourceDone??"break",a=[],n=e.map(f=>ce(f)),s=()=>{},l=n.map(f=>s),u=n.map(f=>!1),c=()=>{for(let f of l)f()};for(let[f,d]of n.entries())a[f]=void 0,l[f]=d.on(h=>{if(ct(h)){if(u[f]=!0,l[f](),l[f]=s,o==="break"){c(),i.dispose("Source has completed and 'break' is set");return}u.includes(!1)||(c(),i.dispose("All sources completed"))}else Fe(h)&&(a[f]=h.value,i.set([...a]))});return{dispose:i.dispose,isDisposed:i.isDisposed,on:i.on,onValue:i.onValue}}function ta(e,r={}){let i=r.eq??Sd,o=Ne(),a=Ne(),n=[],s=e,l=!1,u=y=>{let g=[...eo(s??{},y,{...r,includeMissingFromA:!0})];g.length!==0&&(s=y,o.set(y),a.set(g))},c=(y,g)=>{for(let[m,v,D]of n)m(y)&&D.notify({fieldName:y,pattern:v,value:g})},f={asPartial:!0,includeParents:!0},d=y=>{if(s===void 0){s=y,o.set(s);for(let[g,m]of Object.entries(y))c(g,m);return s}else{let g=[...eo(s,y,f)];if(g.length===0)return s;s={...s,...y},o.set(s),a.set(g);for(let m of g)c(m.path,m.value);return s}};return{dispose:y=>{l||(a.dispose(y),o.dispose(y),l=!0)},isDisposed(){return l},updateField:(y,g)=>{if(s===void 0)throw Error("Cannot update value when it has not already been set");let m=qd(s,y);if(Ct(m))throw Lr(m);if(i(m.value,g,y))return;let v=[...eo(m.value,g,{...r,includeMissingFromA:!0})];v=v.map(B=>B.path.length>0?{...B,path:y+"."+B.path}:{...B,path:y});let D=pl(s,y,g,!0);s=D,o.set(D),a.set(v),c(y,g)},last:()=>s,on:o.on,onValue:o.onValue,onDiff:a.onValue,onField(y,g){let m=q1(y),v=new Mu;n.push([m,y,v]);let D=v.add(g);return()=>v.remove(D)},set:u,update:d}}function Ln(e,r={}){let i=r.disposeSources??!0,o=ta(void 0),a=r.onSourceDone??"break",n=r.emitInitial??!0,s=!1,l=new Map;for(let[y,g]of Object.entries(e)){let m="last"in g?g.last():void 0,v={source:ce(g),done:!1,data:m,off:()=>{}};l.set(y,v)}let u=Object.fromEntries(Object.entries(l).map(y=>[y[0],y[1].source])),c=()=>oo(l,y=>!y.done),f=()=>{for(let y of l.values())y.off()},d=()=>{let y={};for(let[g,m]of l)m.data!==void 0&&(y[g]=m.data);return y},h=()=>{s=!0;let y=d();o.set(y)},p=y=>{y.off=y.source.on(g=>{if(ct(g)){if(y.done=!0,y.off(),y.off=()=>{},a==="break"){f(),o.dispose("Source has completed and 'break' is behaviour");return}c()||(f(),o.dispose("All sources completed"))}else Fe(g)&&(y.data=g.value,h())})};for(let y of l.values())p(y);return!s&&n&&h(),{...o,hasSource(y){return l.has(y)},replaceSource(y,g){let m=l.get(y);if(m===void 0)throw Error(`Field does not exist: '${y}'`);m.off();let v=ce(g);m.source=v,p(m)},setWith(y){let g={};for(let[m,v]of Object.entries(y)){let D=l.get(m);D!==void 0&&(ef(D.source)&&(D.source.set(v),g[m]=v),D.data=v)}return g},sources:u,last(){return d()},dispose(y){if(f(),o.dispose(y),i)for(let g of l.values())g.source.dispose("Part of disposed mergeToObject")}}}function Gw(e,r){let i,o;vr(e)&&(o=i=e.last());let a=()=>{if(i===void 0&&o!==void 0)i=o,n.set(i);else if(i!==void 0&&o!==void 0){let s=r(i,o);i=s,n.set(s)}},n=Be(e,{lazy:"very",debugLabel:"computeWithPrevious",onValue(s){o=s,a()}});return o&&a(),{...Et(n),ping:()=>{o!==void 0&&a()}}}function Uw(e,r={}){let i=R(r.elapsed,50),o,a=bi(()=>{let s=o;s&&(n.set(s),o=void 0)},i),n=Be(e,{...r,onValue(s){o=s,a.start()}});return Et(n)}function ff(e){return r=>Uw(r,e)}const Jw=e=>{let r=0;return zt(e,i=>{let o=r===0?0:Date.now()-r;return r=Date.now(),o})};function In(e,r,i={}){let o=i.fallbackFieldValue,a=i.fallbackObject,n=Be(e,{disposeIfSourceDone:!0,...i,onValue(s){let l;r in s?l=s[r]:a&&r in a&&(l=a[r]),l===void 0&&(l=o),l!==void 0&&n.set(l)}});return Et(n)}function df(e,r,i){if(typeof r!="function")throw TypeError("Param 'predicate' should be a function");let o=Be(e,{...i,onValue(a){r(a)&&o.set(a)}});return Et(o)}function Hw(e,r,i){if(typeof r!="function")throw TypeError("Param 'predicate' should be a function");let o=Be(e,{...i,onValue(a){r(a)||o.set(a)}});return Et(o)}function Kw(e,r={}){let i=r.amount??.1,o=r.snapAt??.99,a=xe(i,r);return Gw(e,(n,s)=>{let l=a(n,s);return s>n&&l/s>=o?s:l})}function hf(e,r){let i=Ql();return zi(i,"max",e,r)}function pf(e,r){let i=Zl();return zi(i,"min",e,r)}function yf(e,r){let i=Yl();return zi(i,"average",e,r)}function gf(e,r){let i=Xl();return zi(i,"sum",e,r)}function mf(e,r={}){let i=r.countArrayItems??!0,o=eu(i);return zi(o,"tally",e,r)}function Qw(e,r,i){let o=tu(r,i);return zi(o,"rank",e,i)}function zi(e,r,i,o={}){let a=o.annotate,n,s=o.skipUndefined??!0,l=o.skipIdentical??!0,u=Be(i,{...o,onValue(c){let f=e(c);if(!(f===void 0&&s)&&!(l&&f===n))if(n=f,a){let d={value:c};d[r]=f,u.set(d)}else u.set(f)}});return Et(u)}const Zw=(...e)=>{let r=Ne(),i=[],o=a=>{for(let n of e)n.isDisposed||n.dispose(a);for(let n of i)n();r.dispose(a)};for(let a=0;a<e.length;a++)i.push(e[a].on(n=>{let s=a===e.length-1;Fe(n)?s?r.set(n.value):e[a+1].set(n.value):ct(n)&&o("Upstream disposed")}));return{on:r.on,onValue:r.onValue,dispose(a){o(a)},isDisposed(){return r.isDisposed()}}};function Xw(e,r={}){let i=r.order??"default";if(!r.at&&!r.predicate)throw Error("Options must have 'predicate' or 'at' fields");let o=n=>n;i==="random"?o=il:typeof i=="function"&&(o=n=>n.toSorted(i));let a=Be(e,{onValue(n){if(n=o(n),r.predicate)for(let s of n)r.predicate(s)&&a.set(s);else r.at&&a.set(n.at(r.at))}});return a}const bf=(e,r={})=>{let i=r.quantity??2,o=[],a=ce(e);for(let n=0;n<i;n++)o.push(Be(a,{disposeIfSourceDone:!0,lazy:"initial"}));return o},vf=(e,r)=>{let i=ce(e),o={};for(let a of r)o[a]=Be(i,{lazy:"initial",disposeIfSourceDone:!0});return o},wf=(e,r,i={})=>{let o=i.match??"first",a=ce(e),n=!1,s={};for(let c of Object.keys(r))s[c]=Ne();let l=()=>{if(!n){u(),n=!0;for(let c of Object.values(s))c.dispose("switcher source dispose")}},u=a.on(c=>{if(Fe(c)){for(let[f,d]of Object.entries(r))if(d(c.value)&&(s[f].set(c.value),o==="first"))break}else ct(c)&&l()});return s};function qn(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=R(r.maximumWait,2e3),n,s=[],l=e.map(m=>({finalData:void 0,done:!1,source:ce(m),unsub:()=>{}})),u=()=>{for(let m of l)m.unsub(),m.unsub=()=>{}},c=()=>{for(let m=0;m<s.length;m++)if(!(i==="allow"&&l[m].done)&&s[m]===void 0)return!1;return!0},f=()=>l.some(m=>!m.done),d=()=>{for(let m=0;m<s.length;m++)o==="last"&&l[m].done||(s[m]=void 0)},h=()=>{p(`Sync timeout exceeded (${a.toString()})`)},p=m=>{n&&clearTimeout(n),u(),g.dispose(m)},y=()=>{n=setTimeout(h,a);for(let[m,v]of l.entries())s[m]=void 0,v.unsub=v.source.on(D=>{if(hi(D)){if(D.signal==="done"){if(v.finalData=s[m],v.unsub(),v.done=!0,v.unsub=()=>{},o==="undefined"&&(s[m]=void 0),i==="break"){p(`Source '${m.toString()}' done, and onSourceDone:'break' is set`);return}if(!f()){p("All sources done");return}}return}s[m]=D.value,c()&&(g.set([...s]),d(),n&&clearTimeout(n),n=setTimeout(h,a))})},g=Ne({onFirstSubscribe(){u(),y()},onNoSubscribers(){n&&clearTimeout(n),u()}});return{dispose:g.dispose,isDisposed:g.isDisposed,on:g.on,onValue:g.onValue}}function _n(e,r={}){let i=Object.keys(e),o=Object.values(e),a=qn(o,r);return zt(a,s=>Co(i,s))}function xf(e,...r){let i=ce(e),o=Process.flow(...r);return i.onValue(a=>{o(a)}),i}function Ef(e,r){let i=ce(e);return i.onValue(o=>{r.set(o)}),i}const Df=(e,...r)=>{for(let i of r)e=i(e);return e};function Af(e,r={}){let i=R(r.elapsed,0),o=performance.now(),a,n=Be(e,{...r,onValue(l){a=l,s()}}),s=()=>{let l=performance.now();i>0&&l-o>i&&(o=l,a!==void 0&&n.set(a))};return Et(n)}function Cf(e,r){let i,o=r.immediate??!0,a=r.repeat??!1,n=R(r.interval,1e3);if(!Iw(r))throw Error("Param 'options' does not contain trigger 'value' or 'fn' fields");let s=()=>{let[u,c]=qw(r);if(c)l.dispose("Trigger completed");else{if(l.isDisposed())return;l.set(u),a&&(i=setTimeout(s,n))}},l=Be(e,{disposeIfSourceDone:!0,onValue(u){i&&clearTimeout(i),i=setTimeout(s,n),l.set(u)},onDispose(){i&&clearTimeout(i)}});return o&&!i&&(i=setTimeout(s,n)),l}function Sf(e,r){let i,o=ce(e),a=r.abort,n=R(r,1e3),s=()=>{if(a?.aborted||o.isDisposed()){u();return}Vw(o)&&o.ping(),i=setTimeout(s,n)},l=()=>{i&&clearTimeout(i)},u=o.on(c=>{Fe(c)?(l(),i=setTimeout(s,n)):ct(c)&&(u(),l())});return i=setTimeout(s,n),o}function nP(e,r,i={}){let o=i.lazy??"initial",a=i.signal,n=ce(e),s=i.gate??(h=>!0),l,u;a&&a.addEventListener("abort",()=>{d(`Abort signal ${a.reason}`)},{once:!0});let c=Ne({onFirstSubscribe(){o!=="never"&&l===void 0&&f()},onNoSubscribers(){o==="very"&&l!==void 0&&(l(),l=void 0)}}),f=()=>{l=n.on(h=>{ct(h)?d("Upstream closed"):hi(h)?c.signal(h.signal):Fe(h)&&s(h.value)&&r.ping()}),u=r.on(h=>{ct(h)?d("Downstream closed"):hi(h)?c.signal(h.signal,h.context):Fe(h)&&c.set(h.value)})},d=h=>{c.dispose(h),l&&l(),u&&u()};return o==="never"&&f(),c}function Yw(e,r){let i=r.initial,o=Be(e,{...r,onValue(n){i=n,o.set(n)}});return{...Et(o),last(){return i}}}const sP=(e,r={})=>{if(Array.isArray(e))return ex(e,r)},ex=(e,r={})=>{let i=r.lazy??"initial",o=r.signal,a=r.whenStopped??"continue",n=r.debugLifecycle??!1,s=[...e];if(i!=="very"&&a==="reset")throw Error(`whenStopped:'reset' has no effect with 'lazy:${i}'. Use lazy:'very' instead.`);let l=R(r.interval,5),u=0,c=s[0],f=er({...r,lazy:i,onStart(){n&&console.log("Rx.readFromArray:onStart"),d.start()},onStop(){n&&console.log(`Rx.readFromArray:onStop. whenStopped: ${a} index: ${u}`),d.cancel(),a==="reset"&&(u=0)}}),d=Yt(()=>{if(o?.aborted)return f.dispose(`Signalled (${o.reason})`),!1;if(c=s[u],u++,f.set(c),u===s.length)return f.dispose("Source array complete"),!1},l);return i||d.start(),{dispose:f.dispose,isDisposed:f.isDisposed,isDone(){return u===s.length},last(){return c},on:f.on,onValue:f.onValue}};function tx(e=[],r={}){let i=r.eq??Cd,o=Ne(),a=Ne(),n=e,s=!1,l=g=>{Ki(n,g,i),n=g,o.set([...g])},u=(g,m)=>{n[g]=m,o.set([...n])},c=g=>{n=[...n,g],o.set([...n]);let m=["add",n.length-1,g];a.set([m])},f=g=>{let m=gd(n,g);if(m.length===n.length)return;let v=Ki(n,m,i);n=m,o.set([...n]),a.set(v.summary)},d=g=>{let m=n.filter(B=>!g(B)),v=n.length-m.length,D=Ki(n,m,i);return n=m,o.set([...n]),a.set(D.summary),v},h=(g,m)=>{let v=hd(n,g,m),D=Ki(n,v,i);n=v,o.set([...n]),a.set(D.summary)};return{dispose:g=>{s||(o.dispose(g),s=!0)},isDisposed(){return s},last:()=>n,on:o.on,onArray:a.on,onValue:o.onValue,setAt:u,push:c,deleteAt:f,deleteWhere:d,insertAt:h,set:l}}function lP(e){let r=e,i=Ne(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}function uP(e={}){let r=e.lazy??"initial",i=R(e.interval,1e3),o=e.amount??1,a=e.offset??0,n=0,s=a,l=f=>{c.dispose(f)},u=Yt(()=>{if(e.signal?.aborted)return l(`Aborted (${e.signal.reason})`),!1;if(c.set(s),s+=1,n++,n>=o)return l("Limit reached"),!1},i),c=er({onStart(){u.start()},onStop(){u.cancel()},onDispose(){u.cancel()},lazy:r});return c}function cP(e,r,i={}){let o=i.ignoreIdentical??!0,a=i.eq??Cd,n=Ln(r),s=c=>{let f=u.last(),d=e(c);if(d!==void 0){if(o&&f!==void 0&&a(d,f))return d;u.set(d)}return d},l=Be(n,{...i,onValue(c){s(c)}}),u=af(l,e(n.last()));return u}function fP(e,r,i,o,a={}){let n={};return n[i]=o,In(wo(e,r,n,a),i,a)}function wo(e,r,i,o={}){let a;if(typeof e=="string"){if(a=document.querySelector(e),a===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else a=e;if(a===null)throw Error("Param 'targetOrQuery' is null");let n=o.debugLifecycle??!1,s=o.debugFiring??!1;o.diff;let l=o.lazy??!1;i===void 0&&(i={});let u=ta(i,{deepEntries:!0}),c=!1,f=!1,d=y=>{s&&console.log(`Reactive.event '${r}' firing '${JSON.stringify(y)}`),u.set(y)},h=()=>{c&&(c=!1,a.removeEventListener(r,d),n&&console.log(`Rx.From.event remove '${r}'`))},p=()=>{c||(c=!0,a.addEventListener(r,d),n&&console.log(`Rx.From.event add '${r}'`))};return l||p(),{last:()=>(l&&p(),u.last()),dispose:y=>{f||(f=!0,h(),u.dispose(y))},isDisposed(){return f},on:y=>(l&&p(),u.on(y)),onValue:y=>(l&&p(),u.onValue(y))}}function Ff(e,r,i={}){let o;if(typeof e=="string"){if(o=document.querySelector(e),o===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else o=e;if(o===null)throw Error("Param 'targetOrQuery' is null");let a=i.debugLifecycle??!1,n=i.debugFiring??!1,s=i.fireInitial??!1,l=0,u=O1(),c=er({lazy:i.lazy??"very",onStart(){o.addEventListener(r,f),a&&console.log(`Rx.From.eventTrigger add '${r}'`),s&&l===0&&((a||n)&&console.log("Rx.From.eventTrigger: firing initial"),f())},onStop(){o.removeEventListener(r,f),a&&console.log(`Rx.From.eventTrigger remove '${r}'`)}}),f=d=>{n&&console.log(`Rx.From.eventTrigger '${r}' triggered'`),c.set({sinceLast:u(),total:++l})};return c}function dP(...e){return rx(e)}function rx(e,r={}){let i=[],o=er({...r,onStart(){for(let a of e)i.push(a.onValue(n=>{o.set(n)}))},onStop(){for(let a of i)a();i=[]}});return o}function hP(e){let r=e,i=Ne(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}const ix=Symbol("Rx"),ox=e=>{let r=ta(e);return{proxy:new Proxy(e,{set(o,a,n,s){let l=Array.isArray(o);if(l&&a==="length")return!0;if(typeof a=="string"&&r.updateField(a,n),l&&typeof a=="string"){let u=Number.parseInt(a);if(!Number.isNaN(u))return o[u]=n,!0}return o[a]=n,!0}}),rx:r}},pP=e=>{let r=tx(e);return{proxy:new Proxy(e,{set(o,a,n,s){if(a==="length")return!0;if(typeof a!="string")throw Error(`Expected numeric index, got type: ${typeof a} value: ${JSON.stringify(a)}`);let l=Number.parseInt(a);if(Number.isNaN(l))throw Error(`Expected numeric index, got: '${a}'`);return r.setAt(l,n),o[l]=n,!0}}),rx:r}},yP=e=>{let{proxy:r,rx:i}=ox(e),o=r;return o[ix]=i,o};function kf(e){let r=ax(e);return{dispose:r.dispose,isDisposed:r.isDisposed,on:r.on,onValue:r.onValue}}function ax(e){let r=()=>{},i=Mf({onFirstSubscribe(){r=e(i)},onNoSubscribers(){r&&r()}});return{...i,onValue:o=>i.on(a=>{Fe(a)&&o(a.value)})}}function gP(e){let r=e,i=Ne(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}var nx={};A(nx,{array:()=>ex,arrayObject:()=>tx,arrayProxy:()=>pP,boolean:()=>lP,count:()=>uP,derived:()=>cP,event:()=>wo,eventField:()=>fP,eventTrigger:()=>Ff,func:()=>_w,iterator:()=>Zs,merged:()=>dP,mergedWithOptions:()=>rx,number:()=>hP,object:()=>ta,objectProxy:()=>ox,objectProxySymbol:()=>yP,observable:()=>kf,observableWritable:()=>ax,of:()=>sP,string:()=>gP});function mP(e){let r=Mf({onNoSubscribers(){e.removeEventListener("removed",i),e.removeEventListener("enqueue",o)},onFirstSubscribe(){e.addEventListener("removed",i),e.addEventListener("enqueue",o),r.set(e.toArray())}}),i=n=>{r.set(n.finalData)},o=n=>{r.set(n.finalData)};return{...r,set:n=>{e.enqueue(...n)}}}var sx={};A(sx,{asResponsive:()=>mP});function bP(e){let r=Rp(),i=Ne();return{dispose:i.dispose,isDisposed:i.isDisposed,graph:r,on:i.on,onValue:i.onValue}}async function $f(e,r={}){let i=r.limit??9007199254740991,o=R(r.maximumWait,10*1e3),a=r.underThreshold??"partial",n=[],s=ce(e);return new Promise((u,c)=>{let f=()=>{if(clearTimeout(d),h(),n.length<i&&a==="throw"){c(Error(`Threshold not reached. Wanted: ${i} got: ${n.length}. Maximum wait: ${o}`));return}if(n.length<i&&a==="fill")for(let p=0;p<i;p++)n[p]===void 0&&(n[p]=r.fillValue);u(n)},d=setTimeout(()=>{f()},o),h=s.on(p=>{ct(p)?f():Fe(p)&&(n.push(p.value),n.length===i&&f())})})}async function lx(e,r={}){let i=r.limit??9007199254740991,o=r.maximumWait??5*1e3,a=await $f(e,{limit:i,maximumWait:o,underThreshold:"partial"});if(r.limit&&a.length<r.limit)throw Error(`Threshold not reached. Wanted: ${r.limit}, got ${a.length}`);return a}async function*vP(e){let r=ce(e),i=l=>{},o=l=>{},a=()=>new Promise((l,u)=>{i=l,o=u}),n=a(),s=!0;for(r.on(l=>{Fe(l)?(i(l.value),n=a()):ct(l)&&(s=!1,o("Source has completed"))});s;)yield await n}function ae(e){return{source:ce(e),enacts:{setHtmlText:r=>nf(e,r)},annotate:r=>{let i=sf(e,r);return ae(i)},annotateWithOp:r=>{let i=lf(e,r);return ae(i)},chunk:r=>ae(uf(e,r)),debounce:(r={})=>ae(Uw(e,r)),field:(r,i={})=>{let o=In(e,r,i);return ae(o)},filter:(r,i)=>ae(df(e,r,i)),combineLatestToArray:(r,i={})=>{let o=[e,...r];return ae(cf(o,i))},combineLatestToObject:(r,i)=>{let o=i.name??"source",a={...r};return a[o]=e,ae(Ln(a,i))},min:(r={})=>ae(pf(e,r)),max:(r={})=>ae(hf(e,r)),average:(r={})=>ae(yf(e,r)),sum:(r={})=>ae(gf(e,r)),tally:(r={})=>ae(mf(e,r)),split:(r={})=>bf(e,r).map(o=>ae(o)),splitLabelled:(...r)=>{let i=vf(e,r);return fs(i,a=>ae(a.value))},switcher:(r,i={})=>{let o=wf(e,r,i);return fs(o,n=>ae(n.value))},syncToArray:(r,i={})=>{let o=[e,...r].map(n=>ce(n)),a=qn(o,i);return ae(a)},syncToObject:(r,i={})=>{let o=i.name??"source",a={...r};return a[o]=e,ae(_n(a,i))},tapProcess:(...r)=>(xf(e,...r),ae(e)),tapStream:r=>(Ef(e,r),ae(e)),tapOps:(r,...i)=>(Df(r,...i),ae(r)),throttle:(r={})=>ae(Af(e,r)),transform:(r,i={})=>ae(zt(e,r,i)),timeoutValue:r=>ae(Cf(e,r)),timeoutPing:r=>ae(Sf(e,r)),toArray:r=>$f(e,r),toArrayOrThrow:r=>lx(e,r),onValue:r=>{ce(e).on(o=>{Fe(o)&&r(o.value)})}}}var wP={};A(wP,{Collections:()=>sx,From:()=>nx,Ops:()=>AP,Sinks:()=>DP,annotate:()=>sf,annotateWithOp:()=>lf,average:()=>yf,cache:()=>af,chunk:()=>uf,cloneFromFields:()=>Ww,combineLatestToArray:()=>cf,combineLatestToObject:()=>Ln,computeWithPrevious:()=>Gw,debounce:()=>ff,drop:()=>Hw,elapsed:()=>Jw,field:()=>In,filter:()=>df,hasLast:()=>vr,initLazyStream:()=>er,initLazyStreamWithInitial:()=>aP,initStream:()=>Ne,initUpstream:()=>Be,interpolate:()=>Kw,isPingable:()=>Vw,isReactive:()=>ea,isTrigger:()=>Iw,isTriggerFunction:()=>rf,isTriggerGenerator:()=>of,isTriggerValue:()=>tf,isWrapped:()=>Lw,isWritable:()=>ef,manual:()=>Mf,max:()=>hf,messageHasValue:()=>Fe,messageIsDoneSignal:()=>ct,messageIsSignal:()=>hi,min:()=>pf,opify:()=>qe,pipe:()=>Zw,prepare:()=>bP,rank:()=>Qw,resolveSource:()=>ce,resolveTriggerValue:()=>qw,run:()=>xP,setHtmlText:()=>nf,singleFromArray:()=>Xw,split:()=>bf,splitLabelled:()=>vf,sum:()=>gf,switcher:()=>wf,symbol:()=>ix,syncToArray:()=>qn,syncToObject:()=>_n,takeNextValue:()=>CP,tally:()=>mf,tapOps:()=>Df,tapProcess:()=>xf,tapStream:()=>Ef,throttle:()=>Af,timeoutPing:()=>Sf,timeoutValue:()=>Cf,to:()=>SP,toArray:()=>$f,toArrayOrThrow:()=>lx,toGenerator:()=>vP,transform:()=>zt,valueToPing:()=>nP,withValue:()=>Yw,wrap:()=>ae,writable:()=>EP});function xP(e,...r){let i=ce(e);for(let o of r)i=o(i);return i}function EP(e,...r){let i=ce(e),o=i;for(let n of r)i=n(i);return{...i,set(n){if(ef(o))o.set(n);else throw Error("Original source is not writable")}}}function Mf(e={}){let r=Ne(e);return{dispose:r.dispose,isDisposed:r.isDisposed,set(i){r.set(i)},on:r.on,onValue:r.onValue}}const DP={setHtmlText:e=>r=>{nf(r,e)}},AP={annotate:e=>qe(sf,e),annotateWithOp:e=>qe(lf,e),chunk:e=>r=>uf(r,e),cloneFromFields:()=>e=>Ww(e),combineLatestToArray:(e={})=>r=>cf(r,e),combineLatestToObject:(e={})=>r=>Ln(r,e),drop:e=>qe(Hw,e),elapsed:()=>qe(Jw),field:(e,r={})=>i=>In(i,e,r),filter:e=>qe(df,e),interpolate:e=>qe(Kw,e),min:e=>qe(pf,e),max:e=>qe(hf,e),sum:e=>qe(gf,e),average:e=>qe(yf,e),tally:e=>qe(mf,e),rank:(e,r)=>qe(Qw,e,r),pipe:(...e)=>r=>{let i=ce(r),o=[i,...e];return Zw(...o)},singleFromArray:(e={})=>r=>Xw(r,e),split:(e={})=>r=>bf(r,e),splitLabelled:e=>r=>vf(r,e),switcher:(e,r={})=>i=>wf(i,e,r),syncToArray:(e={})=>r=>qn(r,e),syncToObject:(e={})=>r=>_n(r,e),tapProcess:e=>r=>xf(r,e),tapStream:e=>r=>Ef(r,e),tapOps:(...e)=>r=>Df(r,...e),throttle:e=>qe(Af,e),timeoutValue:e=>r=>Cf(r,e),timeoutPing:e=>r=>Sf(r,e),transform:(e,r={})=>i=>zt(i,e,r),withValue:e=>qe(Yw,e)};async function CP(e,r=1e3){let i=ce(e),o=()=>{},a;return new Promise((s,l)=>{o=i.on(u=>{a&&clearTimeout(a),Fe(u)?(o(),s(u.value)):ct(u)&&(l(Error(`Source closed. ${u.context??""}`)),o())}),a=setTimeout(()=>{a=void 0,o(),l(Error(`Timeout waiting for value (${JSON.stringify(r)})`))},R(r))})}const SP=(e,r,i,o=!1)=>{let a=e.on(n=>{if(Fe(n)){let s=i?i(n.value):n.value;r.set(s)}else ct(n)&&(a(),o&&r.dispose(`Source closed (${n.context??""})`))});return a},FP=(e,r)=>{if(e===null)throw Error("Param 'elem' is null. Expected element to observe");if(e===void 0)throw Error("Param 'elem' is undefined. Expected element to observe");let i=kf(o=>{let a=new ResizeObserver(n=>{o.set(n)});return a.observe(e),()=>{a.unobserve(e)}});return ff({elapsed:r??100})(i)},kP=e=>ff({elapsed:e??100})(wo(window,"resize",{innerWidth:0,innerHeight:0})),$P=(e=document.documentElement)=>kf(i=>{let o=new MutationObserver(n=>{i.set(n)}),a={attributeFilter:["class"],attributes:!0};return o.observe(e,a),()=>{o.disconnect()}});function MP(e){let r=e,i=Ne(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o,setHsl:a=>{o(a)}}}function PP(e,r={}){let i=Pf(e,r),o=i.el,a=r.relative??!1,n=r.inverted??!1,s=zt(i,u=>Number.parseFloat(u));return a&&(o.max=n?"0":"1",o.min=n?"1":"0",o.hasAttribute("step")||(o.step="0.1")),o.getAttribute("type")===null&&(o.type="range"),{...s,last(){return Number.parseFloat(i.last())},set:u=>{i.set(u.toString())}}}function NP(e,r={}){let i=Pf(e,{...r,upstreamFilter:a=>typeof a=="object"?Me(a):a});return{...zt(i,a=>Rr(a,{scalar:!0,ensureSafe:!0})),last(){return Rr(i.last(),{scalar:!0,ensureSafe:!0})},set(a){i.set(po(a))}}}function Pf(e,r={}){let i=typeof e=="string"?document.querySelector(e):e;if(i===null&&typeof e=="string")throw Error(`Element query could not be resolved '${e}'`);if(i===null)throw Error("targetOrQuery is null");let o=U(e),a=r.when??"changed",n=a==="changed"?"change":"input",s=r.emitInitialValue??!1,l=r.fallbackValue??"",u=r.upstreamSource,c=()=>{},f=r.attributeName,d=r.fieldName;d===void 0&&f===void 0&&(f=d="value");let h=()=>{let v;return f&&(v=o.getAttribute(f)),d&&(v=o[d]),v??=l,v},p=v=>{f&&o.setAttribute(f,v),d&&(o[d]=v)},y=v=>{v=r.upstreamFilter?r.upstreamFilter(v):v,p(v)};u&&(c=u.onValue(y),vr(u)&&y(u.last()));let g=Ff(o,n,{fireInitial:s,debugFiring:r.debugFiring??!1,debugLifecycle:r.debugLifecycle??!1}),m=zt(g,v=>h());return{...m,el:o,last(){return h()},set(v){p(v)},dispose(v){c(),m.dispose(v),g.dispose(v)}}}function BP(e,r={}){let i=U(e),o=r.when??"changed",a=o==="changed"?"change":"input",n=r.emitInitialValue??!1,s=r.upstreamSource,l=new Map,u=()=>{},c=()=>{let g=new FormData(i),m=[];for(let[D,B]of g.entries()){let V=B.toString(),x=l.get(D);if(!x){let k=f(D,V);k&&(x=k.type==="range"||k.type==="number"?"number":k.type==="color"?"colour":k.type==="checkbox"&&(B==="true"||B==="on")?"boolean":"string",l.set(D,x))}if(x==="number")m.push([D,Number.parseFloat(V)]);else if(x==="boolean"){let k=V==="true";m.push([D,k])}else if(x==="colour"){let k=Me(V);m.push([D,Bi(k,{scalar:!1})])}else m.push([D,B.toString()])}for(let D of i.querySelectorAll('input[type="checkbox"]'))!D.checked&&D.value==="true"&&m.push([D.name,!1]);return Object.fromEntries(m)},f=(g,m)=>{let v=i.querySelector(`[name="${g}"]`);if(!v){console.warn(`Form does not contain an element with name="${g}"`);return}if(v.type==="radio"){let D=i.querySelector(`[name="${g}"][value="${m}"]`);if(!D){console.warn(`Form does not contain radio option for name=${g} value=${m}`);return}return D}return v},d=(g,m)=>{let v=f(g,m);if(v&&(v.nodeName==="INPUT"||v.nodeName==="SELECT")){if(v.type==="color")typeof m=="object"&&(m=Me(m));else if(v.type==="checkbox")if(typeof m=="boolean"){v.checked=m;return}else console.warn(`Rx.Sources.domForm: Trying to set non boolean type to a checkbox. Name: ${g} Value: ${m} (${typeof m})`);else if(v.type==="radio"){v.checked=!0;return}v.value=m}},h=g=>{for(let[m,v]of Object.entries(g)){let D=l.get(m);D||(D=typeof v,D==="object"&&(Xo(v),D="colour"),l.set(m,D));let B=r.upstreamFilter?r.upstreamFilter(m,v):v;d(m,B)}};s&&(u=s.onValue(h),vr(s)&&h(s.last()));let p=Ff(i,a,{fireInitial:n,debugFiring:r.debugFiring??!1,debugLifecycle:r.debugLifecycle??!1}),y=zt(p,g=>c());return{...y,el:i,last(){return c()},set:h,setNamedValue:d,dispose(g){u(),y.dispose(g),p.dispose(g)}}}function TP(e){let r=[...document.querySelectorAll(e)];return ta(r)}const zP=(e,r,i={})=>Wn(e,r,{...i,elField:"textContent"}),OP=(e,r,i={})=>Wn(e,r,{...i,elField:"value",attribName:"value"}),jP=(e,r,i={})=>Wn(e,r,{...i,elField:"innerHTML"}),Wn=(e,r,...i)=>{if(r===null)throw Error("Param 'elOrQuery' is null");if(r===void 0)throw Error("Param 'elOrQuery' is undefined");let o=U(r),a=[];i.length===0?a.push({elField:"textContent"}):a=[...i];let n=a.map(s=>"element"in s?s:{...s,element:o});return fx(e,...n)},RP=(e,r)=>{let i=ux(e);return o=>{i(o,r)}},ux=e=>{if(e.elField!==void 0||e.cssVariable===void 0&&e.attribName===void 0&&e.cssProperty===void 0&&e.textContent===void 0&&e.htmlContent===void 0){let r=e.elField??"textContent";return(i,o)=>{o[r]=i}}if(e.attribName!==void 0){let r=e.attribName;return(i,o)=>{o.setAttribute(r,i)}}if(e.textContent)return(r,i)=>{i.textContent=r};if(e.htmlContent)return(r,i)=>{i.innerHTML=r};if(e.cssVariable!==void 0){let r=e.cssVariable;return r.startsWith("--")||(r="--"+r),(i,o)=>{o.style.setProperty(r,i)}}return e.cssProperty===void 0?(r,i)=>{}:(r,i)=>{i.style[e.cssProperty]=r}},cx=e=>{if(!(!e.transform&&!e.transformValue)){if(e.transformValue){if(e.sourceField===void 0)throw Error("Expects 'sourceField' to be set when 'transformValue' is set");return r=>{let i=r[e.sourceField];return e.transformValue(i)}}else if(e.transform){if(e.sourceField!==void 0)throw Error("If 'transform' is set, 'sourceField' is ignored");return r=>e.transform(r)}}},fx=(e,...r)=>{let i=r.map(s=>{if(s.element&&s.element!==void 0)return s;if(s.query)return{...s,element:U(s.query)};throw Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${JSON.stringify(s)}`)}),o=i.map(s=>({update:RP(s,s.element),transformer:cx(s),sourceField:s.sourceField})),a=s=>{for(let l of o)if(l.transformer)l.update(l.transformer(s));else{let u=l.sourceField?s[l.sourceField]:s;typeof u=="object"?(l.sourceField,l.update(JSON.stringify(u))):l.update(u)}},n=e.on(s=>{Fe(s)?a(s.value):hi(s)&&console.warn(s)});return vr(e)&&a(e.last()),{remove:s=>{if(n(),s)for(let l of i)l.element.remove()}}},VP=(e,r,i)=>{let o=U(r),a=s=>{i(s,o)},n=e.on(s=>{Fe(s)?(console.log(s),a(s.value)):console.warn(s)});return vr(e)&&a(e.last()),{remove:s=>{n(),s&&o.remove()}}},LP=(e,r,i,o={})=>{if(r===null)throw Error("Param 'elOrQuery' is null");if(r===void 0)throw Error("Param 'elOrQuery' is undefined");let a=U(r),n=u=>{i(u,a)},s=e.onDiff(u=>{n(u)}),l=()=>{vr(e)&&o.initial&&o.initial(e.last(),a)};return l(),{refresh:()=>{l()},remove:u=>{s(),u&&a.remove()}}},IP=(e,r)=>{let i=r.container?U(r.container):document.body,o=r.defaultTag??"div",a=new Map,n=new Map;for(let[d,h]of Object.entries(r.binds??{})){let p=h.tagName??o;n.set(d,{...h,update:ux(h),transform:cx(h),tagName:p,path:d})}let s=d=>{let h=nl(n,R1(d));if(h!==void 0)return h;if(!d.includes("."))return n.get("_root")};function*l(d){for(let h of V1(d))n.has(h)&&(yield n.get(h));n.has("_root")&&d.includes(".")&&(yield n.get("_root"))}let u=(d,h)=>{let p=us(d);console.log(`Rx.Dom.elements.create: ${d} rooted: ${p} value: ${JSON.stringify(h)}`);let y=s(us(d)),g=o;y?.tagName&&(g=y.tagName);let m=document.createElement(g);m.setAttribute("data-path",d),c(d,m,h);let v;for(let D of l(p))if(D?.nestChildren){let B=Wd(d,"."),V=D.path.replace("_root",B);if(v=a.get(V),v!==void 0)break}(v??i).append(m),a.set(d,m),console.log(`Added el: ${d}`)},c=(d,h,p)=>{console.log(`Rx.dom.update path: ${d} value:`,p);let y=s(us(d));y===void 0?(typeof p=="object"&&(p=JSON.stringify(p)),h.textContent=p):(y.transform&&(p=y.transform(p)),y.update(p,h))},f=d=>{let h=new lt({},d),p=h.dequeue(),y=new Set;for(;p!==void 0;){let g=p.path;if(!("previous"in p)||p.previous===void 0){console.log(`Rx.Dom.elements.changes no previous. path: ${g}`),u(g,p.value);let m=[...ps(p.value,!1,2**53-1,g)];console.log(m);for(let v of m)y.has(v.path)||(h.enqueue(v),y.add(v.path))}else if(p.value===void 0){let m=a.get(g);m===void 0?console.warn(`No element to delete? ${g} `):(console.log(`Rx.Dom.elements.changes delete ${g}`),m.remove())}else{let m=a.get(g);m===void 0?(console.warn(`Rx.Dom.elements.changes No element to update ? ${g} `),u(g,p.value)):c(g,m,p.value)}p=h.dequeue()}};if(e.onDiff(d=>{f(d)}),vr(e)){let d=e.last();f([...ps(d,!1,1)])}},us=e=>{let r=Ka(e,".");return r===e?"_root":"_root."+r};function qP(){let e=()=>({width:window.innerWidth,height:window.innerHeight}),r=wo(window,"resize",{lazy:"very",transform:()=>e()}),i=wo(window,"pointermove",{lazy:"very",transform:a=>{if(a===void 0)return{x:0,y:0};let n=a;return{x:n.x,y:n.y}}});return{dispose:(a="Reactive.win.dispose")=>{r.dispose(a),i.dispose(a)},size:r,pointer:i}}var dx={};A(dx,{bind:()=>fx,bindDiffUpdate:()=>LP,bindElement:()=>Wn,bindHtml:()=>jP,bindText:()=>zP,bindUpdate:()=>VP,bindValueText:()=>OP,browserResizeObservable:()=>FP,colour:()=>MP,cssClassChange:()=>$P,domForm:()=>BP,domHslInputValue:()=>NP,domInputValue:()=>Pf,domNumberInputValue:()=>PP,elements:()=>IP,fromDomQuery:()=>TP,win:()=>qP,windowResize:()=>kP});var _P={};A(_P,{RxUi:()=>dx});const WP=Object.freeze({lastEl:document.getElementById("last"),log:ti.log("#log",{timestamp:!0})});let Xs=Object.freeze({deviceSelEl:void 0,devices:[],activeDevice:void 0});const GP=()=>{const{deviceSelEl:e}=Xs;if(!navigator.requestMIDIAccess)throw new Error("MIDI not supported in this browser.");navigator.requestMIDIAccess().then(r=>{const i=r.inputs;console.log(i);let o=[],a=[];for(const n of i.values())o.push(n.name??"?"),a.push({id:n.id,manufacturer:n.manufacturer,name:n.name,connection:n.connection,state:n.state,type:n.type});e?.setOpts(o),hx({devices:a})},r=>{console.log(r)}),console.log("done")},UP=()=>{const{log:e,lastEl:r}=WP;ti.Forms.checkbox("#evKeydown"),ti.Forms.checkbox("#evKeyup"),ti.Forms.checkbox("#evKeypress");const i=ti.Forms.select("#device",o=>{console.log(o)},{placeholderOpt:"Omni"});hx({deviceSelEl:i}),document.getElementById("btnLogClear")?.addEventListener("click",()=>{e.clear()})};UP();GP();function hx(e){Xs=Object.freeze({...Xs,...e})}
