import"../../modulepreload-polyfill-B5Qt9EMX.js";var fx=Object.create,yl=Object.defineProperty,dx=Object.getOwnPropertyDescriptor,hx=Object.getOwnPropertyNames,px=Object.getPrototypeOf,yx=Object.prototype.hasOwnProperty,gx=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),C=(e,r)=>{for(var i in r)yl(e,i,{get:r[i],enumerable:!0})},mx=(e,r,i,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(var a=hx(r),n=0,s=a.length,l;n<s;n++)l=a[n],!yx.call(e,l)&&l!==i&&yl(e,l,{get:(u=>r[u]).bind(null,l),enumerable:!(o=dx(r,l))||o.enumerable});return e},Ed=(e,r,i)=>(i=e==null?{}:fx(px(e)),mx(yl(i,"default",{value:e,enumerable:!0}),e));const Dd=e=>typeof e=="string"?e:e instanceof Error?e.message:e,tn=(...e)=>{let r=e.filter(o=>Ft(o));if(r.length===0)return;let i=r.map(o=>gl(o));throw Error(i.join(", "))};function w(...e){for(let r of e){let i=typeof r=="object"?r:r();if(!(i===void 0||i.success))throw Hr(i)}return!0}function bx(e){if(e.success)return!0;throw Hr(e)}const vx=(...e)=>{for(let r of e){let i=typeof r=="object"?r:r();if(i!==void 0&&!i.success)return i}};function Ft(e){return typeof e=="object"?!e.success:!1}function Cd(e){return typeof e=="object"?e.success:!1}function Hr(e){if(typeof e.error=="string")throw Error(e.error,{cause:e.info});if(e.error instanceof Error)throw e.error;return Error(JSON.stringify(e.error),{cause:e.info})}function wx(e){if(Cd(e))return e.value;throw Hr(e)}function gl(e){return e.error instanceof Error?Dd(e.error):typeof e.error=="string"?e.error:JSON.stringify(e.error)}const rn=(...e)=>{let r;for(let i of e)if(r=typeof i=="object"?i:i(),r!==void 0&&!r.success)return r;if(!r)throw Error("No results");return r},xx=(e,r)=>{Ft(e)&&r(e)},$d=e=>Math.log2(e)%1==0,Ex=(e,r)=>{if(typeof e!="number")throw TypeError(`v is not a number. Got: ${typeof e}`);return Number.isNaN(e)?r:e},Dx=(e,r="",i=NaN)=>{if(e==null)return i;try{let o=Number.parseInt(typeof e=="number"?e.toString():e);return G(o,r,"parsed").success?o:i}catch{return i}},$=(e,r="",i="?",o)=>{if(e===null)return{success:!1,error:`Parameter '${i}' is null`,info:o};if(e===void 0)return{success:!1,error:`Parameter '${i}' is undefined`,info:o};if(Number.isNaN(e))return{success:!1,error:`Parameter '${i}' is NaN`,info:o};if(typeof e!="number")return{success:!1,error:`Parameter '${i}' is not a number (${JSON.stringify(e)})`,info:o};switch(r){case"finite":if(!Number.isFinite(e))return{success:!1,error:`Parameter '${i} must be finite (Got: ${e})`,info:o};break;case"positive":if(e<0)return{success:!1,error:`Parameter '${i}' must be at least zero (${e})`,info:o};break;case"negative":if(e>0)return{success:!1,error:`Parameter '${i}' must be zero or lower (${e})`,info:o};break;case"aboveZero":if(e<=0)return{success:!1,error:`Parameter '${i}' must be above zero (${e})`,info:o};break;case"belowZero":if(e>=0)return{success:!1,error:`Parameter '${i}' must be below zero (${e})`,info:o};break;case"percentage":if(e>1||e<0)return{success:!1,error:`Parameter '${i}' must be in percentage range (0 to 1). (${e})`,info:o};break;case"nonZero":if(e===0)return{success:!1,error:`Parameter '${i}' must non-zero. (${e})`,info:o};break;case"bipolar":if(e>1||e<-1)return{success:!1,error:`Parameter '${i}' must be in bipolar percentage range (-1 to 1). (${e})`,info:o};break}return{success:!0,value:e,info:o}},Cx=(e,r,i=3)=>{if(i===0)return e=Math.floor(e),r=Math.floor(r),e===r?{success:!0,value:e}:{success:!1,error:"A is not identical to B"};let o=10**i,a=Math.floor(e*o),n=Math.floor(r*o);return a===n?{success:!0,value:e}:{success:!1,error:`A is not close enough to B. A: ${e} B: ${r} Decimals: ${i}`}},it=(e,r="?",i)=>$(e,"percentage",r,i),G=(e,r="",i="?")=>rn($(e,r,i),()=>Number.isInteger(e)?{success:!0,value:e}:{success:!1,error:`Param '${i}' is not an integer`}),Ad=e=>{for(let r of e)if(Math.abs(r)%1!=0)return{success:!1,error:`Value is not an integer: ${r}`};return{success:!0,value:e}},$x=e=>(typeof e=="string"&&(e=Number.parseFloat(e)),G(e).success),Ge=(e,r,i,o="?")=>typeof e=="number"?Number.isNaN(e)?{success:!1,error:`Param '${o}' is not within range ${r}-${i}. Got: NaN`}:Number.isFinite(e)?e<r?{success:!1,error:`Param '${o}' is below range ${r}-${i}. Got: ${e}`}:e>i?{success:!1,error:`Param '${o}' is above range ${r}-${i}. Got: ${e}`}:{success:!0,value:e}:{success:!1,error:`Param '${o}' is not within range ${r}-${i}. Got: infinite`}:{success:!1,error:`Param '${o}' is not a number type. Got type: '${typeof e}' value: '${JSON.stringify(e)}'`},Ie=(e,r="?")=>Array.isArray(e)?{success:!0,value:e}:{success:!1,error:`Parameter '${r}' is expected to be an array'`},uo=(e,r,i="index")=>rn(Ie(e),G(r,"positive",i),Ge(r,0,e.length-1,i)),Ax=e=>Array.isArray(e)?e.some(r=>typeof r!="string")?{success:!1,error:"Contains something not a string"}:{success:!0,value:e}:{success:!1,error:"Value is not an array"},tr=(e,r="?")=>e===void 0?{success:!1,error:`${r} param is undefined`}:e===null?{success:!1,error:`${r} param is null`}:{success:!0,value:e},Sx=e=>e!==void 0,Fx=e=>e instanceof Function,So=(e,r="?")=>e===void 0?{success:!1,error:`Param '${r}' is undefined. Expected: function.`}:e===null?{success:!1,error:`Param '${r}' is null. Expected: function.`}:typeof e=="function"?{success:!0,value:e}:{success:!1,error:`Param '${r}' is type '${typeof e}'. Expected: function`},Sd=e=>{if(typeof e!="object"||!e)return{success:!1,error:"Value is null or not object type"};let r=Object.getPrototypeOf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)?{success:!0,value:e}:{success:!1,error:"Fancy object"}},on=e=>{let r=typeof e;return r==="symbol"?{success:!1,error:"Symbol type"}:r==="function"?{success:!1,error:"Function type"}:r==="bigint"||r==="number"||r==="string"||r==="boolean"?{success:!0,value:e}:Sd(e)},kx=(e,r)=>rn(Fd(e,r),Ad(e)),Fd=(e,r)=>{for(let i of e){if(r.minExclusive!==void 0&&i<=r.minExclusive)return{success:!1,error:`Value '${i}' must be higher than minExclusive: '${r.minExclusive}'`};if(r.minInclusive!==void 0&&i<r.minInclusive)return{success:!1,error:`Value '${i}' must be equal or higher than minInclusive: '${r.minInclusive}'`};if(r.maxExclusive!==void 0&&i>=r.maxExclusive)return{success:!1,error:`Value '${i}' must be less than maxExclusive: '${r.maxExclusive}'`};if(r.maxInclusive!==void 0&&i>r.maxInclusive)return{success:!1,error:`Value '${i}' must be equal or less than maxInclusive: '${r.maxInclusive}'`}}return{success:!0,value:e}},ml=(e,r="",i="?")=>{if(typeof e!="string")return{success:!1,error:`Param '${i} is not type string. Got: ${typeof e}`};switch(r){case"non-empty":if(e.length===0)return{success:!1,error:`Param '${i} is empty`};break}return{success:!0,value:e}};var Nx={};C(Nx,{arrayIndexTest:()=>uo,arrayStringsTest:()=>Ax,arrayTest:()=>Ie,functionTest:()=>So,getErrorMessage:()=>Dd,ifNaN:()=>Ex,integerArrayTest:()=>Ad,integerParse:()=>Dx,integerTest:()=>G,isDefined:()=>Sx,isFunction:()=>Fx,isInteger:()=>$x,isPowerOfTwo:()=>$d,nullUndefTest:()=>tr,numberDecimalTest:()=>Cx,numberInclusiveRangeTest:()=>Ge,numberTest:()=>$,percentTest:()=>it,rangeIntegerTest:()=>kx,rangeTest:()=>Fd,resultErrorToString:()=>gl,resultFirstFail_:()=>vx,resultIsError:()=>Ft,resultIsOk:()=>Cd,resultThrow:()=>w,resultThrowSingle:()=>bx,resultToError:()=>Hr,resultToValue:()=>wx,resultWithFail:()=>xx,resultsCollate:()=>rn,stringTest:()=>ml,testPlainObject:()=>Sd,testPlainObjectOrPrimitive:()=>on,throwIfFailed:()=>tn});const Px=e=>{tn(Ie(e,"options"));let r=[...e],i=0,o=()=>(i++,i===r.length&&(i=0),n()),a=()=>(i--,i===-1&&(i=r.length-1),n()),n=()=>r.at(i);return{toArray:()=>[...r],next:o,prev:a,get current(){return n()},select:u=>{if(typeof u=="number")i=u;else{let c=r.indexOf(u);if(c===-1)throw Error("Could not find value");i=c}}}},Mx=(e,r)=>{if(w($(r,"","index")),!Array.isArray(e))throw Error("Param 'array' is not an array");return r%=e.length,e.at(r)};function Bx(e,r){tn(G(r,"aboveZero","size"),Ie(e,"array"));let i=[];for(let o=0;o<e.length;o+=r)i.push(e.slice(o,o+r));return i}const Aa=e=>typeof e=="string"?e:JSON.stringify(e),Fo=(e,r)=>e===r,zx=(e,r)=>e===r?!0:Aa(e)===Aa(r),Tx=(e,r,i=Fo)=>{if(!Array.isArray(e))throw TypeError("Expects haystack parameter to be an array");if(!Array.isArray(r))throw TypeError(`Expects needles parameter to be an array. Got: ${typeof r}`);for(let o of r){let a=!1;for(let n of e)if(i(o,n)){a=!0;break}if(!a)return!1}return!0},Ox=(e,r=Aa)=>{if(typeof e!="object")throw Error(`Param 'data' is expected to be an Iterable. Got type: ${typeof e}`);let i=new Set;for(let o of e){let a=r(o);if(i.has(a))return!0;i.add(a)}return!1},kd=e=>{if(!Array.isArray(e))throw Error("Parameter needs to be an array");for(let r=0;r<e.length;r++)for(let i=0;i<e.length;i++)if(r!==i&&e[r]===e[i])return!0;return!1};function jx(e,r,i="undefined"){if(e===void 0)throw Error("Data undefined");if(!Array.isArray(e))throw Error("data is not an array");if(e.length===r)return[...e];if(e.length>r)return e.slice(0,r);let o=[...e],a=r-o.length;for(let n=0;n<a;n++)switch(i){case"undefined":o.push(void 0);break;case"repeat":o.push(e[n%e.length]);break;case"first":o.push(e[0]);break;case"last":o.push(e.at(-1));break}return o}const Nd=(e,r,i=Fo)=>{if(w(Ie(e,"arrayA"),Ie(r,"arrayB")),e.length!==r.length)return!1;for(let o=0;o<e.length;o++)if(!i(e[o],r[o]))return!1;return!0},bl=(e,r)=>{if(!Array.isArray(e))throw Error("Param 'array' is not an array.");if(e.length===0)return!0;let i=r??zx,o=e[0];return!e.some(n=>!i(o,n))},Rx=(e,r)=>{let i=[],o=[];for(let a of e)r(a)?i.push(a):o.push(a);return[i,o]};function*Vx(e,r,i,o){w(Ie(e,"array")),i===void 0&&(i=0),o===void 0&&(o=e.length),w(uo(e,i,"startIndex")),w(uo(e,o-1,"endIndex"));for(let a=i;a<o;a++)r(e[a],a,e)&&(yield e[a])}const Lx=e=>[...e].flat(),Ix=(e,r)=>{if(!Array.isArray(r))throw TypeError(`Param 'array' is expected to be an array. Got type: '${typeof r}'`);let i=new Map;for(let o of r){let a=e(o);if(typeof a!="string"&&typeof a!="number")throw TypeError(`groupBy function is expected to return type string or number. Got type: '${typeof a}' for value: '${o}'`);let n=i.get(a);n??=0,n++,i.set(a,n)}return i},qx=(e,r)=>{let i=new Map;for(let o of e){let a=r(o),n=i.get(a);n||(n=[],i.set(a,n)),n.push(o)}return i},_x=(e,r=Fo)=>{let i=[],o=n=>{for(let s of i)if(r(s,n))return!0;return!1},a=e.flat(10);for(let n of a)o(n)||i.push(n);return i},Pd=(e,r=Aa)=>{let i=new Set,o=[],a=e.flat(10);for(let n of a){let s=r(n);i.has(s)||(i.add(s),o.push(n))}return o},Md=(e,r,...i)=>(tn(Ie(e,"data"),uo(e,r,"index")),r===e.length-1?[...e,...i]:r===0?[...i,...e]:[...e.slice(0,r),...i,...e.slice(r)]),Wx=(...e)=>{if(e.some(a=>!Array.isArray(a)))throw Error("All parameters must be an array");let r=e.map(a=>a.length);if(!bl(r))throw Error("Arrays must be of same length");let i=[],o=r[0];for(let a=0;a<o;a++)for(let n of e)i.push(n[a]);return i},Gx=(e,r,i=Fo)=>e.filter(o=>r.some(a=>i(o,a))),Ux=(e,r,...i)=>{let o=new Map;for(let a of i)for(let n of a){if(n===void 0)continue;let s=e(n),l=o.get(s);l=l?r(l,n):n,o.set(s,l)}return[...o.values()]};function*Bd(e){if(w(Ie(e,"values")),e.length<2)throw Error(`Array needs to have at least two entries. Length: ${e.length}`);for(let r=1;r<e.length;r++)yield[e[r-1],e[r]]}const Jx=(e,r,i)=>{if(w(Ie(e,"arr")),e.length<2)return i;for(let o=0;o<e.length-1;o++)i=r(i,e[o],e[o+1]);return i},vl=(e,r=Math.random)=>{w(Ie(e,"dataToShuffle"));let i=[...e];for(let o=i.length-1;o>0;o--){let a=Math.floor(r()*(o+1));[i[o],i[a]]=[i[a],i[o]]}return i},zd=(e,r=Math.random)=>(w(Ie(e,"array")),e[Math.floor(r()*e.length)]),Hx=(e,r=Math.random)=>Math.floor(r()*e.length),Td=(e,r)=>{if(!Array.isArray(e))throw TypeError("'data' parameter should be an array");return w(uo(e,r,"index")),[...e.slice(0,r),...e.slice(r+1)]},Kx=(e,r)=>{if(!Array.isArray(e))throw TypeError(`Param 'array' is not actually an array. Got type: ${typeof e}`);let i=1;if(r<=1){let a=e.length*r;i=Math.round(e.length/a)}else i=r;if(w(G(i,"positive","amount")),i>e.length-1)throw Error("Subsample steps exceeds array length");let o=[];for(let a=i-1;a<e.length;a+=i)o.push(e[a]);return o},ko=(e,r)=>[...e].sort((i,o)=>{w(Ie(e,"data"));let a=i[r],n=o[r];return a<n?-1:a>n?1:0}),Qx=(e,r,i)=>[...e].sort((o,a)=>{w(Ie(e,"data"));let n=o[r],s=a[r];return i===void 0?n<s?-1:n>s?1:0:i(n,s)});function*Zx(e,r,i){let o=i;for(let a of e){let n=r(a,o);if(typeof n=="boolean"){if(n)break}else{let[s,l]=n;if(s)break;o=l}yield a}}const Xx=e=>e.filter(r=>r!==void 0),an=(e,r,i=Fo)=>{if(Array.isArray(r)){let o=[];for(let a of e)r.some(n=>i(a,n))||o.push(a);return o}else return e.filter(o=>!i(o,r))},Od=(...e)=>{if(e.some(a=>!Array.isArray(a)))throw Error("All parameters must be an array");let r=e.map(a=>a.length);if(!bl(r))throw Error("Arrays must be of same length");let i=[],o=r[0];for(let a=0;a<o;a++)i.push(e.map(n=>n[a]));return i};var Yx={};C(Yx,{atWrap:()=>Mx,chunks:()=>Bx,contains:()=>Tx,containsDuplicateInstances:()=>kd,containsDuplicateValues:()=>Ox,containsIdenticalValues:()=>bl,cycle:()=>Px,ensureLength:()=>jx,filterAB:()=>Rx,filterBetween:()=>Vx,flatten:()=>Lx,frequencyByGroup:()=>Ix,groupBy:()=>qx,insertAt:()=>Md,interleave:()=>Wx,intersection:()=>Gx,isEqual:()=>Nd,mergeByKey:()=>Ux,pairwise:()=>Bd,pairwiseReduce:()=>Jx,randomElement:()=>zd,randomIndex:()=>Hx,remove:()=>Td,sample:()=>Kx,shuffle:()=>vl,sortByNumericProperty:()=>ko,sortByProperty:()=>Qx,unique:()=>Pd,uniqueDeep:()=>_x,until:()=>Zx,without:()=>an,withoutUndefined:()=>Xx,zip:()=>Od});function at(e){return typeof e=="number"||typeof e=="string"||typeof e=="bigint"||typeof e=="boolean"}const jd=(e,r=null,i=new WeakSet,o="")=>{if(e===null)return e;if(typeof e!="object")throw TypeError(`Param 'value' must be an object. Got type: ${typeof e}`);i.add(e);let a=Object.entries(e);for(let n of a)if(!(n[1]===null||typeof n[1]!="object")){if(i.has(n[1])){n[1]=r;continue}n[1]=jd(n[1],r,i,`${n[0]}.`)}return Object.fromEntries(a)},Bt=e=>typeof e=="string"?e:JSON.stringify(e),ed=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw TypeError("Symbol cannot be converted to string");try{return JSON.stringify(e)}catch(r){if(typeof e=="object")return JSON.stringify(jd(e,"(circular)"));throw r}},eE=(e,r)=>e===r?0:e>r?1:-1,tE=(e,r)=>{if(e===void 0&&r===void 0)return 0;if(e===void 0)return 1;if(r===void 0)return-1;let i=ed(e),o=ed(r);return i<o?-1:i>o?1:0},No=(e,r)=>typeof e=="number"&&typeof r=="number"?eE(e,r):tE(e,r),td=e=>{if(typeof e=="string")return e;let r=new Set;return JSON.stringify(e,(i,o)=>(r.add(i),o)),JSON.stringify(e,[...r].sort())},Y=(e,r)=>e===r,Rd=(e,r)=>e===r?!0:Bt(e)===Bt(r),wl=(e,r)=>e===r?!0:td(e)===td(r),Vd=(e,r,i)=>JSON.stringify(e)===JSON.stringify(r);var rE={};C(rE,{addObjectEntriesMutate:()=>Fa,addValue:()=>El,addValueMutate:()=>Gd,addValueMutator:()=>Dl,deleteByValueCompareMutate:()=>qd,filterValues:()=>Al,findBySomeKey:()=>xl,findEntryByPredicate:()=>_d,findEntryByValue:()=>Wd,findValue:()=>Sl,fromIterable:()=>Jd,fromObject:()=>Hd,getClosestIntegerKey:()=>Ld,getOrGenerate:()=>Fl,getOrGenerateSync:()=>eh,hasAnyValue:()=>$l,hasKeyValue:()=>Id,mapToArray:()=>Xd,mapToObjectTransform:()=>Kd,mergeByKey:()=>Yd,some:()=>co,sortByValue:()=>Ud,sortByValueProperty:()=>Cl,toArray:()=>Sa,toObject:()=>Zd,transformMap:()=>Qd,zipKeyValue:()=>Po});const Ld=(e,r)=>{if(r=Math.round(r),e.has(r))return r;{let i=1;for(;i<1e3;){if(e.has(r-i))return r-i;if(e.has(r+i))return r+i;i++}throw Error(`Could not find target ${r.toString()}`)}},xl=(e,r)=>{for(let i of r)if(e.has(i))return e.get(i)},Id=(e,r,i,o=Y)=>e.has(r)?[...e.values()].some(n=>o(n,i)):!1,qd=(e,r,i=Y)=>{for(let o of e.entries())i(o[1],r)&&e.delete(o[0])},_d=(e,r)=>{for(let i of e.entries())if(r(i[1],i[0]))return i},Wd=(e,r,i=Y)=>{for(let o of e.entries())if(i(o[1],r))return o},Gd=(e,r,i,...o)=>{let a=e??new Map;return Dl(a,r,i)(...o),a},El=(e,r,i,...o)=>{let a=e===void 0?new Map:new Map(e);for(let n of o){let s=r(n);if(i!=="overwrite"&&a.has(s)){if(i==="throw")throw Error(`Key '${s}' already in map`);if(i==="skip")continue}a.set(s,n)}return a},Dl=(e,r,i="overwrite")=>(...o)=>{for(let a of o){let n=r(a);if(i!=="overwrite"&&e.has(n)){if(i==="throw")throw Error(`Key '${n}' already in map`);if(i==="skip")continue}e.set(n,a)}return e},Ud=(e,r)=>{let i=r??No;return[...e.entries()].sort((o,a)=>i(o[1],a[1]))},Cl=(e,r,i)=>{let o=i===void 0?No:i;return[...e.entries()].sort((a,n)=>{let s=a[1],l=n[1];return o(s[r],l[r])})},$l=(e,r,i)=>[...e.entries()].some(a=>i(a[1],r));function*Al(e,r){for(let i of e.values())r(i)&&(yield i)}const Sa=e=>[...e.values()],Jd=(e,r=Bt,i="overwrite")=>{let o=new Map;for(let a of e){let n=r(a);if(o.has(n)){if(i==="throw")throw Error(`Key '${n}' is already used and new data will overwrite it. `);if(i==="skip")continue}o.set(n,a)}return o},Hd=e=>{let r=new Map;if(Array.isArray(e))for(let i of e)Fa(r,i);else Fa(r,e);return r},Fa=(e,r)=>{let i=Object.entries(r);for(let[o,a]of i)e.set(o,a)},Sl=(e,r)=>[...e.values()].find(i=>r(i)),co=(e,r)=>[...e.values()].some(i=>r(i)),Kd=(e,r)=>[...e].reduce((i,[o,a])=>{let n=r(a);return i[o]=n,i},{}),Po=(e,r)=>{if(e.length!==r.length)throw Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((i,o)=>[i,r[o]]))},Qd=(e,r)=>new Map(Array.from(e,i=>[i[0],r(i[1],i[0])])),Zd=e=>[...e].reduce((r,[i,o])=>(r[i]=o,r),{}),Xd=(e,r)=>[...e.entries()].map(i=>r(i[0],i[1])),Yd=(e,...r)=>{let i=new Map;for(let o of r)for(let[a,n]of o){let s=i.get(a);s=s?e(s,n):n,i.set(a,s)}return i},eh=(e,r)=>(i,o)=>{let a=e.get(i);return a===void 0&&(a=r(i,o),e.set(i,a)),a},Fl=(e,r)=>async(i,o)=>{let a=e.get(i);if(a!==void 0)return a;if(a=await r(i,o),a===void 0)throw Error("fn returned undefined");return e.set(i,a),a},or=(e,r=0,i={})=>{let o=j(r,0);w(G(o,"positive","interval"));let a=i.fireBeforeWait??!1,n=i.onStartCalled,s=i.signal,l=!1,u="idle",c=0,f=0,d=performance.now(),h=r??0,p=!1,y,g=()=>{y!==void 0&&(globalThis.clearTimeout(y),y=void 0,c=0,d=NaN)},m=x=>{o===0?typeof requestAnimationFrame>"u"?y=globalThis.setTimeout(x,0):(y=void 0,requestAnimationFrame(x)):y=globalThis.setTimeout(x,o)},v=()=>{p||(p=!0,u!=="idle"&&(u="idle",g()))},D=async()=>{if(s?.aborted&&(u="idle"),u==="idle")return;u="running",c++,f++;let x=e(c,performance.now()-d),F=typeof x=="object"?await x:x;if(!p){if(u="scheduled",F!==void 0&&!F){v();return}p||m(D)}},B=()=>{if(l)throw Error("Disposed");if(p=!1,n!==void 0)switch(n(c,performance.now()-d)){case"cancel":v();return;case"reset":V();return;case"dispose":l=!0,v();return}u==="idle"&&(c=0,d=performance.now(),u="scheduled",a?D():m(D))},V=()=>{if(l)throw Error("Disposed");p=!1,c=0,d=NaN,u!=="idle"&&v(),B()};return{start:B,reset:V,cancel:v,get interval(){return h},get runState(){return u},get startCountTotal(){return f},get startCount(){return c},set interval(x){let F=j(x,0);w(G(F,"positive","interval")),o=F,h=x},get isDisposed(){return l},get elapsedMs(){return performance.now()-d}}},Mo=e=>typeof e=="string"?e:JSON.stringify(e),Lr=()=>{let e=performance.now();return()=>performance.now()-e},iE=()=>{let e=performance.now();return()=>{let r=performance.now(),i=r-e;return e=r,i}},oE=()=>()=>1/0;function*aE(e,r="."){for(;e.length>0;){yield e;let i=nn(e,r);if(i===e)break;e=i}}function*nE(e,r="."){for(;e.length>0;){yield e;let i=th(e,r,{ifNoMatch:"original",fromEnd:!0});if(i===e)break;e=i}}const sE=(e,r=15)=>{if(w(G(r,"aboveZero","maxLength")),typeof e!="string")throw Error("Parameter 'source' is not a string");if(e.length>r&&e.length>3){if(r>15){let i=Math.round((r-2)/2);return e.slice(0,i)+"..."+e.slice(-i)}return e.slice(0,r)+"..."}return e},ka=(e,r=20)=>e===void 0?"(undefined)":e===null?"(null)":sE(JSON.stringify(e),r),Na=(e,r,i=0,o=e.length-1)=>{for(let a=i;a<=o;a++)if(e.codePointAt(a)===r)return a;return-1},Pa=(e,r,i)=>e.slice(0,r)+e.slice(r+i),lE=(e,r)=>{if(w(G(r,"aboveZero","length")),e===null)throw Error("source parameter null");if(typeof e!="string")throw TypeError("source parameter not a string");let i=Math.ceil(e.length/r),o=[],a=0;for(let n=0;n<i;n++)o.push(e.slice(a,a+r)),a+=r;return o},th=(e,r,i={})=>rh(e,r,i)[0],nn=(e,r,i={})=>rh(e,r,i)[1],rh=(e,r,i={})=>{if(e===void 0)throw Error("Param 'source' is undefined");let o=i.fallback,a=i.ifNoMatch??(o?"fallback":"original");if(a==="original"&&(o=e),a==="fallback"&&o===void 0)throw Error("Fallback must be provided");let n=i.startPos??void 0,s=i.fromEnd??!1,l=s?e.lastIndexOf(r,n):e.indexOf(r,n);if(l<0&&a==="throw")throw Error(`Match '${r}' not found in source.`);return l<0&&a==="original"?[e,e]:l<0&&a==="fallback"?[o,o]:[e.slice(0,l),e.slice(Math.max(0,l+r.length))]},uE=e=>{let r=o=>o.replaceAll(/([!$()*+./:=?[\\\]^{|}])/g,"\\$1");e=e.split("*").map(o=>r(o)).join(".*"),e="^"+e+"$";let i=new RegExp(e);return o=>i.test(o)},ih=(e,r,i=Y)=>{let o=[],a=[],n=[];for(let l of e){let u=!1;for(let c of r)if(i(l,c)){u=!0;break}u?o.push(l):a.push(l)}for(let l of r){let u=!1;for(let c of e)i(l,c)&&(u=!0);u||n.push(l)}let s=a.length===0&&n.length===0;return{shared:o,isSame:s,a,b:n}};function cE(e,r,i){w(G(e,"positive","decimalPlaces"));let o=typeof r=="boolean"?r:!1,a;if(e===0)a=Math.round;else{let n=10**e;a=o?s=>Math.ceil(s*n)/n:s=>Math.floor(s*n)/n}return typeof r=="number"?a(r):a}function j(e,r){if(fE(e)){if(typeof e=="number")return e;let i=e.millis??0;return i+=(e.hours??0)*60*60*1e3,i+=(e.mins??0)*60*1e3,i+=(e.secs??0)*1e3,i}else{if(r!==void 0)return r;throw Error(`Not a valid interval: ${JSON.stringify(e)}`)}}function fE(e){if(e==null)return!1;if(typeof e=="number")return!(Number.isNaN(e)||!Number.isFinite(e));if(typeof e!="object")return!1;let r="millis"in e,i="secs"in e,o="mins"in e,a="hours"in e;return r&&!$(e.millis).success||i&&!$(e.secs).success||o&&!$(e.mins).success||a&&!$(e.hours).success?!1:!!(r||i||a||o)}const oh=(e,r=2)=>{let i=0;if(typeof e=="function"){let a=e();return oh(a)}else typeof e=="number"?i=e:typeof e=="object"&&(i=j(i));let o=j(i);return o===void 0?"(undefined)":o<1e3?`${cE(r,o)}ms`:(o/=1e3,o<120?`${o.toFixed(1)}secs`:(o/=60,o<60?`${o.toFixed(2)}mins`:(o/=60,`${o.toFixed(2)}hrs`)))},dE=(e,r)=>new Promise(i=>{let o=(...a)=>{e.removeEventListener(r,o),Array.isArray(a)&&a.length===1?i(a[0]):i(a)};e.addEventListener(r,o)}),kl=e=>typeof e!="object"||!e?!1:"on"in e&&"onValue"in e,ah=e=>kl(e)?"last"in e&&e.last()!==void 0:!1,hE=(e,r)=>(i,o)=>{let a=e.get(i);return a===void 0&&(a=r(i,o),e.set(i,a)),a},ni=(e,r="log",i)=>o=>{o===void 0?o="(undefined)":typeof o=="object"&&(o=JSON.stringify(o));let a=i??e;switch(r){case"log":console.log(`%c${e} ${o}`,`color: ${nh(a)}`);break;case"warn":console.warn(e,o);break;case"error":console.error(e,o);break}},As=(e,r=!0,i)=>r?{log:ni(e,"log",i),warn:ni(e,"warn",i),error:ni(e,"error",i)}:{log:o=>{},warn:ni(e,"warn",i),error:ni(e,"error",i)},Nl=(e,r={})=>{if(e===void 0||typeof e=="boolean"&&!e)return a=>{};let i=r.category??"",o=r.kind??void 0;return typeof e=="boolean"?a=>{let n=typeof a=="string"?{msg:a}:a,s=n.kind??o,l=n.category??i,u=n.msg;switch(l&&(u=`[${l}] ${u}`),s){case"error":console.error(u);break;case"warn":console.warn(u);break;case"info":console.info(u);break;default:console.log(u)}}:e};let pE=0;const nh=hE(new Map,()=>`hsl(${++pE*137.508},50%,75%)`),yE=(e=!0,r=500)=>{let i=0,o=0,a=performance.now();return()=>{if(i++>=r){let n=performance.now()-a;a=performance.now(),i=0,o=Math.floor(r/n*1e3),e&&console.log(`fps: ${o}`)}return o}},ut=e=>typeof e=="string"?e:e instanceof Error?e.message:e;var gE={};C(gE,{fpsCounter:()=>yE,getErrorMessage:()=>ut,logColours:()=>nh,logSet:()=>As,logger:()=>ni,resolveLogOption:()=>Nl});async function mE(e,...r){if(typeof e=="object")if("next"in e){let i=e[Symbol.toStringTag];if(i==="Generator"||i=="Array Iterator"){let o=e.next();return"done"in o&&"value"in o?o.value:o}else if(i==="AsyncGenerator"){let o=await e.next();return"done"in o&&"value"in o?o.value:o}else throw Error(`Object has 'next' prop, but does not have 'AsyncGenerator', 'Generator' or 'Array Iterator' string tag symbol. Got: '${i}'`)}else if(kl(e)){if(ah(e))return e.last();throw Error("Reactive does not have last value")}else return e;else return typeof e=="function"?await e(r):e}function sh(e,...r){if(typeof e=="object")if("next"in e){let i=e[Symbol.toStringTag];if(i==="Generator"||i=="Array Iterator"){let o=e.next();return"done"in o&&"value"in o?o.value:o}else throw Error(i==="AsyncGenerator"?"resolveSync cannot work with an async generator":`Object has 'next' prop, but does not have 'Generator' or 'Array Iterator' string tag symbol. Got: '${i}'`)}else if(kl(e)){if(ah(e))return e.last();throw Error("Reactive does not have last value")}else return e;else return typeof e=="function"?e(r):e}function bE(e,r,...i){let o=!1,a=r.value,n=r.overrideWithLast;if(a===void 0)throw Error("Needs a fallback value");try{let s=sh(e,...i);return s===void 0||typeof s=="number"&&Number.isNaN(s)?a:(n&&(a=s),s)}catch(s){return o||(o=!0,console.warn("resolveWithFallbackSync swallowed an error. Additional errors not reported.",ut(s))),a}}(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});const Ce=e=>{let r=j(e,1),i=e.signal,o=e.value;return w($(r,"positive","timeoutMs")),r===0?new Promise(a=>requestAnimationFrame(n=>{a(o)})):new Promise((a,n)=>{let s=()=>{clearTimeout(l),i?(i.removeEventListener("abort",s),n(Error(i.reason))):n(Error("Cancelled"))};i&&i.addEventListener("abort",s);let l=setTimeout(()=>{if(i?.removeEventListener("abort",s),i?.aborted){n(Error(i.reason));return}a(o)},r)})};var lh=class uh extends Array{#e;#t;constructor(r=0){super(),w(G(r,"positive","capacity")),this.#e=r,this.#t=0}add(r){let i=uh.from(this);return i[this.#t]=r,i.#e=this.#e,this.#e>0?i.#t=this.#t+1===this.#e?0:this.#t+1:i.#t=this.#t+1,i}get pointer(){return this.#t}get isFull(){return this.#e===0?!1:this.length===this.#e}};const Z=e=>typeof e!="object"||!e?!1:Symbol.asyncIterator in e,wi=e=>typeof e!="object"||!e?!1:Symbol.iterator in e;function*ch(e,r=0,i=1/0){if(i<r)throw Error("Param 'end' should be more than 'start'");if(r<0)throw Error("Param 'start' should be at least 0");let o=0;for(let a of e){if(o<r){o++;continue}if(o>i)break;yield a,o++}}function fh(e,r,i){for(let o of e)i=r(i,o);return i}var dh={};C(dh,{asCallback:()=>ph,chunks:()=>yh,chunksOverlapping:()=>xE,concat:()=>gh,dropWhile:()=>mh,equals:()=>vh,every:()=>wh,fill:()=>xh,filter:()=>Dh,find:()=>Ch,first:()=>wE,flatten:()=>$h,forEach:()=>Eh,fromArray:()=>sn,fromIterable:()=>Nh,last:()=>Pl,map:()=>Ml,max:()=>Ah,min:()=>Sh,next:()=>EE,reduce:()=>fh,repeat:()=>DE,slice:()=>ch,some:()=>Fh,toArray:()=>Ph,unique:()=>Ss,uniqueByValue:()=>hh,until:()=>bh,yieldNumber:()=>vE,zip:()=>kh});function*hh(e,r=Bt,i=new Set){for(let o of e){let a=r(o);i.has(a)||(i.add(a),yield o)}}function ph(e,r,i){for(let o of e)r(o);i&&i()}function vE(e,r){return()=>{let i=e.next().value;return i===void 0?r:i}}function wE(e){for(let r of e)return r}function Pl(e){let r;for(let i of e)r=i;return r}function*xE(e,r){if(r<=1)throw Error("Size should be at least 2");let i=[];for(let o of e)i.push(o),i.length===r&&(yield i,i=[i.at(-1)]);i.length<=1||i.length>0&&(yield i)}function*yh(e,r){let i=[];for(let o of e)i.push(o),i.length===r&&(yield i,i=[]);i.length>0&&(yield i)}function*gh(...e){for(let r of e)yield*r}function*mh(e,r){for(let i of e)r(i)||(yield i)}const bh=(e,r)=>{for(let i of e){let o=r();if(typeof o=="boolean"&&!o)break}},EE=e=>()=>{let r=e.next();if(!r.done)return r.value};function vh(e,r,i){for(;;){let o=e.next(),a=r.next();if(i!==void 0){if(!i(o.value,a.value))return!1}else if(o.value!==a.value)return!1;if(o.done??a.done)return o.done&&a.done}}function wh(e,r){for(let i of e)if(!r(i))return!1;return!0}function*xh(e,r){for(let i of e)yield r}function Eh(e,r){for(let i of e){let o=r(i);if(typeof o=="boolean"&&!o)break}}function*Dh(e,r){for(let i of e)r(i)&&(yield i)}function Ch(e,r){for(let i of e)if(r(i))return i}function*$h(e){for(let r of e)if(typeof r=="object"){if(Array.isArray(r))for(let i of r)yield i;else if(wi(r))for(let i of r)yield i}else yield r}function*Ml(e,r){for(let i of e)yield r(i)}function*Ah(e,r=(i,o)=>i>o){let i;for(let o of e){if(i===void 0){i=o,yield i;continue}r(o,i)&&(i=o,yield i)}return i}function*Sh(e,r=(i,o)=>i>o){let i;for(let o of e)i===void 0&&(i=o,yield i),r(i,o)&&(i=o,yield i)}function Fh(e,r){for(let i of e)if(r(i))return!0;return!1}function*DE(e,r){let i=typeof r=="number"?r:1/0,o=typeof r=="number"?void 0:r,a=i;for(;;){for(let n of e())if(yield n,o?.aborted)break;if(Number.isFinite(i)&&(a--,a===0)||o?.aborted)break}}function*Ss(e){let r=[],i=[];i=Array.isArray(e)?e:[e];for(let o of i)for(let a of o)r.includes(a)||(r.push(a),yield a)}function*kh(...e){let r=e.map(i=>i[Symbol.iterator]());for(;;){let i=r.map(o=>o.next());if(i.some(o=>o.done))return;yield i.map(o=>o.value)}}function*Nh(e){for(let r of e)yield r}function Ph(e,r={}){let i=[],o=Date.now(),a=r.while,n=r.limit??1/0,s=j(r.elapsed,1/0);for(let l of e){if(a&&!a(i.length)||i.length>=n||Date.now()-o>s)break;i.push(l)}return i}function*sn(e){for(let r of e)yield r}const CE=(e,r)=>{e.debug&&console.log(`queue:${r}`)},Mh=(e,r,i)=>{let o=r.length+i.length,a=e.capacity??o,n=o-a,s=e.discardPolicy??"additions";switch(s){case"additions":return r.length===0?i.slice(0,i.length-n):r.length===e.capacity?r:[...r,...i.slice(0,n-1)];case"newer":if(n>=r.length)return r.length===0?[...i.slice(0,a-1),i.at(-1)]:i.slice(Math.max(0,i.length-a),Math.min(i.length,a)+1);{let l=Math.max(1,i.length-r.length),u=i.slice(i.length-l,i.length);return[...r.slice(0,Math.min(r.length,a-1)),...u]}case"older":return[...r,...i].slice(n);default:throw Error(`Unknown overflow policy ${s}`)}},Bl=(e,r,...i)=>{if(e===void 0)throw Error("opts parameter undefined");let o=r.length+i.length,a=e.capacity&&o>e.capacity,n=a?Mh(e,r,i):[...r,...i];if(e.capacity&&n.length!==e.capacity&&a)throw Error(`Bug! Expected return to be at capacity. Return len: ${n.length} capacity: ${e.capacity} opts: ${JSON.stringify(e)}`);if(!e.capacity&&n.length!==o)throw Error(`Bug! Return length not expected. Return len: ${n.length} expected: ${o} opts: ${JSON.stringify(e)}`);return n},zl=(e,r)=>{if(r.length===0)throw Error("Queue is empty");return r.slice(1)},Ma=(e,r)=>r[0],Tl=(e,r)=>r.length===0,Ol=(e,r)=>e.capacity?r.length>=e.capacity:!1;var $E=class{#e=new Map;get(r){let i=this.#e.get(r);return i?[...i]:[]}size(r){let i=this.#e.get(r);return i?i.length:0}*iterateKey(r){let i=this.#e.get(r);i&&(yield*i.values())}*iterateValues(){for(let r of this.#e.keys())yield*this.iterateKey(r)}*iterateKeys(){yield*this.#e.keys()}addKeyedValues(r,...i){let o=this.#e.get(r);o||(o=[],this.#e.set(r,o)),o.push(...i)}deleteKeyValue(r,i){let o=this.#e.get(r);if(!o)return!1;let a=o.filter(n=>n!==i);return a.length===o.length?!1:(this.#e.set(r,a),!0)}clear(){this.#e.clear()}},Ye=class{#e=new $E;#t=!1;dispose(){this.#t||this.clearEventListeners()}get isDisposed(){return this.#t}fireEvent(e,r){if(this.#t)throw Error("Disposed");for(let i of this.#e.iterateKey(e))i(r,this)}addEventListener(e,r){if(this.#t)throw Error("Disposed");this.#e.addKeyedValues(e,r)}removeEventListener(e,r){this.#t||this.#e.deleteKeyValue(e,r)}clearEventListeners(){this.#t||this.#e.clear()}},AE={};C(AE,{SimpleEventEmitter:()=>Ye});var ct=class extends Ye{options;data;eq;constructor(e={},r=[]){if(super(),e===void 0)throw Error("opts parameter undefined");this.options=e,this.data=r,this.eq=e.eq??Y}clear(){let e=[...this.data];this.data=[],this.fireEvent("removed",{finalData:this.data,removed:e}),this.onClear()}onClear(){}at(e){if(e>=this.data.length)throw Error("Index outside bounds of queue");let r=this.data.at(e);if(r===void 0)throw Error("Index appears to be outside range of queue");return r}enqueue(...e){this.data=Bl(this.options,this.data,...e);let r=this.data.length;return this.onEnqueue(this.data,e),r}onEnqueue(e,r){this.fireEvent("enqueue",{added:r,finalData:e})}dequeue(){let e=Ma(this.options,this.data);if(e!==void 0)return this.data=zl(this.options,this.data),this.fireEvent("dequeue",{removed:e,finalData:this.data}),this.onRemoved([e],this.data),e}onRemoved(e,r){this.fireEvent("removed",{removed:e,finalData:r})}removeWhere(e){let r=this.data.length,i=this.data.filter(o=>e(o));return i.length===0?0:(this.data=this.data.filter(o=>!e(o)),this.onRemoved(i,this.data),r-this.data.length)}toArray(){return[...this.data]}get isEmpty(){return Tl(this.options,this.data)}get isFull(){return Ol(this.options,this.data)}get length(){return this.data.length}get peek(){return Ma(this.options,this.data)}};function Bh(e={},...r){return new ct({...e},[...r])}const zh=(e,r,i)=>{let o=r.length+i.length,a=e.discardPolicy??"additions",n=e.capacity??o,s=o-n;switch(e.debug&&console.log(`Stack.push: stackLen: ${r.length} potentialLen: ${o} toRemove: ${s} policy: ${a}`),a){case"additions":return e.debug&&console.log(`Stack.push:DiscardAdditions: stackLen: ${r.length} slice: ${o-n} toAddLen: ${i.length}`),r.length===e.capacity?r:[...r,...i.slice(0,i.length-s)];case"newer":return s>=r.length?i.slice(Math.max(0,i.length-n),Math.min(i.length,n)+1):(e.debug&&console.log(` from orig: ${JSON.stringify(r.slice(0,r.length-s))}`),[...r.slice(0,r.length-s),...i.slice(0,Math.min(i.length,n-s+1))]);case"older":return[...r,...i].slice(s);default:throw Error(`Unknown discard policy ${a}`)}},jl=(e,r,...i)=>{let o=r.length+i.length;return e.capacity&&o>e.capacity?zh(e,r,i):[...r,...i]},Rl=(e,r)=>{if(r.length===0)throw Error("Stack is empty");return r.slice(0,-1)},Ba=(e,r)=>r.at(-1),Vl=(e,r)=>r.length===0,Ll=(e,r)=>e.capacity?r.length>=e.capacity:!1;var Kr=class{opts;data;constructor(e={},r=[]){this.opts=e,this.data=r}push(...e){return e.length===0||(this.data=jl(this.opts,this.data,...e)),this.data.length}forEach(e){this.data.forEach(e)}forEachFromTop(e){[...this.data].reverse().forEach(e)}pop(){let e=Ba(this.opts,this.data);return this.data=Rl(this.opts,this.data),e}get isEmpty(){return Vl(this.opts,this.data)}get isFull(){return Ll(this.opts,this.data)}get peek(){return Ba(this.opts,this.data)}get length(){return this.data.length}};const SE=(e={},...r)=>new Kr({...e},[...r]),Il=(e,r,i=wl,o)=>{let a=Th(e,r,i),n=FE(e,r,i),s={valueChanged:!a,a:e,b:r,added:n.added,removed:n.removed,childChanged:!1},l={value:s,childrenStore:[],parent:o},u=n.identical.map(f=>Il(f[0],f[1],i,l)),c=rd(s)||u.some(f=>rd(f.value));return Jh(l,u),l.toString=()=>Oh(l,0),l.value.childChanged=c,Rh(l),l},rd=e=>e===void 0?!1:!!(e.valueChanged||e.childChanged||e.added.length>0||e.removed.length>0),FE=(e,r,i=wl)=>{let o=[...e.children()],a=[...r.children()],n=[],s=[];for(let u of o){let c=-1;for(let[f,d]of a.entries())if(Th(u,d,i)){n.push([u,d]),c=f;break}c===-1?s.push(u):a.splice(c,1)}return{added:[...a],identical:n,removed:s}},Th=(e,r,i)=>!!(e.getIdentity()===r.getIdentity()||i(e.getValue(),r.getValue())),da=e=>JSON.stringify(e.getValue()),Oh=(e,r=0)=>{if(e===void 0)return"(undefined)";let i=kE(e.value,r);for(let o of e.childrenStore)i+=Oh(o,r+2);return i},kE=(e,r)=>{let i=" ".repeat(r);if(e===void 0)return`${i}(undefined)`;let o=[];if(o.push(`a: ${da(e.a)} b: ${da(e.b)}`),e.valueChanged?o.push(`Value changed. Child changed: ${e.childChanged}`):o.push(`Value unchanged. Child changed: ${e.childChanged}`),e.added.length>0){o.push("Added:");for(let a of e.added)o.push(" - "+da(a))}if(e.removed.length>0){o.push(`Removed: ${e.removed.length}`);for(let a of e.removed)o.push(" - "+da(a))}return o.push(`----
`),o.map(a=>i+a).join(`
`)};var jh={};C(jh,{add:()=>Hl,addValue:()=>Ta,asDynamicTraversable:()=>fi,breadthFirst:()=>Wl,children:()=>BE,childrenLength:()=>LE,childrenValues:()=>zE,compare:()=>NE,computeMaxDepth:()=>RE,createNode:()=>zo,depthFirst:()=>ME,findAnyChildByValue:()=>jE,findChildByValue:()=>OE,findParentsValue:()=>qh,followValue:()=>Hh,fromPlainObject:()=>Gh,getRoot:()=>Ul,hasAnyChild:()=>ln,hasAnyParent:()=>za,hasChild:()=>Vh,hasParent:()=>_h,nodeDepth:()=>TE,parents:()=>Bo,parentsValues:()=>Ih,queryByValue:()=>Lh,queryParentsValue:()=>Jl,remove:()=>_l,root:()=>un,rootWrapped:()=>VE,setChildren:()=>Jh,stripParentage:()=>ql,throwTreeTest:()=>Rh,toStringDeep:()=>Kl,treeTest:()=>Gl,value:()=>IE,wrap:()=>St});const NE=(e,r,i)=>Il(fi(e),fi(r),i),ql=e=>({value:e.value,childrenStore:e.childrenStore.map(i=>ql(i))}),fr=e=>"wraps"in e?e.wraps:e,PE=e=>"wraps"in e?e:St(e),St=e=>({*children(){for(let r of e.childrenStore)yield St(r)},getValue:()=>e.value,getIdentity:()=>e,*queryValue(r){for(let i of Lh(r,fr(e)))yield St(i)},*queryParentsValue(r,i,o){for(let a of Jl(fr(r),i,o))yield St(a)},*parentsValues(r){yield*Ih(fr(r))},findParentsValue(r,i,o){let a=qh(r,i,o);if(a!==void 0)return St(a)},getParent:()=>e.parent===void 0?void 0:St(e.parent),hasParent:r=>_h(e,fr(r)),hasAnyParent:r=>za(e,fr(r)),hasChild:r=>Vh(fr(r),e),hasAnyChild:r=>ln(fr(r),e),remove:()=>{_l(e)},addValue:r=>{let i=Ta(r,e);return St(i)},add:r=>(Hl(fr(r),e),PE(r)),wraps:e}),_l=e=>{let r=e.parent;r!==void 0&&(e.parent=void 0,r.childrenStore=an(r.childrenStore,e))};function*ME(e){if(!un)return;let r=new Kr;r.push(...e.childrenStore);let i=r.pop();for(;i&&(yield i,i&&r.push(...i.childrenStore),!r.isEmpty);)i=r.pop()}function*Wl(e){if(!e)return;let r=new ct;r.enqueue(...e.childrenStore);let i=r.dequeue();for(;i&&(yield i,i&&r.enqueue(...i.childrenStore),!r.isEmpty);)i=r.dequeue()}function Gl(e,r=[]){if(e.parent===e)return[!1,"Root has itself as parent",e];if(r.includes(e))return[!1,"Same node instance is appearing further in tree",e];if(r.push(e),kd(e.childrenStore))return[!1,"Children list contains duplicates",e];for(let i of e.childrenStore){if(i.parent!==e)return[!1,"Member of childrenStore does not have .parent set",i];if(ln(e,i))return[!1,"Child has parent as its own child",i];let o=Gl(i,r);if(!o[0])return o}return[!0,"",e]}function Rh(e){let r=Gl(e);if(!r[0])throw Error(`${r[1]} Node: ${ka(r[2].value,30)}`,{cause:r[2]})}function*BE(e){for(let r of e.childrenStore)yield r}function*zE(e){for(let r of e.childrenStore)r.value!==void 0&&(yield r.value)}function*Bo(e){let r=e.parent;for(;r;)yield r,r=r.parent}function TE(e){return[...Bo(e)].length}const Vh=(e,r)=>{for(let i of r.childrenStore)if(i===e)return!0;return!1},OE=(e,r,i=Y)=>{for(let o of r.childrenStore)if(i(e,o.value))return o};function*Lh(e,r,i=Y){for(let o of r.childrenStore)i(e,o.value)&&(yield o)}const ln=(e,r)=>{for(let i of Wl(r))if(i===e)return!0;return!1},jE=(e,r,i=Y)=>{for(let o of Wl(r))if(i(o.value,e))return o},Ul=e=>e.parent?Ul(e.parent):e,za=(e,r)=>{for(let i of Bo(e))if(i===r)return!0;return!1};function*Ih(e){for(let r of Bo(e))r.value!==void 0&&(yield r.value);return!1}function*Jl(e,r,i=Y){for(let o of Bo(e))o.value!==void 0&&i(o.value,r)&&(yield o);return!1}function qh(e,r,i=Y){for(let o of Jl(e,r,i))return o}const _h=(e,r)=>e.parent===r,RE=e=>Wh(e,0),Wh=(e,r=0)=>{let i=r;for(let o of e.childrenStore)i=Math.max(i,Wh(o,r+1));return i},Hl=(e,r)=>{Uh(e,r);let i=e.parent;r.childrenStore=[...r.childrenStore,e],e.parent=r,i&&(i.childrenStore=an(i.childrenStore,e))},Ta=(e,r)=>zo(e,r),un=e=>zo(e),Gh=(e,r="",i,o=[])=>{let a=Object.entries(e);i=i===void 0?un():Ta({label:r,value:e},i);for(let n of a){let s=n[1];o.includes(s)||(o.push(s),typeof n[1]=="object"?Gh(s,n[0],i,o):Ta({label:n[0],value:s},i))}return i},VE=e=>St(zo(e)),zo=(e,r)=>{let i={childrenStore:[],parent:r,value:e};return r!==void 0&&(r.childrenStore=[...r.childrenStore,i]),i},LE=e=>e.childrenStore.length,IE=e=>e.value,fi=e=>({*children(){for(let i of e.childrenStore)yield fi(i)},getParent(){if(e.parent!==void 0)return fi(e.parent)},getValue(){return e.value},getIdentity(){return e}}),Uh=(e,r)=>{if(r===e)throw Error("Cannot add self as child");if(e.parent!==r){if(za(r,e))throw Error("Child contains parent (1)",{cause:e});if(za(e,r))throw Error("Parent already contains child",{cause:e});if(ln(r,e))throw Error("Child contains parent (2)",{cause:e})}},Jh=(e,r)=>{for(let i of r)Uh(i,e);e.childrenStore=[...r];for(let i of r)i.parent=e},Kl=(e,r=0)=>{let i=`${"  ".repeat(r)} + ${e.value?JSON.stringify(e.value):"-"}`;return e.childrenStore.length>0?i+`
`+e.childrenStore.map(o=>Kl(o,r+1)).join(`
`):i};function*Hh(e,r,i=1){for(let o of e.childrenStore){let a=o.value;a!==void 0&&r(a,i)&&(yield o.value,yield*Hh(o,r,i+1))}}var Kh={};C(Kh,{asDynamicTraversable:()=>Ql,children:()=>xi,create:()=>Zl,createSimplified:()=>UE,createWrapped:()=>GE,depthFirst:()=>Xh,getByPath:()=>WE,prettyPrint:()=>Qh,prettyPrintEntries:()=>qE,toStringDeep:()=>Zh,traceByPath:()=>Yh});function qE(e){if(e.length===0)return"(empty)";let r="";for(let[i,o]of e.entries())r+="  ".repeat(i),r+=o.name+" = "+JSON.stringify(o.leafValue)+`
`;return r}const Qh=(e,r=0,i={})=>{w(tr(e,"node"));let o=i.name??"node",a=JE(e,o),n=`${"  ".repeat(r)} + name: ${a.name} value: ${JSON.stringify(a.leafValue)}`,s=[...xi(e,i)];return s.length>0?n+`
`+s.map(l=>Qh(l.leafValue,r+1,{...i,name:l.name})).join(`
`):n},Zh=(e,r=0)=>{let i=" ".repeat(r)+` ${e.value?.name}`;if(e.value!==void 0){if("sourceValue"in e.value&&"leafValue"in e.value){let o=ka(e.value.sourceValue,20),a=ka(e.value.leafValue,20);o=o===a?"":"source: "+o,i+=` = ${a} ${o}`}else"sourceValue"in e.value&&e.value.sourceValue!==void 0&&(i+=` = ${e.value.sourceValue}`);"ancestors"in e.value&&(i+=` (ancestors: ${e.value.ancestors.join(", ")})`)}i+=`
`;for(let o of e.childrenStore)i+=Zh(o,r+1);return i};function*xi(e,r={}){w(tr(e,"node"));let i=r.filter??"none",o=a=>i==="none"?[!0,at(a)]:i==="leaves"&&at(a)?[!0,!0]:i==="branches"&&!at(a)?[!0,!1]:[!1,at(a)];if(Array.isArray(e))for(let[a,n]of e.entries()){let s=o(n);s[0]&&(yield{name:a.toString(),_kind:"entry",sourceValue:n,leafValue:s[1]?n:void 0})}else if(typeof e=="object"){let a="entries"in e?e.entries():Object.entries(e);for(let[n,s]of a){let[l,u]=o(s);l&&(yield{name:n,_kind:"entry",sourceValue:s,leafValue:u?s:void 0})}}}function*Xh(e,r={},i=[]){for(let o of xi(e,r))yield{...o,ancestors:[...i],_kind:"entry-ancestors"},yield*Xh(o.sourceValue,r,[...i,o.name])}function _E(e,r){for(let i of xi(r))if(i.name===e)return i}function WE(e,r,i={}){let o=Pl(Yh(e,r,i));if(!o)throw Error(`Could not trace path: ${e} `);return o}function*Yh(e,r,i={}){w(tr(e,"path"),tr(r,"node"));let o=i.separator??".",a=e.split(o),n=[];for(let s of a){let l=_E(s,r);if(!l){yield{name:s,sourceValue:void 0,leafValue:void 0,ancestors:n,_kind:"entry-ancestors"};return}r=l.sourceValue,yield{...l,ancestors:[...n],_kind:"entry-ancestors"},n.push(s)}}const Ql=(e,r={},i=[],o)=>{let a=r.name??"object",n={*children(){for(let{name:s,sourceValue:l,leafValue:u}of xi(e,r))yield Ql(l,{...r,name:s},[...i,a],n)},getParent(){return o},getValue(){return{name:a,sourceValue:e,ancestors:i,_kind:"entry-static"}},getIdentity(){return e}};return n},GE=(e,r)=>St(Zl(e,r)),Zl=(e,r={})=>{let i=r.valuesAtLeaves??!1;return e0(e,(i?a=>{if(at(a))return a}:a=>a)(e),r,[])},e0=(e,r,i={},o)=>{let a=i.name??"object_ci",n=un({name:a,sourceValue:r,ancestors:[...o],_kind:"entry-static"});o=[...o,a];for(let s of xi(e,i)){let l=i.valuesAtLeaves?s.leafValue:s.sourceValue;Hl(e0(s.sourceValue,l,{...i,name:s.name},o),n)}return n},UE=(e,r={})=>ql(Zl(e,r));function JE(e,r=""){return"name"in e&&"leafValue"in e&&"sourceValue"in e?{name:e.name,_kind:"entry",leafValue:e.leafValue,sourceValue:e.sourceValue}:"name"in e?{name:e.name,leafValue:e,sourceValue:e,_kind:"entry"}:{name:r,leafValue:e,sourceValue:e,_kind:"entry"}}var t0={};C(t0,{addValueByPath:()=>r0,childrenLengthByPath:()=>KE,clearValuesByPath:()=>o0,create:()=>HE,removeByPath:()=>i0,valueByPath:()=>a0,valuesByPath:()=>Yl});const HE=(e={})=>{let r;return{getRoot:()=>r,add:(h,p)=>{let y=r0(h,p,r,e);r===void 0&&(r=Ul(y))},prettyPrint:()=>r===void 0?"(empty)":Kl(r),remove:h=>r===void 0?!1:i0(h,r,e),getValue:h=>{if(r!==void 0)return a0(h,r,e)},getValues:h=>r===void 0?[]:Yl(h,r,e),hasPath:h=>r===void 0?!1:ui(h,r,e)!==void 0,childrenLength:h=>{if(r===void 0)return 0;let p=ui(h,r,e);return p===void 0?0:p.childrenStore.length},getNode:h=>r===void 0?void 0:ui(h,r,e),clearValues:h=>r===void 0?!1:o0(h,r,e)}},r0=(e,r,i,o={})=>{let a=o.separator??".",n=o.duplicates??"overwrite",s=r.split(a),l=0;for(let u of s){let c=l===s.length-1,f=Xl(u,i);if(f===void 0)i=zo({value:c?e:void 0,label:u},i);else if(i=f,c)switch(n){case"ignore":break;case"allow":{let d=n0(i);i.value={values:[...d,e],label:u};break}case"overwrite":i.value={value:e,label:u};break}else i=f;l++}if(i===void 0)throw Error("Could not create tree");return i},i0=(e,r,i={})=>{if(r===void 0)return!1;let o=ui(e,r,i);return o===void 0?!1:(_l(o),!0)},o0=(e,r,i={})=>{if(r===void 0)return!1;let o=ui(e,r,i);return o===void 0?!1:(o.value={label:o.value?.label??"",value:void 0},!0)},KE=(e,r,i={})=>{if(r===void 0)return 0;let o=ui(e,r,i);return o===void 0?0:o.childrenStore.length},Xl=(e,r)=>{if(r!==void 0){if(e===void 0)throw Error("Parameter 'label' cannot be undefined");if(r.value?.label===e)return r;for(let i of r.childrenStore)if(i.value?.label===e)return i}},a0=(e,r,i={})=>{let o=Yl(e,r,i);if(o.length!==0){if(o.length>1)throw Error("Multiple values at path. Use getValues instead");return o[0]}},n0=e=>e.value===void 0?[]:"values"in e.value?e.value.values:"value"in e.value?e.value.value===void 0?[]:[e.value.value]:[],ui=(e,r,i={})=>{let o=i.separator??".",a=e.split(o),n=r;for(let s of a)if(n=Xl(s,n),n===void 0)return;return n},Yl=(e,r,i={})=>{let o=i.separator??".",a=e.split(o),n=r;for(let s of a)if(n=Xl(s,n),n===void 0)return[];return n0(n)};var s0={};C(s0,{breadthFirst:()=>Ei,childrenLength:()=>QE,couldAddChild:()=>eD,depthFirst:()=>iu,find:()=>aD,findAnyChildByValue:()=>oD,findAnyParentByValue:()=>YE,findByValue:()=>nD,findChildByValue:()=>c0,findParentByValue:()=>ru,followValue:()=>f0,hasAnyChild:()=>Fs,hasAnyChildValue:()=>tD,hasAnyParent:()=>ZE,hasAnyParentValue:()=>XE,hasChild:()=>l0,hasChildValue:()=>u0,hasParent:()=>eu,hasParentValue:()=>tu,parents:()=>iD,siblings:()=>rD,toString:()=>sD,toStringDeep:()=>d0});const QE=e=>[...e.children()].length,ZE=(e,r,i)=>eu(e,r,i,2**53-1),XE=(e,r,i)=>{if(e===void 0)throw TypeError("Param 'child' is undefined");return tu(e,r,i,2**53-1)},YE=(e,r,i)=>ru(e,r,i,2**53-1),eu=(e,r,i=Y,o=0)=>{if(o<0)return!1;let a=vr(e),n=vr(r),s=a?e.getParent():e.parent;if(s===void 0)return!1;if(i(s,r))return!0;let l=a?s.getIdentity():s.value,u=n?r.getIdentity():r.value;return i(l,u)?!0:eu(s,r,i,o-1)},tu=(e,r,i=Y,o=0)=>{if(e===void 0)throw Error("Param 'child' is undefined");if(o<0)return!1;let a="getParent"in e?e.getParent():e.parent;if(a===void 0)return!1;let n="getValue"in a?a.getValue():a.value;return i(n,r)?!0:tu(a,r,i,o-1)},ru=(e,r,i=Y,o=0)=>{if(o<0)return;let a="getParent"in e?e.getParent():e.parent;if(a===void 0)return;let n="getValue"in a?a.getValue():a.value;return i(n,r)?a:ru(a,r,i,o-1)},eD=(e,r,i=Y)=>{if(i(e,r))throw Error("Child equals parent");if(Fs(e,r,i))throw Error("Circular. Parent already has child");if(Fs(r,e,i))throw Error("Prospective child has parent as child relation")},Fs=(e,r,i=Y)=>l0(e,r,i,2**53-1),tD=(e,r,i=Y)=>u0(e,r,i,2**53-1),l0=(e,r,i=Y,o=0)=>{if(o<0)return!1;if(i(e,r))return!0;let a="getIdentity"in e?e.getIdentity():e.value,n="getIdentity"in r?r.getIdentity():r.value;if(i(a,n))return!0;for(let s of Ei(e,o)){let l="getIdentity"in s?s.getIdentity():s.value;if(i(s,r)||i(l,n))return!0}return!1},u0=(e,r,i=Y,o=0)=>{if(o<0)return!1;if(i(e.getValue(),r))return!0;for(let a of Ei(e,o)){let n=a.getValue();if(i(n,r))return!0}return!1};function*rD(e){let r=e.getParent();if(r!==void 0)for(let i of r.children())i!==e&&(yield i)}function*iD(e){if(vr(e)){let r=e.getParent();for(;r!==void 0;)yield r,r=r.getParent()}else{let r=e.parent;for(;r!==void 0;)yield r,r=r.parent}}function oD(e,r,i=Y){return c0(e,r,i,2**53-1)}function c0(e,r,i=Y,o=0){if(o<0)return;let a=vr(e);if(a){if(i(e.getValue(),r))return e}else if(i(e.value,r))return e;for(let n of Ei(e,o))if(a){if(i(n.getValue(),r))return n}else if(i(n.value,r))return n}function*iu(e){if(!e)return;let r=new Kr,i=e;for(;i;){let o=vr(i)?[...i.children()]:[...i.childrenStore];if(r.push(...o),r.isEmpty)break;i=r.pop(),i&&(yield i)}}function*Ei(e,r=2**53-1){if(!e)return;vr(e);let i=new ct,o=e;for(;o;){if(r<0)return;if(o!==void 0){let a="childrenStore"in o?o.childrenStore:o.children();for(let n of a)yield n,i.enqueue(n)}o=i.dequeue(),r--}}function aD(e,r,i="breadth"){if(r(e))return e;let o=i==="breadth"?Ei:iu;for(let a of o(e))if(r(a))return a}function nD(e,r,i="breadth"){if(r(e.getValue()))return e;let o=i==="breadth"?Ei:iu;for(let a of o(e))if(r(a.getValue()))return a}function*f0(e,r,i=1){for(let o of e.children())r(o.getValue(),i)&&(yield o.getValue(),yield*f0(o,r,i+1))}function d0(e,r=0){if(e===void 0)return"(undefined)";if(e===null)return"(null)";let i=e.getValue(),o=typeof i;Array.isArray(i)&&(o="array");let a="  ".repeat(r)+`value: ${JSON.stringify(i)} (${o})
`;for(let n of e.children())a+=d0(n,r+1);return a}function sD(...e){let r="";for(let i of e){let o=i.getValue(),a=ka(o),n=[...i.children()],s=i.getParent(),l=typeof o;Array.isArray(o)&&(l="array"),r+=`value: ${a} (${l}) kids: ${n.length} parented: ${s?"y":"n"}
`}return r}var h0={};C(h0,{FromObject:()=>Kh,Mutable:()=>jh,Pathed:()=>t0,Traverse:()=>s0,compare:()=>Il,isTraversable:()=>vr,isTreeNode:()=>p0,toTraversable:()=>lD});const lD=e=>{if(vr(e))return e;if(p0(e))return fi(e);if(typeof e=="object")return Ql(e);throw Error("Parameter 'node' not convertible")},p0=e=>!!("parent"in e&&"childrenStore"in e&&"value"in e&&Array.isArray(e.childrenStore)),vr=e=>"children"in e&&"getParent"in e&&"getValue"in e&&"getIdentity"in e;var fo=class ks{opts;data;constructor(r={},i=[]){this.opts=r,this.data=i}push(...r){return new ks(this.opts,jl(this.opts,this.data,...r))}pop(){return new ks(this.opts,Rl(this.opts,this.data))}forEach(r){this.data.forEach(r)}forEachFromTop(r){[...this.data].reverse().forEach(r)}get isEmpty(){return Vl(this.opts,this.data)}get isFull(){return Ll(this.opts,this.data)}get peek(){return Ba(this.opts,this.data)}get length(){return this.data.length}};const uD=(e={},...r)=>new fo({...e},[...r]);var y0={};C(y0,{StackImmutable:()=>fo,StackMutable:()=>Kr,immutable:()=>uD,isEmpty:()=>Vl,isFull:()=>Ll,mutable:()=>SE,peek:()=>Ba,pop:()=>Rl,push:()=>jl,trimStack:()=>zh});const g0=e=>new ou(e);var ou=class extends Ye{store=new Map;keyString;constructor(r){super(),this.keyString=r??Mo}get size(){return this.store.size}add(...r){let i=!1;for(let o of r){let a=this.has(o);this.store.set(this.keyString(o),o),super.fireEvent("add",{value:o,updated:a}),a||(i=!0)}return i}values(){return this.store.values()}clear(){this.store.clear(),super.fireEvent("clear",!0)}delete(r){let i=this.store.delete(this.keyString(r));return i&&super.fireEvent("delete",r),i}has(r){return this.store.has(this.keyString(r))}toArray(){return[...this.store.values()]}},au=class Ns{store;keyString;constructor(r,i){this.store=i??new Map,this.keyString=r??Mo}get size(){return this.store.size}add(...r){let i=new Map(this.store);for(let o of r){let a=this.keyString(o);i.set(a,o)}return new Ns(this.keyString,i)}delete(r){let i=new Map(this.store),o=this.keyString(r);return i.delete(o)?new Ns(this.keyString,i):this}has(r){let i=this.keyString(r);return this.store.has(i)}toArray(){return[...this.store.values()]}*values(){yield*this.store.values()}};const cD=(e=Bt)=>new au(e);var fD=class m0{#e;#t;children=new Map;values=[];constructor(r=1,i=0){this.#e=i,this.#t=r}sizeLocal(){return this.values.length}sizeChildren(){return[...this.children.values()].length}sizeChildrenDeep(){let r=this.sizeChildren();for(let i of this.children.values())r+=i.sizeChildrenDeep();return r}size(){let r=this.values.length;for(let i of this.children.values())r+=i.size();return r}add(r){if(typeof r!="string")throw Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw Error("Param 'value' is empty");let i=this.#i(r,!0);if(i===this){this.hasLocal(r)||this.values.push(r);return}if(!i)throw Error(`Could not create child set for: ${r}`);i.add(r)}remove(r){if(typeof r!="string")throw Error(`Param 'value' must be a string. Got: ${typeof r}`);if(r.length===0)throw Error("Param 'value' is empty");let i=this.#i(r,!1);return i===void 0?!1:i===this?this.hasLocal(r)?(this.values=this.values.filter(o=>o!==r),!0):!1:i.remove(r)}debugDump(){let r=this.#r();for(let i of r)console.log(i)}#r(r=0){let i=[];i.push(`Depth: ${this.#e} Max: ${this.#t}`);for(let[o,a]of this.children.entries()){let n=a.#r(r+1);i.push(` key: ${o}`);for(let s of n)i.push(" ".repeat(r+1)+s)}i.push(`Values: (${this.values.length})`);for(let o of this.values)i.push(` ${o}`);return i.map(o=>" ".repeat(r)+o)}#i(r,i){if(r===void 0)throw Error("Param 'value' undefined");if(this.#e===this.#t||r.length<=this.#e)return this;let o=r[this.#e];if(o===void 0)throw Error(`Logic error. Depth: ${this.#e} Len: ${r.length}`);let a=this.children.get(o);return a===void 0&&i&&(a=new m0(this.#t,this.#e+1),this.children.set(o,a)),a}hasLocal(r){for(let i of this.values)if(i===r)return!0;return!1}has(r){if(typeof r!="string")return!1;let i=this.#i(r,!1);return i===void 0?!1:i===this?this.hasLocal(r):i.has(r)}},b0={};C(b0,{MassiveSet:()=>fD,SetStringImmutable:()=>au,SetStringMutable:()=>ou,immutable:()=>cD,mutable:()=>g0});var v0={};C(v0,{asCallback:()=>O0,chunks:()=>w0,concat:()=>x0,dropWhile:()=>E0,equals:()=>C0,every:()=>$0,fill:()=>A0,filter:()=>S0,find:()=>F0,flatten:()=>k0,forEach:()=>N0,fromArray:()=>nu,fromIterable:()=>su,last:()=>P0,map:()=>M0,max:()=>B0,min:()=>z0,nextWithTimeout:()=>lu,reduce:()=>T0,repeat:()=>dD,slice:()=>j0,some:()=>R0,toArray:()=>cn,unique:()=>Ps,uniqueByValue:()=>V0,until:()=>D0,withDelay:()=>hD,zip:()=>L0});async function*nu(e,r=1){for(let i of e)yield i,await Ce(r)}async function*su(e,r=1){for await(let i of e)yield i,await Ce(r)}async function*w0(e,r){let i=[];for await(let o of e)i.push(o),i.length===r&&(yield i,i=[]);i.length>0&&(yield i)}async function*x0(...e){for await(let r of e)yield*r}async function*E0(e,r){for await(let i of e)r(i)||(yield i)}const D0=async(e,r)=>{for await(let i of e){let o=await r();if(typeof o=="boolean"&&!o)break}},dD=async function*(e,r){let i=typeof r=="number"?r:1/0,o=typeof r=="number"?void 0:r,a=i;for(;;){for await(let n of e())if(yield n,o?.aborted)break;if(Number.isFinite(i)&&(a--,a===0)||o?.aborted)break}};async function C0(e,r,i){let o=e[Symbol.asyncIterator](),a=r[Symbol.asyncIterator]();for(;;){let n=await o.next(),s=await a.next();if(i!==void 0){if(!i(n.value,s.value))return!1}else if(n.value!==s.value)return!1;if(n.done??s.done)return n.done&&s.done}}async function $0(e,r){for await(let i of e)if(!await r(i))return!1;return!0}async function*A0(e,r){for await(let i of e)yield r}async function*S0(e,r){for await(let i of e)await r(i)&&(yield i)}async function F0(e,r){for await(let i of e)if(await r(i))return i}async function*k0(e){for await(let r of e)if(typeof r=="object"){if(Array.isArray(r))for(let i of r)yield i;else if(Z(r))for await(let i of r)yield i;else if(wi(r))for(let i of r)yield i}else yield r}const N0=async function(e,r,i={}){let o=i.interval;if(Array.isArray(e))for(let a of e){let n=await r(a);if(typeof n=="boolean"&&!n)break;o&&await Ce(o)}else for await(let a of e){let n=await r(a);if(typeof n=="boolean"&&!n)break;o&&await Ce(o)}};async function P0(e,r={}){let i=r.abort,o;for await(let a of e){if(i?.aborted)return;o=a}return o}async function*M0(e,r){for await(let i of e)yield r(i)}async function*B0(e,r=((i,o)=>i>o)){let i;for await(let o of e){if(i===void 0){i=o,yield i;continue}r(o,i)&&(i=o,yield o)}}async function*z0(e,r=(i,o)=>i>o){let i;for await(let o of e){if(i===void 0){i=o,yield i;continue}r(i,o)&&(i=o,yield o)}return i}async function T0(e,r,i){for await(let o of e)i=r(i,o);return i}async function O0(e,r,i){for await(let o of e)r(o);i&&i()}async function*j0(e,r=0,i=1/0){console.log(`Async slice start: ${r}`);let o=e[Symbol.asyncIterator]();if(i<r)throw Error("Param 'end' should be more than 'start'");for(;r>0;r--,i--)await o.next();for await(let a of e)if(i-- >0)yield a;else break}async function*hD(e,r){for(let i of e)await Ce(r),yield i}async function lu(e,r){let i=j(r,1e3),o=await Promise.race([(async()=>{await Ce({millis:i,signal:r.signal})})(),(async()=>await e.next())()]);if(o===void 0)throw Error("Timeout");return o}async function R0(e,r){for await(let i of e)if(await r(i))return!0;return!1}async function cn(e,r={}){let i=[],o=e[Symbol.asyncIterator](),a=Date.now(),n=r.limit??1/0,s=r.while,l=j(r.elapsed,1/0);for(;i.length<n&&Date.now()-a<l&&!(s&&!s(i.length));){let u=await o.next();if(u.done)break;i.push(u.value)}return i}async function*Ps(e){let r=[],i=Array.isArray(e)?e:[e];for await(let o of i)for await(let a of o)r.includes(a)||(r.push(a),yield a)}async function*V0(e,r=Bt,i=new Set){for await(let o of e){let a=r(o);i.has(a)||(i.add(a),yield o)}}async function*L0(...e){let r=e.map(i=>i[Symbol.asyncIterator]());for(;;){let i=await Promise.all(r.map(o=>o.next()));if(i.some(o=>o.done))return;yield i.map(o=>o.value)}}function Ms(e){return"_type"in e?e._type==="GenFactoryNoInput":!1}function*pD(e){yield e}async function*yD(e){yield e,await Ce(1)}function fe(e){if(Array.isArray(e)){let r=e.values();return r._name="arrayInput",r}else{if(typeof e=="number"||typeof e=="boolean"||typeof e=="string")return pD(e);if(typeof e=="function")return e()}return e}function uu(e){if(e!==void 0)return Array.isArray(e)?nu(e):typeof e=="number"||typeof e=="boolean"||typeof e=="string"?yD(e):typeof e=="function"?e():Z(e)?e:su(e)}function gD(e){if(typeof e=="string"){let r=document.querySelector(e);if(!r)throw Error(`Element not found '${e}'`);return r}return e}var I0={};C(I0,{perValue:()=>bD,query:()=>vD});const mD=e=>{let r=e??(o=>o),i=new Map;return{has(o){return i.has(r(o))},get(o){return i.get(r(o))},set(o,a){i.set(r(o),a)},entries(){return i.entries()},delete(o){i.delete(o)}}};function bD(e={}){let r=e.byReference,i=e.tagName??"div";if(r&&e.key)throw Error("byReference and key options are mutually exclusive");let o=r?void 0:e.key??Bt,a=mD(o),n=e.parentEl??document.body,s=gD(n),l=new Set;async function*u(c){for await(let f of fe(c)){let d=a.get(f);d||(d=document.createElement(i),a.set(f,d),e.beforeInsert&&e.beforeInsert(d),s.append(d),e.afterInsert&&e.afterInsert(d)),l.add(d),yield{el:d,value:f}}for(let[f,d]of a.entries())l.has(d)||(e.beforeRemove&&e.beforeRemove(d),d.remove(),a.delete(f))}return u._name="dom.perValue",u}function vD(e={}){let r=e.baseElement??document;async function*i(o){let a=fe(o);for await(let n of a)for(let s of r.querySelectorAll(n))yield s}return i._name="dom.query",i}const cu=()=>{let e=-9007199254740991;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o){if(typeof a!="number")break;e=Math.max(a,e)}return e}},fu=()=>{let e=9007199254740991;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o){if(typeof a!="number")break;e=Math.min(a,e)}return e}},du=()=>{let e=0;return i=>{let o=Array.isArray(i)?i:[i];for(let a of o)typeof a=="number"&&(e+=a);return e}},hu=()=>{let e=0,r=0;return o=>{let a=Array.isArray(o)?o:[o];for(let n of a)typeof n=="number"&&(r++,e+=n);return e/r}},pu=e=>{let r=0;return o=>(e&&Array.isArray(o)?r+=o.length:r++,r)};function yu(e,r={}){let i=r.includeType,o=r.emitEqualRanked??!1,a=r.emitRepeatHighest??!1,n;return s=>{if(!(i&&typeof s!==i)){if(n===void 0)return n=s,n;{let l=e(s,n);if(l=="a")return n=s,n;if(l==="eq"&&o||a)return n}}}}var q0={};C(q0,{average:()=>ep,chunk:()=>rp,debounce:()=>H0,delay:()=>J0,drop:()=>op,duration:()=>U0,filter:()=>ip,max:()=>Z0,min:()=>Q0,rank:()=>X0,rankArray:()=>Y0,reduce:()=>G0,sum:()=>tp,take:()=>W0,tally:()=>K0,transform:()=>_0});function _0(e){async function*r(i){i=fe(i);for await(let o of i)yield e(o)}return r._name="transform",r}function W0(e){async function*r(i){i=fe(i);let o=0;for await(let a of i){if(++o>e)break;yield a}}return r._name="take",r}function G0(e){async function*r(i){i=fe(i);for await(let o of i)yield e(o)}return r._name="reduce",r}function U0(e){let r=j(e,0);async function*i(o){o=fe(o);let a=Lr();for await(let n of o){if(a()>r)break;yield n}}return i._name="duration",i}function J0(e){let r=j(e.before,0),i=j(e.after,0);async function*o(a){a=fe(a);for await(let n of a)r>0&&await Ce(r),yield n,i>0&&await Ce(i)}return o._name="delay",o}function H0(e){let r=j(e,0);async function*i(o){o=fe(o);let a=Lr();for await(let n of o)a()<r||(yield n,a=Lr())}return i._name="debounce",i}function K0(e=!0){async function*r(i){i=fe(i);let o=pu(e);for await(let a of i)yield o(a)}return r._name="tally",r}function Q0(){async function*e(r){r=fe(r);let i=fu();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="min",e}function Z0(){async function*e(r){r=fe(r);let i=cu();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="max",e}function X0(e,r={}){async function*i(o){o=fe(o);let a=yu(e,r);for await(let n of o){let s=a(n);s!==void 0&&(yield s)}}return i._name="rank",i}function Y0(e,r={}){let i=r.includeType,o=r.emitEqualRanked??!1,a=r.emitRepeatHighest??!1,n=r.withinArrays??!1;async function*s(l){l=fe(l);let u;for await(let c of l){let f=!1;n&&(u=void 0);for(let d of c)if(!(i&&typeof d!==i))if(u===void 0)u=d,f=!0;else{let h=e(d,u);h=="a"?(u=d,f=!0):(h==="eq"&&o||a)&&(f=!0)}f&&u&&(yield u)}}return s._name="rankArray",s}function ep(){async function*e(r){r=fe(r);let i=hu();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="average",e}function tp(){async function*e(r){r=fe(r);let i=du();for await(let o of r){let a=i(o);a!==void 0&&(yield a)}}return e._name="total",e}function rp(e,r=!0){w(G(e,"aboveZero","size"));async function*i(o){o=fe(o);let a=[];for await(let n of o)a.push(n),a.length>=e&&(yield a,a=[]);r&&a.length>0&&(yield a)}return i._name="chunk",i}function ip(e){async function*r(i){i=fe(i);for await(let o of i)e(o)&&(yield o)}return r._name="filter",r}function op(e){async function*r(i){i=fe(i);for await(let o of i)e(o)||(yield o)}return r._name="drop",r}function wD(e,r=5){async function*i(){for(let o of e)await Ce(r),yield o}return i._name="fromArray",i._type="GenFactoryNoInput",i}function xD(e,r){async function*i(){for(;;)yield await dE(e,r)}return i._name="event",i._type="GenFactoryNoInput",i}function ap(e){async function*r(){for(;;){let i=await e();if(i===void 0)break;yield i}}return r._name="fromFunction",r._type="GenFactoryNoInput",r}function ED(e){async function*r(){for await(let i of e)yield i}return r._name="fromIterable",r._type="GenFactoryNoInput",r}function DD(e){let r=j(e.interval,0),i=e.asClockTime??!1,o=e.loops??2**53-1,a=0,n=j(e.elapsed,2**53-1);async function*s(){let l=Lr();for(;a<o&&l()<n;){yield i?Date.now():l();let u=a*r-l();await Ce(Math.max(0,r+u)),a++}}return s._name="timestamp",s._type="GenFactoryNoInput",s}var np={};C(np,{array:()=>wD,event:()=>xD,func:()=>ap,iterable:()=>ED,timestamp:()=>DD});async function CD(e,r){let i=typeof r=="function"?r():r;for await(let o of i)e.push(o)}async function $D(e,r={}){let i=typeof e=="function"?e():e;return cn(i,r)}async function AD(e,r,i){let o=typeof e=="function"?e():e;for await(let a of o)r(a);i&&i()}function SD(e){let r,i=typeof e=="function"?e():e;async function o(){let a=await i.next();if(!a.done)return r=a.value,r}return o}function FD(e,r){let i=r,o=!1,a=typeof e=="function"?e():e;function n(){return o||(o=!0,a.next().then(s=>{i=s.value,o=!1}).catch(s=>{throw o=!1,s})),i}return n}async function*sp(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=r.afterEmit??"last",n=e.map((f,d)=>({waiting:void 0,index:d,gen:fe(f),done:!1,lastValue:void 0})),s=()=>!n.some(f=>!f.done),l=()=>n.some(f=>f.waiting!==void 0),u=f=>!f.some(d=>d!==void 0),c=[];for(;;){let f=[];for(let y of n){if(y.done)continue;if(y.waiting!==void 0){f.push(y.waiting);continue}let g=Promise.resolve((async()=>{if(y.done)return y;let m=await y.gen.next();return y.waiting=void 0,m.done?(y.done=!0,o==="undefined"&&(y.lastValue=void 0)):y.lastValue=m.value,y})());y.waiting=g,f.push(g)}let d=await Promise.race(f);if("done"in d){if(d.done&&i==="break")break}else throw Error("Missing 'done' property");let h=n.map(y=>y.lastValue);if(h.length===0)return;let p=u(h);if(p&&!l())return;if(!Nd(c,h)&&!p&&(c=h,yield h),a==="undefined")for(let y of n)y.waiting===void 0&&(y.lastValue=void 0);if(s())break}}async function*lp(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=r.afterEmit??"last",n=new Map;for(let[d,h]of Object.entries(e))n.set(d,{gen:fe(h),done:!1,lastValue:void 0,waiting:void 0,key:d});let s=()=>!co(n,d=>!d.done),l=()=>co(n,d=>d.waiting!==void 0),u=d=>{for(let h of Object.values(d))if(h!==void 0)return!1;return!0},c=()=>{let d={};for(let[h,p]of n)d[h]=p.lastValue;return d},f;for(;;){let d=[];for(let g of n.values()){if(g.done)continue;if(g.waiting!==void 0){d.push(g.waiting);continue}let m=Promise.resolve((async()=>{if(g.done)return g;let v=await g.gen.next();return g.waiting=void 0,v.done?(g.done=!0,o==="undefined"&&(g.lastValue=void 0)):g.lastValue=v.value,g})());g.waiting=m,d.push(m)}let h=await Promise.race(d);if("done"in h){if(h.done&&i==="break")break}else throw Error("Result missing 'done' property");let p=c(),y=u(p);if(y&&!l())return;if(!wl(f,p)&&!y&&(f=p,yield p),a==="undefined")for(let g of n.values())g.waiting===void 0&&(g.lastValue=void 0);if(s())break}}const id=e=>e._name??e.name;function kD(){let e=[],r,i=a=>{a===void 0&&(a=r);let n=uu(a);for(let s of e)if(n===void 0)if(Ms(s))n=s();else throw Error(`Function '${id(s)}' requires input. Provide it to the function, or call 'input' earlier.`);else n=s(n);return n},o={rankArray:(a,n)=>(e.push(Y0(a,n)),o),rank:(a,n)=>(e.push(X0(a,n)),o),transform:a=>(e.push(_0(a)),o),reduce:a=>(e.push(G0(a)),o),drop:a=>(e.push(op(a)),o),delay:a=>(e.push(J0(a)),o),duration:a=>(e.push(U0(a)),o),debounce:a=>(e.push(H0(a)),o),fromFunction:a=>(e.push(ap(a)),o),take:a=>(e.push(W0(a)),o),chunk:(a,n=!0)=>(e.push(rp(a,n)),o),filter:a=>(e.push(ip(n=>a(n))),o),min:()=>(e.push(Q0()),o),max:()=>(e.push(Z0()),o),average:()=>(e.push(ep()),o),sum:()=>(e.push(tp()),o),tally:a=>(e.push(K0(a)),o),input(a){return r=a,o},asGenerator:i,asAsync(a){let n=a??r;for(let s of e)if(n===void 0&&Ms(s))n=s();else{if(n===void 0)throw Error(`Function '${id(s)}' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);n=s(n)}return o},asArray:async a=>{let n=i(a);return await cn(n)},firstOutput:async a=>(await i(a).next()).value,lastOutput:async a=>{let n=i(a),s;for await(let l of n)s=l;return s}};return o}var ND=class{#e=[];enqueue(r){this.#e.push(r)}dequeue(){return this.#e.shift()}};async function*PD(...e){let r=e.map(l=>uu(l)),i=new ND,o=0,a=async l=>{if(l===void 0){o++;return}let u=await l.next();u.done?o++:(i.enqueue(u.value),setTimeout(()=>a(l),1))};for(let l of r)setTimeout(()=>a(l),1);let n=10,s=1;for(;o<r.length;){let l=i.dequeue();l===void 0?s=Math.min(s+1,10):(yield l,s=1),await Ce(n*s)}}async function*up(...e){let r;for(let i of e)r=typeof i=="function"?i(r??[]):fe(i);if(r!==void 0)for await(let i of r)yield i}async function*MD(e,r,i,o,a,n,s){let l,u=arguments;for(let c of u)l=typeof c=="function"?c(l??[]):fe(c);if(l!==void 0)for await(let c of l)yield c}function BD(...e){return i=>up(i,...e)}async function zD(e,r){return(await e([r]).next()).value}async function*TD(e,r={}){let i=r.onSourceDone??"break",o=j(r.maximumWait,2e3),a=r.finalValue??"undefined",n=e.map(f=>({seq:0,lastValue:void 0,gen:fe(f),done:!1})),s={millis:o},l=0,u=()=>!n.some(f=>!f.done),c=!0;for(;c;){l++;for(let f of n){if(f.done){f.seq=l;continue}let d=await lu(f.gen,s);if(d.done){if(f.done=!0,f.seq=l,a==="undefined"&&(f.lastValue=void 0),i==="break")return}else f.lastValue=d.value,f.seq=l}if(c){let f=n.filter(d=>d.seq===l).map(d=>d.lastValue);if(f.length===0||!f.some(d=>d!==void 0))return;yield f}u()&&(c=!1)}}var cp={};C(cp,{Dom:()=>I0,From:()=>np,Links:()=>q0,addToArray:()=>CD,asArray:()=>$D,asCallback:()=>AD,asPromise:()=>SD,asValue:()=>FD,combineLatestToArray:()=>sp,combineLatestToObject:()=>lp,isGenFactoryNoInput:()=>Ms,lazy:()=>kD,mergeFlat:()=>PD,prepare:()=>BD,resolveToAsyncGen:()=>uu,resolveToGen:()=>fe,run:()=>MD,runN:()=>up,single:()=>zD,syncToArray:()=>TD});const OD=(e,r)=>{let i,o=-9007199254740991;for(let a of e){let n=r(a);n>=o&&(o=n,i=a)}return i},jD=(e,r)=>{let i,o=9007199254740991;for(let a of e){let n=r(a);n<=o&&(o=n,i=a)}return i},RD=(e,r,i)=>{let o=ih(e,r,i);return o.a.length===0&&o.b.length===0},VD=e=>{let r=j(e.delay,10),i,o=e.onValue,a="stopped",n=or(async()=>{if(i){let d=await i.next();if(d.done)return a="stopped",!1;let h=o(d.value);return typeof h=="boolean"?(h||(a="stopped"),h):!0}else return a="stopped",!1},r),s=()=>{a!=="stopped"&&(i=void 0,n.cancel(),a="stopped")},l=()=>{a!=="paused"&&(n.cancel(),a="paused")},u=()=>{a!=="running"&&(i||c(),a="running",n.start())},c=()=>{if(e.iterator)i=e.iterator();else throw Error("No source iterator")};return{start:u,cancel:s,restart:()=>{c(),u()},pause:l,get state(){return a}}},LD=(e,r)=>{let i=[],o=[],a=!1,n=c=>{i.length>0?i.shift()(...c):o.push(c)},s=()=>new Promise(c=>{if(o.length>0){let f=o.shift();c(...f)}else i.push(c)}),l=(...c)=>{n(c)};return e.addEventListener(r,l),{next:async()=>a?{done:!0,value:void 0}:{done:!1,value:await s()},return:async()=>(a=!0,e.removeEventListener(r,l),{done:!0,value:void 0}),throw:async c=>(a=!0,{done:!0,value:Promise.reject(Error(c))})}},ID=(e,r)=>{let i={...e};for(let[o,a]of Object.entries(e))typeof a=="number"?i[o]=r(a):i[o]=a;return i},fp=(e,r)=>{if(!Array.isArray(e))throw TypeError(`Param 'data' is expected to be an array. Got type: ${typeof e}`);let i=r??(o=>o);return e.map((o,a)=>{if(typeof o!="number")throw TypeError(`Param 'data' contains non-number at index: '${a}'. Type: '${typeof o}' value: '${o}'`);let n=a/(e.length-1),s=i(n);if(typeof s!="number")throw TypeError(`Weighting function returned type '${typeof s}' rather than number for input: '${n}'`);return o*s})},fn=e=>e.filter(r=>typeof r=="number"&&!Number.isNaN(r)),dp=e=>{let r=0,i=e[0].length;for(let o=0;o<i;o++){let a=0;for(let[n,s]of e.entries())n===0?a=s[o]:a*=s[o];r+=a}return r},hp=e=>{if(e===void 0)throw Error("data parameter is undefined");let r=fn(e);return r.reduce((o,a)=>o+a,0)/r.length},qD=e=>Math.min(...fn(e)),_D=e=>e.reduce((r,i,o,a)=>i>a[r]?o:r,0),gu=(...e)=>e.reduce((r,i,o,a)=>i<a[r]?o:r,0),pp=e=>Math.max(...fn(e)),WD=e=>e.reduce((r,i)=>typeof i!="number"||Number.isNaN(i)||!Number.isFinite(i)?r:r+i,0),mu=e=>{let r=-9007199254740991;for(let i of e)r=Math.max(r,i);return r},yp=e=>{let r=0;for(let i of e)r+=i;return r},bu=e=>{let r=-9007199254740991;for(let i of e)r=Math.min(r,i);return r},gp=(e,r)=>{typeof r=="function"&&(r=fp(e,r));let i=Od(e,r),[o,a]=i.reduce((n,s)=>[n[0]+s[0]*s[1],n[1]+s[1]],[0,0]);return o/a},ie=(e,r=0,i=1)=>{if(Number.isNaN(e))throw Error("Param 'value' is NaN");if(Number.isNaN(r))throw Error("Param 'min' is NaN");if(Number.isNaN(i))throw Error("Param 'max' is NaN");return e<r?r:e>i?i:e},mp=(e=0,r=1)=>{if(Number.isNaN(e))throw Error("Param 'min' is NaN");if(Number.isNaN(r))throw Error("Param 'max' is NaN");return i=>i>r?r:i<e?e:i},Bs=(e,r)=>{if(!Number.isInteger(e))throw TypeError(`v parameter must be an integer (${e})`);let i=Array.isArray(r)?r.length:r;if(!Number.isInteger(i))throw TypeError(`length parameter must be an integer (${i}, ${typeof i})`);return e=Math.round(e),e<0?0:e>=i?i-1:e},GD=(...e)=>{let r=-1,i=-9007199254740991;for(let o=0;o<e.length;o++){let a=Math.abs(e[o]);a>i&&(i=a,r=o)}return e[r]};function*UD(e,r=0){if(w(G(e,"","amount"),G(r,"","offset")),e===0)return;let i=0;do yield e<0?-i+r:i+r;while(i++<Math.abs(e)-1)}const JD=(e,r="absolute")=>i=>bp(r,i,e),HD=(e="absolute",r=NaN)=>{let i=r;return o=>{let a=bp(e,o,i);return i=o,a}},bp=(e="absolute",r,i)=>{if(Number.isNaN(i))return 0;let o=r-i,a=0;if(e==="absolute")a=Math.abs(o);else if(e==="numerical")a=o;else if(e==="relative")a=Math.abs(o/i);else if(e==="relativeSigned")a=o/i;else throw TypeError(`Unknown kind: '${e}' Expected: 'absolute', 'relative', 'relativeSigned' or 'numerical'`);return a},vp=e=>!(typeof e!="number"||Number.isNaN(e));function*KD(e){for(let r of e)vp(r)&&(yield r)}const QD=e=>r=>r>=e,ZD=(e,r)=>i=>i>=e&&i<=r,XD=e=>(typeof e=="function"&&(e=e()),w($(e,"percentage","v")),1-e),YD=function*(e,r=0,i,o=!1){if(e<=0)throw Error("Interval is expected to be above zero");i===void 0&&(i=2**53-1);let a=r;do for(;a<i;)yield a,a+=e;while(o)},wp=function*(e,r=0,i,o=!1,a){w($(e,"nonZero"));let n=e<0;if(i!==void 0&&(n&&r<i||!n&&r>i))throw Error(`Interval of ${e.toString()} will never go from ${r.toString()} to ${i.toString()}`);a??=1e3,i===void 0?i=2**53-1:i*=a,e*=a;do{let s=r*a;for(;!n&&s<=i||n&&s>=i;)yield s/a,s+=e}while(o)},e2=function(e=.01,r=!1,i=0,o=1){return w($(e,"percentage","interval"),$(i,"percentage","start"),$(o,"percentage","end")),wp(e,i,o,r)};function di(e,r,i){w(G(e,"positive","decimalPlaces"));let o=typeof r=="boolean"?r:i??!1,a;if(e===0)a=Math.round;else{let n=10**e;a=o?s=>Math.ceil(s*n)/n:s=>Math.floor(s*n)/n}return typeof r=="number"?a(r):a}function t2(e,r,i){w($(e,"percentage","rangePercent"));let o=Math.floor(e*100),a=(n,s)=>{try{if(typeof s!="number"||Number.isNaN(s)||!Number.isFinite(s))return!1;let l=Math.abs(s-n);return Math.floor(n===0?l*100:l/n*100)<=o}catch{return!1}};return r===void 0?a:(w($(r,"","baseValue")),i===void 0?n=>a(r,n):a(r,i))}const r2=(e,...r)=>{let i=r.map(a=>a-e),o=r.map(a=>a+e);return(...a)=>{for(let n of a)for(let s=0;s<r.length;s++)if(n>=i[s]&&n<=o[s])return!0;return!1}};var xp={};C(xp,{clamp:()=>jr,fromScalar:()=>i2,immutable:()=>si,scale:()=>o2,scaleUnclamped:()=>a2,toScalar:()=>Ep,towardZero:()=>Dp});const si=(e=0)=>{if(e===void 0)throw Error("Start value is undefined");let r=typeof e=="number"?e:e.value;if(r>1)throw Error("Start value cannot be larger than 1");if(r<-1)throw Error("Start value cannot be smaller than -1");if(Number.isNaN(r))throw Error("Start value is NaN");let i=r;return{[Symbol.toPrimitive](o){return o==="number"?i:o==="string"?i.toString():!0},value:i,towardZero:o=>si(Dp(i,o)),add:o=>si(jr(i+o)),multiply:o=>si(jr(i*o)),inverse:()=>si(-i),interpolate:(o,a)=>si(jr(De(o,i,a))),asScalar:(o=1,a=0)=>Ep(i,o,a)}},Ep=(e,r=1,i=0)=>{if(typeof e!="number")throw Error(`Expected v to be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw Error("Parameter is NaN");return ft(e,-1,1,i,r)},i2=e=>(w($(e,"percentage","v")),e*2-1),o2=(e,r,i)=>jr(zt(r,i,-1,1)(e)),a2=(e,r,i)=>zt(r,i,-1,1)(e),jr=e=>{if(typeof e!="number")throw Error(`Param 'bipolarValue' must be a number. Got: ${typeof e}`);if(Number.isNaN(e))throw Error("Param 'bipolarValue' is NaN");return e>1?1:e<-1?-1:e},Dp=(e,r)=>{if(typeof e!="number")throw Error(`Parameter 'v' must be a number. Got: ${typeof e}`);if(typeof r!="number")throw Error(`Parameter 'amt' must be a number. Got: ${typeof r}`);if(r<0)throw Error("Parameter 'amt' must be positive");return e<0?(e+=r,e>0&&(e=0)):e>0&&(e-=r,e<0&&(e=0)),e},Cp=(e,r=0,i=360)=>(w(G(e,void 0,"v"),G(r,void 0,"min"),G(i,void 0,"max")),e===r||e===i?r:(e>0&&e<r&&(e+=r),e-=r,i-=r,e%=i,e<0&&(e=i-Math.abs(e)+r),e+r)),ho=(e,r=0,i=1)=>{if(w($(e,"","min"),$(r,"","min"),$(i,"","max")),e===r||e===i)return r;for(;(e<=r||e>=i)&&!(e===i||e===r);)e>i?e=r+(e-i):e<r&&(e=i-(r-e));return e},n2=(e,r,i,o,a)=>{let n=0,s=Math.abs(a-o),l=Math.abs(r-o+a),u=Math.abs(o+(360-a)),c=Math.min(s,l,u);return n=c===u?o-i(c):c===l?o+i(c):o>a?o-i(c):o+i(c),Cp(n,e,r)},od=Math.PI*2;function De(e,r,i,o){let a,n="clamp",s=f=>(a&&(f=a(f)),n===void 0||n==="clamp"?f=ie(f):n==="wrap"&&(f>1?f%=1:f<0&&(f=1+f%1)),f),l=(f,d,h)=>(w($(d,"","a"),$(h,"","b"),$(f,"","amount")),f=s(f),(1-f)*d+f*h),u=(f={})=>{if(f.transform){if(typeof f.transform!="function")throw Error(`Param 'transform' is expected to be a function. Got: ${typeof f.transform}`);a=f.transform}n=f.limits??"clamp"},c=(f,d,h)=>(1-f)*d+f*h;if(typeof e!="number")throw TypeError(`First param is expected to be a number. Got: ${typeof e}`);if(typeof r=="number"){let f,d;if(i===void 0||typeof i=="object")return f=e,d=r,u(i),h=>l(h,f,d);if(typeof i=="number")return f=r,d=i,u(o),l(e,f,d);throw Error("Values for 'a' and 'b' not defined")}else if(r===void 0||typeof r=="object"){let f=s(e);return u(r),w($(f,"","amount")),(d,h)=>c(f,d,h)}}const s2=(e,r=0,i=1,o=0,a)=>{let n=o;return(s,l)=>{if(s!==void 0&&(i=s),l!==void 0&&(r=l),n>=1)return i;let u=De(n,r,i,a);return n+=e,u}},$p=(e,r,i,o)=>{let a=ho(i-r,0,od);return De(e,r,r+(a>Math.PI?a-od:a),o)};function*Ap(e,r,i,o){w($(e,"","start"),$(r,"","end"),$(i,"","steps"));let a=o?di(o):s=>s,n=(r-e)/(i-1);if(w($(n,"","step")),!Number.isFinite(n))throw TypeError("Calculated step value is infinite");for(let s=0;s<i;s++){let l=e+n*s;yield a(l)}}var l2=class{#e=[];enqueue(r){this.#e.push(r)}dequeue(){return this.#e.shift()}get data(){return this.#e}get size(){return this.#e.length}};const u2=Math.PI*2,no=(e=3)=>{w($(e,"aboveZero","scaling"));let r=0,i=0;return o=>($(o,"","v").success&&o!==void 0&&(i++,r+=(o-r)/Math.min(i,e)),r)},c2=(e=100,r)=>{let i=new l2;return o=>{if($(o).success&&o!==void 0)for(i.enqueue(o);i.size>e;)i.dequeue();return r===void 0?hp(i.data):gp(i.data,r)}},ad=(e,r)=>{let i=u2*r*e;return i/(i+1)},nd=(e,r,i)=>e*r+(1-e)*i,f2=(e=1,r=0,i=1)=>{let o=0,a=0,n=0;return(l,u)=>{u??=performance.now();let c=u-n,f=ad(c,i),d=(l-o)/c,h=nd(f,d,a),p=e+r*Math.abs(h),y=ad(c,p),g=nd(y,l,o);return o=g,a=h,n=u,g}},ft=(e,r,i,o,a,n)=>zt(r,i,o,a,n)(e),zt=(e,r,i,o,a,n)=>{w($(e,"finite","inMin"),$(r,"finite","inMax"));let s=o??1,l=i??0,u=n?mp(i,o):void 0;return c=>{if(e===r)return s;let f=(c-e)/(r-e);a!==void 0&&(f=a(f));let d=f*(s-l)+l;return u?u(d):d}},d2=()=>e=>e,h2=(e,r,i,o,a,n)=>{if(a===void 0&&(a=1),o===void 0&&(o=0),r===i)return a;let s=ft(e,r,i,o,a,n);return ie(s,o,a)},p2=(e,r,i=1)=>(w($(e,"percentage","v"),$(r,"percentage","outMin"),$(i,"percentage","outMax")),ft(e,0,1,r,i)),y2=(e,r,i)=>Sp(r,i)(e),Sp=(e,r)=>i=>(w($(i,"percentage","v")),ft(i,0,1,e,r)),Fp=(e,r,i=0,o=1,a=!1,n)=>{let s=zt(e,r,i,o,n,a),l=zt(i,o,e,r,n,a);return{out:s,in:l}},To=(e,r={})=>{if(e.length===0)return{total:NaN,min:NaN,max:NaN,avg:NaN,count:NaN};let i=r.nonNumbers??"throw",o=0,a=2**53-1,n=-9007199254740991,s=0;for(let l=0;l<e.length;l++){let u=e[l];if(typeof u!="number"){if(i==="ignore")continue;if(i==="throw")throw Error(`Param 'data' contains a non-number at index: ${l.toString()}`);i==="nan"&&(u=NaN)}Number.isNaN(u)||(a=Math.min(a,u),n=Math.max(n,u),o+=u,s++)}return{total:o,max:n,min:a,count:s,avg:o/s}};var kp={};C(kp,{array:()=>m2,stream:()=>g2});const g2=(e,r)=>{let i=e??9007199254740991,o=r??-9007199254740991;return w($(i),$(o)),a=>(w($(a)),i=Math.min(i,a),o=Math.max(o,a),ft(a,i,o))},m2=(e,r,i)=>{if(!Array.isArray(e))throw TypeError(`Param 'values' should be an array. Got: ${typeof e}`);let o=To(e),a=r??o.min,n=i??o.max;return e.map(s=>ie(ft(s,a,n)))},b2=(e,r)=>(typeof e=="function"&&(e=e()),typeof r=="function"&&(r=r()),w($(e,"percentage","v"),$(r,"percentage","t")),e*r),Br=(e,r,i=!0)=>{let o=r.toString(),a=o.indexOf("."),n=1;a>=0&&(n=10*o.substring(a+1).length,r=Math.floor(n*r),e*=n),w($(e,"","v"),G(r,"","every"));let s=e/r,l=s%1;return s=Math.floor(s),(l===.5&&i||l>.5)&&s++,r*s/n},v2=e=>{let r=e.reduce((a,n)=>Math.max(a,n),-1/0),i=e.map(a=>Math.exp(a-r)),o=i.reduce((a,n)=>a+n);return i.map(a=>a/o)};var w2={};C(w2,{Bipolar:()=>xp,Normalise:()=>kp,applyToValues:()=>ID,average:()=>hp,averageWeighted:()=>gp,clamp:()=>ie,clampIndex:()=>Bs,clamper:()=>mp,count:()=>UD,differenceFromFixed:()=>JD,differenceFromLast:()=>HD,dotProduct:()=>dp,filterIterable:()=>KD,flip:()=>XD,interpolate:()=>De,interpolateAngle:()=>$p,interpolatorStepped:()=>s2,isApprox:()=>t2,isCloseToAny:()=>r2,isValid:()=>vp,linearSpace:()=>Ap,max:()=>pp,maxAbs:()=>GD,maxFast:()=>mu,maxIndex:()=>_D,min:()=>qD,minFast:()=>bu,minIndex:()=>gu,movingAverage:()=>c2,movingAverageLight:()=>no,noiseFilter:()=>f2,numberArrayCompute:()=>To,numericPercent:()=>e2,numericRange:()=>wp,numericRangeRaw:()=>YD,proportion:()=>b2,quantiseEvery:()=>Br,rangeInclusive:()=>ZD,round:()=>di,scale:()=>ft,scaleClamped:()=>h2,scalePercent:()=>y2,scalePercentages:()=>p2,scaler:()=>zt,scalerNull:()=>d2,scalerPercent:()=>Sp,scalerTwoWay:()=>Fp,softmax:()=>v2,thresholdAtLeast:()=>QD,total:()=>WD,totalFast:()=>yp,validNumbers:()=>fn,weight:()=>fp,wrap:()=>ho,wrapInteger:()=>Cp,wrapRange:()=>n2});const x2=(e,r={})=>{if(e===void 0)throw Error("Param 'data' is undefined");if(Array.isArray(e))return To(e,r);if(wi(e))return E2(e,r);throw Error("Param 'data' is neither an array nor iterable")};function E2(e,r={}){let i=0,o=r.nonNumbers??"ignore",a=2**53-1,n=-9007199254740991,s=0;for(let l of e){if(typeof l!="number"||Number.isNaN(l)){if(o==="throw")throw TypeError(`Data contains something not a number. Got type '${typeof l}'`);if(o==="nan"&&(l=NaN),o==="ignore")continue}i+=l,s++,a=Math.min(a,l),n=Math.max(n,l)}return{avg:i/s,total:i,max:n,min:a,count:s}}function D2(e,r={}){let i=0,o=0,a=r.nonNumbers??"ignore";for(let n of e){if(typeof n!="number"||Number.isNaN(n)){if(a==="throw")throw TypeError(`Data contains something not a number. Got type '${typeof n}'`);if(a==="nan"&&(n=NaN),a==="ignore")continue}o+=n,i++}return o/i}var C2={};C(C2,{Async:()=>v0,Chains:()=>cp,Sync:()=>dh,asCallback:()=>H2,chunks:()=>S2,combineLatestToArray:()=>sp,combineLatestToObject:()=>lp,computeAverage:()=>D2,concat:()=>N2,dropWhile:()=>$2,equals:()=>_2,every:()=>q2,fill:()=>k2,filter:()=>F2,find:()=>P2,flatten:()=>T2,forEach:()=>M2,fromArray:()=>z2,fromEvent:()=>LD,fromFunction:()=>U2,fromFunctionAwaited:()=>J2,fromIterable:()=>G2,hasEqualValuesShallow:()=>RD,isAsyncIterable:()=>Z,isIterable:()=>wi,iteratorController:()=>VD,last:()=>to,map:()=>B2,max:()=>ga,maxScore:()=>OD,min:()=>Np,minScore:()=>jD,numbersCompute:()=>x2,reduce:()=>j2,slice:()=>R2,some:()=>O2,toArray:()=>I2,unique:()=>V2,uniqueByValue:()=>L2,until:()=>A2,zip:()=>W2});function Np(e,r=(i,o)=>i>o){return Z(e)?z0(e,r):Sh(e,r)}function ga(e,r=(i,o)=>i>o){return Z(e)?B0(e,r):Ah(e,r)}function $2(e,r){return Z(e)?E0(e,r):mh(e,r)}function A2(e,r){if(Z(e))return D0(e,r);bh(e,r)}function S2(e,r){return Z(e)?w0(e,r):yh(e,r)}function F2(e,r){return Z(e)?S0(e,r):Dh(e,r)}function k2(e,r){return Z(e)?A0(e,r):xh(e,r)}function N2(...e){return Z(e[0])?x0(...e):gh(...e)}function P2(e,r){return Z(e)?F0(e,r):Ch(e,r)}function M2(e,r,i={}){if(Z(e))return N0(e,r,i);Eh(e,r)}function B2(e,r){return Z(e)?M0(e,r):Ml(e,r)}function z2(e,r){return r===void 0?sn(e):nu(e,r)}function T2(e){return Z(e)?k0(e):$h(e)}function O2(e,r){return Z(e)?R0(e,r):Fh(e,r)}function to(e){return Z(e)?P0(e):Pl(e)}function j2(e,r,i){return Z(e)?T0(e,r,i):fh(e,r,i)}function R2(e,r=0,i=1/0){return Z(e)?j0(e,r,i):ch(e,r,i)}function V2(e){return Array.isArray(e)?e.length===0?sn([]):Z(e[0])?Ps(e):Ss(e):Z(e)?Ps(e):Ss(e)}function*L2(e,r=Bt,i=new Set){yield*Z(e)?V0(e,r,i):hh(e,r,i)}function I2(e,r={}){return Z(e)?cn(e,r):Ph(e,r)}function q2(e,r){return Z(e)?$0(e,r):wh(e,r)}function _2(e,r,i){return Z(e)&&Z(r)?C0(e,r,i):vh(e,r,i)}function W2(...e){return e.length===0?sn([]):Z(e[0])?L0(...e):kh(...e)}function G2(e,r){return Z(e)||r!==void 0?su(e,r):Nh(e)}function*U2(e){for(;;)yield e()}async function*J2(e){for(;;)yield await e()}function H2(e,r,i){if(Z(e))return O0(e,r);ph(e,r)}var vu=class extends ct{constructor(r={}){r.eq===void 0&&(r={...r,eq:(i,o)=>Y(i.item,o.item)}),super(r)}enqueueWithPriority(r,i){w($(i,"positive")),super.enqueue({item:r,priority:i})}changePriority(r,i,o=!1,a){if(r===void 0)throw Error("Item cannot be undefined");let n;for(let s of this.data)if(a){if(a(s.item,r)){n=s;break}}else if(this.eq(s,{item:r,priority:0})){n=s;break}if(n===void 0&&!o)throw Error(`Item not found in priority queue. Item: ${JSON.stringify(r)}`);n!==void 0&&this.removeWhere(s=>n===s),this.enqueueWithPriority(r,i)}dequeueMax(){let r=to(ga(this.data,(i,o)=>i.priority>=o.priority));if(r!==void 0)return this.removeWhere(i=>i===r),r.item}dequeueMin(){let r=to(ga(this.data,(i,o)=>i.priority>=o.priority));if(r!==void 0)return this.removeWhere(i=>i.item===r),r.item}peekMax(){let r=to(ga(this.data,(i,o)=>i.priority>=o.priority));if(r!==void 0)return r.item}peekMin(){let r=to(Np(this.data,(i,o)=>i.priority>=o.priority));if(r!==void 0)return r.item}};function K2(e={}){return new vu(e)}var dn=class zs{opts;#e;constructor(r={},i=[]){if(r===void 0)throw Error("opts parameter undefined");this.opts=r,this.#e=i}forEach(r){for(let i=this.#e.length-1;i>=0;i--)r(this.#e[i])}forEachFromFront(r){this.#e.forEach(i=>{r(i)})}enqueue(...r){return new zs(this.opts,Bl(this.opts,this.#e,...r))}dequeue(){return new zs(this.opts,zl(this.opts,this.#e))}get isEmpty(){return Tl(this.opts,this.#e)}get isFull(){return Ol(this.opts,this.#e)}get length(){return this.#e.length}get peek(){return Ma(this.opts,this.#e)}toArray(){return[...this.#e]}};const Q2=(e={},...r)=>(e={...e},new dn(e,[...r]));var Pp={};C(Pp,{PriorityMutable:()=>vu,QueueImmutable:()=>dn,QueueMutable:()=>ct,debug:()=>CE,dequeue:()=>zl,enqueue:()=>Bl,immutable:()=>Q2,isEmpty:()=>Tl,isFull:()=>Ol,mutable:()=>Bh,peek:()=>Ma,priority:()=>K2,trimQueue:()=>Mh});const Z2=(e={})=>new wu(e);var wu=class extends Ye{capacity;store;evictPolicy;autoDeleteElapsedMs;autoDeletePolicy;autoDeleteTimer;disposed=!1;constructor(r={}){if(super(),this.capacity=r.capacity??-1,w(G(this.capacity,"nonZero","capacity")),this.store=new Map,r.evictPolicy&&this.capacity<=0)throw Error("evictPolicy is set, but no capacity limit is set");this.evictPolicy=r.evictPolicy??"none",this.autoDeleteElapsedMs=r.autoDeleteElapsedMs??-1,this.autoDeletePolicy=r.autoDeletePolicy??"none",this.autoDeleteElapsedMs>0&&(this.autoDeleteTimer=setInterval(()=>{this.#e()},Math.max(1e3,this.autoDeleteElapsedMs*2)))}dispose(){this.disposed||(this.disposed=!0,this.autoDeleteTimer&&(clearInterval(this.autoDeleteTimer),this.autoDeleteTimer=void 0))}get keyLength(){return this.store.size}*entries(){for(let r of this.store.entries())yield[r[0],r[1].value]}*values(){for(let r of this.store.values())yield r.value}*keys(){yield*this.store.keys()}elapsedSet(r){let i=this.store.get(r);if(i!==void 0)return Date.now()-i.lastSet}elapsedGet(r){let i=this.store.get(r);if(i!==void 0)return Date.now()-i.lastGet}has(r){return this.store.has(r)}get(r){let i=this.store.get(r);if(i)return(this.autoDeletePolicy==="either"||this.autoDeletePolicy==="get")&&this.store.set(r,{...i,lastGet:performance.now()}),i.value}delete(r){let i=this.store.get(r);if(!i)return!1;let o=this.store.delete(r);return this.fireEvent("removed",{key:r,value:i.value}),o}clear(){this.store.clear()}touch(r){let i=this.store.get(r);return i?(this.store.set(r,{...i,lastSet:Date.now(),lastGet:Date.now()}),!0):!1}findEvicteeKey(){if(this.evictPolicy==="none")return;let r="";if(this.evictPolicy==="oldestGet")r="lastGet";else if(this.evictPolicy==="oldestSet")r="lastSet";else throw Error(`Unknown eviction policy ${this.evictPolicy}`);return Cl(this.store,r)[0][0]}#e(){this.autoDeletePolicy!=="none"&&this.deleteWithElapsed(this.autoDeleteElapsedMs,this.autoDeletePolicy)}deleteWithElapsed(r,i){let o=[...this.store.entries()],a=[],n=j(r,1e3),s=performance.now();for(let l of o){let u=s-l[1].lastGet,c=s-l[1].lastSet;(i==="get"?u:i==="set"?c:Math.max(u,c))>=n&&a.push([l[0],l[1].value])}for(let l of a){this.store.delete(l[0]);let u={key:l[0],value:l[1]};this.fireEvent("expired",u),this.fireEvent("removed",u)}return a}set(r,i){let o=this.store.get(r);if(o){this.store.set(r,{...o,lastSet:performance.now()});return}if(this.keyLength===this.capacity&&this.capacity>0){let a=this.findEvicteeKey();if(!a)throw Error(`ExpiringMap full (capacity: ${this.capacity})`);let n=this.store.get(a);if(this.store.delete(a),n){let s={key:a,value:n.value};this.fireEvent("expired",s),this.fireEvent("removed",s)}}this.store.set(r,{lastGet:0,lastSet:performance.now(),value:i}),this.fireEvent("newKey",{key:r,value:i})}};const X2=(e,r)=>{for(let i of e.entries()){let o=i[1];for(let a of o)if(r(a,i[0]))return i}},Y2=e=>{let r=["",0];for(let i of e.keysAndCounts())i[1]>r[1]&&(r=i);return r[1]},Mp=(e,r,i=Y)=>{for(let o of e.entries()){let a=o[1];for(let n of a)if(i(n,r))return o}};var Bp=class{map;groupBy;valueEq;constructor(r=Mo,i=Y,o=[]){this.groupBy=r,this.valueEq=i,this.map=new Map(o)}has(r){return this.map.has(r)}hasKeyValue(r,i){let o=this.map.get(r);if(!o)return!1;for(let a of o)if(this.valueEq(a,i))return!0;return!1}debugString(){let r="";return[...this.map.keys()].every(o=>{let a=this.map.get(o);a!==void 0&&(r+=o+` (${a.length}) = ${JSON.stringify(a)}\r
`)}),r}count(r){let i=this.map.get(r);return i?i.length:0}firstKeyByValue(r,i=Y){let o=Mp(this,r,i);if(o)return o[0]}*entriesFlat(){for(let r of this.map.keys())for(let i of this.map.get(r))yield[r,i]}*entries(){for(let[r,i]of this.map.entries())yield[r,[...i]]}*get(r){let i=this.map.get(r);i&&(yield*i.values())}*keys(){yield*this.map.keys()}*valuesFlat(){for(let r of this.map)yield*r[1]}*values(){for(let r of this.map)yield r[1]}*keysAndCounts(){for(let r of this.map)yield[r[0],r[1].length]}get lengthKeys(){return this.map.size}get isEmpty(){return this.map.size===0}},hn=class extends Bp{addKeyedValues(r,...i){let o=this.map.get(r);o===void 0?this.map.set(r,i):this.map.set(r,[...o,...i])}setValues(r,i){this.map.set(r,i)}addValue(...r){for(let i of r){let o=this.groupBy(i);this.addKeyedValues(o,i)}}deleteKeyValue(r,i){let o=this.map.get(r);if(o===void 0)return!1;let a=o.filter(n=>!this.valueEq(n,i));return this.map.set(r,a),a.length<o.length}deleteByValue(r){let i=!1,o=[...this.map.entries()];for(let a of o)for(let n of a[1])this.valueEq(n,r)&&(i=!0,this.deleteKeyValue(a[0],r));return i}delete(r){let i=this.map.get(r);return!i||i.length===0?!1:(this.map.delete(r),!0)}clear(){this.map.clear()}};const sd=(e=Mo,r=Y)=>new hn(e,r),eC=(e,r)=>{let i=new Map(e.entries());for(let o of r){if(o[0]===void 0)throw Error("key cannot be undefined");if(o[1]===void 0)throw Error("value cannot be undefined");i.set(o[0],o[1])}return i},tC=(e,r)=>{let i=new Map(e.entries());for(let o of r){if(o.key===void 0)throw Error("key cannot be undefined");if(o.value===void 0)throw Error("value cannot be undefined");i.set(o.key,o.value)}return i},rC=(e,r)=>e.has(r),so=(e,...r)=>{if(e===void 0)throw Error("map parameter is undefined");if(r===void 0)throw Error("data parameter i.s undefined");if(r.length===0)return e;let i=r[0];return i.key!==void 0&&i.value!==void 0?tC(e,r):eC(e,r)},zp=(e,r,i)=>{let o=new Map(e.entries());return o.set(r,i),o},Tp=(e,r)=>{let i=new Map(e.entries());return i.delete(r),i},bt=e=>{if(e===void 0)return bt([]);if(Array.isArray(e))return bt(so(new Map,...e));let r=e;return{add:(...i)=>{let o=so(r,...i);return bt(o)},set:(i,o)=>{let a=zp(r,i,o);return bt(a)},get:i=>r.get(i),delete:i=>bt(Tp(r,i)),clear:()=>bt(),has:i=>r.has(i),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0}},iC=(...e)=>{let r=so(new Map,...e);return{add:(...i)=>{r=so(r,...i)},delete:i=>{r=Tp(r,i)},clear:()=>{r=so(new Map)},set:(i,o)=>{r=zp(r,i,o)},get:i=>r.get(i),entries:()=>r.entries(),values:()=>r.values(),isEmpty:()=>r.size===0,has:i=>rC(r,i)}};var pn=class extends Ye{#e=new Map;groupBy;type;constructor(r,i={}){super(),this.type=r,this.groupBy=i.groupBy??Bt}get typeName(){return this.type.name}get lengthKeys(){return this.#e.size}get lengthMax(){let r=0;for(let i of this.#e.values())r=Math.max(r,this.type.count(i));return r}debugString(){let r=[...this.#e.keys()],i=`Keys: ${r.join(", ")}\r
`;for(let o of r){let a=this.#e.get(o);if(a===void 0)i+=` - ${o} (undefined)\r
`;else{let n=this.type.toArray(a);n!==void 0&&(i+=` - ${o} (${this.type.count(a)}) = ${JSON.stringify(n)}\r
`)}}return i}get isEmpty(){return this.#e.size===0}clear(){this.#e.clear(),super.fireEvent("clear",!0)}addKeyedValues(r,...i){let o=this.#e.get(r);o===void 0?(this.#e.set(r,this.type.addKeyedValues(void 0,i)),super.fireEvent("addedKey",{key:r}),super.fireEvent("addedValues",{values:i})):(this.#e.set(r,this.type.addKeyedValues(o,i)),super.fireEvent("addedValues",{values:i}))}set(r,i){return this.addKeyedValues(r,...i),this}addValue(...r){for(let i of r)this.addKeyedValues(this.groupBy(i),i)}hasKeyValue(r,i,o){let a=this.#e.get(r);return a===void 0?!1:this.type.has(a,i,o)}has(r){return this.#e.has(r)}deleteKeyValue(r,i){let o=this.#e.get(r);return o===void 0?!1:this.deleteKeyValueFromMap(o,r,i)}deleteKeyValueFromMap(r,i,o){let a=this.type.count(r),n=this.type.without(r,o),s=n.length;return this.#e.set(i,this.type.addKeyedValues(void 0,n)),a>s}deleteByValue(r){let i=!1;return[...this.#e.keys()].filter(o=>{let a=this.#e.get(o);if(!a)throw Error("Bug: map could not be accessed");this.deleteKeyValueFromMap(a,o,r)&&(i=!0,this.count(o)===0&&this.delete(o))}),i}delete(r){return this.#e.get(r)===void 0?!1:(this.#e.delete(r),this.fireEvent("deleteKey",{key:r}),!0)}firstKeyByValue(r,i=Y){return[...this.#e.keys()].find(n=>{let s=this.#e.get(n);if(s===void 0)throw Error("Bug: map could not be accessed");return this.type.has(s,r,i)})}count(r){let i=this.#e.get(r);return i===void 0?0:this.type.count(i)}*get(r){let i=this.#e.get(r);i!==void 0&&(yield*this.type.iterable(i))}*valuesFor(r){let i=this.#e.get(r);i!==void 0&&(yield*this.type.iterable(i))}getSource(r){return this.#e.get(r)}*keys(){yield*this.#e.keys()}*entriesFlat(){for(let r of this.#e.entries())for(let i of this.type.iterable(r[1]))yield[r[0],i]}*valuesFlat(){for(let r of this.#e.entries())yield*this.type.iterable(r[1])}*entries(){for(let[r,i]of this.#e.entries()){let o=[...this.type.iterable(i)];yield[r,o]}}*keysAndCounts(){for(let r of this.keys())yield[r,this.count(r)]}merge(r){for(let i of r.keys()){let o=r.get(i);this.addKeyedValues(i,...o)}}get size(){return this.#e.size}get[Symbol.toStringTag](){return this.#e[Symbol.toStringTag]}};const oC=e=>{let r=e?.hash??Bt,i=(n,s)=>r(n)===r(s),o={get name(){return"set"},iterable:n=>n.values(),addKeyedValues:(n,s)=>El(n,r,"skip",...s),count:n=>n.size,find:(n,s)=>Sl(n,s),filter:(n,s)=>Al(n,s),toArray:n=>Sa(n),has:(n,s)=>$l(n,s,i),without:(n,s)=>an(Sa(n),s,i)};return new pn(o,e)},aC=e=>{let r=Y,i={get name(){return"circular"},addKeyedValues:(o,a)=>{let n=o??new lh(e.capacity);for(let s of a)n=n.add(s);return n},count:o=>o.length,find:(o,a)=>o.find(a),filter:(o,a)=>o.filter(a),toArray:o=>o,iterable:o=>o.values(),has:(o,a)=>o.find(n=>r(n,a))!==void 0,without:(o,a)=>o.filter(n=>!r(n,a))};return new pn(i,e)};var Op=class extends Map{defaultValue;constructor(r=0){super(),this.defaultValue=r}get(r){let i=super.get(r);return i===void 0?this.defaultValue:i}reset(r){return super.set(r,this.defaultValue),this.defaultValue}multiply(r,i){let o=super.get(r),a=o??this.defaultValue;return a*=i,super.set(r,a),a}add(r,i=1){let o=super.get(r),a=o??this.defaultValue;return a+=i,super.set(r,a),a}subtract(r,i=1){let o=super.get(r),a=o??this.defaultValue;return a-=i,super.set(r,a),a}};const nC=(e={})=>{let r=e.convertToString,i=r===void 0?Y:(s,l)=>r(s)===r(l),o=e.comparer??i,a={get name(){return"array"},addKeyedValues:(s,l)=>s===void 0?[...l]:[...s,...l],iterable:s=>s.values(),count:s=>s.length,find:(s,l)=>s.find(u=>l(u)),filter:(s,l)=>s.filter(u=>l(u)),toArray:s=>s,has:(s,l)=>s.some(u=>o(u,l)),without:(s,l)=>s.filter(u=>!o(u,l))};return new pn(a,e)};var jp=class ro extends Bp{addKeyedValues(r,...i){return this.addBatch([[r,i]])}addValue(...r){let i=r.map(o=>[this.groupBy(o),o]);return this.addBatch(i)}addBatch(r){let i=new Map([...this.map.entries()].map(o=>[o[0],[...o[1]]]));for(let[o,a]of r){let n=i.get(o);n===void 0?i.set(o,a):n.push(...a)}return new ro(this.groupBy,this.valueEq,[...i.entries()])}clear(){return new ro(this.groupBy,this.valueEq)}deleteKeyValue(r,i){throw Error("Method not implemented.")}deleteByValue(r,i){let o=[...this.map.entries()],a=i??this.valueEq,n=o.map(s=>{let l=s[0],u=s[1].filter(c=>!a(c,r));return[l,u]});return new ro(this.groupBy,this.valueEq,n)}delete(r){let i=[...this.map.entries()].filter(o=>o[0]!==r);return new ro(this.groupBy,this.valueEq,i)}};const sC=(e=Mo,r=Y)=>new jp(e,r);var Rp={};C(Rp,{ExpiringMap:()=>wu,MapOfMutableImpl:()=>pn,MapOfSimple:()=>jp,MapOfSimpleMutable:()=>hn,NumberMap:()=>Op,addObjectEntriesMutate:()=>Fa,addValue:()=>El,addValueMutate:()=>Gd,addValueMutator:()=>Dl,deleteByValueCompareMutate:()=>qd,expiringMap:()=>Z2,filterValues:()=>Al,findBySomeKey:()=>xl,findEntryByPredicate:()=>_d,findEntryByValue:()=>Wd,findValue:()=>Sl,firstEntry:()=>X2,firstEntryByValue:()=>Mp,fromIterable:()=>Jd,fromObject:()=>Hd,getClosestIntegerKey:()=>Ld,getOrGenerate:()=>Fl,getOrGenerateSync:()=>eh,hasAnyValue:()=>$l,hasKeyValue:()=>Id,immutable:()=>bt,lengthMax:()=>Y2,mapOfSimpleMutable:()=>sd,mapToArray:()=>Xd,mapToObjectTransform:()=>Kd,mergeByKey:()=>Yd,mutable:()=>iC,ofArrayMutable:()=>nC,ofCircularMutable:()=>aC,ofSetMutable:()=>oC,ofSimple:()=>sC,ofSimpleMutable:()=>sd,some:()=>co,sortByValue:()=>Ud,sortByValueProperty:()=>Cl,toArray:()=>Sa,toObject:()=>Zd,transformMap:()=>Qd,zipKeyValue:()=>Po});var xu=class{rows=[];rowLabels=[];colLabels=[];columnMaxLength=0;getColumnLabelIndex(r){for(let[i,o]of this.colLabels.entries())if(o===r)return i}getRowLabelIndex(r){for(let[i,o]of this.rowLabels.entries())if(o===r)return i}print(){console.table([...this.rowsWithLabelsObject()])}asArray(){let r=[];for(let i of this.rows)i===void 0?r.push([]):r.push([...i]);return r}get rowCount(){return this.rows.length}get columnCount(){return this.columnMaxLength}*rowsWithLabelsObject(){for(let r=0;r<this.rows.length;r++)yield this.getRowWithLabelsObject(r)}*rowsWithLabelsArray(){for(let r=0;r<this.rows.length;r++)yield this.getRowWithLabelsArray(r)}labelColumns(...r){this.colLabels=r}labelColumn(r,i){this.colLabels[r]=i}labelRows(...r){this.rowLabels=r}labelRow(r,i){this.rowLabels[r]=i}appendRow(...r){return this.columnMaxLength=Math.max(this.columnMaxLength,r.length),this.rows.push(r),r}getRowWithLabelsArray(r){let i=this.rows.at(r);if(i!==void 0)return i.map((o,a)=>[this.colLabels.at(a),o])}getRowWithLabelsObject(r){let i=this.rows.at(r);if(i===void 0)return;let o={};for(let a=0;a<this.colLabels.length;a++){let n=this.colLabels.at(a)??a.toString();o[n]=i[a]}return o}#e(r){let i=typeof r=="number"?r:this.getRowLabelIndex(r);if(i===void 0)return{success:!1,error:"row-label-notfound"};if(i<0)return{success:!1,error:"row-index-invalid"};if(i<this.rows.length)return{success:!0,value:this.rows[i]};let o=[];return this.rows[i]=o,{success:!0,value:o}}row(r){let i=this.#t(r);if(Ft(i))throw Error(i.error);return[...i.value]}set(r,i,o){let a=this.#e(r);if(Ft(a))throw Error(a.error);let n=a.value,s=typeof i=="number"?i:this.getColumnLabelIndex(i);if(s===void 0)throw Error(`Column label '${i}' not found or is invalid`);if(s<0)throw Error("Column index invalid (less than zero)");n[s]=o}get(r,i){let o=this.#t(r);if(Ft(o))throw Error(o.error);let a=this.#r(o.value,i);if(Ft(a))throw Error(a.error);return a.value.value}#t(r){let i=0;if(typeof r=="number")i=r;else if(i=this.getRowLabelIndex(r),typeof i!="number")return{error:"row-label-notfound",success:!1};return typeof i=="number"?i<0||i>=this.rows.length?{error:"row-index-out-of-range",success:!1}:{success:!0,value:this.rows[i]}:{error:"row-invalid",success:!1}}#r(r,i){let o=typeof i=="number"?i:this.getColumnLabelIndex(i);return typeof o=="number"?o<0||o>=r.length?{success:!1,error:"col-index-out-of-range"}:{success:!0,value:{index:o,value:r[o]}}:{success:!1,error:"col-label-notfound"}}setRow(r,i,o){let a=this.#e(r);if(Ft(a))throw Error(a.error);let n=a.value,s=typeof o=="number"?o:this.columnMaxLength;for(let l=0;l<s;l++)n[l]=i;return n}},Vp={};C(Vp,{adjacentVertices:()=>Du,areAdjacent:()=>vC,bfs:()=>wC,clone:()=>EC,connect:()=>Wp,connectTo:()=>Os,connectWithEdges:()=>Gp,createVertex:()=>Lp,dfs:()=>Up,disconnect:()=>_p,distance:()=>Ip,distanceDefault:()=>mC,dumpGraph:()=>fC,edges:()=>qp,get:()=>uC,getCycles:()=>Kp,getOrCreate:()=>Ts,getOrFail:()=>gC,graph:()=>Jp,graphFromVertices:()=>Hp,hasKey:()=>lC,hasNoOuts:()=>pC,hasOnlyOuts:()=>yC,hasOut:()=>Ir,isAcyclic:()=>DC,pathDijkstra:()=>xC,toAdjacencyMatrix:()=>cC,topologicalSort:()=>CC,transitiveReduction:()=>Qp,updateGraphVertex:()=>yn,vertexHasOut:()=>hC,vertices:()=>Eu});const Lp=e=>({id:e,out:[]});function lC(e,r){return w(se(e)),e.vertices.has(r)}function uC(e,r){return w(se(e)),w(ml(r,"non-empty","key")),e.vertices.get(r)}function cC(e){w(se(e));let r=[...e.vertices.values()],i=new xu;i.labelColumns(...r.map(o=>o.id)),i.labelRows(...r.map(o=>o.id));for(let o=0;o<r.length;o++){i.setRow(o,!1,r.length);let a=r[o];for(let[n,s]of r.entries())a.out.some(l=>l.id===s.id)&&i.set(o,n,!0)}return i}const fC=e=>dC(e).join(`
`),dC=e=>{let r=[],i="vertices"in e?e.vertices.values():e;for(let o of i){let a=bC(o);r.push(...a.map(n=>` ${n}`))}return r},Ip=(e,r)=>r.weight===void 0?1:r.weight;function*qp(e){w(se(e));let r=[...e.vertices.values()];for(let i of r)for(let o of i.out)yield o}function*Eu(e){w(se(e));let r=[...e.vertices.values()];for(let i of r)yield i}function se(e,r="graph"){if(e===void 0)return{success:!1,error:`Param '${r}' is undefined. Expected Graph`};if(e===null)return{success:!1,error:`Param '${r}' is null. Expected Graph`};if(typeof e=="object"){if(!("vertices"in e))return{success:!1,error:`Param '${r}.vertices' does not exist. Is it a Graph type?`}}else return{success:!1,error:`Param '${r} is type '${typeof e}'. Expected an object Graph`};return{success:!0,value:e}}function*Du(e,r){if(w(se(e)),r===void 0)return;let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of i.out){let a=e.vertices.get(o.id);if(a===void 0)throw Error(`Could not find vertex: ${o.id}`);yield a}}const hC=(e,r)=>{if(e===void 0)return!1;let i=typeof r=="string"?r:r.id;return e.out.some(o=>o.id===i)},pC=(e,r)=>{w(se(e));let i=typeof r=="string"?e.vertices.get(r):r;return i===void 0?!1:i.out.length===0},yC=(e,r,...i)=>{w(se(e));let o=er(e,r),a=i.map(n=>er(e,n));if(a.length!==o.out.length)return!1;for(let n of a)if(!Ir(e,o,n))return!1;return!0},Ir=(e,r,i)=>{w(se(e));let o=er(e,r),a=typeof i=="string"?i:i.id;return o.out.some(n=>n.id===a)},Ts=(e,r)=>{w(se(e));let i=e.vertices.get(r);if(i!==void 0)return{graph:e,vertex:i};let o=Lp(r);return{graph:yn(e,o),vertex:o}},gC=(e,r)=>{w(se(e));let i=e.vertices.get(r);if(i===void 0)throw Error(`Vertex '${r}' not found in graph`);return i},yn=(e,r)=>(w(se(e)),{...e,vertices:e.vertices.set(r.id,r)}),mC=(e,r)=>r.weight===void 0?1:r.weight;function _p(e,r,i){w(se(e));let o=er(e,r),a=er(e,i);return Ir(e,o,a)?yn(e,{...o,out:o.out.filter(n=>n.id!==a.id)}):e}function Os(e,r,i,o){w(se(e));let a=Ts(e,r);e=a.graph;let n=Ts(e,i);e=n.graph;let s={id:i,weight:o};return Ir(e,a.vertex,n.vertex)||(e=yn(e,{...a.vertex,out:[...a.vertex.out,s]})),{graph:e,edge:s}}function Wp(e,r){if(typeof e!="object")throw TypeError(`Param 'graph' is expected to be a DirectedGraph object. Got: ${typeof e}`);if(typeof r!="object")throw TypeError(`Param 'options' is expected to be ConnectOptions object. Got: ${typeof r}`);return Gp(e,r).graph}function Gp(e,r){w(se(e));let{to:i,weight:o,from:a}=r,n=r.bidi??!1,s=Array.isArray(i)?i:[i],l=[];for(let u of s){let c=Os(e,a,u,o);e=c.graph,l.push(c.edge)}if(!n)return{graph:e,edges:l};for(let u of s){let c=Os(e,u,a,o);e=c.graph,l.push(c.edge)}return{graph:e,edges:l}}const bC=e=>{let r=[e.id],i=o=>o.weight===void 0?o.id:`${o.id} (${o.weight})`;for(let o of e.out)r.push(` -> ${i(o)}`);return e.out.length===0&&(r[0]+=" (terminal)"),r};function vC(e,r,i){if(w(se(e)),Ir(e,r,i.id)||Ir(e,i,r.id))return!0}function er(e,r){if(w(se(e)),r===void 0)throw Error("Param 'idOrVertex' is undefined. Expected string or Vertex");let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Id not found ${r}`);return i}function*wC(e,r,i){w(se(e));let o=er(e,r),a=i===void 0?void 0:er(e,i),n=new ct,s=new Set;for(n.enqueue(o);!n.isEmpty;){let l=n.dequeue();if(yield l,a!==void 0&&a===l)return;for(let u of Du(e,l))s.has(u.id)||(s.add(u.id),n.enqueue(er(e,u.id)))}}function*Up(e,r){w(se(e));let i=er(e,r),o=new Kr,a=new Set;for(o.push(i);!o.isEmpty;){let n=o.pop();if(n!==void 0&&!a.has(n.id)){a.add(n.id),yield n;for(let s of n.out){let l=e.vertices.get(s.id);l&&o.push(l)}}}}const xC=(e,r)=>{w(se(e));let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error("source vertex not found");let o=new Map,a=new Map;o.set(i.id,0);let n=new vu,s=[...e.vertices.values()];for(let u of s)u.id!==i.id&&(o.set(u.id,2**53-1),a.set(u.id,null)),n.enqueueWithPriority(u.id,2**53-1);for(;!n.isEmpty;){let u=n.dequeueMin();if(u===void 0)throw Error("Bug. Queue unexpectedly empty");let c=e.vertices.get(u);for(let f of c.out){let d=o.get(u)+Ip(e,f);d<o.get(f.id)&&(o.set(f.id,d),a.set(f.id,c),n.changePriority(f.id,d,!0))}}return{distances:o,previous:a,pathTo:u=>{let c=[];for(;u!==i.id;){let f=a.get(u);if(f==null)throw Error(`Id not present: ${u}`);c.push({id:u,weight:o.get(u)}),u=f.id}return c}}},EC=e=>(w(se(e)),{vertices:bt([...e.vertices.entries()])}),Jp=(...e)=>{let r={vertices:bt()};for(let i of e)r=Wp(r,i);return r};function DC(e){return w(se(e)),Kp(e).length===0}function CC(e){w(se(e));let r=new Op(0);for(let n of qp(e))r.add(n.id,1);let i=new ct,o=0;for(let n of Eu(e))r.get(n.id)===0&&i.enqueue(n),o++;let a=[];for(;!i.isEmpty;){let n=i.dequeue();a.push(n);for(let s of n.out)r.subtract(s.id,1)===0&&i.enqueue(e.vertices.get(s.id))}if(a.length!==o)throw Error("Graph contains cycles");return Hp(a)}function Hp(e){let r=Ml(e,o=>[o.id,o]);return{vertices:bt([...r])}}function Kp(e){w(se(e));let r=0,i=new Kr,o=new Map,a=[];for(let s of e.vertices.values())o.set(s.id,{...s,lowlink:NaN,index:NaN,onStack:!1});let n=s=>{s.index=r,s.lowlink=r,r++,i.push(s),s.onStack=!0;for(let l of s.out){let u=o.get(l.id);Number.isNaN(u.index)?(n(u),s.lowlink=Math.min(s.lowlink,u.lowlink)):u.onStack&&(s.lowlink=Math.min(s.lowlink,u.lowlink))}if(s.lowlink===s.index){let l=[],u;for(;s!==u;)u=i.pop(),u.onStack=!1,l.push({id:u.id,out:u.out});l.length>1&&a.push(l)}};for(let s of o.values())Number.isNaN(s.index)&&n(s);return a}function Qp(e){w(se(e));for(let r of Eu(e))for(let i of Du(e,r))for(let o of Up(e,i))if(i.id!==o.id&&Ir(e,r,o)){let a=_p(e,r,o);return Qp(a)}return e}var Zp={};C(Zp,{adjacentVertices:()=>NC,connect:()=>ry,connectTo:()=>ty,connectWithEdges:()=>iy,createVertex:()=>Xp,dumpGraph:()=>SC,edgesForVertex:()=>PC,getConnection:()=>Cu,getOrCreate:()=>js,graph:()=>$C,hasConnection:()=>ey,toAdjacencyMatrix:()=>AC,updateGraphVertex:()=>Yp});const Xp=e=>({id:e}),Yp=(e,r)=>({...e,vertices:e.vertices.set(r.id,r)}),js=(e,r)=>{let i=e.vertices.get(r);if(i!==void 0)return{graph:e,vertex:i};let o=Xp(r);return{graph:Yp(e,o),vertex:o}};function Oa(e,r){if(r===void 0)throw Error("Param 'idOrVertex' is undefined. Expected string or Vertex");if(e===void 0)throw Error("Param 'graph' is undefined. Expected Graph");let i=typeof r=="string"?e.vertices.get(r):r;if(i===void 0)throw Error(`Id not found ${r}`);return i}const ey=(e,r,i)=>Cu(e,r,i)!==void 0,Cu=(e,r,i)=>{if(r===void 0)throw Error("Param 'a' is undefined. Expected string or Vertex");if(i===void 0)throw Error("Param 'b' is undefined. Expected string or Vertex");if(e===void 0)throw Error("Param 'graph' is undefined. Expected Graph");let o=Oa(e,r),a=Oa(e,i);for(let n of e.edges)if(n.a==o.id&&n.b===a.id||n.a==a.id&&n.b===o.id)return n};function ty(e,r,i,o){e=js(e,r).graph,e=js(e,i).graph;let s=Cu(e,r,i);return s!==void 0?{graph:e,edge:s}:(s={a:r,b:i,weight:o},{graph:{...e,edges:[...e.edges,s]},edge:s})}function ry(e,r){return iy(e,r).graph}function iy(e,r){let{a:i,weight:o,b:a}=r,n=Array.isArray(a)?a:[a],s=[];for(let l of n){let u=ty(e,i,l,o);e=u.graph,s.push(u.edge)}return{graph:e,edges:s}}const $C=(...e)=>{let r={vertices:bt(),edges:[]};for(let i of e)r=ry(r,i);return r};function AC(e){let r=[...e.vertices.values()],i=new xu;i.labelColumns(...r.map(o=>o.id)),i.labelRows(...r.map(o=>o.id));for(let o=0;o<r.length;o++){i.setRow(o,!1,r.length);let a=r[o];for(let[n,s]of r.entries())ey(e,a,s)&&i.set(o,n,!0)}return i}const SC=e=>FC(e).join(`
`),FC=e=>{let r=[];r.push(`Vertices: ${[...e.vertices.values()].map(i=>i.id).join(", ")}`),r.push("Edges:");for(let i of e.edges)r.push(kC(i));return r},kC=e=>{let r=e.weight?` (${e.weight})`:"";return`${e.a} <-> ${e.b}${r}`};function*NC(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of e.edges)o.a===r?yield Oa(e,o.b):o.b===r&&(yield Oa(e,o.a))}function*PC(e,r){if(r===void 0)return;if((typeof r=="string"?e.vertices.get(r):r)===void 0)throw Error(`Vertex not found ${JSON.stringify(r)}`);for(let o of e.edges)(o.a===r||o.b===r)&&(yield o)}var oy={};C(oy,{Directed:()=>Vp,Undirected:()=>Zp});var MC={};C(MC,{CircularArray:()=>lh,ExpiringMap:()=>wu,Graphs:()=>oy,MapOfSimpleMutable:()=>hn,Maps:()=>Rp,QueueImmutable:()=>dn,QueueMutable:()=>ct,Queues:()=>Pp,SetStringImmutable:()=>au,SetStringMutable:()=>ou,Sets:()=>b0,StackImmutable:()=>fo,StackMutable:()=>Kr,Stacks:()=>y0,Table:()=>xu,Trees:()=>h0});const ja=(e,r="")=>typeof e=="object"&&"name"in e&&e.name!==void 0?e.name:r;function*$u(e,r){r===void 0&&(r=ja(e));for(let[i,o]of Rs(e))yield[o,r];for(let[i,o]of Rs(e)){let a=ja(o,"?"),n=r.length>0?r+"."+a:a;yield*$u(o,n)}}function*BC(e,r){r===void 0&&(r=ja(e));for(let[i,o]of Rs(e)){yield[o,r];let a=ja(o,"?"),n=r.length>0?r+"."+a:a;yield*$u(o,n)}}function zC(e){return e.seq!==void 0}function TC(e){return e.sel!==void 0}function*Rs(e){if(zC(e))yield*e.seq.entries();else if(TC(e))yield*e.sel.entries();else if(typeof e!="string")throw TypeError("Unexpected shape of node. seq/sel missing")}const OC=async(e,r)=>{let i=typeof r=="number"?{millis:r}:r,o=i.delay??"before";(o==="before"||o==="both")&&await Ce(i);let a=Promise.resolve(await e());return(o==="after"||o==="both")&&await Ce(i),a};async function*jC(){let e,r=new Promise(a=>e=a),i=0,o=()=>{e&&e(),r=new Promise(a=>e=a)};try{for(;;)i=globalThis.requestAnimationFrame(o),yield await r}finally{e&&e(),globalThis.cancelAnimationFrame(i)}}async function*ay(e){let r=j(e);if(r===void 0)throw Error("timeout is undefined");if(r<0)throw Error("Timeout is less than zero");if(r===0)return yield*jC();let i,o=new Promise(s=>i=s),a,n=()=>{i&&i(),o=new Promise(s=>i=s)};try{for(;;)a=globalThis.setTimeout(n,r),yield await o}finally{i&&i(),a!==void 0&&globalThis.clearTimeout(a),a=void 0}}const Di=(e,r)=>{if(e===void 0)throw Error("callback parameter is undefined");let i=j(r);w(G(i,"aboveZero","interval"));let o,a=0,n=0,s=0,l="idle",u=()=>{a=0,globalThis.clearTimeout(o),l="idle"},c=async(d=r,h)=>new Promise((y,g)=>{a=performance.now();let m=j(d),v=G(m,"aboveZero","altTimeoutMs");if(Ft(v)){g(Hr(v));return}switch(l){case"scheduled":f();break}l="scheduled",o=globalThis.setTimeout(async()=>{if(l!=="scheduled"){console.warn("Timeout skipping execution since state is not 'scheduled'"),u();return}let D=h??[];n++,s++,l="running",await e(performance.now()-a,...D),l="idle",u(),y()},m)}),f=()=>{l!=="idle"&&u()};return{start:c,cancel:f,get runState(){return l},get startCount(){return n},get startCountTotal(){return s}}},RC=(e,r)=>{let i=Di(e,r);return(...o)=>{i.start(void 0,o)}};var Au=class{#e;#t=0;#r=Math.floor(Math.random()*100);constructor(){this.#e=[]}isEmpty(){return this.#e.length===0}add(r,i={}){this.#t++;let o=i.once??!1,a={id:`${this.#r} - ${this.#t}`,handler:r,once:o};return this.#e.push(a),a.id}remove(r){let i=this.#e.length;return this.#e=this.#e.filter(o=>o.id!==r),this.#e.length!==i}notify(r){for(let i of this.#e)i.handler(r),i.once&&this.remove(i.id)}clear(){this.#e=[]}};const VC=(e,r)=>{w(G(e,"positive","nth"));let i=0;return o=>(i++,i===e?(i=0,r&&r(o),!0):!1)},Su=async(e,r={},i)=>{let o=[],a=r.rank??No,n=Array.isArray(e)?e:[e];r.shuffle&&(n=vl(n));for(let s=0;s<n.length;s++){let l=n[s],u;if(u=typeof l=="function"?await l(i):l,u!==void 0&&(o.push(u),o.sort(a)),r.stop!==void 0&&r.stop(u,o))break}return r.filter?o.filter(r.filter):o},LC=async(e,r={},i)=>{let o=await Su(e,r,i);if(!o||o.length===0)return;let a=r.at??-1;return o.at(a)},ny=(e,r,i={})=>{let o=i.timeoutMs??601e3,a=i.signal,n=!1,s=!1,l;return new Promise((c,f)=>{let d=p=>{"type"in p?r.includes(p.type)?(n=!0,c(p),h()):console.warn(`eventRace: Got event '${p.type}' that is not in race list`):(console.warn("eventRace: Event data does not have expected 'type' field"),console.log(p))};for(let p of r)e.addEventListener(p,d);let h=()=>{if(!s){l!==void 0&&clearTimeout(l),l=void 0,s=!0;for(let p of r)e.removeEventListener(p,d)}};l=setTimeout(()=>{n||s||(h(),f(Error(`eventRace: Events not fired within interval. Events: ${JSON.stringify(r)} Interval: ${o}`)))},o),a?.addEventListener("abort",()=>{n||s||(h(),f(Error(`Abort signal received ${a.reason}`)))})})},IC=e=>{let r=no(),i=fy({...e,whatToCall:o=>{r(o)},fallback(){return e.default??0}});return o=>(i(o),r())};var sy=class extends Ye{key;resource;_lastUpdate;_pool;_state;_userExpireAfterMs;constructor(r,i){super(),this.key=r,this.resource=i,this._lastUpdate=performance.now(),this._pool=i.pool,this._userExpireAfterMs=this._pool.userExpireAfterMs,this._state="idle",this._pool.log.log(`PoolUser ctor key: ${this.key}`)}toString(){return this.isDisposed?"PoolUser. State: disposed":`PoolUser. State: ${this._state} Elapsed: ${performance.now()-this._lastUpdate} Data: ${JSON.stringify(this.resource.data)}`}keepAlive(){if(this._state==="disposed")throw Error("PoolItem disposed");this._lastUpdate=performance.now()}_dispose(r,i){if(this._state==="disposed")return;let o=this.resource;this._state="disposed",o._release(this),this._pool.log.log(`PoolUser dispose key: ${this.key} reason: ${r}`),this.fireEvent("disposed",{data:i,reason:r}),super.clearEventListeners()}release(r){if(this.isDisposed)throw Error("User disposed");let i=this.resource,o=i.data;this._pool.log.log(`PoolUser release key: ${this.key} reason: ${r}`),this.fireEvent("released",{data:o,reason:r}),this._dispose(`release-${r}`,o)}get data(){if(this.isDisposed)throw Error("User disposed");return this.resource.data}get isExpired(){return this._userExpireAfterMs>0?performance.now()>this._lastUpdate+this._userExpireAfterMs:!1}get elapsed(){return performance.now()-this._lastUpdate}get isDisposed(){return this._state==="disposed"}get isValid(){return!(this.isDisposed||this.isExpired||this.resource.isDisposed)}},ly=class{pool;#e;#t;#r;#i;#o;#a;constructor(r,i){if(this.pool=r,i===void 0)throw Error("Parameter 'data' is undefined");if(r===void 0)throw Error("Parameter 'pool' is undefined");this.#t=i,this.#a=0,this.#o=r.resourcesWithoutUserExpireAfterMs,this.#i=r.capacityPerResource,this.#r=[],this.#e="idle"}get data(){if(this.#e==="disposed")throw Error("Resource disposed");return this.#t}updateData(r){if(this.#e==="disposed")throw Error("Resource disposed");if(r===void 0)throw Error("Parameter 'data' is undefined");this.#t=r}toString(){return`Resource (expired: ${this.isExpiredFromUsers} users: ${this.#r.length}, state: ${this.#e}) data: ${JSON.stringify(this.data)}`}_assign(r){if(this.#r.find(o=>o===r||o.key===r.key))throw Error("User instance already assigned to resource");this.#r.push(r),this.#a=performance.now()}_release(r){this.#r=this.#r.filter(i=>i!==r),this.pool._release(r),this.#a=performance.now()}get hasUserCapacity(){return this.usersCount<this.#i}get usersCount(){return this.#r.length}get isExpiredFromUsers(){return this.#o<=0||this.#r.length>0?!1:performance.now()>this.#o+this.#a}get isDisposed(){return this.#e==="disposed"}dispose(r){if(this.#e==="disposed")return;let i=this.#t;this.#e="disposed",this.pool.log.log(`Resource disposed (${r})`);for(let o of this.#r)o._dispose(`resource-${r}`,i);this.#r=[],this.#a=performance.now(),this.pool._releaseResource(this,r),this.pool.freeResource&&this.pool.freeResource(i)}},uy=class{_resources;_users;capacity;userExpireAfterMs;resourcesWithoutUserExpireAfterMs;capacityPerResource;fullPolicy;generateResource;freeResource;log=As("Pool");constructor(r={}){this.capacity=r.capacity??-1,this.fullPolicy=r.fullPolicy??"error",this.capacityPerResource=r.capacityPerResource??1,this.userExpireAfterMs=r.userExpireAfterMs??-1,this.resourcesWithoutUserExpireAfterMs=r.resourcesWithoutUserExpireAfterMs??-1,this.generateResource=r.generate,this.freeResource=r.free,this._users=new Map,this._resources=[],this.log=As("Pool",r.debug??!1);let i=Math.max(this.userExpireAfterMs,this.resourcesWithoutUserExpireAfterMs);i>0&&setInterval(()=>{this.maintain()},i*1.1)}dumpToString(){let r=`Pool
    capacity: ${this.capacity} userExpireAfterMs: ${this.userExpireAfterMs} capacityPerResource: ${this.capacityPerResource}
    resources count: ${this._resources.length}`,i=this._resources.map(o=>o.toString()).join(`\r
	`);r+=`\r
Resources:\r
	`+i,r+=`\r
Users: \r
`;for(let[o,a]of this._users.entries())r+=`	k: ${o} v: ${a.toString()}\r
`;return r}getUsersByLongestElapsed(){return[...this._users.values()].sort((r,i)=>{let o=r.elapsed,a=i.elapsed;return o===a?0:o<a?1:-1})}getResourcesSortedByUse(){return[...this._resources].sort((r,i)=>r.usersCount===i.usersCount?0:r.usersCount<i.usersCount?-1:1)}addResource(r){if(r===void 0)throw Error("Cannot add undefined resource");if(r===null)throw TypeError("Cannot add null resource");if(this.capacity>0&&this._resources.length===this.capacity)throw Error(`Capacity limit (${this.capacity}) reached. Cannot add more.`);this.log.log(`Adding resource: ${JSON.stringify(r)}`);let i=new ly(this,r);return this._resources.push(i),i}maintain(){let r=!1,i=[];for(let a of this._resources)a.isDisposed?(this.log.log(`Maintain, disposed resource: ${JSON.stringify(a.data)}`),i.push(a)):a.isExpiredFromUsers&&(this.log.log(`Maintain, expired resource: ${JSON.stringify(a.data)}`),i.push(a));if(i.length>0){for(let a of i)a.dispose("diposed/expired");r=!0}let o=[];for(let[a,n]of this._users.entries())n.isValid||(this.log.log(`Maintain. Invalid user: ${n.key} (Disposed: ${n.isDisposed} Expired: ${n.isExpired} Resource disposed: ${n.resource.isDisposed})`),o.push(a),n._dispose("invalid",n.data));for(let a of o)this._users.delete(a),r=!0;r&&this.log.log(`End: resource len: ${this._resources.length} users: ${this.usersLength}`)}*resources(){let r=[...this._resources];for(let i of r)yield i}*values(){let r=[...this._resources];for(let i of r)yield i.data}release(r,i){let o=this._users.get(r);o&&o.release(i??"Pool.release")}_release(r){this._users.delete(r.key)}_releaseResource(r,i){this._resources=this._resources.filter(o=>o!==r)}hasResource(r){return this._resources.find(o=>o.data===r)!==void 0}hasUser(r){return this._users.has(r)}_assign(r,i){let o=new sy(r,i);return this._users.set(r,o),i._assign(o),o}#e(r){let i=this.getResourcesSortedByUse();if(i.length>0&&i[0].hasUserCapacity)return this._assign(r,i[0]);if(this.generateResource&&(this.capacity<0||this._resources.length<this.capacity)){this.log.log(`capacity: ${this.capacity} resources: ${this._resources.length}`);let o=this.addResource(this.generateResource());return this._assign(r,o)}}get usersLength(){return[...this._users.values()].length}useValue(r){return this.use(r).resource.data}use(r){let i=this._users.get(r);if(i)return i.keepAlive(),i;this.maintain();let o=this.#e(r);if(o)return o;if(this.fullPolicy==="error")throw Error(`Pool is fully used (fullPolicy: ${this.fullPolicy}, capacity: ${this.capacity})`);if(this.fullPolicy==="evictOldestUser"){let a=this.getUsersByLongestElapsed();if(a.length>0){this.release(a[0].key,"evictedOldestUser");let n=this.#e(r);if(n)return n}}throw Error(`Pool is fully used (${this.fullPolicy})`)}};const qC=(e={})=>new uy(e);function cy(){let e,r;return{promise:new Promise((o,a)=>{e=o,r=a}),resolve:e,reject:r}}const fy=e=>{let r=!1,i=Di(()=>{r||(i.start(),e.whatToCall(e.fallback()))},e.interval);return e.abort&&e.abort.addEventListener("abort",o=>{r=!0,i.cancel()}),i.start(),o=>{if(r)throw Error("AbortSignal has been fired");i.start(),e.whatToCall(o)}};async function*dy(e,r){let i=r.signal??void 0,o=r.delayWhen??"before",a=r.count??void 0,n=r.allowUndefined??!1,s=r.delayMinimum?j(r.delayMinimum):void 0,l=r.while,u=!1,c=j(r.delay,j(r.delayMinimum,0)),f=performance.now(),d=async()=>{let y=performance.now()-f;if(s!==void 0&&(c=Math.max(0,s-y)),c&&await Ce({millis:c,signal:i}),f=performance.now(),i?.aborted)throw Error(`Signal aborted ${i.reason}`)};Array.isArray(e)&&(e=e.values()),r.onStart&&r.onStart();let h=!0,p=0;try{for(;!u;){p++,(o==="before"||o==="both")&&await d();let y=await mE(e);y===void 0&&!n?u=!0:(yield y,(o==="after"||o==="both")&&await d(),a!==void 0&&p>=a&&(u=!0)),l&&(l(p)||(u=!0))}h=!1}finally{u=!0,r.onComplete&&r.onComplete(h)}}function*_C(e,r){let i=r.signal??void 0,o=r.count??void 0,a=r.allowUndefined??!1,n=!1;Array.isArray(e)&&(e=e.values()),r.onStart&&r.onStart();let s=!0,l=0;try{for(;!n;){l++;let u=sh(e);u===void 0&&!a?n=!0:(yield u,o!==void 0&&l>=o&&(n=!0),i?.aborted&&(n=!0))}s=!1}finally{n=!0,r.onComplete&&r.onComplete(s)}}var WC=class extends Ye{timeoutMs;whenUnmatchedResponse;keyRequest;keyResponse;#e=new Map;#t;constructor(r={}){if(super(),typeof window>"u"&&(globalThis.window={setTimeout,clearTimeout}),this.timeoutMs=r.timeoutMs??1e3,this.whenUnmatchedResponse=r.whenUnmatchedResponse??"throw",this.#t=or(()=>this.#r(),this.timeoutMs*2),r.key){if(r.keyRequest)throw Error("Cannot set 'keyRequest' when 'key' is set ");if(r.keyResponse)throw Error("Cannot set 'keyResponse' when 'key' is set ");this.keyRequest=r.key,this.keyResponse=r.key}else{if(!r.keyRequest||!r.keyResponse)throw Error("Expects 'keyRequest' & 'keyResponse' fields to be set if 'key' is not set");this.keyRequest=r.keyRequest,this.keyResponse=r.keyResponse}}#r(){let r=[...this.#e.values()],i=Date.now();for(let o of r)if(o.expiresAt<=i){o.promiseReject&&o.promiseReject("Request timeout");let a=o.callback;a&&setTimeout(()=>{a(!0,"Request timeout")},1),this.fireEvent("completed",{request:o.req,response:"Request timeout",success:!1}),this.#e.delete(o.id)}return this.debugDump(),this.#e.size>0}debugDump(){let r=[...this.#e.values()],i=Date.now();for(let o of r){let a=i-o.expiresAt;console.log(`${o.id} Expires in: ${Math.floor(a/1e3).toString()}s`)}}request(r,i){if(i!==void 0){this.#o(r,i);return}return this.#i(r)}requestAndForget(r){let i=this.keyRequest(r);if(this.#e.has(i))throw Error(`Already a request pending with id '${i}'`);let o={expiresAt:Date.now()+this.timeoutMs,id:i,req:r};this.#e.set(i,o),this.#t.start()}#i(r){let i=this.keyRequest(r);if(this.#e.has(i))throw Error(`Already a request pending with id '${i}'`);return new Promise((a,n)=>{let s={expiresAt:Date.now()+this.timeoutMs,id:i,req:r,promiseResolve:a,promiseReject:n};this.#e.set(i,s),this.#t.start()})}#o(r,i){let o=this.keyRequest(r);if(this.#e.has(o))throw Error(`Already a request pending with id '${o}'`);let a={expiresAt:Date.now()+this.timeoutMs,id:o,req:r,callback:i};this.#e.set(o,a),this.#t.start()}response(r,i){let o=this.keyResponse(r),a=this.#e.get(o);if(!a){if(this.whenUnmatchedResponse==="throw")throw Error(`Unmatched response with id: '${o}'`,{cause:r});return!1}return i?a.expiresAt=Date.now()+this.timeoutMs:this.#e.delete(o),a.promiseResolve&&a.promiseResolve(r),a.callback&&a.callback(!1,r),this.fireEvent("match",{request:a.req,response:r}),i||this.fireEvent("completed",{request:a.req,response:r,success:!0}),!0}};function*hy(e={}){let r=e.startAt??1,i=e.limitAttempts??2**53-1,o=e.limitValue,a=e.power??1.1,n=r;for(w(G(i,"aboveZero","limitAttempts"),$(r,"","startAt"),$(i,"","limitAttempts"),()=>o===void 0?void 0:$(o,"","limitValue"),$(a,"","power"));i>0;){if(o&&n>=o)return;i--,yield n,n+=n**+a}}const Fu=(e,r={})=>ku({async probe(){try{let o=await e();return o===void 0?{value:r.taskValueFallback,error:"Fallback",success:!1}:{value:o,success:!0}}catch(o){return{success:!1,error:o}}}},r),ku=async(e,r={})=>{let i=r.abort,o=Nl(r.log),a=r.predelayMs??0,n=Lr(),s=0,l=r.startAt??1e3,u=r.limitAttempts??2**53-1,c=hy({...r,startAt:l,limitAttempts:u});if(l<=0)throw Error("Param 'initialValue' must be above zero");if(a>0)try{await Ce({millis:a,signal:i})}catch(f){return{success:!1,attempts:s,value:r.taskValueFallback,elapsed:n(),message:ut(f)}}for(let f of c){s++;let d=await e.probe(s);if(d.success)return{success:d.success,value:d.value,attempts:s,elapsed:n()};if(o({msg:`retry attempts: ${s.toString()} t: ${oh(f)}`}),s>=u)break;try{await Ce({millis:f,signal:i})}catch(h){return{success:!1,attempts:s,value:r.taskValueFallback,message:ut(h),elapsed:n()}}}return{message:`Giving up after ${s.toString()} attempts.`,success:!1,attempts:s,value:r.taskValueFallback,elapsed:n()}},GC=e=>{let r=!1,i=!1;return()=>(r||(r=!0,i=e()),i)};var UC=class{#e;#t;#r;signal(){this.#e&&(this.#e(),this.#e=void 0),this.#r=Promise.resolve()}flush(){this.#t&&(this.#t("Flushed"),this.#t=void 0),this.#e=void 0,this.#r=void 0}#i(){let r=new Promise((i,o)=>{this.#e=i,this.#t=o});return this.#r=r,r}async forSignal(r){let i=this.#r;if(i??=this.#i(),r){let o=this.#t;setTimeout(()=>{o&&o(`Timeout elapsed ${r.toString()}`)},r)}await i,this.#r=void 0,this.#e=void 0,this.#t=void 0}async didSignal(r){try{return await this.forSignal(r),!0}catch{return!1}}},JC=class py extends Ye{static shared=new py;_loop;_queue;constructor(){super(),this._queue=Bh(),this._loop=or(()=>this.processQueue(),100)}enqueue(r){let i=this._queue.enqueue(r);return this._loop.runState==="idle"&&(this.fireEvent("started",{}),this._loop.start()),i}dequeue(){return this._queue.dequeue()}async processQueue(){let r=this._queue.dequeue();if(r===void 0)return this.fireEvent("empty",{}),!1;try{await r()}catch(i){console.error(i)}}clear(){this._queue.length!==0&&(this._queue.clear(),this._loop.cancel(),this.fireEvent("empty",{}))}get isEmpty(){return this._queue.isEmpty}get length(){return this._queue.length}};const HC=(e,r)=>{let i=0;return async(...o)=>{let a=performance.now()-i;if(a>=r){let n=e(a,...o);typeof n=="object"&&await n,i=performance.now()}}};function KC(e){let r=Ci(j(e,0),{timer:Er(),clampValue:!0});return()=>r.isDone}function Nu(e,r={}){let i=j(e);if(!i)throw Error("Param 'duration' not valid");let o={...r,timer:Er()},a;return()=>(a??=Ci(i,o),a.elapsed)}function yy(e,r={}){let i={...r,timer:Pu()},o;return()=>(o??=Ci(e,i),o.elapsed)}const gy=()=>({elapsed:1,isDone:!0,reset(){},mod(e){}}),my=()=>({elapsed:0,isDone:!1,reset(){},mod(){}}),Ci=(e,r={})=>{if(Number.isFinite(e)){if(Number.isNaN(e))return my()}else return gy();let i=r.clampValue??!1,o=r.wrapValue??!1;if(i&&o)throw Error("clampValue and wrapValue cannot both be enabled");let a=1,n=r.timer??Er(),s=0,l=u=>{s=u;let c=u/(e*a);return i?c=ie(c):o&&c>=1&&(c%=1),c};return{mod(u){a=u},get isDone(){return l(s)>=1},get elapsed(){return l(n.elapsed)},reset:()=>{n.reset()}}},Qr=(e,r={})=>{let i=r.timer??Er(),o=e/1e3,a=1,n=()=>{let s=i.elapsed*(o*a),l=s-Math.floor(s);if(l<0)throw Error(`Unexpected cycle fraction less than 0. Elapsed: ${s} f: ${l}`);if(l>1)throw Error(`Unexpected cycle fraction more than 1. Elapsed: ${s} f: ${l}`);return l};return{mod:s=>{a=s},reset:()=>{i.reset()},get isDone(){return n()>=1},get elapsed(){return n()}}},Er=()=>{let e=performance.now();return{reset:()=>{e=performance.now()},get elapsed(){return performance.now()-e}}},Pu=()=>{let e=0;return{reset:()=>{e=0},get peek(){return e},get elapsed(){return++e}}},Mu=(e,r)=>{if(typeof e!="function")throw Error(`Param 'fn' should be a function. Got: ${typeof e}`);let i=1;return{get elapsed(){return r.elapsed},get isDone(){return r.isDone},get runState(){return r.isDone?"idle":"scheduled"},get startCount(){return i},get startCountTotal(){return i},compute:()=>{let o=r.elapsed;return e(o)},reset:()=>{r.reset(),i++}}},QC=(e,r,i="slow")=>{let o=0,a,n=j(r,1e3);return()=>new Promise(async(s,l)=>{let u=performance.now()-o;if(a===void 0||u>n)try{o=performance.now(),a=await e(u),n=j(r,1e3)}catch(c){i==="fast"?(a=void 0,o=0):i==="backoff"&&(n=Math.floor(n*1.2)),l(c);return}s(a)})};var by=class{#e;#t;#r=!1;constructor(){let{promise:r,resolve:i}=cy();this.#e=r,this.#t=i}get(){return this.#e}add(r){if(this.#r)throw Error("QueueSingleUse has already been used");this.#r=!0,this.#t(r)}get isUsed(){return this.#r}};const ZC=()=>new by,Bu=(e,r,i)=>{let o,a=!1,n=s=>{o!==void 0&&(window.clearTimeout(o),o=void 0),s?r(s):a=!0,i!==void 0&&i(a)};return o=globalThis.setTimeout(()=>{o=void 0;try{r(`Timeout after ${e}ms`)}finally{i!==void 0&&i(a)}},e),n},Vs=e=>Object.freeze({value:e.value,visited:[...e.visited],machine:e.machine}),$i=(e,r)=>{let[i,o]=vy(e);if(!i)throw Error(o);let a=r??Object.keys(i.states)[0];if(i.states[a]===void 0)throw TypeError(`Initial state ('${a}') not found`);let n=XC(i.states);if(n===void 0)throw Error("Could not normalise transitions");return Object.freeze({value:a,visited:[],machine:Object.freeze(Object.fromEntries(n))})},Ls=e=>$i(e.machine),vy=e=>e===void 0?[void 0,"Parameter undefined"]:e===null?[void 0,"Parameter null"]:"states"in e?[e,""]:typeof e=="object"?[{states:e},""]:[void 0,`Unexpected type: ${typeof e}. Expected object`],Is=e=>po(e).length===0,zu=e=>{xy(e);let r=e.machine[e.value];return r.length===1&&r[0].state===null?[]:r},po=e=>zu(e).map(i=>i.state),wy=e=>{let r=i=>{if(i===null)return{state:null};if(typeof i=="string")return{state:i};if(typeof i=="object"&&"state"in i){let o=i.state;if(typeof o!="string")throw TypeError(`Target 'state' field is not a string. Got: ${typeof o}`);return"preconditions"in i?{state:o,preconditions:i.preconditions}:{state:o}}else throw Error(`Unexpected type: ${typeof i}. Expected string or object with 'state' field.`)};if(Array.isArray(e)){let i=!1,o=e.map(a=>{let n=r(a);if(!n)throw Error("Invalid target");return i||=n.state===null,n});if(i&&o.length>1)throw Error("Cannot have null as an possible state");return o}else{let i=r(e);return i?[i]:void 0}},XC=e=>{let r=new Map;for(let[i,o]of Object.entries(e)){if(i===void 0)throw TypeError("Top-level undefined state");if(o===void 0)throw TypeError(`Undefined target state for ${i}`);if(r.has(i))throw Error(`State defined twice: ${i}`);if(i.includes(" "))throw Error("State names cannot contain spaces");r.set(i,[])}for(let[i,o]of Object.entries(e)){let a=wy(o);if(a===void 0)throw Error("Could not normalise target");if(a!==null){let n=new Set;for(let s of a){if(n.has(s.state))throw Error(`Target state '${s.state}' already exists for '${i}'`);if(n.add(s.state),s.state!==null&&!r.has(s.state))throw Error(`Target state '${s.state}' is not defined as a top-level state. Defined under: '${i}'`)}r.set(i,a)}}return r},xy=e=>{if(e===void 0)throw TypeError("Param 'state' is undefined");if(typeof e.value!="string")throw TypeError("Existing state is not a string")},Pe=(e,r)=>(xy(e),gn(e,r),Object.freeze({value:r,machine:e.machine,visited:Pd([e.visited,[e.value]])})),Ey=e=>{let r=zu(e).at(0);if(!r||r.state===null)throw Error(`Not possible to move to a next state from '${e.value}`);return Pe(e,r.state)},Dy=(e,r)=>{try{return gn(e,r),!0}catch{return!1}},gn=(e,r)=>{if(r===null)throw Error("Cannot transition to null state");if(r===void 0)throw Error("Cannot transition to undefined state");if(typeof r!="string")throw TypeError(`Parameter 'toState' should be a string. Got: ${typeof r}`);let i=po(e);if(i.length===0)throw Error("Machine is in terminal state");if(!i.includes(r))throw Error(`Target state '${r}' not available at current state '${e.value}'. Possible states: ${i.join(", ")}`)},YC=(...e)=>{let r={};if(!Array.isArray(e))throw Error("Expected array of strings");if(e.length<=2)throw Error("Expects at least two states");for(let i=0;i<e.length;i++){let o=e[i];if(typeof o!="string")throw TypeError(`Expected array of strings. Got type '${typeof o}' at index ${i.toString()}`);r[o]=i===e.length-1?null:e[i+1]}return r},e$=(...e)=>{let r={};if(!Array.isArray(e))throw Error("Expected array of strings");if(e.length<2)throw Error("Expects at least two states");for(let[i,o]of e.entries()){if(typeof o!="string")throw TypeError(`Expected array of strings. Got type '${typeof o}' at index ${i.toString()}`);r[o]=[]}for(let i=0;i<e.length;i++){let o=r[e[i]];i===e.length-1?e.length>1?o.push(e[i-1]):r[e[i]]=null:(o.push(e[i+1]),i>0&&o.push(e[i-1]))}return r};async function t$(e,r){let i=Array.isArray(r)?{handlers:r}:r,o=Nl(i.debug,{category:"StateMachineDriver"}),a=new Map;for(let u of i.handlers){let c=Array.isArray(u.if)?u.if:[u.if];for(let f of c){if(typeof f!="string")throw TypeError(`Expected single or array of strings for the 'if' field. Got: '${typeof f}'.`);if(a.has(f))throw Error(`Multiple handlers defined for state '${f}'. There should be at most one.`);a.set(f,u)}}let n={rank:(u,c)=>No(u.score??0,c.score??0),shuffle:i.shuffleHandlers??!1},s=$i(e);for(let[u]of a)if(s.machine[u]===void 0&&u!=="__fallback")throw Error(`StateMachineDriver handler references a state ('${u}') which is not defined on the machine. Therefore this handler will never run.'`);return{reset:()=>{s=Ls(s)},getValue:()=>s.value,run:async()=>{o(`Run. State: ${s.value}`);let u=s.value,c=a.get(u);if(c===void 0&&(o(`  No handler for state '${u}', trying __fallback`),c=a.get("__fallback")),c===void 0){o("  No __fallback handler");return}let f=c.resultChoice==="first"?{...n,stop:p=>p?"reset"in p||"next"in p&&p.next!==void 0:!1}:n,d=await Su(c.then,f,s);o(`  In state '${s.value}' results: ${d.length}. Choice: ${c.resultChoice}`);let h;switch(c.resultChoice??"highest"){case"highest":h=d.at(-1);break;case"first":h=d[0];break;case"lowest":h=d.at(0);break;case"random":h=zd(d);break;default:throw Error(`Unknown 'resultChoice' option: ${c.resultChoice}. Expected highest, first, lowest or random`)}return o(`  Chosen result: ${JSON.stringify(h)}`),h?.reset?s=Ls(s):h&&h.next&&(typeof h.next=="boolean"?s=Ey(s):(o(JSON.stringify(d)),s=Pe(s,h.next))),s},to:u=>(s=Pe(s,u),s)}}var mn=class extends Ye{#e;#t;#r;#i=!1;#o=!1;#a=oE();constructor(r,i={}){super(),this.#r=i.debug??!1,this.#e=$i(r,i.initial),this.#t=Vs(this.#e)}#n(r){this.#o!==r&&(this.#o=r,r?(this.#i=!0,setTimeout(()=>{this.#i&&(this.#i=!1,this.fireEvent("stop",{state:this.#e.value}))},2)):this.#i=!1)}get statesPossible(){return po(this.#e)}get statesDefined(){return Object.keys(this.#e.machine)}next(){let r=po(this.#e);return r.length===0?null:(this.state=r[0],r[0])}get isDone(){return Is(this.#e)}reset(){this.#n(!1),this.#e=Vs(this.#t),this.#a=Lr()}validateTransition(r){gn(this.#e,r)}isValid(r){return Dy(this.#e,r)}set state(r){let i=this.#e.value;r!==this.#e.value&&(this.#e=Pe(this.#e,r),this.#r&&console.log(`StateMachine: ${i} -> ${r}`),this.#a=Lr(),setTimeout(()=>{this.fireEvent("change",{newState:r,priorState:i})},1),Is(this.#e)&&this.#n(!0))}get state(){return this.#e.value}get changedAt(){return this.#a()}get elapsed(){return this.#a()}},Cy={};C(Cy,{StateMachineWithEvents:()=>mn,cloneState:()=>Vs,driver:()=>t$,fromList:()=>YC,fromListBidirectional:()=>e$,init:()=>$i,isDone:()=>Is,isValidTransition:()=>Dy,next:()=>Ey,normaliseTargets:()=>wy,possible:()=>po,possibleTargets:()=>zu,reset:()=>Ls,to:()=>Pe,validateMachine:()=>vy,validateTransition:()=>gn});var r$={};C(r$,{DispatchList:()=>Au,Pool:()=>uy,PoolUser:()=>sy,RequestResponseMatch:()=>WC,Resource:()=>ly,StateMachine:()=>Cy,SyncWait:()=>UC,TaskQueueMutable:()=>JC,WaitForValue:()=>by,backoffGenerator:()=>hy,continuously:()=>or,create:()=>qC,debounce:()=>RC,delay:()=>OC,delayLoop:()=>ay,elapsedMillisecondsAbsolute:()=>Er,elapsedTicksAbsolute:()=>Pu,eventRace:()=>ny,everyNth:()=>VC,frequencyTimer:()=>Qr,hasElapsed:()=>KC,iterateBreadth:()=>$u,iterateDepth:()=>BC,movingAverageTimed:()=>IC,ofTotal:()=>Nu,ofTotalTicks:()=>yy,promiseWithResolvers:()=>cy,rateMinimum:()=>fy,relative:()=>Ci,repeat:()=>dy,repeatSync:()=>_C,retryFunction:()=>Fu,retryTask:()=>ku,run:()=>Su,runOnce:()=>GC,runSingle:()=>LC,singleItem:()=>ZC,sleep:()=>Ce,throttle:()=>HC,timeout:()=>Di,timerAlwaysDone:()=>gy,timerNeverDone:()=>my,timerWithFunction:()=>Mu,updateOutdated:()=>QC,waitFor:()=>Bu});const qs=(e,r)=>{let i={};for(let o of Object.entries(e)){let a=r(o[0]);i[a]=o[1]}return i},$y=(e,r)=>ih(Object.keys(e),Object.keys(r)),i$=(e,r)=>{let i=bn(e,r,!0);if(Object.entries(i.added).length>0||Object.entries(i.removed).length>0)throw Error("Shape of data has changed");return Ay(i,r)},Ay=(e,r)=>{let i={};if(e.isArray)return r;for(let o of Object.entries(e.changed))i[o[0]]=o[1];for(let o of Object.entries(e.added))i[o[0]]=o[1];for(let o of Object.entries(e.children)){let a=o[1];a.hasChanged&&(i[o[0]]=Ay(a,r[o[0]]))}return i},io=(e,r,i=Y)=>{if(!Array.isArray(e))throw Error("Param 'a' is not an array");if(!Array.isArray(r))throw Error("Param 'b' is not an array");let o=bn(e,r,!1,i);if(!o.isArray)throw Error("Change set does not have arrays as parameters");let a=s=>{if(s.startsWith("_"))return Number.parseInt(s.slice(1));throw Error(`Unexpected key '${s}'`)};return{...o,added:qs(o.added,a),changed:qs(o.changed,a),removed:o.removed.map(s=>a(s)),summary:o.summary.map(s=>[s[0],a(s[1]),s[2]])}},bn=(e,r,i=!1,o=Y)=>{e??={},r??={};let a=Object.entries(e),n=Object.entries(r),s=new Set,l={},u={},c={},f=[],d=Array.isArray(e),h=[],p=!1;for(let y of a){let g=d?`_${y[0]}`:y[0],m=y[1],v=r[y[0]];if(s.add(y[0]),v===void 0){p=!0,i&&!d?(l[g]=v,h.push(["mutate",g,v])):(f.push(g),h.push(["del",g,m]));continue}if(typeof m=="object"){let D=bn(m,v,i,o);D.hasChanged&&(p=!0),c[g]=D;let B=D.summary.map(V=>[V[0],g+"."+V[1],V[2]]);h.push(...B)}else o(m,v)||(l[g]=v,p=!0,h.push(["mutate",g,v]))}if(!i||d)for(let y of n){let g=d?`_${y[0]}`:y[0];s.has(y[0])||(u[g]=y[1],p=!0,h.push(["add",g,y[1]]))}return{changed:l,added:u,removed:f,children:c,hasChanged:p,isArray:d,summary:h}},Sy=e=>{let r=[];for(let i in e){let o=e[i];on(o)&&r.push([i,o])}return Object.fromEntries(r)},_s=(e,r)=>{let i=Object.entries(e),o=i.map(([a,n],s)=>[a,r({value:n,field:a,index:s,path:a})]);return Object.fromEntries(o)};function Fy(e,r){let i=Object.entries(e);for(let o of i)if(o[0]in r){let a=r[o[0]];o[1]=typeof a=="object"?Fy(o[1],a):a(o[1],e)}return Object.fromEntries(i)}function o$(e){if(e.length===0)return"(empty)";let r="";for(let[i,o]of e.entries())r+="  ".repeat(i),r+=o.name+" = "+JSON.stringify(o.nodeValue)+`
`;return r}const ky=(e,r=0,i={})=>{w(tr(e,"node"));let o=i.name??"node",a=s$(e,o),n=`${"  ".repeat(r)} + name: ${a.name} value: ${JSON.stringify(a.nodeValue)}`,s=[...vn(e,i)];return s.length>0?n+`
`+s.map(l=>ky(l.nodeValue,r+1,{...i,name:l.name})).join(`
`):n};function*vn(e,r={}){w(tr(e,"node"));let i=r.filter??"none",o=a=>i==="none"?[!0,at(a)]:i==="leaves"&&at(a)?[!0,!0]:i==="branches"&&!at(a)?[!0,!1]:[!1,at(a)];if(Array.isArray(e))for(let[a,n]of e.entries()){let s=o(n);s[0]&&(yield{name:a.toString(),sourceValue:n,nodeValue:s[1]?n:void 0})}else if(typeof e=="object"){let a="entries"in e?e.entries():Object.entries(e);for(let[n,s]of a){let l=o(s);l[0]&&(yield{name:n,sourceValue:s,nodeValue:l[1]?s:void 0})}}}function*Tu(e,r={},i=[]){for(let o of vn(e,r))yield{...o,ancestors:[...i]},yield*Tu(o.sourceValue,r,[...i,o.name])}function a$(e,r){for(let i of vn(r))if(i.name===e)return i}function n$(e,r,i={}){let o=[...Ny(e,r,i)];if(o.length===0)throw Error(`Could not trace path: ${e} `);return o.at(-1)}function*Ny(e,r,i={}){w(tr(e,"path"),tr(r,"node"));let o=i.separator??".",a=e.split(o),n=[];for(let s of a){let l=a$(s,r);if(!l){yield{name:s,sourceValue:void 0,nodeValue:void 0,ancestors:n};return}r=l.sourceValue,yield{...l,ancestors:[...n]},n.push(s)}}function s$(e,r=""){return"name"in e&&"nodeValue"in e&&"sourceValue"in e?e:"name"in e?{name:e.name,nodeValue:e,sourceValue:e}:{name:r,nodeValue:e,sourceValue:e}}function l$(...e){return Object.assign({},...e)}const u$=(e,r="throw")=>{let i={};for(let o of Object.entries(e)){let a=Number.parseInt(o[0]);if(Number.isNaN(a))switch(r){case"throw":throw TypeError(`Cannot convert key '${o[0]}' to an integer`);case"ignore":continue;case"keep":i[o[0]]=o[1];continue;default:throw Error("Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.")}i[a]=o[1]}return i};var c$={};C(c$,{changedObjectDataFields:()=>i$,cloneFromFields:()=>Sy,compareArrays:()=>io,compareObjectData:()=>bn,compareObjectKeys:()=>$y,getRecordEntryByPath:()=>n$,keysToNumbers:()=>u$,mapObjectByObject:()=>Fy,mapObjectKeys:()=>qs,mapObjectShallow:()=>_s,mergeObjects:()=>l$,prettyPrintEntries:()=>o$,recordChildren:()=>vn,recordEntriesDepthFirst:()=>Tu,recordEntryPrettyPrint:()=>ky,traceRecordEntryByPath:()=>Ny});var f$={};C(f$,{applyChanges:()=>d$,compareData:()=>lo,getField:()=>Py,getPaths:()=>h$,getPathsAndData:()=>Us,updateByPath:()=>Ou});const ld=(e,r)=>{if(e===void 0)throw Error("Param 'target' is undefined");if(e===null)throw Error("Param 'target' is null");if(typeof e!="object")throw Error(`Param 'target' is not an object (got: ${typeof e})`);if(r){let i=[];for(let o in e){let a=e[o];on(a)&&i.push([o,a])}return i}else return Object.entries(e)};function*lo(e,r,i={}){if(e===void 0){yield{path:i.pathPrefix??"",value:r,state:"added"};return}if(r===void 0){yield{path:i.pathPrefix??"",previous:e,value:void 0,state:"removed"};return}let o=i.asPartial??!1,a=i.skipInstances??new WeakSet,n=i.undefinedValueMeansRemoved??!1,s=i.pathPrefix??"",l=i.deepEntries??!1,u=i.eq??Vd,c=i.includeMissingFromA??!1,f=i.includeParents??!1;if(at(e)&&at(r)){e!==r&&(yield{path:s,value:r,previous:e,state:"change"});return}if(at(r)){yield{path:s,value:r,previous:e,state:"change"};return}let d=ld(e,l),h=new Set;for(let[p,y]of d){h.add(p);let g=p in r,m=r[p];if(typeof y=="object"&&y){if(a.has(y))continue;if(a.add(y),g){if(m===void 0)throw Error(`Pathed.compareData Value for key ${p} is undefined`);{let v=[...lo(y,m,{...i,skipInstances:a,pathPrefix:s+p+"."})];if(v.length>0){for(let D of v)yield D;f&&(yield{path:s+p,value:r[p],previous:y,state:"change"})}}}else{if(o)continue;yield{path:s+p,value:void 0,previous:y,state:"removed"}}}else{let v=s+p;if(g)m===void 0&&n?yield{path:v,previous:y,value:void 0,state:"removed"}:u(y,m,v)||(yield{path:v,previous:y,value:m,state:"change"});else{if(o)continue;yield{path:v,previous:y,value:void 0,state:"removed"}}}}if(c){let p=ld(r,l);for(let[y,g]of p)h.has(y)||(yield{path:s+y,previous:void 0,value:g,state:"added"})}}const d$=(e,r)=>{for(let i of r)e=Ou(e,i.path,i.value);return e},Ou=(e,r,i,o=!1)=>{if(r===void 0)throw Error("Parameter 'path' is undefined");if(typeof r!="string")throw Error(`Parameter 'path' should be a string. Got: ${typeof r}`);if(e===void 0)throw Error("Parameter 'target' is undefined");if(e===null)throw Error("Parameter 'target' is null");let a=r.split(".");return Ws(e,a,i,o)},Ws=(e,r,i,o)=>{if(r.length===0){if(o)return i;if(Array.isArray(e)&&!Array.isArray(i))throw Error(`Expected array value, got: '${JSON.stringify(i)}'. Set allowShapeChange=true to ignore.`);if(!Array.isArray(e)&&Array.isArray(i))throw Error(`Unexpected array value, got: '${JSON.stringify(i)}'. Set allowShapeChange=true to ignore.`);if(typeof e!=typeof i)throw Error(`Cannot reassign object type. (${typeof e} -> ${typeof i}). Set allowShapeChange=true to ignore.`);if(typeof e=="object"&&!Array.isArray(e)){let s=$y(e,i);if(s.a.length>0)throw Error(`New value is missing key(s): ${s.a.join(",")}`);if(s.b.length>0)throw Error(`New value cannot add new key(s): ${s.b.join(",")}`)}return i}let a=r.shift();if(!a)return i;if(By(a)&&Array.isArray(e)){let s=Number.parseInt(a);if(s>=e.length&&!o)throw Error(`Array index ${s.toString()} is outside of the existing length of ${e.length.toString()}. Use allowShapeChange=true to permit this.`);let l=[...e];return l[s]=Ws(l[s],r,i,o),l}else if(a in e){let s={...e};return s[a]=Ws(s[a],r,i,o),s}else throw Error(`Path ${a} not found in data`)},Py=(e,r,i=".")=>{if(typeof r!="string")throw Error(`Param 'path' ought to be a string. Got: '${typeof r}'`);if(r.length===0)throw Error("Param string 'path' is empty");if(e===void 0)throw Error("Param 'object' is undefined");if(e===null)throw Error("Param 'object' is null");let o=r.split(i);return Gs(e,o,r)},Gs=(e,r,i)=>{if(e===void 0)return{success:!1,error:`Param 'object' is undefined. Position: ${i}`};if(r.length===0)return{success:!1,error:`Path has been exhausted. position: ${i}`};let o=r.shift();if(!o)return{success:!1,error:`Unexpected empty split path. Position: ${i}`};if(By(o)&&Array.isArray(e)){let n=Number.parseInt(o);return e[n]===void 0?{success:!1,error:`Index '${n}' does not exist. Length: ${e.length}. Position: ${i}`}:r.length===0?{value:e[n],success:!0}:Gs(e[n],r,r.join("."))}else return typeof e=="object"&&o in e?r.length===0?{value:e[o],success:!0}:Gs(e[o],r,r.join(".")):{success:!1,error:`Path '${o}' not found. Position: ${i}`}};function*h$(e,r=!1){if(e==null)return;let i=Tu(e);for(let o of i){if(o.nodeValue===void 0&&r)continue;let a=o.name;o.ancestors.length>0&&(a=o.ancestors.join(".")+"."+a),yield a}}function*Us(e,r=!1,i=2**53-1,o=""){e!=null&&(yield*My(e,o,r,i))}function*My(e,r,i=!1,o){if(!(o<=0)&&typeof e=="object")for(let a of Object.entries(e)){let n=(r.length>0?r+".":"")+a[0],s=a[1];(i&&typeof s!="object"||!i)&&(yield{path:n,value:s}),yield*My(s,n,i,o-1)}}const By=e=>{if(e===void 0)return!1;if(typeof e=="string"){let r=Number.parseInt(e);return Number.isNaN(r)?!1:r.toString()===e.toString()}return typeof e=="number"?Number.isNaN(e)||!Number.isFinite(e)?!1:Math.round(e)===e:!1},ha=(e,r=!1)=>i=>{let o=i.toSorted((a,n)=>No(a[e],n[e]));return r?o.reverse():o},p$=e=>{switch(e){case"value":return ha(1,!1);case"value-reverse":return ha(1,!0);case"key":return ha(0,!1);case"key-reverse":return ha(0,!0);default:throw Error(`Unknown sorting value '${e}'. Expecting: value, value-reverse, key or key-reverse`)}},y$=()=>{let e=new Set;return r=>{if(r===null)throw TypeError("Param 'value' cannot be null");if(r===void 0)throw TypeError("Param 'value' cannot be undefined");return e.has(r)?!1:(e.add(r),!0)}},U=e=>{let r=ju(e);if(r.success)return r.value;throw Hr(r)},ju=e=>{if(typeof e=="string"){let i=document.querySelector(e);if(i===null)return{success:!1,error:e.startsWith("#")?`Query '${e}' did not match anything. Try '#id', 'div', or '.class'`:`Query '${e}' did not match anything. Did you mean '#${e}?`};e=i}else{if(e===null)return{success:!1,error:"Param 'domQueryOrEl' is null"};if(e===void 0)return{success:!1,error:"Param 'domQueryOrEl' is undefined"}}return{success:!0,value:e}},Zr=e=>e==null?[]:Array.isArray(e)?e:typeof e=="string"?[...document.querySelectorAll(e)]:[e];var zy=gx((e,r)=>{(function(i,o){typeof e=="object"&&r!==void 0?r.exports=o():typeof define=="function"&&define.amd?define(o):i.JSON5=o()})(e,function(){function i(b,A){return A={exports:{}},b(A,A.exports),A.exports}var o=i(function(b){var A=b.exports=typeof window<"u"&&window.Math==Math?window:typeof self<"u"&&self.Math==Math?self:Function("return this")();typeof __g=="number"&&(__g=A)}),a=i(function(b){var A=b.exports={version:"2.6.5"};typeof __e=="number"&&(__e=A)});a.version;var n=function(b){return typeof b=="object"?b!==null:typeof b=="function"},s=function(b){if(!n(b))throw TypeError(b+" is not an object!");return b},l=function(b){try{return!!b()}catch{return!0}},u=!l(function(){return Object.defineProperty({},"a",{get:function(){return 7}}).a!=7}),c=o.document,f=n(c)&&n(c.createElement),d=function(b){return f?c.createElement(b):{}},h=!u&&!l(function(){return Object.defineProperty(d("div"),"a",{get:function(){return 7}}).a!=7}),p=function(b,A){if(!n(b))return b;var M,L;if(typeof(M=b.toString)=="function"&&!n(L=M.call(b))||typeof(M=b.valueOf)=="function"&&!n(L=M.call(b)))return L;throw TypeError("Can't convert object to primitive value")},y=Object.defineProperty,g=u?Object.defineProperty:function(b,A,M){if(s(b),A=p(A),s(M),h)try{return y(b,A,M)}catch{}if("get"in M||"set"in M)throw TypeError("Accessors not supported!");return"value"in M&&(b[A]=M.value),b},m={f:g},v=function(b,A){return{enumerable:!1,configurable:!0,writable:!0,value:A}},D=u?function(b,A,M){return m.f(b,A,v(1,M))}:function(b,A,M){return b[A]=M,b},B={}.hasOwnProperty,V=function(b,A){return B.call(b,A)},x=0,F=Math.random(),N=function(b){return`Symbol(${b})_${(++x+F).toString(36)}`},P=i(function(b){var A="__core-js_shared__",M=o[A]||(o[A]={});(b.exports=function(L,T){return M[L]||(M[L]=T===void 0?{}:T)})("versions",[]).push({version:a.version,mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),k=P("native-function-to-string",Function.toString),te=i(function(b){var A=N("src"),M="toString",L=(""+k).split(M);a.inspectSource=function(T){return k.call(T)},(b.exports=function(T,K,oe,xe){var Ke=typeof oe=="function";Ke&&(V(oe,"name")||D(oe,"name",K)),T[K]!==oe&&(Ke&&(V(oe,A)||D(oe,A,T[K]?""+T[K]:L.join(String(K)))),T===o?T[K]=oe:xe?T[K]?T[K]=oe:D(T,K,oe):(delete T[K],D(T,K,oe)))})(Function.prototype,M,function(){return typeof this=="function"&&this[A]||k.call(this)})}),le=function(b){if(typeof b!="function")throw TypeError(b+" is not a function!");return b},ve=function(b,A,M){if(le(b),A===void 0)return b;switch(M){case 1:return function(L){return b.call(A,L)};case 2:return function(L,T){return b.call(A,L,T)};case 3:return function(L,T,K){return b.call(A,L,T,K)}}return function(){return b.apply(A,arguments)}},He="prototype",J=function(b,A,M){var L=b&J.F,T=b&J.G,K=b&J.S,oe=b&J.P,xe=b&J.B,Ke=T?o:K?o[A]||(o[A]={}):(o[A]||{})[He],ur=T?a:a[A]||(a[A]={}),Ui=ur[He]||(ur[He]={}),_e,_t,et,kr;for(_e in T&&(M=A),M)_t=!L&&Ke&&Ke[_e]!==void 0,et=(_t?Ke:M)[_e],kr=xe&&_t?ve(et,o):oe&&typeof et=="function"?ve(Function.call,et):et,Ke&&te(Ke,_e,et,b&J.U),ur[_e]!=et&&D(ur,_e,kr),oe&&Ui[_e]!=et&&(Ui[_e]=et)};o.core=a,J.F=1,J.G=2,J.S=4,J.P=8,J.B=16,J.W=32,J.U=64,J.R=128;var Oe=J,sr=Math.ceil,qi=Math.floor,_i=function(b){return isNaN(b=+b)?0:(b>0?qi:sr)(b)},ns=function(b){if(b==null)throw TypeError("Can't call method on  "+b);return b},la=function(b){return function(A,M){var L=String(ns(A)),T=_i(M),K=L.length,oe,xe;return T<0||T>=K?void 0:(oe=L.charCodeAt(T),oe<55296||oe>56319||T+1===K||(xe=L.charCodeAt(T+1))<56320||xe>57343?oe:(oe-55296<<10)+(xe-56320)+65536)}},ss=la();Oe(Oe.P,"String",{codePointAt:function(b){return ss(this,b)}}),a.String.codePointAt;var ls=Math.max,Uw=Math.min,Jw=function(b,A){return b=_i(b),b<0?ls(b+A,0):Uw(b,A)},Kf=String.fromCharCode,Qf=String.fromCodePoint;Oe(Oe.S+Oe.F*(!!Qf&&Qf.length!=1),"String",{fromCodePoint:function(b){for(var A=arguments,M=[],L=arguments.length,T=0,K;L>T;){if(K=+A[T++],Jw(K,1114111)!==K)throw RangeError(K+" is not a valid code point");M.push(K<65536?Kf(K):Kf(((K-=65536)>>10)+55296,K%1024+56320))}return M.join("")}}),a.String.fromCodePoint;var Hw=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,Kw=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Qw=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,us={Space_Separator:Hw,ID_Start:Kw,ID_Continue:Qw},me={isSpaceSeparator:function(b){return typeof b=="string"&&us.Space_Separator.test(b)},isIdStartChar:function(b){return typeof b=="string"&&(b>="a"&&b<="z"||b>="A"&&b<="Z"||b==="$"||b==="_"||us.ID_Start.test(b))},isIdContinueChar:function(b){return typeof b=="string"&&(b>="a"&&b<="z"||b>="A"&&b<="Z"||b>="0"&&b<="9"||b==="$"||b==="_"||b==="‌"||b==="‍"||us.ID_Continue.test(b))},isDigit:function(b){return typeof b=="string"&&/[0-9]/.test(b)},isHexDigit:function(b){return typeof b=="string"&&/[0-9A-Fa-f]/.test(b)}},cs,At,Lt,ua,lr,gt,Ae,fs,Wi,Zw=function(b,A){cs=String(b),At="start",Lt=[],ua=0,lr=1,gt=0,Ae=void 0,fs=void 0,Wi=void 0;do Ae=Xw(),tx[At]();while(Ae.type!=="eof");return typeof A=="function"?ds({"":Wi},"",A):Wi};function ds(b,A,M){var L=b[A];if(typeof L=="object"&&L)if(Array.isArray(L))for(var T=0;T<L.length;T++){var K=String(T),oe=ds(L,K,M);oe===void 0?delete L[K]:Object.defineProperty(L,K,{value:oe,writable:!0,enumerable:!0,configurable:!0})}else for(var xe in L){var Ke=ds(L,xe,M);Ke===void 0?delete L[xe]:Object.defineProperty(L,xe,{value:Ke,writable:!0,enumerable:!0,configurable:!0})}return M.call(b,A,L)}var W,I,Gi,It,H;function Xw(){for(W="default",I="",Gi=!1,It=1;;){H=qt();var b=Zf[W]();if(b)return b}}function qt(){if(cs[ua])return String.fromCodePoint(cs.codePointAt(ua))}function E(){var b=qt();return b===`
`?(lr++,gt=0):b?gt+=b.length:gt++,b&&(ua+=b.length),b}var Zf={default:function(){switch(H){case"	":case"\v":case"\f":case" ":case" ":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":E();return;case"/":E(),W="comment";return;case void 0:return E(),ne("eof")}if(me.isSpaceSeparator(H)){E();return}return Zf[At]()},comment:function(){switch(H){case"*":E(),W="multiLineComment";return;case"/":E(),W="singleLineComment";return}throw ue(E())},multiLineComment:function(){switch(H){case"*":E(),W="multiLineCommentAsterisk";return;case void 0:throw ue(E())}E()},multiLineCommentAsterisk:function(){switch(H){case"*":E();return;case"/":E(),W="default";return;case void 0:throw ue(E())}E(),W="multiLineComment"},singleLineComment:function(){switch(H){case`
`:case"\r":case"\u2028":case"\u2029":E(),W="default";return;case void 0:return E(),ne("eof")}E()},value:function(){switch(H){case"{":case"[":return ne("punctuator",E());case"n":return E(),Sr("ull"),ne("null",null);case"t":return E(),Sr("rue"),ne("boolean",!0);case"f":return E(),Sr("alse"),ne("boolean",!1);case"-":case"+":E()==="-"&&(It=-1),W="sign";return;case".":I=E(),W="decimalPointLeading";return;case"0":I=E(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":I=E(),W="decimalInteger";return;case"I":return E(),Sr("nfinity"),ne("numeric",1/0);case"N":return E(),Sr("aN"),ne("numeric",NaN);case'"':case"'":Gi=E()==='"',I="",W="string";return}throw ue(E())},identifierNameStartEscape:function(){if(H!=="u")throw ue(E());E();var b=hs();switch(b){case"$":case"_":break;default:if(!me.isIdStartChar(b))throw Xf();break}I+=b,W="identifierName"},identifierName:function(){switch(H){case"$":case"_":case"‌":case"‍":I+=E();return;case"\\":E(),W="identifierNameEscape";return}if(me.isIdContinueChar(H)){I+=E();return}return ne("identifier",I)},identifierNameEscape:function(){if(H!=="u")throw ue(E());E();var b=hs();switch(b){case"$":case"_":case"‌":case"‍":break;default:if(!me.isIdContinueChar(b))throw Xf();break}I+=b,W="identifierName"},sign:function(){switch(H){case".":I=E(),W="decimalPointLeading";return;case"0":I=E(),W="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":I=E(),W="decimalInteger";return;case"I":return E(),Sr("nfinity"),ne("numeric",It*(1/0));case"N":return E(),Sr("aN"),ne("numeric",NaN)}throw ue(E())},zero:function(){switch(H){case".":I+=E(),W="decimalPoint";return;case"e":case"E":I+=E(),W="decimalExponent";return;case"x":case"X":I+=E(),W="hexadecimal";return}return ne("numeric",It*0)},decimalInteger:function(){switch(H){case".":I+=E(),W="decimalPoint";return;case"e":case"E":I+=E(),W="decimalExponent";return}if(me.isDigit(H)){I+=E();return}return ne("numeric",It*Number(I))},decimalPointLeading:function(){if(me.isDigit(H)){I+=E(),W="decimalFraction";return}throw ue(E())},decimalPoint:function(){switch(H){case"e":case"E":I+=E(),W="decimalExponent";return}if(me.isDigit(H)){I+=E(),W="decimalFraction";return}return ne("numeric",It*Number(I))},decimalFraction:function(){switch(H){case"e":case"E":I+=E(),W="decimalExponent";return}if(me.isDigit(H)){I+=E();return}return ne("numeric",It*Number(I))},decimalExponent:function(){switch(H){case"+":case"-":I+=E(),W="decimalExponentSign";return}if(me.isDigit(H)){I+=E(),W="decimalExponentInteger";return}throw ue(E())},decimalExponentSign:function(){if(me.isDigit(H)){I+=E(),W="decimalExponentInteger";return}throw ue(E())},decimalExponentInteger:function(){if(me.isDigit(H)){I+=E();return}return ne("numeric",It*Number(I))},hexadecimal:function(){if(me.isHexDigit(H)){I+=E(),W="hexadecimalInteger";return}throw ue(E())},hexadecimalInteger:function(){if(me.isHexDigit(H)){I+=E();return}return ne("numeric",It*Number(I))},string:function(){switch(H){case"\\":E(),I+=Yw();return;case'"':if(Gi)return E(),ne("string",I);I+=E();return;case"'":if(!Gi)return E(),ne("string",I);I+=E();return;case`
`:case"\r":throw ue(E());case"\u2028":case"\u2029":rx(H);break;case void 0:throw ue(E())}I+=E()},start:function(){switch(H){case"{":case"[":return ne("punctuator",E())}W="value"},beforePropertyName:function(){switch(H){case"$":case"_":I=E(),W="identifierName";return;case"\\":E(),W="identifierNameStartEscape";return;case"}":return ne("punctuator",E());case'"':case"'":Gi=E()==='"',W="string";return}if(me.isIdStartChar(H)){I+=E(),W="identifierName";return}throw ue(E())},afterPropertyName:function(){if(H===":")return ne("punctuator",E());throw ue(E())},beforePropertyValue:function(){W="value"},afterPropertyValue:function(){switch(H){case",":case"}":return ne("punctuator",E())}throw ue(E())},beforeArrayValue:function(){if(H==="]")return ne("punctuator",E());W="value"},afterArrayValue:function(){switch(H){case",":case"]":return ne("punctuator",E())}throw ue(E())},end:function(){throw ue(E())}};function ne(b,A){return{type:b,value:A,line:lr,column:gt}}function Sr(b){for(var A=0,M=b;A<M.length;A+=1){var L=M[A],T=qt();if(T!==L)throw ue(E());E()}}function Yw(){var b=qt();switch(b){case"b":return E(),"\b";case"f":return E(),"\f";case"n":return E(),`
`;case"r":return E(),"\r";case"t":return E(),"	";case"v":return E(),"\v";case"0":if(E(),me.isDigit(qt()))throw ue(E());return"\0";case"x":return E(),ex();case"u":return E(),hs();case`
`:case"\u2028":case"\u2029":return E(),"";case"\r":return E(),qt()===`
`&&E(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw ue(E());case void 0:throw ue(E())}return E()}function ex(){var b="",A=qt();if(!me.isHexDigit(A)||(b+=E(),A=qt(),!me.isHexDigit(A)))throw ue(E());return b+=E(),String.fromCodePoint(parseInt(b,16))}function hs(){for(var b="",A=4;A-- >0;){var M=qt();if(!me.isHexDigit(M))throw ue(E());b+=E()}return String.fromCodePoint(parseInt(b,16))}var tx={start:function(){if(Ae.type==="eof")throw Fr();ps()},beforePropertyName:function(){switch(Ae.type){case"identifier":case"string":fs=Ae.value,At="afterPropertyName";return;case"punctuator":ca();return;case"eof":throw Fr()}},afterPropertyName:function(){if(Ae.type==="eof")throw Fr();At="beforePropertyValue"},beforePropertyValue:function(){if(Ae.type==="eof")throw Fr();ps()},beforeArrayValue:function(){if(Ae.type==="eof")throw Fr();if(Ae.type==="punctuator"&&Ae.value==="]"){ca();return}ps()},afterPropertyValue:function(){if(Ae.type==="eof")throw Fr();switch(Ae.value){case",":At="beforePropertyName";return;case"}":ca()}},afterArrayValue:function(){if(Ae.type==="eof")throw Fr();switch(Ae.value){case",":At="beforeArrayValue";return;case"]":ca()}},end:function(){}};function ps(){var b;switch(Ae.type){case"punctuator":switch(Ae.value){case"{":b={};break;case"[":b=[];break}break;case"null":case"boolean":case"numeric":case"string":b=Ae.value;break}if(Wi===void 0)Wi=b;else{var A=Lt[Lt.length-1];Array.isArray(A)?A.push(b):Object.defineProperty(A,fs,{value:b,writable:!0,enumerable:!0,configurable:!0})}if(typeof b=="object"&&b)Lt.push(b),At=Array.isArray(b)?"beforeArrayValue":"beforePropertyName";else{var M=Lt[Lt.length-1];At=M==null?"end":Array.isArray(M)?"afterArrayValue":"afterPropertyValue"}}function ca(){Lt.pop();var b=Lt[Lt.length-1];At=b==null?"end":Array.isArray(b)?"afterArrayValue":"afterPropertyValue"}function ue(b){return ys(b===void 0?"JSON5: invalid end of input at "+lr+":"+gt:"JSON5: invalid character '"+Yf(b)+"' at "+lr+":"+gt)}function Fr(){return ys("JSON5: invalid end of input at "+lr+":"+gt)}function Xf(){return gt-=5,ys("JSON5: invalid identifier character at "+lr+":"+gt)}function rx(b){console.warn("JSON5: '"+Yf(b)+"' in strings is not valid ECMAScript; consider escaping")}function Yf(b){var A={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(A[b])return A[b];if(b<" "){var M=b.charCodeAt(0).toString(16);return"\\x"+("00"+M).substring(M.length)}return b}function ys(b){var A=SyntaxError(b);return A.lineNumber=lr,A.columnNumber=gt,A}var ix=function(b,A,M){var L=[],T="",K,oe,xe="",Ke;if(typeof A=="object"&&A&&!Array.isArray(A)&&(M=A.space,Ke=A.quote,A=A.replacer),typeof A=="function")oe=A;else if(Array.isArray(A)){K=[];for(var ur=0,Ui=A;ur<Ui.length;ur+=1){var _e=Ui[ur],_t=void 0;typeof _e=="string"?_t=_e:(typeof _e=="number"||_e instanceof String||_e instanceof Number)&&(_t=String(_e)),_t!==void 0&&K.indexOf(_t)<0&&K.push(_t)}}return M instanceof Number?M=Number(M):M instanceof String&&(M=String(M)),typeof M=="number"?M>0&&(M=Math.min(10,Math.floor(M)),xe="          ".substr(0,M)):typeof M=="string"&&(xe=M.substr(0,10)),et("",{"":b});function et(re,je){var q=je[re];switch(q!=null&&(typeof q.toJSON5=="function"?q=q.toJSON5(re):typeof q.toJSON=="function"&&(q=q.toJSON(re))),oe&&(q=oe.call(je,re,q)),q instanceof Number?q=Number(q):q instanceof String?q=String(q):q instanceof Boolean&&(q=q.valueOf()),q){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof q=="string")return kr(q);if(typeof q=="number")return String(q);if(typeof q=="object")return Array.isArray(q)?ux(q):sx(q)}function kr(re){for(var je={"'":.1,'"':.2},q={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"},Ne="",mt=0;mt<re.length;mt++){var Re=re[mt];switch(Re){case"'":case'"':je[Re]++,Ne+=Re;continue;case"\0":if(me.isDigit(re[mt+1])){Ne+="\\x00";continue}}if(q[Re]){Ne+=q[Re];continue}if(Re<" "){var Nr=Re.charCodeAt(0).toString(16);Ne+="\\x"+("00"+Nr).substring(Nr.length);continue}Ne+=Re}var Wt=Ke||Object.keys(je).reduce(function(cr,Pr){return je[cr]<je[Pr]?cr:Pr});return Ne=Ne.replace(new RegExp(Wt,"g"),q[Wt]),Wt+Ne+Wt}function sx(re){if(L.indexOf(re)>=0)throw TypeError("Converting circular structure to JSON5");L.push(re);var je=T;T+=xe;for(var q=K||Object.keys(re),Ne=[],mt=0,Re=q;mt<Re.length;mt+=1){var Nr=Re[mt],Wt=et(Nr,re);if(Wt!==void 0){var cr=lx(Nr)+":";xe!==""&&(cr+=" "),cr+=Wt,Ne.push(cr)}}var Pr;if(Ne.length===0)Pr="{}";else{var fa;if(xe==="")fa=Ne.join(","),Pr="{"+fa+"}";else{var cx=`,
`+T;fa=Ne.join(cx),Pr=`{
`+T+fa+`,
`+je+"}"}}return L.pop(),T=je,Pr}function lx(re){if(re.length===0)return kr(re);var je=String.fromCodePoint(re.codePointAt(0));if(!me.isIdStartChar(je))return kr(re);for(var q=je.length;q<re.length;q++)if(!me.isIdContinueChar(String.fromCodePoint(re.codePointAt(q))))return kr(re);return re}function ux(re){if(L.indexOf(re)>=0)throw TypeError("Converting circular structure to JSON5");L.push(re);var je=T;T+=xe;for(var q=[],Ne=0;Ne<re.length;Ne++){var mt=et(String(Ne),re);q.push(mt===void 0?"null":mt)}var Re;if(q.length===0)Re="[]";else if(xe===""){var Nr=q.join(",");Re="["+Nr+"]"}else{var Wt=`,
`+T,cr=q.join(Wt);Re=`[
`+T+cr+`,
`+je+"]"}return L.pop(),T=je,Re}},ox={parse:Zw,stringify:ix},ax=ox,nx=ax;return nx})}),Ty={};C(Ty,{fromList:()=>b$,fromObject:()=>Vy});var Oy=Ed(zy());const g$=(e,r)=>r.leftPadding&&e.length<r.leftPadding?"&nbsp;".repeat(r.leftPadding-e.length)+e:e,jy=(e,r)=>{e=r.roundNumbers===void 0?e:di(r.roundNumbers,e);let i=r.precision===void 0?e.toString():e.toFixed(r.precision);return i=g$(i.toString(),r),i},m$=(e,r)=>e===null?"(null)":e===void 0?"(undefined)":typeof e=="boolean"?e?"true":"false":typeof e=="string"?`"${e}"`:typeof e=="number"?jy(e,r.numbers):typeof e=="object"?Ry(e,r):Oy.default.stringify(e),Ry=(e,r)=>{let i='<div style="display:grid; grid-template-columns: repeat(2, 1fr)">';for(let o of Object.entries(e)){let a=m$(o[1],r);i+=`<div class="label" style="display:table-cell">${o[0]}</div>
      <div class="data" style="display:table-cell">${a}</div>`}return i+="</div>",i},b$=(e,r)=>{let i=U(e),o=document.createElement("DIV");i.append(o);let a={numbers:{},objectsAsTables:!0},n=()=>o?(o.remove(),o=void 0,!0):!1,s=l=>{let u=new Set;for(let[f,d]of l){let h=`table-${f}`;u.add(h);let p=i.querySelector(`#${h}`);if(p===null){if(p=document.createElement("table"),!p)throw Error("Could not create table element");p.id=h,i.append(p)}Js(p,d,a)}let c=Array.from(i.querySelectorAll("table"));for(let f of c)u.has(f.id)||f.remove()};return r&&s(r),{update:s,remove:n}},Js=(e,r,i)=>{let o=i.numbers??{},a=i.idPrefix??"",n=i.objectsAsTables??!1;if(r===void 0){e.innerHTML="";return}let s=new Set;for(let[u,c]of Object.entries(r)){let f=`${a}-row-${u}`;s.add(f);let d=e.querySelector(`tr[data-key='${f}']`);if(d===null){d=document.createElement("tr"),e.append(d),d.setAttribute("data-key",f);let y=document.createElement("td");y.textContent=u,y.classList.add("label"),d.append(y)}let h=d.querySelector(`td[data-key='${f}-val']`);h===null&&(h=document.createElement("td"),h.classList.add("data"),h.setAttribute("data-key",`${f}-val`),d.append(h));let p;i.formatter&&(p=i.formatter(c,u)),p===void 0&&(p=typeof c=="object"?n?Ry(c,i):Oy.default.stringify(c):typeof c=="number"?jy(c,o):typeof c=="boolean"?c?"true":"false":typeof c=="string"?`"${c}"`:JSON.stringify(c)),h.innerHTML=p}let l=Array.from(e.querySelectorAll("tr"));for(let u of l){let c=u.getAttribute("data-key");s.has(c)||u.remove()}},Vy=(e,r,i={})=>{let o=U(e),a=i.idPrefix??Math.floor(Math.random()*1e3).toString(),n={numbers:{},objectsAsTables:!0,idPrefix:"",...i},s=document.createElement("table");o.append(s);let l=()=>s?(s.remove(),s=void 0,!0):!1;return r&&Js(s,r,n),{remove:l,update:c=>{if(!s)throw Error("Table disposed");Js(s,c,{...n,idPrefix:a})}}},v$=e=>Q(e)&&e.z!==null?!1:e.x===null&&e.y===null,w$=e=>Q(e)&&!Number.isNaN(e.z)?!1:Number.isNaN(e.x)||Number.isNaN(e.y);function O(e,r="Point"){if(e===void 0)throw Error(`'${r}' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e===null)throw Error(`'${r}' is null. Expected {x,y} got ${JSON.stringify(e)}`);if(e.x===void 0)throw Error(`'${r}.x' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(e.y===void 0)throw Error(`'${r}.y' is undefined. Expected {x,y} got ${JSON.stringify(e)}`);if(typeof e.x!="number")throw TypeError(`'${r}.x' must be a number. Got ${typeof e.x}`);if(typeof e.y!="number")throw TypeError(`'${r}.y' must be a number. Got ${typeof e.y}`);if(e.z!==void 0){if(typeof e.z!="number")throw TypeError(`${r}.z must be a number. Got: ${typeof e.z}`);if(Number.isNaN(e.z))throw Error(`'${r}.z' is NaN. Got: ${JSON.stringify(e)}`)}if(e.x===null)throw Error(`'${r}.x' is null`);if(e.y===null)throw Error(`'${r}.y' is null`);if(Number.isNaN(e.x))throw Error(`'${r}.x' is NaN`);if(Number.isNaN(e.y))throw Error(`'${r}.y' is NaN`)}const Ly=(e,r="pt")=>(O(e,r),w($(e.x,"nonZero",`${r}.x`),$(e.y,"nonZero",`${r}.y`),()=>{if(e.z!==void 0)return $(e.z,"nonZero",`${r}.z`)}),!0);function R(e){return!(e==null||e.x===void 0||e.y===void 0)}const Q=e=>!(e==null||e.x===void 0||e.y===void 0||e.z===void 0),ci=e=>Q(e)&&e.z!==0?!1:e.x===0&&e.y===0,Rr=e=>Q(e)&&!Number.isNaN(e.z)?!1:Number.isNaN(e.x)&&Number.isNaN(e.y),qr=(e,r="Dimension")=>{if(e===void 0)throw Error(`${r} is undefined`);if(Number.isNaN(e))throw Error(`${r} is NaN`);if(e<0)throw Error(`${r} cannot be negative`)},ht=(e,r="rect")=>{if(e===void 0)throw Error("{$name} undefined");Fe(e)&&O(e,r),qr(e.width,r+".width"),qr(e.height,r+".height")},Ru=(e,r)=>{if(ht(e),Fe(e)&&r===void 0)return e;if(r===void 0)throw Error("Unpositioned rect needs origin parameter");return Object.freeze({...e,...r})},Vu=(e,r="rect")=>{if(!Fe(e))throw Error(`Expected ${r} to have x,y`);ht(e,r)},x$=e=>e.width===0&&e.height===0,Iy=e=>Number.isNaN(e.width)&&Number.isNaN(e.height),Fe=e=>e.x!==void 0&&e.y!==void 0,nt=e=>!(e===void 0||e.width===void 0||e.height===void 0),xt=e=>nt(e)&&Fe(e),E$=e=>(ht(e),e.height*e.width);function qy(e,r,i){let o=typeof r=="number"?r:r.width,a=typeof r=="number"?i:r.height;if(o===void 0)throw Error("Param 'width' undefined");if(a===void 0)throw Error("Param 'height' undefined");if(o=e(o,"width"),a=e(a,"height"),typeof r=="object")if(Fe(r)){let n=e(r.x,"x"),s=e(r.y,"y");return{...r,width:o,height:a,x:n,y:s}}else return{...r,width:o,height:a};return{width:o,height:a}}function Oo(e,r,i,o){if(ht(r,"a"),nt(i))return xt(r)?Object.freeze({...r,x:e(r.x,i.width),y:e(r.y,i.height),width:e(r.width,i.width),height:e(r.height,i.height)}):Object.freeze({...r,width:e(r.width,i.width),height:e(r.height,i.height)});if(typeof i!="number")throw TypeError(`Expected second parameter of type Rect or number. Got ${JSON.stringify(i)}`);if(typeof o!="number")throw Error(`Expected third param as height. Got ${JSON.stringify(o)}`);return xt(r)?Object.freeze({...r,x:e(r.x,i),y:e(r.y,o),width:e(r.width,i),height:e(r.height,o)}):Object.freeze({...r,width:e(r.width,i),height:e(r.height,o)})}function Lu(e,r,i){return Fe(r)?Object.freeze({...r,x:e(r.x,i),y:e(r.y,i),width:e(r.width,i),height:e(r.height,i)}):Object.freeze({...r,width:e(r.width,i),height:e(r.height,i)})}function Iu(e,r,i){return Object.freeze({...r,width:e(r.width,i),height:e(r.height,i)})}const Ra=(e,r)=>{let{x:i,y:o,width:a,height:n}=e;switch(r){case"nw":return Object.freeze({x:i,y:o});case"n":return Object.freeze({x:i+a/2,y:o});case"ne":return Object.freeze({x:i+a,y:o});case"sw":return Object.freeze({x:i,y:o+n});case"s":return Object.freeze({x:i+a/2,y:o+n});case"se":return Object.freeze({x:i+a,y:o+n});case"w":return Object.freeze({x:i,y:o+n/2});case"e":return Object.freeze({x:i+a,y:o+n/2});case"center":return Object.freeze({x:i+a/2,y:o+n/2});default:throw Error(`Unknown direction: ${r}`)}},wn=(e,r)=>(ht(e),r===void 0&&R(e)?r=e:r===void 0&&(r={x:0,y:0}),Ru(e,r),Object.freeze({x:r.x+e.width/2,y:r.y+e.height/2})),Va=Object.freeze({x:NaN,y:NaN}),D$=Object.freeze({x:NaN,y:NaN,z:NaN}),Vr=(e,r)=>{let i=Ru(e,r);return[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}]},jo=(e,r="circle")=>{if(ye(e)&&O(e,"circle"),Number.isNaN(e.radius))throw Error(`${r}.radius is NaN`);if(e.radius<=0)throw Error(`${r}.radius must be greater than zero`)},La=(e,r="circle")=>{if(!ye(e))throw Error("Expected a positioned circle with x,y");jo(e,r)},C$=e=>!!(Number.isNaN(e.radius)||ye(e)&&(Number.isNaN(e.x)||Number.isNaN(e.y))),_y=e=>e.x!==void 0&&e.y!==void 0,Ai=e=>e.radius!==void 0,ye=e=>Ai(e)&&_y(e),Wy=(e,r)=>e.radius===r.radius?ye(e)&&ye(r)?!(e.x!==r.x||e.y!==r.y||e.z!==r.z):(!ye(e)&&ye(r),!1):!1;function Ro(e,r,i,o,a,n){if(Q(e)&&Q(r)||R(e)&&R(r))return[e,r];if(Q(e)){let u={x:r,y:i,z:o};if(!Q(u))throw Error("Expected x, y & z parameters");return[e,u]}if(R(e)){let u={x:r,y:i};if(!R(u))throw Error("Expected x & y parameters");return[e,u]}if(a!==void 0&&o!==void 0){let u={x:e,y:r,z:i},c={x:o,y:a,z:n};if(!Q(u))throw Error("Expected x,y,z for first point");if(!Q(c))throw Error("Expected x,y,z for second point");return[u,c]}let s={x:e,y:r},l={x:i,y:o};if(!R(s))throw Error("Expected x,y for first point");if(!R(l))throw Error("Expected x,y for second point");return[s,l]}function Be(e,r,i){if(e===void 0)return{x:0,y:0};if(Array.isArray(e)){if(e.length===0)return Object.freeze({x:0,y:0});if(e.length===1)return Object.freeze({x:e[0],y:0});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});throw Error(`Expected array to be 1-3 elements in length. Got ${e.length}.`)}if(R(e))return e;if(typeof e!="number"||typeof r!="number")throw TypeError(`Expected point or x,y as parameters. Got: a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`);return Object.freeze(typeof i=="number"?{x:e,y:r,z:i}:{x:e,y:r})}function Xe(e,r,i,o,a,n){let[s,l]=Ro(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x+l.x,y:s.y+l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)+(l.z??0)),Object.freeze(u)}function $e(e,r,i,o,a,n){let[s,l]=Ro(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x-l.x,y:s.y-l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)-(l.z??0)),Object.freeze(u)}const $$=(e,r)=>{let i={x:r.b.x-r.a.x,y:r.b.y-r.a.y},o={x:r.a.x-e.x,y:r.a.y-e.y},a=(i.x*o.x+i.y*o.y)*-2,n=2*(i.x*i.x+i.y*i.y),s=Math.sqrt(a*a-2*n*(o.x*o.x+o.y*o.y-e.radius*e.radius));if(Number.isNaN(s))return[];let l=(a-s)/n,u=(a+s)/n,c=[];return l<=1&&l>=0&&c.push({x:r.a.x+i.x*l,y:r.a.y+i.y*l}),u<=1&&u>=0&&c.push({x:r.a.x+i.x*u,y:r.a.y+i.y*u}),c},Gy=(e,r)=>{let i=$e(r,e),o=Math.hypot(i.y,i.x);if(o>e.radius+r.radius||o<Math.abs(e.radius-r.radius)||Wy(e,r))return[];let a=(e.radius*e.radius-r.radius*r.radius+o*o)/(2*o),n={x:e.x+i.x*a/o,y:e.y+i.y*a/o},s=Math.sqrt(e.radius*e.radius-a*a),l={x:-i.y*(s/o),y:i.x*(s/o)};return[Xe(n,l),$e(n,l)]},Uy=(e,r)=>{let i=e.x-Math.max(r.x,Math.min(e.x,r.x+r.width)),o=e.y-Math.max(r.y,Math.min(e.y,r.y+r.height));return i*i+o*o<e.radius*e.radius},ud=(e,r)=>Gy(e,r).length===2;function Vo(e,r,i){ht(e,"rect");let o=0,a=0;if(typeof r=="number"){if(i===void 0)throw Error("x and y coordinate needed");o=r,a=i}else o=r.x,a=r.y;if(Fe(e)){if(o-e.x>e.width||o<e.x||a-e.y>e.height||a<e.y)return!1}else if(o>e.width||o<0||a>e.height||a<0)return!1;return!0}const Jy=(e,r)=>{if(!xt(e))throw Error("a parameter should be RectPositioned");if(ye(r))return Uy(r,e);if(R(r))return Vo(e,r);throw Error(`Unknown shape for b: ${JSON.stringify(r)}`)};function X(e,r,i,o){let a=Be(r,i,o);return O(a,"b"),O(e,"a"),Q(a)&&Q(e)?Math.hypot(a.x-e.x,a.y-e.y,a.z-e.z):Math.hypot(a.x-e.x,a.y-e.y)}const qu=(e,r)=>{if(Vu(e,"rect"),O(r,"pt"),Vo(e,r))return 0;let i=Math.max(e.x-r.x,0,r.x-e.x+e.width),o=Math.max(e.y-r.y,0,r.y-e.y+e.height);return Math.hypot(i,o)},A$=(e,r)=>X(wn(e),r),_u=(e,r)=>e/r;function S$(e,r,i){return Oo(_u,e,r,i)}function F$(e,r){return Lu(_u,e,r)}function k$(e,r){return Iu(_u,e,r)}const Lo=(e,r)=>(O(e,"a"),O(r,"b"),e=Object.freeze({...e}),r=Object.freeze({...r}),Object.freeze({a:e,b:r})),Io=(...e)=>{let r=[],i=e[0];for(let o=1;o<e.length;o++)r.push(Lo(i,e[o])),i=e[o];return r},Hy=(e,r)=>{let i=Vr(e,r);return Io(...i,i[0])},Hs=(e,r)=>{switch(ht(e),r){case"top":return R(e)?e.x:0;case"bottom":return R(e)?e.x:0;case"left":return R(e)?e.y:0;case"right":return R(e)?e.x+e.width:e.width}},Ks=(e,r)=>{switch(ht(e),r){case"top":return R(e)?e.y:0;case"bottom":return R(e)?e.y+e.height:e.height;case"left":return R(e)?e.y:0;case"right":return R(e)?e.y:0}},xn=Object.freeze({width:0,height:0}),En=Object.freeze({x:0,y:0,width:0,height:0}),N$=(e,...r)=>{let i=r.map(f=>f.x),o=r.map(f=>f.y),a=Math.min(...i,e.x),n=Math.min(...o,e.y),s=Math.max(...i,e.x+e.width),l=Math.max(...o,e.y+e.height),u=Math.max(e.width,s-a),c=Math.max(e.height,l-n);return Object.freeze({...e,x:a,y:n,width:u,height:c})},Ky=(e,r,i)=>{O(e,"origin"),qr(r,"width"),qr(i,"height");let o=r/2,a=i/2;return{x:e.x-o,y:e.y-a,width:r,height:i}},P$=e=>({width:e.clientWidth,height:e.clientHeight});function M$(e,r,i,o){if(i===void 0||o===void 0){if(typeof e!="number")throw Error("width is not an number");if(typeof r!="number")throw TypeError("height is not an number");return Object.freeze({width:e,height:r})}if(typeof e!="number")throw Error("x is not an number");if(typeof r!="number")throw Error("y is not an number");if(typeof i!="number")throw Error("width is not an number");if(typeof o!="number")throw Error("height is not an number");return Object.freeze({x:e,y:r,width:i,height:o})}const gr=(e,r,i)=>(qr(r,"width"),qr(i,"height"),O(e,"origin"),{x:e.x,y:e.y,width:r,height:i});function B$(e,r,i,o){if(typeof e=="number")if(typeof r=="number"){if(typeof i=="number"&&typeof o=="number")return{x:e,y:r,width:i,height:o};if(nt(i))return{x:e,y:r,width:i.width,height:i.height};throw TypeError("If params 'a' & 'b' are numbers, expect following parameters to be x,y or Rect")}else throw TypeError("If parameter 'a' is a number, expect following parameters to be: y,w,h");else{if(xt(e))return e;if(nt(e)){if(typeof r=="number"&&typeof i=="number")return{width:e.width,height:e.height,x:r,y:i};if(R(r))return{width:e.width,height:e.height,x:r.x,y:r.y};throw TypeError("If param 'a' is a Rect, expects following parameters to be x,y")}else if(R(e)){if(typeof r=="number"&&typeof i=="number")return{x:e.x,y:e.y,width:r,height:i};if(nt(r))return{x:e.x,y:e.y,width:r.width,height:r.height};throw TypeError("If parameter 'a' is a Point, expect following params to be: Rect or width,height")}}throw TypeError("Expect a first parameter to be x,RectPositioned,Rect or Point")}const kt=(...e)=>{if(e===void 0)throw Error("parameter 'p' is undefined");if(e.length<2)return!0;for(let r=1;r<e.length;r++)if(e[r].x!==e[0].x||e[r].y!==e[0].y)return!1;return!0},z$=(e,r)=>{if(e===void 0)throw Error("a undefined");if(r===void 0)throw Error("b undefined");return e.width===r.width&&e.height===r.height},Qy=(e,r)=>Fe(e)&&Fe(r)?kt(e,r)?e.width===r.width&&e.height===r.height:!1:!Fe(e)&&!Fe(r)?e.width===r.width&&e.height===r.height:!1,jt=e=>!(e===void 0||e.a===void 0||e.b===void 0||!R(e.a)||!R(e.b)),Zy=e=>Array.isArray(e)?!e.some(i=>!jt(i)):!1,qo=(e,r="line")=>{if(e===void 0)throw Error(`${r} undefined`);if(e.a===void 0)throw Error(`${r}.a undefined. Expected {a:Point, b:Point}. Got: ${JSON.stringify(e)}`);if(e.b===void 0)throw Error(`${r}.b undefined. Expected {a:Point, b:Point} Got: ${JSON.stringify(e)}`)},Dn=(e,r)=>{let i;if(jt(e))r=e.b,i=e.a;else if(i=e,r===void 0)throw Error(`Since first parameter is not a line, two points are expected. Got a: ${JSON.stringify(i)} b: ${JSON.stringify(r)}`);return O(i,"a"),O(i,"b"),[i,r]};function Le(e,r){if(Zy(e))return e.reduce((l,u)=>Le(u)+l,0);if(e===void 0)throw TypeError("Parameter 'aOrLine' is undefined");let[i,o]=Dn(e,r),a=o.x-i.x,n=o.y-i.y;if(i.z!==void 0&&o.z!==void 0){let s=o.z-i.z;return Math.hypot(a,n,s)}else return Math.hypot(a,n)}const T$=e=>(Vu(e,"rect"),Hy(e).map(r=>Le(r))),Xy=(e,r,i,o)=>{if(e.y>i.y)throw Error("topLeft.y greater than bottomRight.y");if(e.y>o.y)throw Error("topLeft.y greater than bottomLeft.y");let a=r.x-e.x,n=i.x-o.x,s=Math.abs(o.y-e.y),l=Math.abs(i.y-r.y);return{x:Math.min(e.x,o.x),y:Math.min(r.y,e.y),width:Math.max(a,n),height:Math.max(s,l)}},Wu=(e,r)=>e*r;function O$(e,r,i){return Oo(Wu,e,r,i)}function Yy(e,r){return Lu(Wu,e,r)}function j$(e,r){return Iu(Wu,e,r)}const R$=(e,r)=>{let{x:i,y:o}=r;return i<e.x?i=e.x:i>e.x+e.width&&(i=e.x+e.width),o<e.y?o=e.y:o>e.y+e.height&&(o=e.y+e.height),Object.freeze({...r,x:i,y:o})},eg=Object.freeze({width:NaN,height:NaN}),Gu=Object.freeze({x:NaN,y:NaN,width:NaN,height:NaN}),V$=e=>(ht(e),e.height+e.height+e.width+e.width),L$=e=>{let r=Math.max(e.width,e.height);return i=>{if(typeof i=="number")return i/r;if(Q(i))return Object.freeze({...i,x:i.x/r,y:i.y/r,z:i.x/r});if(R(i))return Object.freeze({...i,x:i.x/r,y:i.y/r});throw Error("Param 'value' is neither number nor Point")}},tg=(e,r=Math.random)=>{let i=[],o=0;for(let a=0;a<e.length;a++)o+=e[a],i[a]=o;if(o!==1)throw Error(`Weightings should add up to 1. Got: ${o}`);return()=>{let a=r();for(let n=0;n<i.length;n++)if(a<=i[n])return n;throw Error("Bug: weightedIndex could not select index")}},rg=(e,r=Math.random)=>Math.floor(r()*e.length);function I$(e,r={}){if(e===void 0)throw Error("Param 'array' is undefined");if(!Array.isArray(e))throw Error("Param 'array' is not an array");let i=r.mutate??!1,o=r.source??Math.random;if(e.length===0)return i?void 0:{value:void 0,remainder:[]};let a=rg(e,o);if(i){let n=e[a];return e.splice(a,1),n}else{let n=[...e];return n.splice(a,1),{value:e[a],remainder:n}}}const ig=(e,r=Math.random)=>(w(Ie(e,"array")),e[Math.floor(r()*e.length)]),q$=(e,r,i=Math.random)=>{if(e.length!==r.length)throw Error("Lengths of 'array' and 'weightings' should be the same.");let o=tg(r,i);return()=>{let a=o();return e[a]}},Qs=(e,r=Math.random)=>{let i=[...e];for(let o=i.length-1;o>0;o--){let a=Math.floor(r()*(o+1));[i[o],i[a]]=[i[a],i[o]]}return i},_$=(e,r,i,o)=>{let a=o??Math.random,n=l=>typeof l=="function"?l():l,s=n(e);return w($(s,"percentage","p")),a()<=s?n(i):n(r)},og=e=>{let r=Cn(e);return()=>r()*2-1},W$=e=>og(e)(),Cn=(e=1)=>{let r=typeof e=="number"?{max:e}:e,i=r.max??1,o=r.min??0,a=r.source??Math.random;if(w($(o,"","min"),$(i,"","max")),!r.min&&i<0&&(o=i,i=0),o>i)throw Error(`Min is greater than max. Min: ${o.toString()} max: ${i.toString()}`);return()=>a()*(i-o)+o},ag=(e=1)=>Cn(e)(),Zs=(e=Math.random)=>{let r=0;for(;r===0;)r=e();return r},G$=(e=1)=>ng(e)(),ng=(e=1)=>{let r=0,i=1,o=()=>{let a=Zs(),n=Zs(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*n);return s=s/10+.5,s>1||s<0?s=o():(s**=+e,s*=i-r,s+=r),s};return o},Uu=(e={})=>{let r=e.source??Math.random,i=Math.trunc(r()*46656),o=Math.trunc(r()*46656),a=`000${i.toString(36)}`.slice(-3),n=`000${o.toString(36)}`.slice(-3);return a+n};function*U$(e,r=0){if(w(G(e,"","amount"),G(r,"","offset")),e===0)return;let i=0;do yield e<0?-i+r:i+r;while(i++<Math.abs(e)-1)}const Ju=e=>{if(e===void 0)throw TypeError("maxOrOptions is undefined");let r=typeof e=="number"?{max:e}:e,i=Math.floor(r.max??100),o=Math.floor(r.min??0);!r.min&&i<0&&(i=1,o=r.max??0);let a=r.source??Math.random;if(o>i)throw Error(`Min value is greater than max (min: ${o.toString()} max: ${i.toString()})`);if(w($(o,"","min"),$(i,"","max")),i===o)throw Error(`Max and min values cannot be the same (${i.toString()})`);let n=Math.abs(i-o);return()=>Math.floor(a()*n)+o},sg=e=>Ju(e)();function*J$(e){let r=typeof e=="number"?{max:e}:e,i=r.min??0,o=r.max??100,a=r.source??Math.random,n=r.loop??!1;if(w(G(i,"","min"),G(o,"","max")),i>o)throw Error(`Min value is greater than max. Min: ${i.toString()} Max: ${o.toString()}`);let s=[...U$(o-i,i)],l=Qs(s),u=0;for(;;){if(u===l.length)if(n)l=Qs(s,a);else return;yield l[u++]}}function H$(e){e||=Math.random()*4294967295;let r=Array(624);r[0]=e>>>0;let i=1812433253;for(let l=1;l<624;l++){let u=r[l-1]^r[l-1]>>>30;r[l]=((i&4294901760)*u>>>0)+((i&65535)*u>>>0)+l>>>0}let o=624,a=()=>{let l;if(o>=624){for(let u=0;u<227;u++)l=(r[u]&2147483648|r[u+1]&2147483647)>>>0,r[u]=(r[u+397]^l>>>1^(l&1?2567483615:0))>>>0;for(let u=227;u<623;u++)l=(r[u]&2147483648|r[u+1]&2147483647)>>>0,r[u]=(r[u-227]^l>>>1^(l&1?2567483615:0))>>>0;l=(r[623]&2147483648|r[0]&2147483647)>>>0,r[623]=(r[396]^l>>>1^(l&1?2567483615:0))>>>0,o=0}return l=r[o++],l=(l^l>>>11)>>>0,l=(l^l<<7&2636928640)>>>0,l=(l^l<<15&4022730752)>>>0,l=(l^l>>>18)>>>0,l};return{integer:(l,u=0)=>{if(l<1)throw Error("Upper bound must be greater than or equal to 1");if(l>4294967296)throw Error("Upper bound must not be greater than 4294967296");if(l===1)return 0;let c=l-u,f=Math.ceil(Math.log2(c)),d=(1<<f)-1;for(;;){let h=a()&d;if(h<c)return u+h}},float:()=>a()/4294967296}}const lg=(e=5)=>{let r=typeof e=="number"?{length:e}:e,i=r.source??Math.random,o=r.length??5,a="";for(;a.length<o;)a+=i().toString(36).slice(2);return a.substring(0,o)},ug=e=>{let r=typeof e=="number"?{max:e}:e,i=(r.min??0)*60*1e3,o=(r.max??5)*60*1e3;return Ju({...r,max:o,min:i})},K$=e=>ug(e)(),cg=e=>{let r=typeof e=="number"?{max:e}:e,i=(r.min??0)*1e3,o=(r.max??5)*1e3;return()=>sg({...r,max:o,min:i})},Q$=e=>cg(e)();function Z$(e,r=0,i=1){return e<r?r:e>i?i:e}const fg=e=>{let r=e.source??Math.random;if(e.easingFunction===void 0)throw Error("Param 'easingFunction' is undefined");let i=e.max??1,o=e.min??0;if(i===o)throw Error("Param 'max' is the same as  'min'");if(i<o)throw Error("Param 'max' should be greater than  'min'");return()=>{let n=Z$(e.easingFunction(r()));return Math.floor(n*(i-o))+o}},X$=e=>fg(e)(),Y$=e=>dg(e)(),dg=e=>{let r=e.source??Math.random;if(e.easing!==void 0)throw Error("Param 'easingName' unavailable. Use @ixfx/modulation.weighted instead.");if(e.easingFunction===void 0)throw Error("Param 'easingFunction' is undefined");return()=>e.easingFunction(r())};var eA={};C(eA,{bipolar:()=>W$,bipolarSource:()=>og,calculateNonZero:()=>Zs,chance:()=>_$,float:()=>ag,floatSource:()=>Cn,gaussian:()=>G$,gaussianSource:()=>ng,integer:()=>sg,integerSource:()=>Ju,integerUniqueGen:()=>J$,mersenneTwister:()=>H$,minutesMs:()=>K$,minutesMsSource:()=>ug,randomElement:()=>ig,randomElementWeightedSource:()=>q$,randomIndex:()=>rg,randomPluck:()=>I$,secondsMs:()=>Q$,secondsMsSource:()=>cg,shortGuid:()=>Uu,shuffle:()=>Qs,string:()=>lg,weighted:()=>Y$,weightedIndex:()=>tg,weightedInteger:()=>X$,weightedIntegerSource:()=>fg,weightedSource:()=>dg});const tA=e=>(e??=Math.random,Object.freeze({x:e(),y:e(),width:e(),height:e()})),hg=(e,r={})=>{let i=r.randomSource??Math.random,o=r.margin??{x:0,y:0},a=i()*(e.width-o.x-o.x),n=i()*(e.height-o.y-o.y),s={x:a+o.x,y:n+o.y};return Fe(e)?Xe(s,e):Object.freeze(s)},rA=(e,r)=>e-r;function iA(e,r,i){return Oo(rA,e,r,i)}function pg(e,r,i){let o=typeof r=="number"?r:r.width,a=typeof r=="number"?i:r.height;if(a===void 0)throw Error("Expected height as third parameter");return{...e,width:e.width-o,height:e.height-a}}function oA(e,r){let i=0,o=0;Fe(e)&&(i=e.x,o=e.y);let a=0,n=0;return Fe(r)&&(a=r.x,n=r.y),Object.freeze({...e,x:i-a,y:o-n,width:e.width-r.width,height:e.height-r.height})}const aA=(e,r)=>e+r;function nA(e,r,i){return Oo(aA,e,r,i)}function sA(e,r){let i=0,o=0;Fe(e)&&(i=e.x,o=e.y);let a=0,n=0;return Fe(r)&&(a=r.x,n=r.y),Object.freeze({...e,x:i+a,y:o+n,width:e.width+r.width,height:e.height+r.height})}function lA(e){if(Fe(e))return[e.x,e.y,e.width,e.height];if(nt(e))return[e.width,e.height];throw Error(`Param 'rect' is not a rectangle. Got: ${JSON.stringify(e)}`)}var yg={};C(yg,{Empty:()=>xn,EmptyPositioned:()=>En,Placeholder:()=>eg,PlaceholderPositioned:()=>Gu,applyDim:()=>Iu,applyFields:()=>qy,applyMerge:()=>Oo,applyScalar:()=>Lu,area:()=>E$,cardinal:()=>Ra,center:()=>wn,corners:()=>Vr,distanceFromCenter:()=>A$,distanceFromExterior:()=>qu,divide:()=>S$,divideDim:()=>k$,divideScalar:()=>F$,dividerByLargestDimension:()=>L$,edges:()=>Hy,encompass:()=>N$,fromCenter:()=>Ky,fromElement:()=>P$,fromNumbers:()=>M$,fromTopLeft:()=>gr,getEdgeX:()=>Hs,getEdgeY:()=>Ks,getRectPositioned:()=>Ru,getRectPositionedParameter:()=>B$,guard:()=>ht,guardDim:()=>qr,guardPositioned:()=>Vu,intersectsPoint:()=>Vo,isEmpty:()=>x$,isEqual:()=>Qy,isEqualSize:()=>z$,isIntersecting:()=>Jy,isPlaceholder:()=>Iy,isPositioned:()=>Fe,isRect:()=>nt,isRectPositioned:()=>xt,lengths:()=>T$,maxFromCorners:()=>Xy,multiply:()=>O$,multiplyDim:()=>j$,multiplyScalar:()=>Yy,nearestInternal:()=>R$,perimeter:()=>V$,random:()=>tA,randomPoint:()=>hg,subtract:()=>iA,subtractOffset:()=>oA,subtractSize:()=>pg,sum:()=>nA,sumOffset:()=>sA,toArray:()=>lA});function gg(e){if(Q(e))return Object.freeze({...e,x:Math.abs(e.x),y:Math.abs(e.y),z:Math.abs(e.z)});if(R(e))return Object.freeze({...e,x:Math.abs(e.x),y:Math.abs(e.y)});throw TypeError("Param 'pt' is not a point")}const Ze=Math.PI*2,Nt=(e,r,i)=>(O(e,"a"),r===void 0?Math.atan2(e.y,e.x):(O(r,"b"),i===void 0?Math.atan2(r.y-e.y,r.x-e.x):(O(i,"c"),Math.atan2(r.y-e.y,r.x-e.x)-Math.atan2(i.y-e.y,i.x-e.x)))),uA=(e,r,i)=>{let o=Nt(e,r,i);return o<0?o+Ze:o};function cA(e,r){return O(e,"pt"),Q(e)?Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y"),z:r(e.z,"z")}):Object.freeze({...e,x:r(e.x,"x"),y:r(e.y,"y")})}function fA(e,r){let i,o,a;switch(e){case"moving-average-light":let n=r.scaling??3;i=no(n),o=no(n),a=no(n);break;default:throw Error(`Unknown averaging kind '${e}'. Expected: 'moving-average-light'`)}return n=>{let s=i(n.x),l=o(n.y);if(Q(n)){let u=a(n.z);return Object.freeze({x:s,y:l,z:u})}else return Object.freeze({x:s,y:l})}}function Xt(e,...r){if(r.length===0)throw Error("No points provided");let i=r[0];for(let o of r)i=(Q(i)&&Q(o),e(i,o));return i}const _o=(...e)=>{let r=Xt((c,f)=>c.x<f.x?c:f,...e),i=Xt((c,f)=>c.x>f.x?c:f,...e),o=Xt((c,f)=>c.y<f.y?c:f,...e),a=Xt((c,f)=>c.y>f.y?c:f,...e),n={x:r.x,y:o.y},s={x:i.x,y:o.y},l={x:i.x,y:a.y},u={x:r.x,y:a.y};return Xy(n,s,l,u)},dA=(...e)=>{let r=_o(...e),i=Xt((a,n)=>a.z<n.z?a:n,...e),o=Xt((a,n)=>a.z>n.z?a:n,...e);return{...r,z:i.z,depth:o.z-i.z}},mg=(...e)=>{if(!Array.isArray(e))throw Error("Expected list of points");let r=e.reduce((i,o)=>{if(o===void 0)return i;if(Array.isArray(o))throw TypeError("'points' list contains an array. Did you mean: centroid(...myPoints)?");if(!R(o))throw Error(`'points' contains something which is not a point: ${JSON.stringify(o)}`);return{x:i.x+o.x,y:i.y+o.y}},{x:0,y:0});return Object.freeze({x:r.x/e.length,y:r.y/e.length})};function hA(e,r=0,i=1){return Q(e)?Object.freeze({x:ie(e.x,r,i),y:ie(e.y,r,i),z:ie(e.z,r,i)}):Object.freeze({x:ie(e.x,r,i),y:ie(e.y,r,i)})}const bg=(e,r)=>e.x<r.x&&e.y<r.y?-2:e.x>r.x&&e.y>r.y?2:e.x<r.x||e.y<r.y?-1:e.x>r.x||e.y>r.y?1:e.x===r.x&&e.x===r.y?0:NaN,vg=(e,r)=>e.x===r.x?0:e.x<r.x?-1:1,pA=(e,r)=>e.y===r.y?0:e.y<r.y?-1:1,yA=(e,r)=>e.z===r.z?0:e.z<r.z?-1:1,gA=(...e)=>{let r=[...e].sort(vg);if(r.length===1)return r;let i=n=>{let s=[];for(let l of n){for(;s.length>=2;){let u=s.at(-1),c=s.at(-2);if((u.x-c.x)*(l.y-c.y)>=(u.y-c.y)*(l.x-c.x))s.pop();else break}s.push(l)}return s.pop(),s},o=i(r),a=i(r.reverse());return o.length===1&&a.length===1&&kt(a[0],o[0])?o:[...o,...a]},Hu=(e,r)=>(La(e,"a"),ye(r)&&La(r,"b"),X(e,r)),Ku=(e,r)=>{if(La(e,"a"),ye(r))return Math.max(0,Hu(e,r)-e.radius-r.radius);if(R(r)){let i=X(e,r);return i<e.radius?0:i}else throw Error("Second parameter invalid type")},mA=(e,r)=>{if(xt(r))return qu(r,e);if(ye(r))return Ku(r,e);if(R(r))return X(e,r);throw Error("Unknown shape")},bA=(e,r)=>{if(xt(r))return qu(r,e);if(ye(r))return Ku(r,e);if(R(r))return X(e,r);throw Error("Unknown shape")};function yo(e,r,i,o,a,n){let[s,l]=Ro(e,r,i,o,a,n);if(O(s,"a"),O(l,"b"),l.x===0)throw TypeError("Cannot divide by zero (b.x is 0)");if(l.y===0)throw TypeError("Cannot divide by zero (b.y is 0)");let u={x:s.x/l.x,y:s.y/l.y};if(Q(s)||Q(l)){if(l.z===0)throw TypeError("Cannot divide by zero (b.z is 0)");u.z=(s.z??0)/(l.z??0)}return Object.freeze(u)}function vA(e,r,i){let o=Be(e,r,i);return Ly(o,"divisor"),(a,n,s)=>{let l=Be(a,n,s);return l.z===void 0?Object.freeze({x:l.x/o.x,y:l.y/o.y}):Object.freeze({x:l.x/o.x,y:l.y/o.y,z:l.z/(o.z??1)})}}const wg=e=>[e.x,e.y],xg=(...e)=>{let r=e.map(i=>wg(i));return dp(r)},ee={x:0,y:0},Eg={x:1,y:1},wA={x:0,y:0,z:0},xA={x:1,y:1,z:1};function EA(e,r,i){if(Array.isArray(e)){if(e.length===3)return Object.freeze({x:e[0],y:e[1],z:e[2]});if(e.length===2)return Object.freeze({x:e[0],y:e[1]});throw Error(`Expected array of length two or three, got ${e.length}`)}else{if(e===void 0)throw Error("Requires an array of [x,y] or x,y parameters at least");if(Number.isNaN(e))throw Error("x is NaN");if(r===void 0)throw Error("Param 'y' is missing");if(Number.isNaN(r))throw Error("y is NaN");return Object.freeze(i===void 0?{x:e,y:r}:{x:e,y:r,z:i})}}const DA=e=>{if(typeof e!="string")throw TypeError(`Param 'str' ought to be a string. Got: ${typeof e}`);let r=e.indexOf(","),i=Number.parseFloat(e.substring(0,r)),o=e.indexOf(",",r+1);if(o>0){let a=Number.parseFloat(e.substring(r+1,o-r+2)),n=Number.parseFloat(e.substring(o+1));return{x:i,y:a,z:n}}else{let a=Number.parseFloat(e.substring(r+1));return{x:i,y:a}}},Qu=(...e)=>{let r=[];if(Array.isArray(e[0]))for(let i of e){if(i.length%2!=0)throw Error("coords array should be even-numbered");r.push(Object.freeze({x:i[0],y:i[1]}))}else{if(e.length%2!=0)throw Error("Expected even number of elements: [x,y,x,y...]");for(let i=0;i<e.length;i+=2)r.push(Object.freeze({x:e[i],y:e[i+1]}))}return r};function Dg(e){return qo(e,"line"),{a:e.b,b:e.a}}function Tt(e,r,i,o){typeof i=="boolean"&&(o=i,i=void 0),w(o?$(e,"","amount"):it(e,"amount"));let[a,n]=Dn(r,i),s=Le(a,n),l=s*(1-e);if(s===0&&l===0)return Object.freeze({...n});let u=n.x-l*(n.x-a.x)/s,c=n.y-l*(n.y-a.y)/s;return Object.freeze({...n,x:u,y:c})}function CA(e,r,i=!0){i||(e=Dg(e));let o=e.b.x-e.a.x,a=e.b.y-e.a.y,n=Math.atan2(a,o),s=r*Math.cos(n),l=r*Math.sin(n);return{x:s+e.a.x,y:l+e.a.y}}const ma=(e,r,i,o=!1)=>Tt(e,r,i,o),Or=(e,r="both")=>{switch(r){case"both":return Q(e)?Object.freeze({...e,x:e.x*-1,y:e.y*-1,z:e.z*-1}):Object.freeze({...e,x:e.x*-1,y:e.y*-1});case"x":return Object.freeze({...e,x:e.x*-1});case"y":return Object.freeze({...e,y:e.y*-1});case"z":if(Q(e))return Object.freeze({...e,z:e.z*-1});throw Error("pt parameter is missing z");default:throw Error("Unknown what parameter. Expecting 'both', 'x' or 'y'")}};function wr(e,r,i,o,a,n){let[s,l]=Ro(e,r,i,o,a,n);O(s,"a"),O(l,"b");let u={x:s.x*l.x,y:s.y*l.y};return(Q(s)||Q(l))&&(u.z=(s.z??0)*(l.z??0)),Object.freeze(u)}const vt=(e,r)=>Q(e)?Object.freeze({...e,x:e.x*r,y:e.y*r,z:e.z*r}):Object.freeze({...e,x:e.x*r,y:e.y*r}),Zu=(e,r=1,i=0)=>{let o=X(e),a=1;return o>r?a=r/o:o<i&&(a=i/o),a===1?e:wr(e,a,a)},$A=(...e)=>Xt((r,i)=>r.x<=i.x?r:i,...e),AA=(...e)=>Xt((r,i)=>r.x>=i.x?r:i,...e),SA=(e,r)=>{if(R(e)&&(r=e.y,e=e.x),r===void 0)throw Error("Expected y");return Math.hypot(e,r)},Wo=(e,r)=>{let i=Be(e,r),o=SA(i);return o===0?ee:Object.freeze({...i,x:i.x/o,y:i.y/o})};function Xs(e,r,i,o){if(R(e)){if(typeof r=="number"&&i!==void 0)w($(r,"positive","width"),$(i,"positive","height"));else{if(!nt(r))throw Error("Expected second parameter to be a rect");i=r.height,r=r.width}return Object.freeze({x:e.x/r,y:e.y/i})}else{if(w($(e,"positive","x")),typeof r!="number")throw TypeError("Expecting second parameter to be a number (width)");if(typeof i!="number")throw TypeError("Expecting third parameter to be a number (height)");if(w($(r,"positive","y")),w($(i,"positive","width")),o===void 0)throw Error("Expected height parameter");return w($(o,"positive","height")),Object.freeze({x:e/i,y:r/o})}}const Cg=(e,...r)=>Xu(...r)(e),Xu=(...e)=>r=>e.reduce((i,o)=>o(i),r);var $g=class extends Ye{#e;#t;constructor(e){super(),this.#e=new Map,e===void 0&&(e=r=>{if(r===void 0)throw Error("Cannot create key for undefined");return typeof r=="string"?r:JSON.stringify(r)}),this.#t=e}clear(){this.#e.clear(),this.fireEvent("change",{context:this})}keys(){return this.#e.keys()}values(){return this.#e.values()}toArray(){return[...this.#e.entries()]}debugString(){let e="";for(let[r,i]of this.#e.entries())e+=`${r}: ${i.toString()}, `;return e.endsWith(", ")?e.slice(0,Math.max(0,e.length-2)):e}frequencyOf(e){if(typeof e=="string")return this.#e.get(e);let r=this.#t(e);return this.#e.get(r)}relativeFrequencyOf(e){let r;if(typeof e=="string")r=this.#e.get(e);else{let o=this.#t(e);r=this.#e.get(o)}if(r===void 0)return;let i=this.computeValues();return r/i.total}entries(){return[...this.#e.entries()]}computeValues(){let e=[...this.values()];return To(e)}entriesSorted(e="value"){return p$(e)(this.entries())}add(...e){if(e===void 0)throw Error("Param 'values' undefined");let r=e.map(i=>this.#t(i));for(let i of r){let o=this.#e.get(i)??0;this.#e.set(i,o+1)}this.fireEvent("change",{context:this})}};const FA=e=>new $g(e);var Yu=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(e={}){this.id=e.id??"tracker",this.debug=e.debug??!1,this.sampleLimit=e.sampleLimit??-1,this.resetAfterSamples=e.resetAfterSamples??-1,this.storeIntermediate=e.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...e){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed("resize")),this.seenCount+=e.length;let r=this.filterData(e);return this.computeResults(r)}},Ag=class extends Yu{values;timestamps;constructor(e){super(e),this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(e){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){let r=e.at(-1),i={value:r,at:performance.now()},o=e.map(a=>({at:performance.now(),value:a}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...o.map(a=>a.at));else switch(this.values.length){case 0:this.values.push(i.value),this.timestamps.push(i.at);break;case 2:this.values[1]=i.value,this.timestamps[1]=i.at;break;case 1:this.values.push(i.value),this.timestamps.push(i.at);break}return o}},ec=class extends Ag{total=0;min=2**53-1;max=-9007199254740991;get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=2**53-1,this.max=-9007199254740991,this.total=0,super.onReset()}onTrimmed(e){this.min=bu(this.values),this.max=mu(this.values),this.total=yp(this.values)}computeResults(e){if(e.some(o=>Number.isNaN(o)))throw Error("Cannot add NaN");let r=e.map(o=>o.value);return this.total=r.reduce((o,a)=>o+a,this.total),this.min=Math.min(...r,this.min),this.max=Math.max(...r,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}};const ba=(e={})=>new ec(e);var Sg=class extends ec{lastMark=0;mark(){this.lastMark>0&&this.seen(performance.now()-this.lastMark),this.lastMark=performance.now()}};const kA=e=>new Sg(e);var Fg=class{#e=[];#t;#r;#i;#o;constructor(e={}){this.#r=e.resetAfterSamples??2**53-1,this.#i=e.sampleLimit??2**53-1,e.timeoutInterval&&(this.#o=Di(()=>{this.reset()},e.timeoutInterval)),this.#t=performance.now()}mark(){this.#e.length>=this.#r?this.reset():this.#e.length>=this.#i&&(this.#e=this.#e.slice(1),this.#t=this.#e[0]),this.#e.push(performance.now()),this.#o&&this.#o.start()}computeIntervals(){let e=9007199254740991,r=-9007199254740991,i=0,o=0,a=0;for(let s of this.#e){if(o>0){let l=s-a;e=Math.min(l,e),r=Math.max(l,r),i+=l}a=s,o++}let n=i/o;return{min:e,max:r,avg:n}}get elapsed(){return performance.now()-this.#t}reset(){this.#e=[],this.#t=performance.now()}get perSecond(){return this.#e.length/(this.elapsed/1e3)}get perMinute(){return this.#e.length/(this.elapsed/1e3/60)}};const NA=(e={})=>new Fg(e);var kg=class extends Yu{values;constructor(e={}){super(e),this.values=[]}onTrimmed(e){}trimStore(e){return e>=this.values.length||(this.values=this.values.slice(-e)),this.values.length}onReset(){this.values=[]}filterData(e){let r=e.map(o=>"at"in o?o:{...o,at:Date.now()}),i=r.at(-1);if(this.storeIntermediate)this.values.push(...r);else switch(this.values.length){case 0:this.values.push(i);break;case 1:this.values.push(i);break;case 2:this.values[1]=i;break}return r}get last(){return this.values.length===1?this.values[0]:this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){return Date.now()-this.values[0].at}},Ng=class{store;gog;constructor(e){this.store=new Map,this.gog=Fl(this.store,e)}get size(){return this.store.size}has(e){return this.store.has(e)}async seen(e,...r){return(await this.getTrackedValue(e,...r)).seen(...r)}async getTrackedValue(e,...r){if(e===null)throw Error("id parameter cannot be null");if(e===void 0)throw Error("id parameter cannot be undefined");return await this.gog(e,r[0])}delete(e){this.store.delete(e)}reset(){this.store=new Map}*ids(){yield*this.store.keys()}*tracked(){yield*this.store.values()}*trackedByAge(){let e=[...this.store.values()];e.sort((r,i)=>{let o=r.elapsed,a=i.elapsed;return o===a?0:o>a?-1:1});for(let r of e)yield r}*valuesByAge(){for(let e of this.trackedByAge())yield e.last}*last(){for(let e of this.store.values())yield e.last}*initialValues(){for(let e of this.store.values())yield e.initial}get(e){return this.store.get(e)}},PA={};C(PA,{FrequencyTracker:()=>$g,IntervalTracker:()=>Sg,NumberTracker:()=>ec,ObjectTracker:()=>kg,PrimitiveTracker:()=>Ag,RateTracker:()=>Fg,TrackedValueMap:()=>Ng,TrackerBase:()=>Yu,frequency:()=>FA,interval:()=>kA,number:()=>ba,rate:()=>NA});const tc=e=>!(e.distance===void 0||e.angleRadian===void 0),tt=(e,r="Point")=>{if(e===void 0)throw Error(`'${r}' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e===null)throw Error(`'${r}' is null. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.angleRadian===void 0)throw Error(`'${r}.angleRadian' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(e.distance===void 0)throw Error(`'${r}.distance' is undefined. Expected {distance, angleRadian} got ${JSON.stringify(e)}`);if(typeof e.angleRadian!="number")throw TypeError(`'${r}.angleRadian' must be a number. Got ${e.angleRadian}`);if(typeof e.distance!="number")throw TypeError(`'${r}.distance' must be a number. Got ${e.distance}`);if(e.angleRadian===null)throw Error(`'${r}.angleRadian' is null`);if(e.distance===null)throw Error(`'${r}.distance' is null`);if(Number.isNaN(e.angleRadian))throw TypeError(`'${r}.angleRadian' is NaN`);if(Number.isNaN(e.distance))throw Error(`'${r}.distance' is NaN`)};function st(e){return Array.isArray(e)?e.map(r=>r*(Math.PI/180)):e*(Math.PI/180)}function Pg(e){return(e+Math.PI)%(2*Math.PI)}function Mg(e){return e*1.111111}function Bg(e,r=!0){return r?e*.9%360:e*.9}function va(e){return e*63.6619772368}function Ys(e){return e*.0157079633}function Si(e){return Array.isArray(e)?e.map(r=>r*180/Math.PI):e*180/Math.PI}const MA=e=>Math.atan2(e.x,e.y),$n=(e,r,i=!0)=>{if(i){let o=e+r;return o>=Ze&&(o%=Ze),o}else{let o=e-r;return o<0?Ze+o:o}},BA=(e,r,i=!0)=>Si($n(st(e),st(r),i)),rc=(e,r,i=!0)=>{let o=e;r<o&&(o=0,r=Ze-e+r);let a=r-o;return i&&(a=Ze-a),a>=Ze?a%Ze:a},zA=(e,r,i=!0)=>Si(rc(st(e),st(r),i)),An=e=>{if(TA(e))return e;if(typeof e=="number")return{value:e,unit:"deg"};e=e.toLowerCase();let r="deg",i=NaN;if(e.endsWith("grad")?(i=Number.parseFloat(e.substring(0,e.length-4)),r="grad"):e.endsWith("rad")?(i=Number.parseFloat(e.substring(0,e.length-3)),r="rad"):e.endsWith("turn")?(i=Number.parseFloat(e.substring(0,e.length-4)),r="turn"):e.endsWith("deg")?(i=Number.parseFloat(e.substring(0,e.length-3)),r="deg"):i=Number.parseFloat(e),Number.isNaN(i))throw Error("Invalid angle (bad value?)");if(r.length===0)throw Error("Invalid angle (no unit)");return{value:i,unit:r}},TA=e=>typeof e=="object"&&"unit"in e&&"value"in e?!(typeof e.unit!="string"||typeof e.value!="number"):!1,ic=(e,r)=>{let i=typeof e=="object"?e:An(e);switch(r){case"deg":if(i.unit==="deg")return i;if(i.unit==="rad")return{value:Si(i.value),unit:"deg"};if(i.unit==="grad")return{value:Bg(i.value),unit:"deg"};if(i.unit==="turn")return{value:zg(i.value),unit:"deg"};throw Error(`Unknown unit: ${i.unit}`);case"grad":if(i.unit==="deg")return{value:Mg(i.value),unit:"grad"};if(i.unit==="rad")return{value:va(i.value),unit:"grad"};if(i.unit==="grad")return i;if(i.unit==="turn")return{value:va(el(i.value)),unit:"grad"};throw Error(`Unknown unit: ${i.unit}`);case"rad":if(i.unit==="deg")return{value:st(i.value),unit:"rad"};if(i.unit==="rad")return i;if(i.unit==="grad")return{value:Ys(i.value),unit:"rad"};if(i.unit==="turn")return{value:va(el(i.value)),unit:"grad"};throw Error(`Unknown unit: ${i.unit}`);case"turn":if(i.unit==="deg")return{value:Tg(i.value),unit:"turn"};if(i.unit==="rad")return{value:tl(i.value),unit:"turn"};if(i.unit==="grad")return{value:tl(Ys(i.value)),unit:"turn"};if(i.unit==="turn")return i;throw Error(`Unknown unit: ${i.unit}`);default:throw Error(`Destination unit unknown ('${r}). Expects: deg, grad, rad or turn`)}},zg=(e,r=!0)=>r?e*360%360:e*360,el=e=>e*Ze,Tg=e=>e/360,tl=e=>e/Ze,Og=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+r}),OA=e=>(tt(e,"c"),Object.freeze({...e,angleRadian:e.angleRadian-Math.PI})),jA=(e,r)=>(tt(e,"a"),tt(r,"b"),e.distance===r.distance?e.angleRadian===-r.angleRadian:!1),RA=(e,r)=>(tt(e,"a"),tt(r,"b"),e.angleRadian===r.angleRadian),VA=(e,r)=>(tt(e,"a"),tt(r,"b"),e.angleRadian===-r.angleRadian),LA=(e,r)=>Object.freeze({...e,angleRadian:e.angleRadian+st(r)}),Ue=(e,r,i)=>{if(tc(e)){if(r===void 0&&(r=ee),R(r))return cd(e.distance,e.angleRadian,r);throw Error("Expecting (Coord, Point). Second parameter is not a point")}else{if(typeof e=="object")throw TypeError(`First param is an object, but not a Coord: ${JSON.stringify(e)}`);if(typeof e=="number"&&typeof r=="number"){if(i===void 0&&(i=ee),!R(i))throw Error("Expecting (number, number, Point). Point param wrong type");return cd(e,r,i)}else throw TypeError(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof r}, ${typeof i}). a: ${JSON.stringify(e)}`)}},oc=(e,r)=>{e=$e(e,r);let i=Math.atan2(e.y,e.x);return Object.freeze({...e,angleRadian:i,distance:Math.hypot(e.x,e.y)})},cd=(e,r,i=ee)=>(O(i),Object.freeze({x:i.x+e*Math.cos(r),y:i.y+e*Math.sin(r)})),jg=(e,r)=>{if(e===void 0)return"(undefined)";if(e===null)return"(null)";let i=Si(e.angleRadian),o=r?e.distance.toFixed(r):e.distance,a=r?i.toFixed(r):i;return`(${o},${a})`},Rg=(e,r=ee)=>(tt(e,"v"),Object.freeze({x:r.x+e.distance*Math.cos(e.angleRadian),y:r.y+e.distance*Math.sin(e.angleRadian)})),Vg=e=>{if(e.distance===0)throw Error("Cannot normalise vector of length 0");return Object.freeze({...e,distance:1})},Lg=(e,r=1,i=0)=>{let o=e.distance;return o>r&&(o=r),o<i&&(o=i),Object.freeze({...e,distance:o})},Ig=(e,r)=>(tt(e,"a"),tt(r,"b"),e.distance*r.distance*Math.cos(r.angleRadian-e.angleRadian)),IA=(e,r)=>(tt(e),w($(r,"","amt")),Object.freeze({...e,distance:e.distance*r})),qA=(e,r)=>(tt(e),w($(r,"","amt")),Object.freeze({...e,distance:e.distance/r})),_A=(e,r=Math.round)=>(O(e,"pt"),Object.freeze({x:r(e.x),y:r(e.y)})),WA=e=>{O(e,"pt");let r={...e};return delete r.z,Object.freeze(r)},GA=(e,r=0)=>(O(e,"pt"),Object.freeze({...e,z:r}));function go(e,r){if(e===void 0)return"(undefined)";if(e===null)return"(null)";O(e,"pt");let i=r?e.x.toFixed(r):e.x,o=r?e.y.toFixed(r):e.y;if(e.z===void 0)return`(${i},${o})`;{let a=r?e.z.toFixed(r):e.z;return`(${i},${o},${a})`}}var qg={};C(qg,{fromLine:()=>Wg,toCartesian:()=>_g,toString:()=>JA});const _g=(e,r)=>{let i=UA(e,r),o=Ue(e.offset,e.angleRadian,i),a=Ue(e.offset+e.length,e.angleRadian,i);return{a:o,b:a}},UA=(e,r)=>r===void 0?e.origin===void 0?{x:0,y:0}:e.origin:r,JA=e=>{let r=`PolarRay(angle: ${e.angleRadian} offset: ${e.offset} len: ${e.length}`;return e.origin&&(r+=` origin: ${go(e.origin)}`),r+=")",r},Wg=(e,r)=>{let i=r??e.a;return{angleRadian:Nt(e.b,i),offset:X(e.a,i),length:X(e.b,e.a),origin:i}};function*HA(e,r){let i=0;for(;;){let o=e*i++;yield{distance:r*o,angleRadian:o,step:i}}}const KA=(e,r,i)=>{let o=r*e;return Object.freeze({distance:i*o,angleRadian:o})};var Gg={};C(Gg,{Ray:()=>qg,clampMagnitude:()=>Lg,divide:()=>qA,dotProduct:()=>Ig,fromCartesian:()=>oc,guard:()=>tt,invert:()=>OA,isAntiParallel:()=>VA,isOpposite:()=>jA,isParallel:()=>RA,isPolarCoord:()=>tc,multiply:()=>IA,normalise:()=>Vg,rotate:()=>Og,rotateDegrees:()=>LA,spiral:()=>HA,spiralRaw:()=>KA,toCartesian:()=>Ue,toPoint:()=>Rg,toString:()=>jg});var Ug={};C(Ug,{clampMagnitude:()=>iS,divide:()=>sS,dotProduct:()=>rS,fromLineCartesian:()=>Hg,fromLinePolar:()=>Kg,fromPointPolar:()=>Jg,fromRadians:()=>ZA,multiply:()=>nS,normalise:()=>YA,quadrantOffsetAngle:()=>eS,subtract:()=>aS,sum:()=>oS,toCartesian:()=>rr,toPolar:()=>Go,toRadians:()=>XA,toString:()=>tS});const QA=Object.freeze({x:0,y:0}),wa=Math.PI*2,rl=Math.PI,ZA=e=>Object.freeze({x:Math.cos(e),y:Math.sin(e)}),XA=e=>Math.atan2(e.y,e.x),Jg=(e,r="",i=QA)=>{e=$e(e,i);let o=Math.atan2(e.y,e.x);return r==="unipolar"&&o<0?o+=wa:r==="bipolar"&&(o>rl?o-=wa:o<=-rl&&(o+=wa)),Object.freeze({distance:X(e),angleRadian:o})},Hg=e=>$e(e.b,e.a),Kg=e=>{qo(e,"line");let r=$e(e.b,e.a);return Jg(r)},Et=e=>!!tc(e),_r=e=>!!R(e),YA=e=>{if(Et(e))return Vg(e);if(_r(e))return Wo(e);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},eS=e=>e.x>=0&&e.y>=0?0:e.x<0&&e.y>=0||e.x<0&&e.y<0?rl:wa,Go=(e,r=ee)=>{if(Et(e))return e;if(_r(e))return oc(e,r);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},rr=e=>{if(Et(e))return Rg(e);if(_r(e))return e;throw Error(`Expected polar/cartesian vector. Got: ${e}`)},tS=(e,r)=>{if(Et(e))return jg(e,r);if(_r(e))return go(e,r);throw Error(`Expected polar/cartesian vector. Got: ${e}`)},rS=(e,r)=>{if(Et(e)&&Et(r))return Ig(e,r);if(_r(e)&&_r(r))return xg(e,r);throw Error("Expected two polar/Cartesian vectors.")},iS=(e,r=1,i=0)=>{if(Et(e))return Lg(e,r,i);if(_r(e))return Zu(e,r,i);throw Error("Expected either polar or Cartesian vector")},oS=(e,r)=>{let i=Et(e);e=rr(e),r=rr(r);let o=Xe(e,r);return i?Go(o):o},aS=(e,r)=>{let i=Et(e);e=rr(e),r=rr(r);let o=$e(e,r);return i?Go(o):o},nS=(e,r)=>{let i=Et(e);e=rr(e),r=rr(r);let o=wr(e,r);return i?Go(o):o},sS=(e,r)=>{let i=Et(e);e=rr(e),r=rr(r);let o=yo(e,r);return i?Go(o):o},ac=(e,r)=>{let i=o=>{let{a,b:n}=o,s={x:n.x-a.x,y:n.y-a.y},l={x:r.x-a.x,y:r.y-a.y},u=s.x*s.x+s.y*s.y,c=l.x*s.x+l.y*s.y,f=Math.min(1,Math.max(0,c/u));return c=(n.x-a.x)*(r.y-a.y)-(n.y-a.y)*(r.x-a.x),{x:a.x+s.x*f,y:a.y+s.y*f}};if(Array.isArray(e)){let o=e.map(n=>i(n)),a=o.map(n=>X(n,r));return Object.freeze(o[gu(...a)])}else return Object.freeze(i(e))},Ia=(e,r)=>{if(qo(e,"line"),O(r,"point"),Le(e)===0)return Le(e.a,r);let i=ac(e,r);return Le(i,r)},Qg=e=>({x:e.b.x-e.a.x,y:e.b.y-e.a.y}),Zg=e=>{let r=Le(e),i=Qg(e);return{x:i.x/r,y:i.y/r}},Xg=(e,r)=>{let i=Qg(e),o=Zg(e),a={x:e.a.x-o.y*r,y:e.a.y+o.x*r};return{a,b:{x:a.x+i.x,y:a.y+i.y}}},Yg=(e,r,i=0)=>{let o=Tt(i,e),a=Zg(e);return{x:o.x-a.y*r,y:o.y+a.x*r}},em=e=>_o(e.a,e.b),tm=(e,r)=>Object.freeze({...e,a:yo(e.a,r),b:yo(e.b,r)}),qa=(e,r,i,o)=>{if(Number.isNaN(e))throw Error("x1 is NaN");if(Number.isNaN(i))throw Error("x2 is NaN");if(Number.isNaN(r))throw Error("y1 is NaN");if(Number.isNaN(o))throw Error("y2 is NaN");return Lo({x:e,y:r},{x:i,y:o})},lS=e=>{if(!Array.isArray(e))throw Error("arr parameter is not an array");if(e.length!==4)throw Error("array is expected to have length four");return qa(e[0],e[1],e[2],e[3])},uS=(e={x:.5,y:.5},r=1,i=0,o=.5)=>{let a=r*o,n=r*(1-o),s=Ue(a,Pg(i),e),l=Ue(n,i,e);return Object.freeze({a:s,b:l})},rm=(e,r)=>{let[i,o]=Dn(e,r);return Tt(.5,i,o)},im=(e,r)=>{let i=X(e.a,r),o=Le(e);return i/o},om=(e,r)=>Object.freeze({...e,a:Xe(e.a,r),b:Xe(e.b,r)}),am=(e,r,i)=>r===void 0||r===0?e:(i===void 0&&(i=.5),typeof i=="number"&&(i=Tt(i,e.a,e.b)),Object.freeze({...e,a:Pt(e.a,r,i),b:Pt(e.b,r,i)})),nm=(e,r)=>kt(e.a,r.a)&&kt(e.b,r.b),sm=(e,r)=>Object.freeze({...e,a:wr(e.a,r),b:wr(e.b,r)}),lm=(e,r)=>Object.freeze({...e,a:$e(e.a,r),b:$e(e.b,r)});function um(e,r){if(jt(e))qo(e,"a"),r=e.b,e=e.a;else if(r===void 0)throw Error("Expect second point if first is a point");return go(e)+"-"+go(r)}const Qt=e=>{let{a:r,b:i}=e;return Object.freeze({...e,length:()=>Le(r,i),interpolate:o=>Tt(o,r,i),relativePosition:o=>im(e,o),bbox:()=>em(e),toString:()=>um(r,i),toFlatArray:()=>ym(r,i),toSvgString:()=>gm(r,i),toPoints:()=>[r,i],rotate:(o,a)=>Qt(am(e,o,a)),nearest:o=>ac(e,o),sum:o=>Qt(om(e,o)),divide:o=>Qt(tm(e,o)),multiply:o=>Qt(sm(e,o)),subtract:o=>Qt(lm(e,o)),midpoint:()=>rm(r,i),distanceToPoint:o=>Ia(e,o),parallel:o=>Xg(e,o),perpendicularPoint:(o,a)=>Yg(e,o,a),slope:()=>nc(e),withinRange:(o,a)=>hm(e,o,a),isEqual:o=>nm(e,o),apply:o=>Qt(dm(e,o)),kind:"line"})},cS=(e,r)=>Qt(Lo(e,r));var cm={};C(cm,{Empty:()=>fm,Placeholder:()=>fS,angleRadian:()=>pS,apply:()=>dm,asPoints:()=>wS,bbox:()=>em,distance:()=>pm,distanceSingleLine:()=>Ia,divide:()=>tm,extendFromA:()=>bS,fromFlatArray:()=>lS,fromNumbers:()=>qa,fromPivot:()=>uS,fromPoints:()=>Lo,fromPointsToPath:()=>cS,getPointParameter:()=>Dn,guard:()=>qo,interpolate:()=>Tt,isEmpty:()=>dS,isEqual:()=>nm,isLine:()=>jt,isPlaceholder:()=>hS,isPolyLine:()=>Zy,joinPointsToLines:()=>Io,length:()=>Le,midpoint:()=>rm,multiply:()=>sm,nearest:()=>ac,normaliseByRect:()=>yS,parallel:()=>Xg,perpendicularPoint:()=>Yg,pointAtDistance:()=>CA,pointAtX:()=>mS,pointsOf:()=>vS,relativePosition:()=>im,reverse:()=>Dg,rotate:()=>am,scaleFromMidpoint:()=>gS,slope:()=>nc,subtract:()=>lm,sum:()=>om,toFlatArray:()=>ym,toPath:()=>Qt,toString:()=>um,toSvgString:()=>gm,withinRange:()=>hm});const fm=Object.freeze({a:Object.freeze({x:0,y:0}),b:Object.freeze({x:0,y:0})}),fS=Object.freeze({a:Object.freeze({x:NaN,y:NaN}),b:Object.freeze({x:NaN,y:NaN})}),dS=e=>ci(e.a)&&ci(e.b),hS=e=>Rr(e.a)&&Rr(e.b),dm=(e,r)=>Object.freeze({...e,a:r(e.a),b:r(e.b)}),pS=(e,r)=>{let i;if(jt(e))i=e.a,r=e.b;else if(i=e,r===void 0)throw Error("b point must be provided");return Math.atan2(r.y-i.y,r.x-i.x)},yS=(e,r,i)=>Object.freeze({...e,a:Xs(e.a,r,i),b:Xs(e.b,r,i)}),hm=(e,r,i)=>pm(e,r)<=i,nc=(e,r)=>{let i;if(jt(e))i=e.a,r=e.b;else if(i=e,r===void 0)throw Error("b parameter required");if(r===void 0)throw TypeError("Second point missing");return(r.y-i.y)/(r.x-i.x)},gS=(e,r)=>{let i=Tt(r/2,e),o=Tt(.5+r/2,e);return{a:i,b:o}},mS=(e,r)=>{let i=e.a.y+(r-e.a.x)*nc(e);return Object.freeze({x:r,y:i})},bS=(e,r)=>{let i=Le(e);return Object.freeze({...e,a:e.a,b:Object.freeze({x:e.b.x+(e.b.x-e.a.x)/i*r,y:e.b.y+(e.b.y-e.a.y)/i*r})})};function*vS(e){let{a:r,b:i}=e,o=Math.floor(r.x),a=Math.floor(r.y),n=Math.floor(i.x),s=Math.floor(i.y),l=Math.abs(n-o),u=-Math.abs(s-a),c=o<n?1:-1,f=a<s?1:-1,d=l+u;for(;yield{x:o,y:a},!(o===n&&a===s);){let h=2*d;h>=u&&(d+=u,o+=c),h<=l&&(d+=l,a+=f)}}const pm=(e,r)=>{if(Array.isArray(e)){let i=e.map(o=>Ia(o,r));return bu(i)}else return Ia(e,r)},ym=(e,r)=>{if(jt(e))return[e.a.x,e.a.y,e.b.x,e.b.y];if(R(e)&&R(r))return[e.x,e.y,r.x,r.y];throw Error("Expected single line parameter, or a and b points")};function*wS(e){for(let r of e)yield r.a,yield r.b}const gm=(e,r)=>[`M${e.x} ${e.y} L ${r.x} ${r.y}`],xa=(e,r)=>{let i=Be(e,r),o=0,a=0,n=0,s=performance.now(),l=i;return(c,f)=>{let d=Be(c,f);o+=d.x,a+=d.y,n++;let h=X(d,i),p=X(d,l),y=performance.now(),g=p/(y-s);return s=y,l=d,Object.freeze({angle:Nt(d,i),distanceFromStart:h,distanceFromLast:p,speed:g,centroid:mg(d,i),average:{x:o/n,y:a/n}})}};var sc=class extends kg{initialRelation;markRelation;lastResult;constructor(e={}){super(e)}onTrimmed(e){this.initialRelation=void 0}onReset(){super.onReset(),this.lastResult=void 0,this.initialRelation=void 0,this.markRelation=void 0}seenEvent(e){if("getCoalescedEvents"in e){let r=e.getCoalescedEvents(),i=r.map(o=>({x:o.clientX,y:o.clientY}));return this.seen(...i)}else return this.seen({x:e.clientX,y:e.clientY})}mark(){this.markRelation=xa(this.last)}computeResults(e){let r=this.last,i=this.values.at(-2);if(this.initialRelation===void 0&&this.initial)this.initialRelation=xa(this.initial);else if(this.initialRelation===void 0)throw Error("Bug: No initialRelation, and this.inital is undefined?");let o=xa(i===void 0?r:i),a=this.initialRelation(r),n=this.markRelation===void 0?void 0:this.markRelation(r),s=i===void 0?0:Le(i,r)/(r.at-i.at),l={...o(r),speed:s},u={fromInitial:a,fromLast:l,fromMark:n,values:[...this.values]};return this.lastResult=u,u}get line(){return this.values.length===1?[]:Io(...this.values)}get vectorPolar(){return Kg(this.lineStartEnd)}get vectorCartesian(){return Hg(this.lineStartEnd)}get lineStartEnd(){let e=this.initial;return this.values.length<2||!e?fm:{a:e,b:this.last}}distanceFromStart(){let e=this.initial;return this.values.length>=2&&e!==void 0?X(e,this.last):0}difference(){let e=this.initial;return this.values.length>=2&&e!==void 0?$e(this.last,e):Va}angleFromStart(){let e=this.initial;if(e!==void 0&&this.values.length>2)return Nt(e,this.last)}get length(){if(this.values.length===1)return 0;let e=this.line;return Le(e)}get x(){return this.last.x}get y(){return this.last.y}get z(){return this.last.z}},lc=class extends Ng{constructor(e={}){super((r,i)=>{if(i===void 0)throw Error("Requires start point");let o=new sc({...e,id:r});return o.seen(i),o})}seenEvent(e){if("getCoalescedEvents"in e){let r=e.getCoalescedEvents(),i=r.map(o=>super.seen(o.pointerId.toString(),o));return Promise.all(i)}else return Promise.all([super.seen(e.pointerId.toString(),e)])}};const xS=(e,r,i)=>{let o=$e(e,r),a=$e(i,r);return Q(o)&&Q(a)?(o.x*a.x+o.y*a.y+o.z*a.z)/(a.x*a.x+a.y*a.y+a.z*a.z):(o.x*a.x+o.y*a.y)/(a.x*a.x+a.y*a.y)},il=(e,r,i)=>{let o=Math.cos(i)*r+e.x,a=Math.sin(i)*r+e.y;return{x:o,y:a}};function ES(e,r,i=!0){if(O(e,"pt"),O(r,"snap"),Q(e)){if(!Q(r))throw TypeError("Param 'snap' is missing 'z' field");return Object.freeze({x:Br(e.x,r.x,i),y:Br(e.y,r.y,i),z:Br(e.z,r.z,i)})}return Object.freeze({x:Br(e.x,r.x,i),y:Br(e.y,r.y,i)})}const DS=e=>(e===void 0&&(e=Math.random),Object.freeze({x:e(),y:e()})),CS=e=>(e===void 0&&(e=Math.random),Object.freeze({x:e(),y:e(),z:e()})),mm=(e,r,i)=>{i===void 0&&(i={x:0,y:0});let o=i;for(let a of e)o=r(a,o);return o};function Pt(e,r,i){i===void 0&&(i={x:0,y:0}),O(i,"origin"),w($(r,"","amountRadian"));let o=Array.isArray(e);if(r===0)return e;o||(e=[e]);let a=e;for(let[u,c]of a.entries())O(c,`pt[${u}]`);let n=a.map(u=>oc(u,i)),s=n.map(u=>Og(u,r)),l=s.map(u=>Ue(u,i));return o?l:l[0]}const $S=(e,r)=>{let i=[[Math.cos(r),-Math.sin(r)],[Math.sin(r),Math.cos(r)]],o=[];for(let[a,n]of e.entries())o[a]=[i[0][0]*n[0]+i[0][1]*n[1],i[1][0]*n[0]+i[1][1]*n[1]];return o},AS=(e,r,i)=>{let o=Be(e,r);return i??=r,i??=2,Object.freeze({...o,x:di(i,o.x),y:di(i,o.y)})},SS=(e,r,i)=>{O(e,"a"),O(r,"b"),typeof i=="number"?(w($(i,"positive","maxRange")),i={x:i,y:i}):O(i,"maxRange");let o=Math.abs(r.x-e.x),a=Math.abs(r.y-e.y);return o<=i.x&&a<=i.y},FS=(e,r,i)=>(r===void 0&&(r={x:1,y:1}),i===void 0&&(i={x:0,y:0}),O(e,"pt"),O(r,"ptMax"),O(i,"ptMin"),Object.freeze({x:ho(e.x,i.x,r.x),y:ho(e.y,i.y,r.y)}));var bm={};C(bm,{Empty:()=>ee,Empty3d:()=>wA,Placeholder:()=>Va,Placeholder3d:()=>D$,PointTracker:()=>sc,PointsTracker:()=>lc,Unit:()=>Eg,Unit3d:()=>xA,abs:()=>gg,angleRadian:()=>Nt,angleRadianCircle:()=>uA,apply:()=>cA,averager:()=>fA,bbox:()=>_o,bbox3d:()=>dA,centroid:()=>mg,clamp:()=>hA,clampMagnitude:()=>Zu,compare:()=>bg,compareByX:()=>vg,compareByY:()=>pA,compareByZ:()=>yA,convexHull:()=>gA,distance:()=>X,distanceToCenter:()=>mA,distanceToExterior:()=>bA,divide:()=>yo,divider:()=>vA,dotProduct:()=>xg,findMinimum:()=>Xt,from:()=>EA,fromNumbers:()=>Qu,fromString:()=>DA,getPointParameter:()=>Be,getTwoPointParameters:()=>Ro,guard:()=>O,guardNonZeroPoint:()=>Ly,interpolate:()=>ma,invert:()=>Or,isEmpty:()=>ci,isEqual:()=>kt,isNaN:()=>w$,isNull:()=>v$,isPlaceholder:()=>Rr,isPoint:()=>R,isPoint3d:()=>Q,leftmost:()=>$A,multiply:()=>wr,multiplyScalar:()=>vt,normalise:()=>Wo,normaliseByRect:()=>Xs,pipeline:()=>Xu,pipelineApply:()=>Cg,progressBetween:()=>xS,project:()=>il,quantiseEvery:()=>ES,random:()=>DS,random3d:()=>CS,reduce:()=>mm,relation:()=>xa,rightmost:()=>AA,rotate:()=>Pt,rotatePointArray:()=>$S,round:()=>AS,subtract:()=>$e,sum:()=>Xe,to2d:()=>WA,to3d:()=>GA,toArray:()=>wg,toIntegerValues:()=>_A,toString:()=>go,withinRange:()=>SS,wrap:()=>FS});var vm={};C(vm,{draggable:()=>kS});const kS=(e,r,i={})=>{let o=U(e),a=Va,n,s=i.autoTranslate??!1,l=i.quickDrag??!1,u=i.fence?U(i.fence):void 0,c=i.fenceViewport,f=Gu,d=window.getComputedStyle(o).position==="relative",h=()=>{o.classList.contains("drag-sel")&&o.classList.remove("drag-sel")},p=x=>{o.classList.contains("drag-sel")?o.classList.remove("drag-sel"):o.classList.add("drag-sel"),x.stopPropagation()};o.ownerDocument.addEventListener("click",h),o.addEventListener("click",p);let y=()=>{o.classList.remove("drag-progress"),o.ownerDocument.removeEventListener("pointermove",D),o.ownerDocument.removeEventListener("pointerup",B),o.ownerDocument.removeEventListener("pointercancel",V)},g=()=>{o.classList.contains("drag-progress")?V(void 0,"dispose"):y(),o.ownerDocument.removeEventListener("click",h),o.removeEventListener("click",p)},m=(x,F,N)=>(Iy(f)||(x={x:ie(x.x,f.x,f.width),y:ie(x.y,f.y,f.height)},c&&(F=ie(F,c.x,c.x+c.width),N=ie(N,c.y,c.y+c.height))),[x,{x:F,y:N}]),v=ee,D=x=>{x.preventDefault(),x.stopPropagation();let{x:F,y:N}=x,P=Rr(a)?{x:x.offsetX,y:x.offsetY}:{x:F-a.x,y:N-a.y},k=m(P,F,N);P=k[0];let te={delta:P,initial:a,token:n,viewport:k[1]};if(r.progress!==void 0){let le=r.progress(te);if(le.abort){V(void 0,"discontinued");return}le.viewport&&(P={x:le.viewport.x-a.x,y:le.viewport.y-a.y})}if(v=P,s){let le=P.x,ve=P.y;o.style.translate=`${le}px ${ve}px`}},B=x=>{let F=o.getBoundingClientRect();y();let{x:N,y:P}=x,k=m(v,N,P),te={initial:a,token:n,delta:k[0],viewport:k[1]};if(s)if(o.style.translate="none",d){let le=o.parentElement?.getBoundingClientRect();o.style.left=`${F.x-le.left}px`,o.style.top=`${F.y-le.top}px`}else o.style.left=`${F.x}px`,o.style.top=`${F.y}px`;r.success!==void 0&&r.success(te)},V=(x,F="pointercancel")=>{y();let N=Va;x&&"x"in x&&"y"in x&&(N={x:x.x,y:x.y});let P={token:n,initial:a,delta:{x:-1,y:-1},viewport:N};r.abort!==void 0&&r.abort(F,P)};return o.addEventListener("pointerdown",x=>{if(!o.classList.contains("drag-sel")&&!l)return;let N=x;a={x:N.x,y:N.y};let P=r.start===void 0?{allow:!0,token:n}:r.start();if(P.allow){if(n=P.token,u){let k=u.getBoundingClientRect();f={x:k.x-a.x,y:k.y-a.y,width:k.x+k.width-a.x,height:k.y+k.height-a.y}}else c&&(f={x:c.x-a.x,y:c.y-a.y,width:c.width+c.x-a.x,height:c.height+c.y-a.y});o.classList.add("drag-progress"),o.ownerDocument.addEventListener("pointermove",D),o.ownerDocument.addEventListener("pointerup",B),o.ownerDocument.addEventListener("pointercancel",V)}}),g};var wm={};C(wm,{button:()=>xm,buttonCreate:()=>BS,checkbox:()=>PS,numeric:()=>MS,select:()=>zS,textAreaKeyboard:()=>NS});const NS=e=>{e.addEventListener("keydown",r=>{let i=e.value,o=e.selectionStart,a=e.selectionEnd;if(r.key==="Tab"&&r.shiftKey)return e.value.substring(o-2,o)==="  "&&(e.value=i.slice(0,Math.max(0,o-2))+i.slice(Math.max(0,a))),e.selectionStart=e.selectionEnd=o-2,r.preventDefault(),!1;if(r.key==="Tab")return e.value=i.slice(0,Math.max(0,o))+"  "+i.slice(Math.max(0,a)),e.selectionStart=e.selectionEnd=o+2,r.preventDefault(),!1})},PS=(e,r)=>{let i=U(e);return r&&i.addEventListener("change",()=>{r(i.checked)}),{get checked(){return i.checked},set checked(o){i.checked=o}}},MS=(e,r,i)=>{let o=U(e),a=i?"change":"input";return r&&o.addEventListener(a,()=>{r(Number.parseInt(o.value))}),{get value(){return Number.parseInt(o.value)},set value(n){o.value=n.toString()}}},xm=(e,r)=>{let i=U(e),o=()=>{r&&i.addEventListener("click",r)},a=()=>{r&&i.removeEventListener("click",r)};return o(),{get title(){return i.textContent},set title(n){i.textContent=n},dispose(n=!1){a(),n&&i.remove()},onClick(n){a(),r=n,o()},click(){r&&r()},set disabled(n){i.disabled=n},get el(){return i}}},BS=(e,r)=>{let i=document.createElement("button"),o=xm(i,r);return o.title=e,o},zS=(e,r,i={})=>{let o=U(e),{placeholderOpt:a,shouldAddChoosePlaceholder:n=!1,autoSelectAfterChoice:s=-1}=i,l=()=>{r!==void 0&&r(o.value),s>=0&&(o.selectedIndex=s)};return r&&o.addEventListener("change",u=>{l()}),{set disabled(u){o.disabled=u},get value(){return o.value},get index(){return o.selectedIndex},get isSelectedPlaceholder(){return(n||i.placeholderOpt!==void 0)&&o.selectedIndex===0},setOpts(u,c){o.options.length=0,n?u=["-- Choose --",...u]:a!==void 0&&(u=[a,...u]);let f=0;for(let[d,h]of u.entries()){let p=document.createElement("option");p.value=h,p.innerHTML=h,c!==void 0&&h===c&&(f=d),o.options.add(p)}o.selectedIndex=f},select(u=0,c=!1){o.selectedIndex=u,c&&r&&l()}}};function Em(e){return typeof HTMLElement=="object"?e instanceof HTMLElement:e&&typeof e=="object"&&!!e&&e.nodeType===1&&typeof e.nodeName=="string"}const TS=e=>e.map(r=>{let i;Array.isArray(r)&&(i=r[1],r=r[0]);let o=r.indexOf("-");if(o<0)throw Error("Simple expression expects form of: 'elementid-attribute'");return{variable:r,attribute:r.slice(o+1),id:r.slice(0,o),defaultValue:i}}),OS=(e,...r)=>{let i=U(e),o=window.getComputedStyle(i);for(let a of r){let n=nn(a.variable,"--"),s=o.getPropertyValue(`--${n}`);if(s===null||s.length===0){if(a.defaultValue===void 0)continue;s=a.defaultValue}let l,u;if("query"in a&&a.query!==void 0?l=a.query:"id"in a&&a.id!==void 0?l=`#${a.id}`:"object"in a&&a.object!==void 0&&(u=Array.isArray(a.object)?a.object:[a.object]),l===void 0){if(u===void 0)throw Error("Missing 'query', 'id' or 'object' fields")}else u=[...i.querySelectorAll(l)];if(u!=null)if(a.attribute)for(let c of u)if(Em(c))c.setAttribute(a.attribute,s);else throw Error("Trying to set an attribute on something not a HTML element",{cause:c});else if(a.field)for(let c of u)if(typeof c=="object")c[a.field]=s;else throw Error(`Trying to set field on something that is not an object (${typeof c})`,{cause:c});else throw Error(`Neither 'attribute' or 'field' to set is defined in option (${JSON.stringify(a)})`)}};function jS(e,r){let i=getComputedStyle(r??document.body),o=Object.entries(e),a=o.map(n=>[n[0],Dm(i,n[0],n[1])]);return Object.fromEntries(a)}function RS(e,r){e.startsWith("--")||(e=`--${e}`);let i=getComputedStyle(document.body).getPropertyValue(e).trim();return i.length===0?r:i}function VS(e,r){let i=r===void 0?document.body.style:Em(r)?r.style:r;for(let[o,a]of Object.entries(e)){let n=o.replaceAll("_","-");n.startsWith("--")||(n="--"+n),i.setProperty(n,a.toString())}}function Dm(e,r,i){r.startsWith("--")||(r="--"+r),r=r.replaceAll("_","-");let o=e.getPropertyValue(r);if(o.length===0)return i;if(typeof i=="number")return parseFloat(o);if(typeof i=="boolean"){if(o==="true")return!0;if(o==="false")return!1}return o}const LS=e=>{let r=U(e),i=r.getBoundingClientRect();r instanceof SVGElement&&(r=r.parentElement);let o=uc(r,"borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth");return{x:i.x,y:i.y,width:i.width+o.borderLeftWidth+o.borderRightWidth,height:i.height+o.borderTopWidth+o.borderBottomWidth}},uc=(e,...r)=>{let i=getComputedStyle(U(e)),o={};for(let a of r){let n=i[a];if(typeof n=="string")if(n.endsWith("px"))o[a]=Number.parseFloat(n.substring(0,n.length-2));else throw Error(`Property '${String(a)}' does not end in 'px'. Value: ${n}`);else throw Error(`Property '${String(a)}' is not type string. Got: ${typeof n} Value: ${n}`)}return o},cc=(e,r,i)=>{let o=Zr(e);if(o.length!==0)for(let a of o)r?a.classList.add(i):a.classList.remove(i)},fc=(e,r)=>{let i=Zr(e);if(i.length!==0)for(let o of i)o.classList.toggle(r)},dc=(e,r)=>{let i=Zr(e);if(i.length!==0)for(let o of i)o.style.display=r};var IS=class{dataTable;constructor(e={}){let r=e.theme??"dark";if(document.querySelector("#ixfx-data-display")!==null)throw Error("DataDisplay already loaded on this page");let o=document.createElement("div");o.id="ixfx-data-display",o.classList.add(`theme-${r}`);let a=document.createElement("style");a.textContent=`
    #ixfx-data-display {
      background: white;
      color: black;
      border: 2px solid hsl(0deg 0.61% 90%);
      border-radius: 4px;
      z-index: 1000;
      opacity: 40%;
      padding: 1em;
      font-family: monospace;
      position: fixed;
      right: 1em;
      top: 1em;
    }
    #ixfx-data-display.theme-dark {
      background: black;
      color: white;
      border: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display:hover {
      opacity: 100%;
    }
    #ixfx-data-display table {
      border-collapse: collapse;
    }
    #ixfx-data-display tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 90%);
    }
    #ixfx-data-display.dark tr:not(:last-child) {
      border-bottom: 2px solid hsl(0deg 0.61% 10%);
    }
    #ixfx-data-display td {
      padding-bottom: 0.4em;
      padding-top: 0.4em;
    }
    #ixfx-data-display .label {
      color: hsl(0deg 0.61% 60%);
      text-align: right;
      padding-right: 0.5em;
    }
    #ixfx-data-display.theme-dark .label {
      color: gray;
    }
    `,o.style.display="inline-block",document.body.append(a),document.body.append(o),this.dataTable=Vy(o,void 0,{objectsAsTables:!0,...e})}update(e){this.dataTable.update(e)}};function hc(e,r){return Sn("textContent",e,r)}function pc(e,r){return Sn("innerHTML",e,r)}function Sn(e,r,i){let o=[],a=n=>{let s=typeof n,l=s==="string"||s==="number"||s==="boolean"?n:JSON.stringify(n);o.length===0&&(o=Zr(r));for(let u of o)u[e]=l;return l};return i===void 0?a:a(i)}const qS=e=>{let r=Zr(e),i=hc(r),o=pc(r);return{text:i,html:o,cssDisplay:a=>{dc(r,a)},cssClass:(a,n)=>{cc(r,a,n)},cssToggle:a=>{fc(r,a)},el:()=>r[0],els:()=>r}},_S=e=>({text:r=>hc(e,r),html:r=>pc(e,r),cssDisplay:r=>{dc(e,r)},cssClass:(r,i)=>{cc(e,r,i)},cssToggle:r=>{fc(e,r)},el:()=>U(e),els:()=>Zr(e)});var Cm={};C(Cm,{fromPoints:()=>WS,init:()=>$m});const WS=(e,r={})=>{let i=Io(...e);return $m(i.map(o=>Qt(o)),r)},$m=(e,r={})=>{let i=r.maxDistanceFromLine??.1;return a=>{let n=e.map((u,c)=>{let f=u.nearest(a),d=X(a,f);return{positionRelative:u.relativePosition(f,i),path:u,index:c,nearest:f,distance:d,rank:9007199254740991}}),s=n.filter(u=>u.distance<=i),l=ko(s,"distance");for(let u=0;u<l.length;u++)l[u].rank=u;return l}},GS=Object.freeze({a:{x:0,y:0},b:{x:0,y:0},c:{x:0,y:0}}),US=Object.freeze({a:{x:NaN,y:NaN},b:{x:NaN,y:NaN},c:{x:NaN,y:NaN}}),Ea=(e,r=10,i=Math.PI/2)=>{e||=Object.freeze({x:0,y:0});let o=il(e,r,Math.PI- -i/2),a=il(e,r,Math.PI-i/2);return{a:o,b:e,c:a}},JS=(e,r,i={})=>{let o=i.tailLength??10,a=i.tailThickness??Math.max(o/5,5),n=i.angleRadian??0,s=i.arrowSize??Math.max(o/5,15),l=Math.PI/2,u,c;if(r==="tip")u=Ea(e,s,l),c=Vr(gr({x:u.a.x-o,y:e.y-a/2},o,a));else if(r==="middle"){let d=o+s/2,h=a/2;u=Ea({x:e.x+s*1.2,y:e.y},s,l),c=Vr(gr({x:e.x-d,y:e.y-h},o+s,a))}else c=Vr(gr({x:e.x,y:e.y-a/2},o,a)),u=Ea({x:e.x+o+s*.7,y:e.y},s,l);return Pt([c[0],c[1],u.a,u.b,u.c,c[2],c[3]],n,e)},fd=Math.PI*2,Am=(e,r={})=>{let i=ye(e)?e:{x:0,y:0},o=r.strategy??"uniform",a=r.margin??0,n=e.radius-a,s=r.randomSource??Math.random;switch(o){case"naive":return Xe(i,Ue(s()*n,s()*fd));case"uniform":return Xe(i,Ue(Math.sqrt(s())*n,s()*fd));default:throw Error(`Unknown strategy '${o}'. Expects 'uniform' or 'naive'`)}},Sm=e=>ye(e)?Object.freeze({x:e.x,y:e.y}):Object.freeze({x:e.radius,y:e.radius}),pt=(e,r="t")=>{if(e===void 0)throw Error("{$name} undefined");O(e.a,r+".a"),O(e.b,r+".b"),O(e.c,r+".c")},Fm=e=>{if(e===void 0)return!1;let r=e;return!(!R(r.a)||!R(r.b)||!R(r.c))},HS=e=>ci(e.a)&&ci(e.b)&&ci(e.c),KS=e=>Rr(e.a)&&Rr(e.b)&&Rr(e.c),QS=(e,r)=>kt(e.a,r.a)&&kt(e.b,r.b)&&kt(e.c,r.c),Uo=e=>{pt(e);let r=mm([e.a,e.b,e.c],(o,a)=>({x:o.x+a.x,y:o.y+a.y}));return{x:r.x/3,y:r.y/3}},km=(e,r={})=>{if(ye(e))return Am(e,r);if(xt(e))return hg(e,r);throw Error("Unknown shape. Only CirclePositioned and RectPositioned are supported.")},ZS=e=>{if(e===void 0)return Object.freeze({x:.5,y:.5});if(nt(e))return wn(e);if(Fm(e))return Uo(e);if(Ai(e))return Sm(e);throw Error(`Unknown shape: ${JSON.stringify(e)}`)},Nm=(e,r,i)=>{let o=Hu(e,r);if(Ai(r))return o<Math.abs(e.radius-r.radius);if(R(r))return i===void 0?o<=e.radius:o<Math.abs(e.radius-i);throw Error("b parameter is expected to be CirclePositioned or Point")},yc=(e,r,i)=>kt(e,r)||Nm(e,r,i)?!0:Ai(r)?ud(e,r):xt(r)?Uy(e,r):R(r)&&i!==void 0?ud(e,{...r,radius:i}):!1,Pm=(e,r)=>{if(ye(e))return yc(e,r);if(xt(e))return Jy(e,r);throw Error(`a or b are unknown shapes. a: ${JSON.stringify(e)} b: ${JSON.stringify(r)}`)},XS=(e,r=5,i,o=ee,a)=>{w(G(r,"positive","points"));let n=Math.PI*2/r,s=n/2,l=a?.initialAngleRadian??-Math.PI/2;i===void 0&&(i=e/2);let u=l,c=[];for(let f=0;f<r;f++){let d=Ue(e,u,o),h=Ue(i,u-s,o),p=Ue(i,u+s,o);c.push(h,d),f+1<r&&c.push(p),u+=n}return c};var Mm={};C(Mm,{arrow:()=>JS,center:()=>ZS,isIntersecting:()=>Pm,randomPoint:()=>km,starburst:()=>XS});var Bm={};C(Bm,{random:()=>YS});const YS=(e,r,i={})=>{if(!Array.isArray(e))throw Error("Parameter 'circles' is not an array");let o=i.attempts??2e3,a=ko(e,"radius"),n=[],s=(l,u)=>n.some(c=>yc(c,l,u));for(;a.length>0;){let l=a.pop();if(!l)break;let u={...i,margin:{x:l.radius,y:l.radius}};for(let c=0;c<o;c++){let f=km(r,u);if(!s(f,l.radius)){n.push(Object.freeze({...l,...f}));break}}}return n};var zm={};C(zm,{CirclePacking:()=>Bm});const eF=e=>(jo(e),Math.PI*e.radius*e.radius),Tm=e=>ye(e)?Ky(e,e.radius*2,e.radius*2):{width:e.radius*2,height:e.radius*2,x:0,y:0};function*tF(e){let{x:r,y:i,radius:o}=e,a=o,n=0,s=1-r;for(;a>=n;)yield{x:a+r,y:n+i},yield{x:n+r,y:a+i},yield{x:-a+r,y:n+i},yield{x:-n+r,y:a+i},yield{x:-a+r,y:-n+i},yield{x:-n+r,y:-a+i},yield{x:a+r,y:-n+i},yield{x:n+r,y:-a+i},n++,s<0?s+=2*n+1:(a--,s+=2*(n-a+1))}function*rF(e){let r=e.x-e.radius,i=e.x+e.radius,o=e.y-e.radius,a=e.y+e.radius;for(let n=r;n<i;n++)for(let s=o;s<a;s++)Math.abs(X(e,n,s))<=e.radius&&(yield{x:n,y:s})}const iF=Math.PI*2,Om=(e,r)=>{let i=o=>{let a=Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),n=o.x+o.radius*((r.x-o.x)/a),s=o.y+o.radius*((r.y-o.y)/a);return{x:n,y:s}};if(Array.isArray(e)){let o=e.map(n=>i(n)),a=o.map(n=>X(n,r));return Object.freeze(o[gu(...a)])}else return Object.freeze(i(e))},jm=(e,r,i)=>(i===void 0&&(i=ye(e)?e:{x:0,y:0}),{x:Math.cos(-r)*e.radius+i.x,y:Math.sin(-r)*e.radius+i.y}),gc=e=>(jo(e),iF*e.radius),oF=e=>gc(e),aF=Math.PI*2,Rm=(e,r)=>jm(e,r*aF);function nF(e,r){if(ye(e)){let i=vt(e,r);return Object.freeze({...e,...i,radius:e.radius*r})}else return Object.freeze({...e,radius:e.radius*r})}const Vm=(e,r,i)=>{if(Ai(e)){if(i!==void 0)return gs(e.radius,i,r);if(ye(e))return gs(e.radius,e,r);throw Error("origin parameter needed for non-positioned circle")}else{if(i===void 0)throw Error("origin parameter needed");return gs(e,i,r)}},gs=(e,r,i)=>{let{x:o,y:a}=r,n=i?"1":"0";return`
    M ${o}, ${a}
    m -${e}, 0
    a ${e},${e} 0 1,${n} ${e*2},0
    a ${e},${e} 0 1,${n} -${e*2},0
  `.split(`
`)},sF=e=>(jo(e),{...e,nearest:r=>Om(e,r),interpolate:r=>Rm(e,r),bbox:()=>Tm(e),length:()=>gc(e),toSvgString:(r=!0)=>Vm(e,r),relativePosition:(r,i)=>{throw Error("Not implemented")},distanceToPoint:r=>{throw Error("Not implemented")},kind:"circular"}),mc=(e,r,i)=>{if(ye(e))return e;let o=Be(r,i);return Object.freeze({...e,...o})};var Lm={};C(Lm,{area:()=>eF,bbox:()=>Tm,center:()=>Sm,circumference:()=>gc,distanceCenter:()=>Hu,distanceFromExterior:()=>Ku,exteriorIntegerPoints:()=>tF,guard:()=>jo,guardPositioned:()=>La,interiorIntegerPoints:()=>rF,interpolate:()=>Rm,intersectionLine:()=>$$,intersections:()=>Gy,isCircle:()=>Ai,isCirclePositioned:()=>ye,isContainedBy:()=>Nm,isEqual:()=>Wy,isIntersecting:()=>yc,isNaN:()=>C$,isPositioned:()=>_y,length:()=>oF,multiplyScalar:()=>nF,nearest:()=>Om,pointOnPerimeter:()=>jm,randomPoint:()=>Am,toPath:()=>sF,toPositioned:()=>mc,toSvg:()=>Vm});const Fi=e=>e.quadratic!==void 0,Fn=e=>e.cubic1!==void 0&&e.cubic2!==void 0,Im=function(e){if(Fi(e)||jt(e))return e.a;throw Error(`Unknown path type ${JSON.stringify(e)}`)},ol=function(e){if(Fi(e)||jt(e))return e.b;throw Error(`Unknown path type ${JSON.stringify(e)}`)};var qm={};C(qm,{bbox:()=>xc,computeDimensions:()=>Jo,distanceToPoint:()=>vc,fromPaths:()=>$c,guardContinuous:()=>Dc,interpolate:()=>bc,relativePosition:()=>wc,setSegment:()=>_m,toString:()=>Ec,toSvgString:()=>Cc});const _m=(e,r,i)=>{let o=[...e.segments];return o[r]=i,$c(...o)},bc=(e,r,i,o)=>{o===void 0&&(o=Jo(e));let a=r*(i?o.totalWidth:o.totalLength),n=0,s=i?o.widths:o.lengths;for(let[l,u]of s.entries())if(n+u>=a){let c=a-n,f=c/u;return f>1&&(f=1),e[l].interpolate(f)}else n+=u;return{x:0,y:0}},vc=(e,r)=>{if(e.length===0)return 0;let i=e.map((o,a)=>({path:o,index:a,distance:o.distanceToPoint(r)}));if(i=ko(i,"distance"),i.length===0)throw Error("Could not look up distances");return i[0].distance},wc=(e,r,i,o)=>{o===void 0&&(o=Jo(e));let a=e.map((c,f)=>({path:c,index:f,distance:c.distanceToPoint(r)}));if(a=ko(a,"distance"),a.length<0)throw Error("Point does not intersect with path");let n=a[0];if(n.distance>i)throw Error(`Point does not intersect with path. Minimum distance: ${n.distance}, threshold: ${i}`);let s=n.path.relativePosition(r,i),l=0;for(let c=0;c<n.index;c++)l+=o.lengths[c];l+=o.lengths[n.index]*s;let u=l/o.totalLength;return console.log(`acc: ${l} rel: ${u} on path: ${s} path: ${n.index}`),u},Jo=e=>{let r=e.map(n=>n.bbox().width),i=e.map(n=>n.length()),o=0,a=0;for(let n of i)o+=n;for(let n of r)a+=n;return{totalLength:o,totalWidth:a,widths:r,lengths:i}},xc=e=>{let r=e.map(o=>o.bbox()),i=r.flatMap(o=>Vr(o));return _o(...i)},Ec=e=>e.map(r=>r.toString()).join(", "),Dc=e=>{let r=ol(e[0]);for(let i=1;i<e.length;i++){let o=Im(e[i]);if(!kt(o,r))throw Error(`Path index ${i} does not start at prior path end. Start: ${o.x},${o.y} expected: ${r.x},${r.y}`);r=ol(e[i])}},Cc=e=>e.flatMap(r=>r.toSvgString()),$c=(...e)=>{Dc(e);let r=Jo(e);return Object.freeze({segments:e,length:()=>r.totalLength,nearest:i=>{throw Error("not implemented")},interpolate:(i,o=!1)=>bc(e,i,o,r),relativePosition:(i,o)=>wc(e,i,o,r),distanceToPoint:i=>vc(e,i),bbox:()=>xc(e),toString:()=>Ec(e),toSvgString:()=>Cc(e),kind:"compound"})};var Wm={};C(Wm,{bbox:()=>xc,computeDimensions:()=>Jo,distanceToPoint:()=>vc,fromPaths:()=>$c,getEnd:()=>ol,getStart:()=>Im,guardContinuous:()=>Dc,interpolate:()=>bc,relativePosition:()=>wc,setSegment:()=>_m,toString:()=>Ec,toSvgString:()=>Cc});const Gm=(e,r)=>!(r.x<0||r.y<0||r.x>=e.cols||r.y>=e.rows),lF=e=>e===void 0?!1:"x"in e&&"y"in e,Ot=(e,r="Param",i)=>{if(e===void 0)throw Error(r+" is undefined. Expecting {x,y}");if(e.x===void 0)throw Error(r+".x is undefined");if(e.y===void 0)throw Error(r+".y is undefined");if(Number.isNaN(e.x))throw Error(r+".x is NaN");if(Number.isNaN(e.y))throw Error(r+".y is NaN");if(!Number.isInteger(e.x))throw TypeError(r+".x is non-integer");if(!Number.isInteger(e.y))throw TypeError(r+".y is non-integer");if(i!==void 0&&!Gm(i,e))throw Error(`${r} is outside of grid. Cell: ${e.x},${e.y} Grid: ${i.cols}, ${i.rows}`)},Xr=(e,r="Param")=>{if(e===void 0)throw Error(`${r} is undefined. Expecting grid.`);if(!("rows"in e))throw Error(`${r}.rows is undefined`);if(!("cols"in e))throw Error(`${r}.cols is undefined`);if(!Number.isInteger(e.rows))throw TypeError(`${r}.rows is not an integer`);if(!Number.isInteger(e.cols))throw TypeError(`${r}.cols is not an integer`)},Ho=function(e,r,i="undefined"){Xr(e,"grid"),Ot(r,"cell");let o=r.x,a=r.y;switch(i){case"wrap":o%=e.cols,a%=e.rows,o<0?o=e.cols+o:o>=e.cols&&(o-=e.cols),a<0?a=e.rows+a:a>=e.rows&&(a-=e.rows),o=Math.abs(o),a=Math.abs(a);break;case"stop":o=Bs(o,e.cols),a=Bs(a,e.rows);break;case"undefined":if(o<0||a<0||o>=e.cols||a>=e.rows)return;break;case"unbounded":break;default:throw Error(`Unknown BoundsLogic '${i}'. Expected: wrap, stop, undefined or unbounded`)}return Object.freeze({x:o,y:a})};var Um={};C(Um,{access:()=>Jm,createArray:()=>Ym,createMutable:()=>fF,set:()=>cF,setMutate:()=>Km,wrap:()=>Xm,wrapMutable:()=>Zm});const Jm=(e,r)=>{let i=Ko(e,r);return(a,n="undefined")=>Hm(i,e,a,n)},Hm=(e,r,i,o)=>{let a=Pi(e,i,o);if(a!==void 0)return r[a]},Km=(e,r)=>{let i=Ko(e,r);return(o,a,n="undefined")=>uF(i,e,o,a,n)},uF=(e,r,i,o,a)=>{let n=Pi(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);return r[n]=i,r},cF=(e,r)=>{let i=Ko(e,r);return(o,a,n)=>Qm(i,e,o,a,n)},Qm=(e,r,i,o,a)=>{let n=Pi(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);let s=[...r];return s[n]=i,r=s,s},Ko=(e,r)=>({cols:r,rows:Math.ceil(e.length/r)}),Zm=(e,r)=>({...Ko(e,r),get:Jm(e,r),set:Km(e,r),get array(){return e}}),Xm=(e,r)=>{let i=Ko(e,r);return{...i,get:(o,a="undefined")=>Hm(i,e,o,a),set:(o,a,n="undefined")=>(e=Qm(i,e,o,a,n),Xm(e,r)),get array(){return e}}},Ym=(e,r,i)=>{let o=typeof r=="number"?r:r.rows,a=typeof r=="object"?r.cols:i;if(!a)throw Error("Parameter 'columns' missing");w(G(o,"aboveZero","rows"),G(a,"aboveZero","cols"));let n=[],s=o*a;for(let l=0;l<s;l++)n[l]=e;return n},fF=(e,r,i)=>{let o=typeof r=="number"?r:r.rows,a=typeof r=="object"?r.cols:i;if(!a)throw Error("Parameter 'columns' missing");let n=Ym(e,o,a);return Zm(n,a)};var eb={};C(eb,{access:()=>rb,create:()=>ki,set:()=>pF,setMutate:()=>tb,wrap:()=>ab,wrapMutable:()=>hF});const ki=e=>{let r=NaN;for(let i of e)if(Number.isNaN(r))r=i.length;else if(r!==i.length)throw Error("Array does not have uniform column length");return{rows:e.length,cols:r}},tb=e=>{let r=ki(e);return(i,o,a="undefined")=>dF(r,e,i,o,a)},dF=(e,r,i,o,a)=>{let n=Ho(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);return r[n.y][n.x]=i,r},rb=e=>{let r=ki(e);return(o,a="undefined")=>ib(r,e,o,a)},ib=(e,r,i,o)=>{let a=Ho(e,i,o);if(a!==void 0)return r[a.y][a.x]},hF=e=>({...ki(e),get:rb(e),set:tb(e),get array(){return e}}),pF=e=>{let r=ki(e);return(i,o,a)=>ob(r,e,i,o,a)},ob=(e,r,i,o,a)=>{let n=Ho(e,o,a);if(n===void 0)throw RangeError(`Cell (${o.x},${o.y}) is out of range of grid cols: ${e.cols} rows: ${e.rows}`);let s=[...r],l=[...s[n.y]];return l[n.x]=i,s[n.y]=l,r=s,s},ab=e=>{let r=ki(e);return{...r,get:(i,o="undefined")=>ib(r,e,i,o),set:(i,o,a="undefined")=>(e=ob(r,e,i,o,a),ab(e)),get array(){return e}}};function*nb(e,r){for(let i of r)Array.isArray(i)?yield i.map(o=>e.get(o,"undefined")):yield e.get(i,"undefined")}function*Ni(e,r,i=!0){r||={x:0,y:0},Xr(e,"grid"),Ot(r,"start",e);let{x:o,y:a}=r,n=!0;do yield{x:o,y:a},o++,o===e.cols&&(a++,o=0),a===e.rows&&(i?(a=0,o=0):n=!1),o===r.x&&a===r.y&&(n=!1);while(n)}function*yF(e,r,i=!0){yield*nb(e,Ni(e,r,i))}function*gF(e,r,i=!0){for(let o of Ni(e,r,i))yield{cell:o,value:e.get(o)}}var sb={};C(sb,{columns:()=>mF,rows:()=>lb});const lb=function*(e,r){r||={x:0,y:0};let i=r.y,o=[];for(let a of Ni(e,r))a.y===i?o.push(a):(yield o,o=[a],i=a.y);o.length>0&&(yield o)};function*mF(e,r){r||={x:0,y:0};for(let i=r.x;i<e.cols;i++){let o=[];for(let a=r.y;a<e.rows;a++)o.push({x:i,y:a});yield o}}const kn=function(e,r,i,o="undefined"){return Ho(e,{x:r.x+i.x,y:r.y+i.y},o)},Nn=Object.freeze(["n","ne","nw","e","s","se","sw","w"]),ub=Object.freeze(["n","e","s","w"]),bF=(e,r,i,o="stop")=>{Xr(e,"grid"),Ot(r,"start"),w(G(i,"aboveZero","steps"));let a=Nn,n=a.map(l=>Ac(l,i)),s=a.map((l,u)=>kn(e,r,n[u],o));return Po(a,s)},Ac=(e,r=1)=>{let i;switch(e){case"n":i={x:0,y:-1*r};break;case"ne":i={x:1*r,y:-1*r};break;case"e":i={x:1*r,y:0};break;case"se":i={x:1*r,y:1*r};break;case"s":i={x:0,y:1*r};break;case"sw":i={x:-1*r,y:1*r};break;case"w":i={x:-1*r,y:0};break;case"nw":i={x:-1*r,y:-1*r};break;default:i={x:0,y:0}}return Object.freeze(i)};var cb={};C(cb,{cellValues:()=>yF,cells:()=>Ni,cellsAndValues:()=>gF});const vF=(e,r)=>{Ot(e),Ot(r);let i=e.x,o=e.y,a=Math.abs(r.x-i),n=Math.abs(r.y-o),s=i<r.x?1:-1,l=o<r.y?1:-1,u=a-n,c=[];for(;c.push(Object.freeze({x:i,y:o})),!(i===r.x&&o===r.y);){let f=2*u;f>-n&&(u-=n,i+=s),f<a&&(u+=a,o+=l)}return c},wF=function(e,r,i=!1){let o=[];if(e.x===r.x){let a=i?r.y+1:r.y;for(let n=e.y;n<a;n++)o.push({x:e.x,y:n})}else if(e.y===r.y){let a=i?r.x+1:r.x;for(let n=e.x;n<a;n++)o.push({x:n,y:e.y})}else throw Error(`Only does vertical and horizontal: ${e.x},${e.y} - ${r.x},${r.y}`);return o},Pi=(e,r,i)=>{if(Xr(e,"grid"),r.x<0)switch(i){case"stop":r={...r,x:0};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r=kn(e,{x:0,y:r.y},{x:r.x,y:0},"wrap");break}if(r.y<0)switch(i){case"stop":r={...r,y:0};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,y:e.rows+r.y};break}if(r.x>=e.cols)switch(i){case"stop":r={...r,x:e.cols-1};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,x:r.x%e.cols};break}if(r.y>=e.rows)switch(i){case"stop":r={...r,y:e.rows-1};break;case"unbounded":throw Error("unbounded not supported");case"undefined":return;case"wrap":r={...r,y:r.y%e.rows};break}return r.y*e.cols+r.x},xF=(e,r)=>{let i=0;return i=typeof e=="number"?e:e.cols,w(G(i,"aboveZero","colsOrGrid")),{x:r%i,y:Math.floor(r/i)}},EF=(e,r)=>{if(r===void 0||e===void 0)return!1;if("rows"in e&&"cols"in e)if("rows"in r&&"cols"in r){if(e.rows!==r.rows||e.cols!==r.cols)return!1}else return!1;if("size"in e)if("size"in r){if(e.size!==r.size)return!1}else return!1;return!0},fb=(e,r)=>r===void 0||e===void 0?!1:e.x===r.x&&e.y===r.y,Sc=e=>ig(e),DF=e=>!(e===void 0||e[1]===void 0),Fc=(e,r,i,o)=>{let a=db(e,r,o,i);return Object.entries(a).filter(s=>DF(s))},db=(e,r,i="undefined",o)=>{let a=o??Nn,n=a.map(s=>kn(e,r,Ac(s),i));return Po(a,n)},CF=(e,r)=>{let i=[];for(let o=0;o<e.rows;o++)if(i[o]=Array.from({length:e.cols}),r)for(let a=0;a<e.cols;a++)i[o][a]=r;return i},hb=e=>`Cell{${e.x},${e.y}}`;function*$F(e){for(let r of Ni(e))yield pb(e,r)}const AF=(e,r)=>{let i=e.size;if(w($(i,"positive","grid.size")),r.x<0||r.y<0)return;let o=Math.floor(r.x/i),a=Math.floor(r.y/i);if(!(o>=e.cols)&&!(a>=e.rows))return{x:o,y:a}},pb=(e,r)=>{Ot(r);let i=e.size,o=r.x*i,a=r.y*i;return gr({x:o,y:a},i,i)},SF=(e,r)=>{Ot(r);let i=e.size,o=r.x*i,a=r.y*i;return Object.freeze({x:o+i/2,y:a+i/2})},yb=()=>({select:e=>e[0]}),gb=()=>({select:e=>e.at(0),getNeighbours:(e,r)=>Fc(e,r,Nn,"undefined")}),mb=(e={})=>{let r=e.reversed??!1;return{select:i=>i.find(o=>o[0]===(r?"n":"s")),getNeighbours:(i,o)=>(o=r?o.y>0?{x:o.x,y:o.y-1}:o.x===0?{x:i.cols-1,y:i.rows-1}:{x:o.x-1,y:i.rows-1}:o.y<i.rows-1?{x:o.x,y:o.y+1}:o.x<i.cols-1?{x:o.x+1,y:0}:{x:0,y:0},[[r?"n":"s",o]])}},bb=()=>({select:e=>e.at(-1)}),vb=()=>({getNeighbours:(e,r)=>{let i=[];for(let o of Ni(e,r))i.push(["n",o]);return i},select:Sc}),wb=()=>({select:Sc}),xb=(e={})=>{let r=e.reversed??!1;return{select:i=>i.find(o=>o[0]===(r?"w":"e")),getNeighbours:(i,o)=>(o=r?o.x>0?{x:o.x-1,y:o.y}:o.y>0?{x:i.cols-1,y:o.y-1}:{x:i.cols-1,y:i.rows-1}:o.x<i.rows-1?{x:o.x+1,y:o.y}:o.y<i.rows-1?{x:0,y:o.y+1}:{x:0,y:0},[[r?"w":"e",o]])}};function*Eb(e,r,i={}){Xr(r,"grid");let o=i.start??{x:0,y:0};Ot(o,"opts.start",r);let a=i.visited??g0(hb),n=e.getNeighbours??((c,f)=>Fc(c,f,ub,"undefined")),s=[o],l=[],u;for(;s.length>0;){if(u===void 0){let c=s.pop();if(c===void 0)break;u=c}if(!a.has(u)){a.add(u),yield u;let c=n(r,u).filter(f=>f[1]===void 0?!1:!a.has(f[1]));if(c.length===0)u!==void 0&&(s=s.filter(f=>fb(f,u)));else for(let f of c)f===void 0||f[1]===void 0||l.push(f)}if(l=l.filter(c=>!a.has(c[1])),l.length===0)u=void 0;else{let c=e.select(l);c!==void 0&&(s.push(c[1]),u=c[1])}}}const FF=(e,r,i={x:0,y:0},o=1)=>{Xr(e,"grid"),Ot(i,"start"),w(G(o,"","resolution"));let a=[],n=0,s=0;for(let l of r(e,{start:i,boundsWrap:"undefined"}))n++,n%o===0&&a.push(l);return(l,u=!1)=>(w(G(l,"","step")),u?s=l:s+=l,a.at(s%a.length))};var Db={};C(Db,{breadthLogic:()=>yb,columnLogic:()=>mb,create:()=>kF,depthLogic:()=>bb,neighboursLogic:()=>gb,randomContiguousLogic:()=>wb,randomLogic:()=>vb,rowLogic:()=>xb,stepper:()=>FF,visitByNeighbours:()=>Eb,withLogic:()=>pr});const kF=(e,r={})=>{switch(e){case"random-contiguous":return pr(wb(),r);case"random":return pr(vb(),r);case"depth":return pr(bb(),r);case"breadth":return pr(yb(),r);case"neighbours":return pr(gb(),r);case"row":return pr(xb(r),r);case"column":return pr(mb(r),r);default:throw TypeError(`Param 'type' unknown. Value: ${e}`)}},pr=(e,r={})=>(i,o={})=>Eb(e,i,{...r,...o});var Cb={};C(Cb,{Array1d:()=>Um,Array2d:()=>eb,As:()=>sb,By:()=>cb,Visit:()=>Db,allDirections:()=>Nn,applyBounds:()=>Ho,asRectangles:()=>$F,cellAtPoint:()=>AF,cellEquals:()=>fb,cellFromIndex:()=>xF,cellKeyString:()=>hb,cellMiddle:()=>SF,crossDirections:()=>ub,getLine:()=>vF,getVectorFromCardinal:()=>Ac,guardCell:()=>Ot,guardGrid:()=>Xr,indexFromCell:()=>Pi,inside:()=>Gm,isCell:()=>lF,isEqual:()=>EF,neighbourList:()=>Fc,neighbours:()=>db,offset:()=>kn,offsetCardinals:()=>bF,randomNeighbour:()=>Sc,rectangleForCell:()=>pb,simpleLine:()=>wF,toArray2d:()=>CF,values:()=>nb});const{abs:Ji,cos:Gt,sin:oi,acos:NF,atan2:Hi,sqrt:dr,pow:rt}=Math;function Ki(e){return e<0?-rt(-e,1/3):rt(e,1/3)}const $b=Math.PI,pa=2*$b,hr=$b/2,PF=1e-6,ms=2**53-1,bs=-9007199254740991,MF={x:0,y:0,z:0},S={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(e,r){let i=r(e),o=i.x*i.x+i.y*i.y;return i.z!==void 0&&(o+=i.z*i.z),dr(o)},compute:function(e,r,i){if(e===0)return r[0].t=0,r[0];let o=r.length-1;if(e===1)return r[o].t=1,r[o];let a=1-e,n=r;if(o===0)return r[0].t=e,r[0];if(o===1){let l={x:a*n[0].x+e*n[1].x,y:a*n[0].y+e*n[1].y,t:e};return i&&(l.z=a*n[0].z+e*n[1].z),l}if(o<4){let l=a*a,u=e*e,c,f,d,h=0;o===2?(n=[n[0],n[1],n[2],MF],c=l,f=a*e*2,d=u):o===3&&(c=l*a,f=l*e*3,d=a*u*3,h=e*u);let p={x:c*n[0].x+f*n[1].x+d*n[2].x+h*n[3].x,y:c*n[0].y+f*n[1].y+d*n[2].y+h*n[3].y,t:e};return i&&(p.z=c*n[0].z+f*n[1].z+d*n[2].z+h*n[3].z),p}let s=JSON.parse(JSON.stringify(r));for(;s.length>1;){for(let l=0;l<s.length-1;l++)s[l]={x:s[l].x+(s[l+1].x-s[l].x)*e,y:s[l].y+(s[l+1].y-s[l].y)*e},s[l].z!==void 0&&(s[l].z=s[l].z+(s[l+1].z-s[l].z)*e);s.splice(s.length-1,1)}return s[0].t=e,s[0]},computeWithRatios:function(e,r,i,o){let a=1-e,n=i,s=r,l=n[0],u=n[1],c=n[2],f=n[3],d;if(l*=a,u*=e,s.length===2)return d=l+u,{x:(l*s[0].x+u*s[1].x)/d,y:(l*s[0].y+u*s[1].y)/d,z:o?(l*s[0].z+u*s[1].z)/d:!1,t:e};if(l*=a,u*=2*a,c*=e*e,s.length===3)return d=l+u+c,{x:(l*s[0].x+u*s[1].x+c*s[2].x)/d,y:(l*s[0].y+u*s[1].y+c*s[2].y)/d,z:o?(l*s[0].z+u*s[1].z+c*s[2].z)/d:!1,t:e};if(l*=a,u*=1.5*a,c*=3*a,f*=e*e*e,s.length===4)return d=l+u+c+f,{x:(l*s[0].x+u*s[1].x+c*s[2].x+f*s[3].x)/d,y:(l*s[0].y+u*s[1].y+c*s[2].y+f*s[3].y)/d,z:o?(l*s[0].z+u*s[1].z+c*s[2].z+f*s[3].z)/d:!1,t:e}},derive:function(e,r){let i=[];for(let o=e,a=o.length,n=a-1;a>1;a--,n--){let s=[];for(let l=0,u;l<n;l++)u={x:n*(o[l+1].x-o[l].x),y:n*(o[l+1].y-o[l].y)},r&&(u.z=n*(o[l+1].z-o[l].z)),s.push(u);i.push(s),o=s}return i},between:function(e,r,i){return r<=e&&e<=i||S.approximately(e,r)||S.approximately(e,i)},approximately:function(e,r,i){return Ji(e-r)<=(i||PF)},length:function(e){let r=.5,i=S.Tvalues.length,o=0;for(let a=0,n;a<i;a++)n=r*S.Tvalues[a]+r,o+=S.Cvalues[a]*S.arcfn(n,e);return r*o},map:function(e,r,i,o,a){let n=i-r,s=a-o,l=e-r,u=l/n;return o+s*u},lerp:function(e,r,i){let o={x:r.x+e*(i.x-r.x),y:r.y+e*(i.y-r.y)};return r.z!==void 0&&i.z!==void 0&&(o.z=r.z+e*(i.z-r.z)),o},pointToString:function(e){let r=e.x+"/"+e.y;return e.z!==void 0&&(r+="/"+e.z),r},pointsToString:function(e){return"["+e.map(S.pointToString).join(", ")+"]"},copy:function(e){return JSON.parse(JSON.stringify(e))},angle:function(e,r,i){let o=r.x-e.x,a=r.y-e.y,n=i.x-e.x,s=i.y-e.y,l=o*s-a*n,u=o*n+a*s;return Hi(l,u)},round:function(e,r){let i=""+e,o=i.indexOf(".");return parseFloat(i.substring(0,o+1+r))},dist:function(e,r){let i=e.x-r.x,o=e.y-r.y;return dr(i*i+o*o)},closest:function(e,r){let i=rt(2,63),o,a;return e.forEach(function(n,s){a=S.dist(r,n),a<i&&(i=a,o=s)}),{mdist:i,mpos:o}},abcratio:function(e,r){if(r!==2&&r!==3)return!1;if(e===void 0)e=.5;else if(e===0||e===1)return e;let i=rt(e,r)+rt(1-e,r),o=i-1;return Ji(o/i)},projectionratio:function(e,r){if(r!==2&&r!==3)return!1;if(e===void 0)e=.5;else if(e===0||e===1)return e;let i=rt(1-e,r),o=rt(e,r)+i;return i/o},lli8:function(e,r,i,o,a,n,s,l){let u=(e*o-r*i)*(a-s)-(e-i)*(a*l-n*s),c=(e*o-r*i)*(n-l)-(r-o)*(a*l-n*s),f=(e-i)*(n-l)-(r-o)*(a-s);return f==0?!1:{x:u/f,y:c/f}},lli4:function(e,r,i,o){let a=e.x,n=e.y,s=r.x,l=r.y,u=i.x,c=i.y,f=o.x,d=o.y;return S.lli8(a,n,s,l,u,c,f,d)},lli:function(e,r){return S.lli4(e,e.c,r,r.c)},makeline:function(e,r){return new mo(e.x,e.y,(e.x+r.x)/2,(e.y+r.y)/2,r.x,r.y)},findbbox:function(e){let r=ms,i=ms,o=bs,a=bs;return e.forEach(function(n){let s=n.bbox();r>s.x.min&&(r=s.x.min),i>s.y.min&&(i=s.y.min),o<s.x.max&&(o=s.x.max),a<s.y.max&&(a=s.y.max)}),{x:{min:r,mid:(r+o)/2,max:o,size:o-r},y:{min:i,mid:(i+a)/2,max:a,size:a-i}}},shapeintersections:function(e,r,i,o,a){if(!S.bboxoverlap(r,o))return[];let n=[],s=[e.startcap,e.forward,e.back,e.endcap],l=[i.startcap,i.forward,i.back,i.endcap];return s.forEach(function(u){u.virtual||l.forEach(function(c){if(c.virtual)return;let f=u.intersects(c,a);f.length>0&&(f.c1=u,f.c2=c,f.s1=e,f.s2=i,n.push(f))})}),n},makeshape:function(e,r,i){let o=r.points.length,a=e.points.length,n=S.makeline(r.points[o-1],e.points[0]),s=S.makeline(e.points[a-1],r.points[0]),l={startcap:n,forward:e,back:r,endcap:s,bbox:S.findbbox([n,e,r,s])};return l.intersections=function(u){return S.shapeintersections(l,l.bbox,u,u.bbox,i)},l},getminmax:function(e,r,i){if(!i)return{min:0,max:0};let o=ms,a=bs,n,s;i.indexOf(0)===-1&&(i=[0].concat(i)),i.indexOf(1)===-1&&i.push(1);for(let l=0,u=i.length;l<u;l++)n=i[l],s=e.get(n),s[r]<o&&(o=s[r]),s[r]>a&&(a=s[r]);return{min:o,mid:(o+a)/2,max:a,size:a-o}},align:function(e,r){let i=r.p1.x,o=r.p1.y,a=-Hi(r.p2.y-o,r.p2.x-i),n=function(s){return{x:(s.x-i)*Gt(a)-(s.y-o)*oi(a),y:(s.x-i)*oi(a)+(s.y-o)*Gt(a)}};return e.map(n)},roots:function(e,r){r||={p1:{x:0,y:0},p2:{x:1,y:0}};let i=e.length-1,o=S.align(e,r),a=function(N){return 0<=N&&N<=1};if(i===2){let N=o[0].y,P=o[1].y,k=o[2].y,te=N-2*P+k;if(te!==0){let le=-dr(P*P-N*k),ve=-N+P,He=-(le+ve)/te,J=-(-le+ve)/te;return[He,J].filter(a)}else if(P!==k&&te===0)return[(2*P-k)/(2*P-2*k)].filter(a);return[]}let n=o[0].y,s=o[1].y,l=o[2].y,u=o[3].y,c=-n+3*s-3*l+u,f=3*n-6*s+3*l,d=-3*n+3*s,h=n;if(S.approximately(c,0)){if(S.approximately(f,0))return S.approximately(d,0)?[]:[-h/d].filter(a);let N=dr(d*d-4*f*h),P=2*f;return[(N-d)/P,(-d-N)/P].filter(a)}f/=c,d/=c,h/=c;let p=(3*d-f*f)/3,y=p/3,g=(2*f*f*f-9*f*d+27*h)/27,m=g/2,v=m*m+y*y*y,D,B,V,x,F;if(v<0){let N=-p/3,P=N*N*N,k=dr(P),te=-g/(2*k),le=te<-1?-1:te>1?1:te,ve=NF(le),He=Ki(k),J=2*He;return V=J*Gt(ve/3)-f/3,x=J*Gt((ve+pa)/3)-f/3,F=J*Gt((ve+2*pa)/3)-f/3,[V,x,F].filter(a)}else{if(v===0)return D=m<0?Ki(-m):-Ki(m),V=2*D-f/3,x=-D-f/3,[V,x].filter(a);{let N=dr(v);return D=Ki(-m+N),B=Ki(m+N),[D-B-f/3].filter(a)}}},droots:function(e){if(e.length===3){let r=e[0],i=e[1],o=e[2],a=r-2*i+o;if(a!==0){let n=-dr(i*i-r*o),s=-r+i,l=-(n+s)/a,u=-(-n+s)/a;return[l,u]}else if(i!==o&&a===0)return[(2*i-o)/(2*(i-o))];return[]}if(e.length===2){let r=e[0],i=e[1];return r===i?[]:[r/(r-i)]}return[]},curvature:function(e,r,i,o,a){let n,s,l,u,c=0,f=0,d=S.compute(e,r),h=S.compute(e,i),p=d.x*d.x+d.y*d.y;if(o?(n=dr(rt(d.y*h.z-h.y*d.z,2)+rt(d.z*h.x-h.z*d.x,2)+rt(d.x*h.y-h.x*d.y,2)),s=rt(p+d.z*d.z,3/2)):(n=d.x*h.y-d.y*h.x,s=rt(p,3/2)),n===0||s===0)return{k:0,r:0};if(c=n/s,f=s/n,!a){let y=S.curvature(e-.001,r,i,o,!0).k,g=S.curvature(e+.001,r,i,o,!0).k;u=(g-c+(c-y))/2,l=(Ji(g-c)+Ji(c-y))/2}return{k:c,r:f,dk:u,adk:l}},inflections:function(e){if(e.length<4)return[];let r=S.align(e,{p1:e[0],p2:e.slice(-1)[0]}),i=r[2].x*r[1].y,o=r[3].x*r[1].y,a=r[1].x*r[2].y,n=r[3].x*r[2].y,s=18*(-3*i+2*o+3*a-n),l=18*(3*i-o-3*a),u=18*(a-i);if(S.approximately(s,0)){if(!S.approximately(l,0)){let h=-u/l;if(0<=h&&h<=1)return[h]}return[]}let c=2*s;if(S.approximately(c,0))return[];let f=l*l-4*s*u;if(f<0)return[];let d=Math.sqrt(f);return[(d-l)/c,-(l+d)/c].filter(function(h){return 0<=h&&h<=1})},bboxoverlap:function(e,r){let i=["x","y"],o=i.length;for(let a=0,n,s,l,u;a<o;a++)if(n=i[a],s=e[n].mid,l=r[n].mid,u=(e[n].size+r[n].size)/2,Ji(s-l)>=u)return!1;return!0},expandbox:function(e,r){r.x.min<e.x.min&&(e.x.min=r.x.min),r.y.min<e.y.min&&(e.y.min=r.y.min),r.z&&r.z.min<e.z.min&&(e.z.min=r.z.min),r.x.max>e.x.max&&(e.x.max=r.x.max),r.y.max>e.y.max&&(e.y.max=r.y.max),r.z&&r.z.max>e.z.max&&(e.z.max=r.z.max),e.x.mid=(e.x.min+e.x.max)/2,e.y.mid=(e.y.min+e.y.max)/2,e.z&&(e.z.mid=(e.z.min+e.z.max)/2),e.x.size=e.x.max-e.x.min,e.y.size=e.y.max-e.y.min,e.z&&(e.z.size=e.z.max-e.z.min)},pairiteration:function(e,r,i){let o=e.bbox(),a=r.bbox(),n=1e5,s=i||.5;if(o.x.size+o.y.size<s&&a.x.size+a.y.size<s)return[(n*(e._t1+e._t2)/2|0)/n+"/"+(n*(r._t1+r._t2)/2|0)/n];let l=e.split(.5),u=r.split(.5),c=[{left:l.left,right:u.left},{left:l.left,right:u.right},{left:l.right,right:u.right},{left:l.right,right:u.left}];c=c.filter(function(d){return S.bboxoverlap(d.left.bbox(),d.right.bbox())});let f=[];return c.length===0||(c.forEach(function(d){f=f.concat(S.pairiteration(d.left,d.right,s))}),f=f.filter(function(d,h){return f.indexOf(d)===h})),f},getccenter:function(e,r,i){let o=r.x-e.x,a=r.y-e.y,n=i.x-r.x,s=i.y-r.y,l=o*Gt(hr)-a*oi(hr),u=o*oi(hr)+a*Gt(hr),c=n*Gt(hr)-s*oi(hr),f=n*oi(hr)+s*Gt(hr),d=(e.x+r.x)/2,h=(e.y+r.y)/2,p=(r.x+i.x)/2,y=(r.y+i.y)/2,g=d+l,m=h+u,v=p+c,D=y+f,B=S.lli8(d,h,g,m,p,y,v,D),V=S.dist(B,e),x=Hi(e.y-B.y,e.x-B.x),F=Hi(r.y-B.y,r.x-B.x),N=Hi(i.y-B.y,i.x-B.x),P;return x<N?((x>F||F>N)&&(x+=pa),x>N&&(P=N,N=x,x=P)):N<F&&F<x?(P=N,N=x,x=P):N+=pa,B.s=x,B.e=N,B.r=V,B},numberSort:function(e,r){return e-r}};var vs=class Ab{constructor(r){this.curves=[],this._3d=!1,r&&(this.curves=r,this._3d=this.curves[0]._3d)}valueOf(){return this.toString()}toString(){return"["+this.curves.map(function(r){return S.pointsToString(r.points)}).join(", ")+"]"}addCurve(r){this.curves.push(r),this._3d=this._3d||r._3d}length(){return this.curves.map(function(r){return r.length()}).reduce(function(r,i){return r+i})}curve(r){return this.curves[r]}bbox(){let r=this.curves;for(var i=r[0].bbox(),o=1;o<r.length;o++)S.expandbox(i,r[o].bbox());return i}offset(r){let i=[];return this.curves.forEach(function(o){i.push(...o.offset(r))}),new Ab(i)}};const{abs:Qi,min:dd,max:hd,cos:BF,sin:zF,acos:TF,sqrt:Zi}=Math,OF=Math.PI;var mo=class he{constructor(r){let i=r&&r.forEach?r:Array.from(arguments).slice(),o=!1;if(typeof i[0]=="object"){o=i.length;let p=[];i.forEach(function(y){["x","y","z"].forEach(function(g){y[g]!==void 0&&p.push(y[g])})}),i=p}let a=!1,n=i.length;if(o){if(o>4){if(arguments.length!==1)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");a=!0}}else if(n!==6&&n!==8&&n!==9&&n!==12&&arguments.length!==1)throw Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");let s=this._3d=!a&&(n===9||n===12)||r&&r[0]&&r[0].z!==void 0,l=this.points=[];for(let p=0,y=s?3:2;p<n;p+=y){var u={x:i[p],y:i[p+1]};s&&(u.z=i[p+2]),l.push(u)}let c=this.order=l.length-1,f=this.dims=["x","y"];s&&f.push("z"),this.dimlen=f.length;let d=S.align(l,{p1:l[0],p2:l[c]}),h=S.dist(l[0],l[c]);this._linear=d.reduce((p,y)=>p+Qi(y.y),0)<h/50,this._lut=[],this._t1=0,this._t2=1,this.update()}static quadraticFromPoints(r,i,o,a){if(a===void 0&&(a=.5),a===0)return new he(i,i,o);if(a===1)return new he(r,i,i);let n=he.getABC(2,r,i,o,a);return new he(r,n.A,o)}static cubicFromPoints(r,i,o,a,n){a===void 0&&(a=.5);let s=he.getABC(3,r,i,o,a);n===void 0&&(n=S.dist(i,s.C));let l=n*(1-a)/a,u=S.dist(r,o),c=(o.x-r.x)/u,f=(o.y-r.y)/u,d=n*c,h=n*f,p=l*c,y=l*f,g={x:i.x-d,y:i.y-h},m={x:i.x+p,y:i.y+y},v=s.A,D={x:v.x+(g.x-v.x)/(1-a),y:v.y+(g.y-v.y)/(1-a)},B={x:v.x+(m.x-v.x)/a,y:v.y+(m.y-v.y)/a},V={x:r.x+(D.x-r.x)/a,y:r.y+(D.y-r.y)/a},x={x:o.x+(B.x-o.x)/(1-a),y:o.y+(B.y-o.y)/(1-a)};return new he(r,V,x,o)}static getUtils(){return S}getUtils(){return he.getUtils()}static get PolyBezier(){return vs}valueOf(){return this.toString()}toString(){return S.pointsToString(this.points)}toSVG(){if(this._3d)return!1;let r=this.points,i=r[0].x,o=r[0].y,a=["M",i,o,this.order===2?"Q":"C"];for(let n=1,s=r.length;n<s;n++)a.push(r[n].x),a.push(r[n].y);return a.join(" ")}setRatios(r){if(r.length!==this.points.length)throw Error("incorrect number of ratio values");this.ratios=r,this._lut=[]}verify(){let r=this.coordDigest();r!==this._print&&(this._print=r,this.update())}coordDigest(){return this.points.map(function(r,i){return""+i+r.x+r.y+(r.z?r.z:0)}).join("")}update(){this._lut=[],this.dpoints=S.derive(this.points,this._3d),this.computedirection()}computedirection(){let r=this.points,i=S.angle(r[0],r[this.order],r[1]);this.clockwise=i>0}length(){return S.length(this.derivative.bind(this))}static getABC(r=2,i,o,a,n=.5){let s=S.projectionratio(n,r),l=1-s,u={x:s*i.x+l*a.x,y:s*i.y+l*a.y},c=S.abcratio(n,r);return{A:{x:o.x+(o.x-u.x)/c,y:o.y+(o.y-u.y)/c},B:o,C:u,S:i,E:a}}getABC(r,i){i||=this.get(r);let o=this.points[0],a=this.points[this.order];return he.getABC(this.order,o,i,a,r)}getLUT(r){if(this.verify(),r||=100,this._lut.length===r+1)return this._lut;this._lut=[],r++,this._lut=[];for(let i=0,o,a;i<r;i++)a=i/(r-1),o=this.compute(a),o.t=a,this._lut.push(o);return this._lut}on(r,i){i||=5;let o=this.getLUT(),a=[];for(let n=0,s,l=0;n<o.length;n++)s=o[n],S.dist(s,r)<i&&(a.push(s),l+=n/o.length);return a.length?t/=a.length:!1}project(r){let i=this.getLUT(),o=i.length-1,a=S.closest(i,r),n=a.mpos,s=(n-1)/o,l=(n+1)/o,u=.1/o,c=a.mdist,f=s,d=f,h;c+=1;for(let p;f<l+u;f+=u)h=this.compute(f),p=S.dist(r,h),p<c&&(c=p,d=f);return d=d<0?0:d>1?1:d,h=this.compute(d),h.t=d,h.d=c,h}get(r){return this.compute(r)}point(r){return this.points[r]}compute(r){return this.ratios?S.computeWithRatios(r,this.points,this.ratios,this._3d):S.compute(r,this.points,this._3d,this.ratios)}raise(){let r=this.points,i=[r[0]],o=r.length;for(let a=1,n,s;a<o;a++)n=r[a],s=r[a-1],i[a]={x:(o-a)/o*n.x+a/o*s.x,y:(o-a)/o*n.y+a/o*s.y};return i[o]=r[o-1],new he(i)}derivative(r){return S.compute(r,this.dpoints[0],this._3d)}dderivative(r){return S.compute(r,this.dpoints[1],this._3d)}align(){let r=this.points;return new he(S.align(r,{p1:r[0],p2:r[r.length-1]}))}curvature(r){return S.curvature(r,this.dpoints[0],this.dpoints[1],this._3d)}inflections(){return S.inflections(this.points)}normal(r){return this._3d?this.__normal3(r):this.__normal2(r)}__normal2(r){let i=this.derivative(r),o=Zi(i.x*i.x+i.y*i.y);return{t:r,x:-i.y/o,y:i.x/o}}__normal3(r){let i=this.derivative(r),o=this.derivative(r+.01),a=Zi(i.x*i.x+i.y*i.y+i.z*i.z),n=Zi(o.x*o.x+o.y*o.y+o.z*o.z);i.x/=a,i.y/=a,i.z/=a,o.x/=n,o.y/=n,o.z/=n;let s={x:o.y*i.z-o.z*i.y,y:o.z*i.x-o.x*i.z,z:o.x*i.y-o.y*i.x},l=Zi(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=l,s.y/=l,s.z/=l;let u=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{t:r,x:u[0]*i.x+u[1]*i.y+u[2]*i.z,y:u[3]*i.x+u[4]*i.y+u[5]*i.z,z:u[6]*i.x+u[7]*i.y+u[8]*i.z}}hull(r){let i=this.points,o=[],a=[],n=0;for(a[n++]=i[0],a[n++]=i[1],a[n++]=i[2],this.order===3&&(a[n++]=i[3]);i.length>1;){o=[];for(let s=0,l,u=i.length-1;s<u;s++)l=S.lerp(r,i[s],i[s+1]),a[n++]=l,o.push(l);i=o}return a}split(r,i){if(r===0&&i)return this.split(i).left;if(i===1)return this.split(r).right;let o=this.hull(r),a={left:this.order===2?new he([o[0],o[3],o[5]]):new he([o[0],o[4],o[7],o[9]]),right:this.order===2?new he([o[5],o[4],o[2]]):new he([o[9],o[8],o[6],o[3]]),span:o};return a.left._t1=S.map(0,0,1,this._t1,this._t2),a.left._t2=S.map(r,0,1,this._t1,this._t2),a.right._t1=S.map(r,0,1,this._t1,this._t2),a.right._t2=S.map(1,0,1,this._t1,this._t2),i?(i=S.map(i,r,1,0,1),a.right.split(i).left):a}extrema(){let r={},i=[];return this.dims.forEach((function(o){let a=function(s){return s[o]},n=this.dpoints[0].map(a);r[o]=S.droots(n),this.order===3&&(n=this.dpoints[1].map(a),r[o]=r[o].concat(S.droots(n))),r[o]=r[o].filter(function(s){return s>=0&&s<=1}),i=i.concat(r[o].sort(S.numberSort))}).bind(this)),r.values=i.sort(S.numberSort).filter(function(o,a){return i.indexOf(o)===a}),r}bbox(){let r=this.extrema(),i={};return this.dims.forEach((function(o){i[o]=S.getminmax(this,o,r[o])}).bind(this)),i}overlaps(r){let i=this.bbox(),o=r.bbox();return S.bboxoverlap(i,o)}offset(r,i){if(i!==void 0){let o=this.get(r),a=this.normal(r),n={c:o,n:a,x:o.x+a.x*i,y:o.y+a.y*i};return this._3d&&(n.z=o.z+a.z*i),n}if(this._linear){let o=this.normal(0),a=this.points.map(function(n){let s={x:n.x+r*o.x,y:n.y+r*o.y};return n.z&&o.z&&(s.z=n.z+r*o.z),s});return[new he(a)]}return this.reduce().map(function(o){return o._linear?o.offset(r)[0]:o.scale(r)})}simple(){if(this.order===3){let a=S.angle(this.points[0],this.points[3],this.points[1]),n=S.angle(this.points[0],this.points[3],this.points[2]);if(a>0&&n<0||a<0&&n>0)return!1}let r=this.normal(0),i=this.normal(1),o=r.x*i.x+r.y*i.y;return this._3d&&(o+=r.z*i.z),Qi(TF(o))<OF/3}reduce(){let r,i=0,o=0,a=.01,n,s=[],l=[],u=this.extrema().values;for(u.indexOf(0)===-1&&(u=[0].concat(u)),u.indexOf(1)===-1&&u.push(1),i=u[0],r=1;r<u.length;r++)o=u[r],n=this.split(i,o),n._t1=i,n._t2=o,s.push(n),i=o;return s.forEach(function(c){for(i=0,o=0;o<=1;)for(o=i+a;o<=1+a;o+=a)if(n=c.split(i,o),!n.simple()){if(o-=a,Qi(i-o)<a)return[];n=c.split(i,o),n._t1=S.map(i,0,1,c._t1,c._t2),n._t2=S.map(o,0,1,c._t1,c._t2),l.push(n),i=o;break}i<1&&(n=c.split(i,1),n._t1=S.map(i,0,1,c._t1,c._t2),n._t2=c._t2,l.push(n))}),l}translate(r,i,o){o=typeof o=="number"?o:i;let a=this.order,n=this.points.map((s,l)=>(1-l/a)*i+l/a*o);return new he(this.points.map((s,l)=>({x:s.x+r.x*n[l],y:s.y+r.y*n[l]})))}scale(r){let i=this.order,o=!1;if(typeof r=="function"&&(o=r),o&&i===2)return this.raise().scale(o);let a=this.clockwise,n=this.points;if(this._linear)return this.translate(this.normal(0),o?o(0):r,o?o(1):r);let s=o?o(0):r,l=o?o(1):r,u=[this.offset(0,10),this.offset(1,10)],c=[],f=S.lli4(u[0],u[0].c,u[1],u[1].c);if(!f)throw Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(d){let h=c[d*i]=S.copy(n[d*i]);h.x+=(d?l:s)*u[d].n.x,h.y+=(d?l:s)*u[d].n.y}),o?([0,1].forEach(function(d){if(!(i===2&&d)){var h=n[d+1],p={x:h.x-f.x,y:h.y-f.y},y=o?o((d+1)/i):r;o&&!a&&(y=-y);var g=Zi(p.x*p.x+p.y*p.y);p.x/=g,p.y/=g,c[d+1]={x:h.x+y*p.x,y:h.y+y*p.y}}}),new he(c)):([0,1].forEach(d=>{if(i===2&&d)return;let h=c[d*i],p=this.derivative(d),y={x:h.x+p.x,y:h.y+p.y};c[d+1]=S.lli4(h,y,f,n[d+1])}),new he(c))}outline(r,i,o,a){if(i=i===void 0?r:i,this._linear){let x=this.normal(0),F=this.points[0],N=this.points[this.points.length-1],P,k,te;o===void 0&&(o=r,a=i),P={x:F.x+x.x*r,y:F.y+x.y*r},te={x:N.x+x.x*o,y:N.y+x.y*o},k={x:(P.x+te.x)/2,y:(P.y+te.y)/2};let le=[P,k,te];P={x:F.x-x.x*i,y:F.y-x.y*i},te={x:N.x-x.x*a,y:N.y-x.y*a},k={x:(P.x+te.x)/2,y:(P.y+te.y)/2};let ve=[te,k,P],He=S.makeline(ve[2],le[0]),J=S.makeline(le[2],ve[0]),Oe=[He,new he(le),J,new he(ve)];return new vs(Oe)}let n=this.reduce(),s=n.length,l=[],u=[],c,f=0,d=this.length(),h=o!==void 0&&a!==void 0;function p(x,F,N,P,k){return function(te){let le=P/N,ve=(P+k)/N,He=F-x;return S.map(te,0,1,x+le*He,x+ve*He)}}n.forEach(function(x){let F=x.length();h?(l.push(x.scale(p(r,o,d,f,F))),u.push(x.scale(p(-i,-a,d,f,F)))):(l.push(x.scale(r)),u.push(x.scale(-i))),f+=F}),u=u.map(function(x){return c=x.points,c[3]?x.points=[c[3],c[2],c[1],c[0]]:x.points=[c[2],c[1],c[0]],x}).reverse();let y=l[0].points[0],g=l[s-1].points[l[s-1].points.length-1],m=u[s-1].points[u[s-1].points.length-1],v=u[0].points[0],D=S.makeline(m,y),B=S.makeline(g,v),V=[D].concat(l,[B],u);return new vs(V)}outlineshapes(r,i,o){i||=r;let a=this.outline(r,i).curves,n=[];for(let s=1,l=a.length;s<l/2;s++){let u=S.makeshape(a[s],a[l-s],o);u.startcap.virtual=s>1,u.endcap.virtual=s<l/2-1,n.push(u)}return n}intersects(r,i){return r?r.p1&&r.p2?this.lineIntersects(r):(r instanceof he&&(r=r.reduce()),this.curveintersects(this.reduce(),r,i)):this.selfintersects(i)}lineIntersects(r){let i=dd(r.p1.x,r.p2.x),o=dd(r.p1.y,r.p2.y),a=hd(r.p1.x,r.p2.x),n=hd(r.p1.y,r.p2.y);return S.roots(this.points,r).filter(s=>{var l=this.get(s);return S.between(l.x,i,a)&&S.between(l.y,o,n)})}selfintersects(r){let i=this.reduce(),o=i.length-2,a=[];for(let n=0,s,l,u;n<o;n++)l=i.slice(n,n+1),u=i.slice(n+2),s=this.curveintersects(l,u,r),a.push(...s);return a}curveintersects(r,i,o){let a=[];r.forEach(function(s){i.forEach(function(l){s.overlaps(l)&&a.push({left:s,right:l})})});let n=[];return a.forEach(function(s){let l=S.pairiteration(s.left,s.right,o);l.length>0&&(n=n.concat(l))}),n}arcs(r){return r||=.5,this._iterate(r,[])}_error(r,i,o,a){let n=(a-o)/4,s=this.get(o+n),l=this.get(a-n),u=S.dist(r,i),c=S.dist(r,s),f=S.dist(r,l);return Qi(c-u)+Qi(f-u)}_iterate(r,i){let o=0,a=1,n;do{n=0,a=1;let s=this.get(o),l,u,c,f,d=!1,h=!1,p,y=a,g=1;do if(h=d,f=c,y=(o+a)/2,l=this.get(y),u=this.get(a),c=S.getccenter(s,l,u),c.interval={start:o,end:a},d=this._error(c,s,o,a)<=r,p=h&&!d,p||(g=a),d){if(a>=1){if(c.interval.end=g=1,f=c,a>1){let v={x:c.x+c.r*BF(c.e),y:c.y+c.r*zF(c.e)};c.e+=S.angle({x:c.x,y:c.y},v,this.get(1))}break}a+=(a-o)/2}else a=y;while(!p&&n++<100);if(n>=100)break;f||=c,i.push(f),o=g}while(a<1);return i}},Sb={};C(Sb,{cubic:()=>Nb,interpolator:()=>Fb,isCubicBezier:()=>Fn,isQuadraticBezier:()=>Fi,quadratic:()=>Pb,quadraticSimple:()=>Da,quadraticToSvgString:()=>kb,toPath:()=>Ca});const Da=(e,r,i=0)=>{if(Number.isNaN(i))throw Error("bend is NaN");if(i<-1||i>1)throw Error("Expects bend range of -1 to 1");let o=Tt(.5,e,r),a=o;a=r.y<e.y?i>0?{x:Math.min(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.max(e.x,r.x),y:Math.max(e.y,r.y)}:i>0?{x:Math.max(e.x,r.x),y:Math.min(e.y,r.y)}:{x:Math.min(e.x,r.x),y:Math.max(e.y,r.y)};let n=Tt(Math.abs(i),o,a);return Pb(e,r,n)},Fb=e=>{let r=Fn(e)?new mo(e.a.x,e.a.y,e.cubic1.x,e.cubic1.y,e.cubic2.x,e.cubic2.y,e.b.x,e.b.y):new mo(e.a,e.quadratic,e.b);return i=>r.compute(i)},kb=(e,r,i)=>[`M ${e.x} ${e.y} Q ${i.x} ${i.y} ${r.x} ${r.y}`],Ca=e=>{if(Fn(e))return jF(e);if(Fi(e))return RF(e);throw Error("Unknown bezier type")},Nb=(e,r,i,o)=>({a:Object.freeze(e),b:Object.freeze(r),cubic1:Object.freeze(i),cubic2:Object.freeze(o)}),jF=e=>{let{a:r,cubic1:i,cubic2:o,b:a}=e,n=new mo(r,i,o,a);return Object.freeze({...e,length:()=>n.length(),interpolate:s=>n.compute(s),nearest:s=>{throw Error("not implemented")},bbox:()=>{let{x:s,y:l}=n.bbox(),u=s.size,c=l.size;if(u===void 0||c===void 0)throw Error("x.size not present on calculated bbox");return gr({x:s.min,y:l.min},u,c)},relativePosition:(s,l)=>{throw Error("Not implemented")},distanceToPoint:s=>{throw Error("Not implemented")},toSvgString:()=>["brrup"],kind:"bezier/cubic"})},Pb=(e,r,i)=>({a:Object.freeze(e),b:Object.freeze(r),quadratic:Object.freeze(i)}),RF=e=>{let{a:r,b:i,quadratic:o}=e,a=new mo(r,o,i);return Object.freeze({...e,length:()=>a.length(),interpolate:n=>a.compute(n),nearest:n=>{throw Error("not implemented")},bbox:()=>{let{x:n,y:s}=a.bbox(),l=n.size,u=s.size;if(l===void 0||u===void 0)throw Error("x.size not present on calculated bbox");return gr({x:n.min,y:s.min},l,u)},distanceToPoint:n=>{throw Error("Not implemented")},relativePosition:(n,s)=>{throw Error("Not implemented")},toString:()=>a.toString(),toSvgString:()=>kb(r,i,o),kind:"bezier/quadratic"})};var Mb={};C(Mb,{fromDegrees:()=>VF});const VF=(e,r,i=0,o=0,a=360)=>({radiusX:e,radiusY:r,rotation:st(i),startAngle:st(o),endAngle:st(a)});var Bb={};C(Bb,{rdpPerpendicularDistance:()=>nl,rdpShortestDistance:()=>al});const al=(e,r=.1)=>{let i=e[0],o=e.at(-1);if(e.length<3)return e;let a=-1,n=0;for(let s=1;s<e.length-1;s++){let l=IF(e[s],i,o);l>n&&(n=l,a=s)}if(n>r){let s=e.slice(0,a+1),l=e.slice(a),u=al(s,r),c=al(l,r);return[...u.slice(0,-1),...c]}else return[i,o]},nl=(e,r=.1)=>{let i=e[0],o=e.at(-1);if(e.length<3)return e;let a=-1,n=0;for(let s=1;s<e.length-1;s++){let l=LF(e[s],i,o);l>n&&(n=l,a=s)}if(n>r){let s=e.slice(0,a+1),l=e.slice(a),u=nl(s,r),c=nl(l,r);return[...u.slice(0,-1),...c]}else return[i,o]};function LF(e,r,i){let o,a,n;return r.x==i.x?o=Math.abs(e.x-r.x):(a=(i.y-r.y)/(i.x-r.x),n=r.y-a*r.x,o=Math.abs(a*e.x-e.y+n)/Math.sqrt(a**2+1)),o}const IF=(e,r,i)=>{let o=X(r,i);if(o==0)return X(e,r);let a=((e.x-r.x)*(i.x-r.x)+(e.y-r.y)*(i.y-r.y))/o;return a<0?X(e,r):a>1?X(e,i):X(e,{x:r.x+a*(i.x-r.x),y:r.y+a*(i.y-r.y)})};var zb={};C(zb,{Direction:()=>Tb,QuadTreeNode:()=>Ob,quadTree:()=>qF});var Tb;(function(e){e[e.Nw=0]="Nw",e[e.Ne=1]="Ne",e[e.Sw=2]="Sw",e[e.Se=3]="Se"})(Tb||={});const qF=(e,r=[],i={})=>{let o={maxItems:i.maxItems??4,maxLevels:i.maxLevels??4},a=new Ob(void 0,e,0,o);for(let n of r)a.add(n);return a};var Ob=class jb{boundary;level;opts;#e=[];#t=[];#r;constructor(r,i,o,a){this.boundary=i,this.level=o,this.opts=a,this.#r=r}getLengthChildren(){return this.#t.length}*parents(){let r=this;for(;r.#r!==void 0;)yield r.#r,r=r.#r}getParent(){return this.#r}*children(){for(let r of this.#t)yield r}getValue(){return this.#e}getIdentity(){return this}direction(r){return this.#t[r]}add(r){if(!Pm(this.boundary,r))return!1;if(this.#t.length>0){for(let i of this.#t)i.add(r);return!0}if(this.#e.push(r),this.#e.length>this.opts.maxItems&&this.level<this.opts.maxLevels){this.#t.length===0&&this.#i();for(let i of this.#e)for(let o of this.#t)o.add(i);this.#e=[]}return!0}couldHold(r){return Vo(this.boundary,r)}#i(){let r=this.boundary.width/2,i=this.boundary.height/2,o=this.boundary.x,a=this.boundary.y,n=Qu(o+r,a,o,a,o,a+i,o+r,a+i),s=n.map(l=>gr(l,r,i));this.#t=s.map(l=>new jb(this,l,this.level+1,this.opts))}};const oo=(e="both",r)=>{let i=r??eg,o=1,a=1,n={x:1,y:1},s=()=>{switch(e){case"height":return{x:a,y:a};case"width":return{x:o,y:o};case"min":return{x:Math.min(o,a),y:Math.min(o,a)};case"max":return{x:Math.max(o,a),y:Math.max(o,a)};default:return{x:o,y:a}}},l=(d,h,p,y)=>{let g=NaN,m=NaN,v=i.width,D=i.height;if(typeof d=="number")if(g=d,typeof h=="number"){if(m=h,p===void 0)return[g,m,v,D];if(nt(p))v=p.width,D=p.height;else if(typeof p=="number")if(v=p,typeof y=="number")D=y;else throw TypeError("Missing final height value");else throw Error("Missing valid output range")}else if(nt(h))v=h.width,D=h.height;else throw Error("Expected input y or output Rect to follow first number parameter");else if(R(d)){if(g=d.x,m=d.y,h===void 0)return[g,m,v,D];if(nt(h))v=h.width,D=h.height;else if(typeof h=="number")if(v=h,typeof p=="number")D=p;else throw TypeError("Expected height as third parameter after Point and output width");else throw TypeError("Expected Rect or width as second parameter when first parameter is a Point")}else throw Error("Expected input Point or x value as first parameter");return[g,m,v,D]},u=(d,h,p,y)=>{let g=l(d,h,p,y);return f(!0,...g)},c=(d,h,p,y)=>{let g=l(d,h,p,y);return f(!1,...g)},f=(d,h,p,y,g)=>{if(Number.isNaN(y))throw Error("Output width range missing");if(Number.isNaN(g))throw Error("Output height range missing");return(y!==o||g!==a)&&(o=y,a=g,n=s()),d?{x:h*n.x,y:p*n.y}:{x:h/n.x,y:p/n.y}};return{computeScale:s,rel:c,abs:u,width:i.width,height:i.height}};var Rb={};C(Rb,{angularSize:()=>Ib,bbox:()=>Wb,distanceCenter:()=>JF,fromCircle:()=>qb,fromCircleAmount:()=>UF,fromDegrees:()=>_F,getStartEnd:()=>WF,guard:()=>Pn,interpolate:()=>kc,isArc:()=>Vb,isEqual:()=>HF,isPositioned:()=>Yt,length:()=>_b,point:()=>hi,toLine:()=>Lb,toPath:()=>GF,toSvg:()=>Gb});const Vb=e=>e.startRadian!==void 0&&e.endRadian!==void 0&&e.clockwise!==void 0,Yt=e=>e.x!==void 0&&e.y!==void 0;function _F(e,r,i,o,a){let n={radius:e,startRadian:st(r),endRadian:st(i),clockwise:o};if(R(a)){O(a);let s={...n,x:a.x,y:a.y};return Object.freeze(s)}else return Object.freeze(n)}const Lb=e=>Lo(hi(e,e.startRadian),hi(e,e.endRadian)),WF=(e,r)=>{Pn(e);let i=hi(e,e.startRadian,r),o=hi(e,e.endRadian,r);return[i,o]},hi=(e,r,i)=>(i===void 0&&(i=Yt(e)?e:{x:0,y:0}),{x:Math.cos(r)*e.radius+i.x,y:Math.sin(r)*e.radius+i.y}),Pn=e=>{if(e===void 0)throw TypeError("Arc is undefined");if(Yt(e)&&O(e,"arc"),e.radius===void 0)throw TypeError(`Arc radius is undefined (${JSON.stringify(e)})`);if(typeof e.radius!="number")throw TypeError("Radius must be a number");if(Number.isNaN(e.radius))throw TypeError("Radius is NaN");if(e.radius<=0)throw TypeError("Radius must be greater than zero");if(e.startRadian===void 0||e.endRadian===void 0)throw TypeError("Arc is missing 'startRadian' field");if(Number.isNaN(e.endRadian)||Number.isNaN(e.startRadian))throw TypeError("Arc endRadian is NaN");if(e.clockwise===void 0)throw TypeError("Arc is missing 'clockwise field");if(e.startRadian>=e.endRadian)throw TypeError("startRadian is expected to be les than endRadian")},kc=(e,r,i,o)=>{if(Pn(r),!(i??!1)){if(e<0)throw Error("Param 'amount' is under zero, and overflow is not allowed");if(e>1)throw Error("Param 'amount' is above 1 and overflow is not allowed")}let n=Ib(r),s=n*e,l=$n(r.startRadian,s,r.clockwise);return hi(r,l,o)},Ib=e=>rc(e.startRadian,e.endRadian,e.clockwise),GF=e=>(Pn(e),Object.freeze({...e,nearest:r=>{throw Error("not implemented")},interpolate:r=>kc(r,e),bbox:()=>Wb(e),length:()=>_b(e),toSvgString:()=>Gb(e),relativePosition:(r,i)=>{throw Error("Not implemented")},distanceToPoint:r=>{throw Error("Not implemented")},kind:"arc"})),qb=(e,r,i,o=!0)=>Object.freeze({...e,endRadian:i,startRadian:r,clockwise:o}),UF=(e,r,i,o=!0)=>{let a=$n(r,i,o);return qb(e,r,a)},_b=e=>Ze*e.radius*((e.startRadian-e.endRadian)/Ze),Wb=e=>{if(Yt(e)){let r=kc(.5,e),i=Lb(e);return _o(r,i.a,i.b)}else return{width:e.radius*2,height:e.radius*2}},Gb=(e,r,i,o,a)=>{if(Vb(e))return Yt(e)?R(r)?Xi(r,e.radius,e.startRadian,e.endRadian,i):Xi(e,e.radius,e.startRadian,e.endRadian,r):R(r)?Xi(r,e.radius,e.startRadian,e.endRadian,i):Xi({x:0,y:0},e.radius,e.startRadian,e.endRadian);if(i===void 0)throw Error("startAngle undefined");if(o===void 0)throw Error("endAngle undefined");if(R(e)){if(typeof r=="number"&&typeof i=="number"&&typeof o=="number")return Xi(e,r,i,o,a);throw TypeError("Expected (point, number, number, number). Missing a number param.")}else throw Error("Expected (point, number, number, number). Missing first point.")},Xi=(e,r,i,o,a)=>{(a===void 0||typeof a!="object")&&(a={});let n=o-i===360,s=Ue(r,o-.01,e),l=Ue(r,i,e),{largeArc:u=!1,sweep:c=!1}=a,f=[`
    M ${s.x} ${s.y}
    A ${r} ${r} 0 ${u?"1":"0"} ${c?"1":"0"} ${l.x} ${l.y},
  `];return n&&f.push("z"),f},JF=(e,r)=>X(e,r),HF=(e,r)=>{if(e.radius!==r.radius||e.endRadian!==r.endRadian||e.startRadian!==r.startRadian||e.clockwise!==r.clockwise)return!1;if(Yt(e)&&Yt(r)){if(e.x!==r.x||e.y!==r.y||e.z!==r.z)return!1}else if(!(!Yt(e)&&!Yt(r)))return!1;return!0};var Ub={};C(Ub,{circleRings:()=>tk,circleVogelSpiral:()=>ek,sphereFibonacci:()=>rk});const Nc=Math.cos,Pc=Math.sin,KF=Math.asin,Mc=Math.sqrt,QF=Math.pow,Bc=Math.PI,ZF=Math.PI*2,XF=Bc*(3-Mc(5)),YF=(1+Mc(5))/2;function*ek(e,r={}){let i=r.maxPoints??5e3,o=r.density??.95,a=r.rotation??0,n=mc(e??{radius:1,x:0,y:0}),s=n.radius,l=n.radius*ft(o,0,1,.3,.01);r.spacing&&(l=r.spacing);let u=0,c=0,f=0;for(;c<i&&u<s;)u=l*c**.5,f=a+c*2*Bc/YF,yield Object.freeze({x:n.x+u*Nc(f),y:n.y+u*Pc(f)}),c++}function*tk(e,r={}){let i=r.rings??5,o=mc(e??{radius:1,x:0,y:0}),a=1/i,n=r.rotation??0,s=1;yield Object.freeze({x:o.x,y:o.y});for(let l=a;l<=1;l+=a){let u=Math.round(Bc/KF(1/(2*s)));for(let c of Ap(0,ZF,u+1))yield Object.freeze({x:o.x+l*Nc(c+n)*o.radius,y:o.y+l*Pc(c+n)*o.radius});s++}}function*rk(e=100,r=0,i){let o=2/e,a=i??{x:0,y:0,z:0,radius:1};for(let n=0;n<e;n++){let s=n*o-1+o/2,l=Mc(1-QF(s,2)),u=(n+1)%e*XF+r,c=Nc(u)*l,f=Pc(u)*l;yield Object.freeze({x:a.x+c*a.radius,y:a.y+s*a.radius,z:a.z+f*a.radius})}}const Qo=e=>(pt(e),[Nt(e.a,e.b),Nt(e.b,e.c),Nt(e.c,e.a)]),ik=e=>(pt(e),Si(Qo(e))),Mn=e=>(pt(e),Io(e.a,e.b,e.c,e.a)),Jb=e=>{pt(e,"t");let r=Mn(e).map(o=>Le(o)),i=(r[0]+r[1]+r[2])/2;return Math.sqrt(i*(i-r[0])*(i-r[1])*(i-r[2]))},Hb=(e,r,i)=>{let o=Be(r,i),a=(u,c,f,d)=>(f.y-d.y)*u+(d.x-f.x)*c+f.x*d.y-d.x*f.y,n=a(o.x,o.y,e.b,e.c)/a(e.a.x,e.a.y,e.b,e.c),s=a(o.x,o.y,e.c,e.a)/a(e.b.x,e.b.y,e.c,e.a),l=a(o.x,o.y,e.a,e.b)/a(e.c.x,e.c.y,e.a,e.b);return{a:n,b:s,c:l}},ok=(e,r)=>{pt(e);let{a:i,b:o,c:a}=e,n=i.x*r.a+o.x*r.b+a.x*r.c,s=i.y*r.a+o.y*r.b+a.y*r.c;if(i.z&&o.z&&a.z){let l=i.z*r.a+o.z*r.b+a.z*r.c;return Object.freeze({x:n,y:s,z:l})}else return Object.freeze({x:n,y:s})},Kb=(e,r=0)=>{let{a:i,b:o,c:a}=e,n=Math.min(i.x,o.x,a.x)-r,s=Math.max(i.x,o.x,a.x)+r,l=Math.min(i.y,o.y,a.y)-r,u=Math.max(i.y,o.y,a.y)+r;return{x:n,y:l,width:s-n,height:u-l}},sl=e=>(pt(e),[e.a,e.b,e.c]),ak=(e,r,i={})=>{w($(r,"positive","radius")),O(e,"origin");let o=i.initialAngleRadian??0,a=[o,o+Ze*1/3,o+Ze*2/3],n=a.map(s=>Ue(r,s,e));return zc(n)},nk=e=>{if(!Array.isArray(e))throw Error("coords expected as array");if(e.length!==6)throw Error(`coords array expected with 6 elements. Got ${e.length}`);return zc(Qu(...e))},zc=e=>{if(!Array.isArray(e))throw Error("points expected as array");if(e.length!==3)throw Error(`points array expected with 3 elements. Got ${e.length}`);return{a:e[0],b:e[1],c:e[2]}},Qb=e=>(pt(e),Mn(e).reduce((r,i)=>r+Le(i),0)),sk=e=>{let r=Uo(e),i=Qb(e)/2;return{radius:Jb(e)/i,...r}},lk=(e,r,i)=>{let o=Kb(e),a=Be(r,i);if(!Vo(o,a))return!1;let n=Hb(e,a);return 0<=n.a&&n.a<=1&&0<=n.b&&n.b<=1&&0<=n.c&&n.c<=1},Tc=e=>(pt(e),[X(e.a,e.b),X(e.b,e.c),X(e.c,e.a)]),uk=e=>{pt(e);let[r,i,o]=Tc(e);return r===i&&i===o},ck=e=>{let[r,i,o]=Tc(e);return r===i||i===o||o===r},Zb=e=>Qo(e).includes(Math.PI/2),fk=e=>!Zb(e),dk=e=>!Qo(e).some(r=>r>=Math.PI/2),hk=e=>Qo(e).some(r=>r>Math.PI/2),pk=(e,r)=>Object.freeze({...e,a:r(e.a,"a"),b:r(e.b,"b"),c:r(e.c,"c")}),yk=e=>{let[r,i,o]=Mn(e).map(s=>Le(s)),a=Uo(e);return{radius:r*i*o/Math.sqrt((r+i+o)*(-r+i+o)*(r-i+o)*(r+i-o)),...a}},gk=(e,r,i)=>r===void 0||r===0?e:(i===void 0&&(i=Uo(e)),Object.freeze({...e,a:Pt(e.a,r,i),b:Pt(e.b,r,i),c:Pt(e.c,r,i)})),mk=(e,r,i="b")=>{let o=i==="a"?e.a:i==="b"?e.b:e.c;return Object.freeze({a:Pt(e.a,r,o),b:Pt(e.b,r,o),c:Pt(e.c,r,o)})},bk=e=>(pt(e),[e.a.x,e.a.y,e.b.x,e.b.y,e.c.x,e.c.y]);var Xb={};C(Xb,{area:()=>$k,centerFromA:()=>wk,centerFromB:()=>xk,centerFromC:()=>Ek,circumcircle:()=>Ak,fromCenter:()=>vk,height:()=>Dk,incircle:()=>Bn,perimeter:()=>Ck});const pd=Math.PI*4/3,yd=Math.PI*2/3,Dr=e=>typeof e=="number"?e:e.length,vk=(e,r,i)=>{r||=Object.freeze({x:0,y:0});let o=Dr(e)/Math.sqrt(3),a=i??Math.PI*1.5,n={x:o*Math.cos(a)+r.x,y:o*Math.sin(a)+r.y},s={x:o*Math.cos(a+pd)+r.x,y:o*Math.sin(a+pd)+r.y},l={x:o*Math.cos(a+yd)+r.x,y:o*Math.sin(a+yd)+r.y};return Object.freeze({a:s,b:n,c:l})},wk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Dr(e),{radius:o}=Bn(e);return{x:r.x+i/2,y:r.y-o}},xk=(e,r)=>{r||=Object.freeze({x:0,y:0});let{radius:i}=Bn(e);return{x:r.x,y:r.y+i*2}},Ek=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Dr(e),{radius:o}=Bn(e);return{x:r.x-i/2,y:r.y-o}},Dk=e=>Math.sqrt(3)/2*Dr(e),Ck=e=>Dr(e)*3,$k=e=>Dr(e)**2*Math.sqrt(3)/4,Ak=e=>({radius:Math.sqrt(3)/3*Dr(e)}),Bn=e=>({radius:Math.sqrt(3)/6*Dr(e)});var Yb={};C(Yb,{adjacentFromHypotenuse:()=>Vk,adjacentFromOpposite:()=>Lk,angleAtPointA:()=>Mk,angleAtPointB:()=>Bk,area:()=>Pk,circumcircle:()=>Tk,fromA:()=>Sk,fromB:()=>Fk,fromC:()=>kk,height:()=>zn,hypotenuseFromAdjacent:()=>qk,hypotenuseFromOpposite:()=>Ik,hypotenuseSegments:()=>Tn,incircle:()=>Ok,medians:()=>zk,oppositeFromAdjacent:()=>jk,oppositeFromHypotenuse:()=>Rk,perimeter:()=>Nk,resolveLengths:()=>yt});const Sk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=yt(e),o=Tn(e),a=zn(e),n={x:r.x,y:r.y},s={x:r.x+i.hypotenuse,y:r.y},l={x:r.x+o[1],y:r.y-a};return{a:n,b:s,c:l}},Fk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=yt(e),o=Tn(e),a=zn(e),n={x:r.x,y:r.y},s={x:r.x-i.hypotenuse,y:r.y},l={x:r.x-o[0],y:r.y-a};return{a:s,b:n,c:l}},kk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Tn(e),o=zn(e),a={x:r.x,y:r.y},n={x:r.x-i[1],y:r.y+o},s={x:r.x+i[0],y:r.y+o};return{a:n,b:s,c:a}},yt=e=>{let r=e.adjacent,i=e.opposite,o=e.hypotenuse;if(r!==void 0&&i!==void 0)return{...e,adjacent:r,opposite:i,hypotenuse:Math.hypot(r,i)};if(r&&o)return{...e,adjacent:r,hypotenuse:o,opposite:o*o-r*r};if(i&&o)return{...e,hypotenuse:o,opposite:i,adjacent:o*o-i*i};if(e.opposite&&e.hypotenuse&&e.adjacent)return e;throw Error("Missing at least two edges")},zn=e=>{let r=yt(e),i=r.opposite*r.opposite/r.hypotenuse,o=r.adjacent*r.adjacent/r.hypotenuse;return Math.sqrt(i*o)},Tn=e=>{let r=yt(e),i=r.opposite*r.opposite/r.hypotenuse,o=r.adjacent*r.adjacent/r.hypotenuse;return[i,o]},Nk=e=>{let r=yt(e);return r.adjacent+r.hypotenuse+r.opposite},Pk=e=>{let r=yt(e);return r.opposite*r.adjacent/2},Mk=e=>{let r=yt(e);return Math.acos((r.adjacent*r.adjacent+r.hypotenuse*r.hypotenuse-r.opposite*r.opposite)/(2*r.adjacent*r.hypotenuse))},Bk=e=>{let r=yt(e);return Math.acos((r.opposite*r.opposite+r.hypotenuse*r.hypotenuse-r.adjacent*r.adjacent)/(2*r.opposite*r.hypotenuse))},zk=e=>{let r=yt(e),i=r.adjacent*r.adjacent,o=r.hypotenuse*r.hypotenuse,a=r.opposite*r.opposite;return[Math.sqrt(2*(i+o)-a)/2,Math.sqrt(2*(o+a)-i)/2,Math.sqrt(2*(a+i)-o)/2]},Tk=e=>({radius:yt(e).hypotenuse/2}),Ok=e=>{let r=yt(e);return{radius:(r.adjacent+r.opposite-r.hypotenuse)/2}},jk=(e,r)=>Math.tan(e)*r,Rk=(e,r)=>Math.sin(e)*r,Vk=(e,r)=>Math.cos(e)*r,Lk=(e,r)=>r/Math.tan(e),Ik=(e,r)=>r/Math.sin(e),qk=(e,r)=>r/Math.cos(e);var ev={};C(ev,{apexAngle:()=>_k,area:()=>Uk,baseAngle:()=>tv,circumcircle:()=>Jk,fromA:()=>Qk,fromB:()=>Zk,fromC:()=>Xk,fromCenter:()=>Kk,height:()=>Cr,incircle:()=>rv,legHeights:()=>Wk,medians:()=>Hk,perimeter:()=>Gk});const tv=e=>Math.acos(e.base/(2*e.legs)),_k=e=>{let r=e.legs*e.legs,i=e.base*e.base;return Math.acos((2*r-i)/(2*r))},Cr=e=>{let r=e.legs*e.legs,i=e.base*e.base;return Math.sqrt((4*r-i)/4)},Wk=e=>{let r=tv(e);return e.base*Math.sin(r)},Gk=e=>2*e.legs+e.base,Uk=e=>Cr(e)*e.base/2,Jk=e=>{let r=Cr(e),i=r*r,o=e.base*e.base;return{radius:(4*i+o)/(8*r)}},rv=e=>{let r=Cr(e);return{radius:e.base*r/(2*e.legs+e.base)}},Hk=e=>{let r=e.legs*e.legs,i=e.base*e.base,o=Math.sqrt(r+2*i)/2,a=Math.sqrt(4*r-i)/2;return[o,o,a]},Kk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Cr(e),o=rv(e).radius,a=i-o,n={x:r.x-e.base/2,y:r.y+o},s={x:r.x+e.base/2,y:r.y+o},l={x:r.x,y:r.y-a};return{a:n,b:s,c:l}},Qk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Cr(e),o={x:r.x,y:r.y},a={x:r.x+e.base,y:r.y},n={x:r.x+e.base/2,y:r.y-i};return{a:o,b:a,c:n}},Zk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Cr(e),o={x:r.x,y:r.y},a={x:r.x-e.base,y:r.y},n={x:r.x-e.base/2,y:r.y-i};return{a,b:o,c:n}},Xk=(e,r)=>{r||=Object.freeze({x:0,y:0});let i=Cr(e),o={x:r.x,y:r.y},a={x:r.x-e.base/2,y:r.y+i},n={x:r.x+e.base/2,y:r.y+i};return{a,b:n,c:o}};var iv={};C(iv,{Empty:()=>GS,Equilateral:()=>Xb,Isosceles:()=>ev,Placeholder:()=>US,Right:()=>Yb,angles:()=>Qo,anglesDegrees:()=>ik,apply:()=>pk,area:()=>Jb,barycentricCoord:()=>Hb,barycentricToCartestian:()=>ok,bbox:()=>Kb,centroid:()=>Uo,corners:()=>sl,edges:()=>Mn,equilateralFromVertex:()=>Ea,fromFlatArray:()=>nk,fromPoints:()=>zc,fromRadius:()=>ak,guard:()=>pt,innerCircle:()=>sk,intersectsPoint:()=>lk,isAcute:()=>dk,isEmpty:()=>HS,isEqual:()=>QS,isEquilateral:()=>uk,isIsosceles:()=>ck,isOblique:()=>fk,isObtuse:()=>hk,isPlaceholder:()=>KS,isRightAngle:()=>Zb,isTriangle:()=>Fm,lengths:()=>Tc,outerCircle:()=>yk,perimeter:()=>Qb,rotate:()=>gk,rotateByVertex:()=>mk,toFlatArray:()=>bk});var Yk={};C(Yk,{Arcs:()=>Rb,Beziers:()=>Sb,Circles:()=>Lm,Compound:()=>qm,CurveSimplification:()=>Bb,Ellipses:()=>Mb,Grids:()=>Cb,Layouts:()=>zm,Lines:()=>cm,Paths:()=>Wm,PointTracker:()=>sc,Points:()=>bm,PointsTracker:()=>lc,Polar:()=>Gg,QuadTree:()=>zb,Rects:()=>yg,Shapes:()=>Mm,SurfacePoints:()=>Ub,Triangles:()=>iv,Vectors:()=>Ug,Waypoints:()=>Cm,angleConvert:()=>ic,angleParse:()=>An,degreeArc:()=>zA,degreeToGradian:()=>Mg,degreeToRadian:()=>st,degreeToTurn:()=>Tg,degreesSum:()=>BA,gradianToDegree:()=>Bg,gradianToRadian:()=>Ys,radianArc:()=>rc,radianInvert:()=>Pg,radianToDegree:()=>Si,radianToGradian:()=>va,radianToTurn:()=>tl,radiansFromAxisX:()=>MA,radiansSum:()=>$n,scaler:()=>oo,turnToDegree:()=>zg,turnToRadian:()=>el});const e3=(e,r)=>{let i,o=j(r,100);return()=>{i&&clearTimeout(i),i=setTimeout(e,o)}};var bo=class ll{#e;#t;#r;#i;#o;#a;#n;#l;#s=!1;#c;#u=()=>({});constructor(r,i){this.#n=U(r),this.#l=i.containerEl?U(i.containerEl):this.#n.parentElement,this.#e=i.stretch??"none",this.#a=i.onSizeChanging,this.#t=xn;let o=i.onSizeDone;o!==void 0&&(this.#u=e3(()=>{o(this.size,this.#n)},i.debounceTimeout));let a=i.naturalSize;a??=this.#n.getBoundingClientRect(),this.#i=1,this.#r=a,this.setNaturalSize(a),this.#o=En,this.#l===document.body?this.#p():this.#f()}dispose(r){this.#s||(this.#s=!0,this.#c&&(this.#c.disconnect(),this.#c=void 0))}static canvasParent(r,i){let o=U(r);return new ll(o,{...i,onSizeChanging(n,s){s.width=n.width,s.height=n.height,i.onSizeChanging&&i.onSizeChanging(n,s)}})}static canvasViewport(r,i){let o=U(r);o.style.position="absolute",o.style.zIndex=(i.zIndex??0).toString(),o.style.left="0px",o.style.top="0px";let a={...i,containerEl:document.body};return this.canvasParent(r,a)}static svgViewport(r,i){return new ll(r,{containerEl:document.body,stretch:"both",onSizeChanging(a){r.setAttribute("width",a.width.toString()),r.setAttribute("height",a.height.toString()),i&&i(a)}})}#f(){let r=this.#l;if(!r)throw Error("No container element");let i=new ResizeObserver(a=>{this.#g(a)});i.observe(r);let o=this.#d(r.getBoundingClientRect());this.size=o,this.#c=i}#p(){let r=new ResizeObserver(i=>{this.#y()});r.observe(document.documentElement),this.#c=r,this.#y()}#y(){this.size={width:window.innerWidth,height:window.innerHeight},this.#o={x:0,y:0,...this.size}}setNaturalSize(r){this.#r=r,this.#i=r.width/r.height}get naturalSize(){return this.#r}get viewport(){return this.#o}#d(r){let{width:i,height:o}=r,a=this.#e;if(a==="min"?a=i<o?"width":"height":a==="max"&&(a=i>o?"width":"height"),a==="width"?o=i/this.#i:a==="height"&&(i=o*this.#i),this.#n instanceof HTMLElement){let n=uc(this.#n,"borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth");i-=n.borderLeftWidth+n.borderRightWidth,o-=n.borderTopWidth+n.borderBottomWidth}return{width:i,height:o}}#g(r){let i=r[0].contentBoxSize[0],o={width:i.inlineSize,height:i.blockSize};this.size=this.#d(o),this.#o={x:0,y:0,width:o.width,height:o.height}}set size(r){ht(r,"size"),this.#t=r,this.#a(r,this.#n),this.#u()}get size(){return this.#t}};const t3=()=>{let e=!0,r=document.createElement("div");r.style.color="black",r.style.border="2px solid red",r.style.backgroundColor="hsl(0, 80%, 90%)",r.style.padding="1em",r.style.display="none",r.style.top="1em",r.style.left="1em",r.style.position="absolute",r.style.fontFamily="monospace";let i=document.createElement("div");i.style.maxWidth="50vw",i.style.maxHeight="50vh",i.style.overflowY="scroll",r.innerHTML="<h1>Error</h1>",r.append(i);let o=u=>{u.style.padding="0.3em",u.style.marginTop="1em"},a=document.createElement("button");a.textContent="Close",a.addEventListener("click",()=>{l()});let n=document.createElement("button");n.textContent="Stop displaying errors",n.addEventListener("click",()=>{e=!1,l()}),o(a),o(n),r.append(a),r.append(n),document.body.append(r);let s=u=>{r.style.display="inline",i.innerHTML+=u.stack?`<pre>${u.stack}</pre>`:`<p>${ut(u)}</p>`},l=()=>{r.style.display="none"};return window.onerror=(u,c,f,d,h)=>{e&&(h?(console.log(h),s(h)):(console.log(u),s(u)))},window.addEventListener("unhandledrejection",u=>{console.log(u.reason),e&&s(u.reason)}),{show:s,hide:l}},ov=(e,r)=>{let i=document.createElement("style");i.textContent=r;let o;return e.shadowRoot?(o=e.shadowRoot,o.innerHTML=""):o=e.attachShadow({mode:"open"}),o.append(i),o},av=(e,r={})=>{let{capacity:i=0,monospaced:o=!0,timestamp:a=!1,collapseDuplicates:n=!0,css:s=""}=r,l=0,u,c=0,f=U(e),d=o?'Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", Monaco, "Courier New", Courier, monospace':"normal",h=ov(f,`
  .log {
    font-family: ${d};
    background-color: var(--code-background-color);
    padding: var(--padding1, 0.2em);
    overflow-y: auto;
    height:100%;
  }
  .timestamp {
    margin-right: 0.5em;
    opacity: 0.5;
    font-size: 70%;
    align-self: center;
  }
  .line {
    display: flex;
    padding-bottom: 0.1em;
    padding-top: 0.1em;
  }
  .line:hover {
  
  }
  .error {
    color: red;
  }
  .badge {
    border: 1px solid currentColor;
    align-self: center;
    font-size: 70%;
    padding-left: 0.2em;
    padding-right: 0.2em;
    border-radius: 1em;
    margin-left: 0.5em;
    margin-right: 0.5em;
  }
  .msg {
    flex: 1;
    word-break: break-word;
  }
  ${s}
  `),p=document.createElement("div");p.className="log",h.append(p);let y=x=>{let F=document.createElement("div");if(typeof x=="string")F.innerHTML=x;else if(x instanceof Error){let N=x.stack;F.innerHTML=N===void 0?x.toString():N.toString()}else F.innerHTML=x;F.classList.add("error"),D(F),u=void 0,c=0},g=0,m=(x="")=>{let F=v(x);return F&&(F.classList.add("warning"),F)},v=(x="")=>{let F,N=window.performance.now()-g;if(!(r.minIntervalMs&&N<r.minIntervalMs))if(g=window.performance.now(),typeof x=="object"?F=JSON.stringify(x):x===void 0?F="(undefined)":x===null?F="(null)":typeof x=="number"?(Number.isNaN(F)&&(F="(NaN)"),F=x.toString()):F=x,F.length===0){let P=document.createElement("hr");u=void 0,D(P)}else if(F===u&&n){let P=p.firstElementChild,k=P.querySelector(".badge");return k===null&&(k=document.createElement("div"),k.className="badge",P.insertAdjacentElement("beforeend",k)),P!==null&&(k.textContent=(++c).toString()),P}else{let P=document.createElement("div");return P.textContent=F,D(P),u=F,P}},D=x=>{if(a){let F=document.createElement("div"),N=document.createElement("div");N.className="timestamp",N.textContent=new Date().toLocaleTimeString(),F.append(N,x),x.classList.add("msg"),F.classList.add("line"),x=F}else x.classList.add("line","msg");if(r.reverse?p.append(x):p.insertBefore(x,p.firstChild),i>0&&++l>i*2)for(;l>i;)p.lastChild?.remove(),l--;r.reverse&&(p.scrollTop=p.scrollHeight),c=0};return{error:y,log:v,warn:m,append:D,clear:()=>{p.innerHTML="",u=void 0,c=0,l=0},dispose:()=>{p.remove()},get isEmpty(){return l===0}}},r3=(e={})=>{let r={log:console.log,error:console.error,warn:console.warn},i=e.witholdCss??!1,o=e.insertIntoEl,a;o?a=U(o):(a=document.createElement("DIV"),a.id="ixfx-log",document.body.prepend(a)),i||(a.style.position="fixed",a.style.left="0px",a.style.top="0px",a.style.pointerEvents="none",a.style.display="none");let n=av(a,e),s=l=>{a.style.display="block"};console.error=(l,...u)=>{n.error(l),u.length>0&&n.error(u),r.error(l,...u),s()},console.warn=(l,...u)=>{n.warn(l),u.length>0&&n.warn(u),s()},console.log=(l,...u)=>{n.log(l),u.length>0&&n.log(u),r.log(l,...u),s()},window.onerror=(l,u,c,f,d)=>{let h=u===void 0?"":nn(u,"/",{fromEnd:!0}),p=ut(d);n.error(p+` (${h}:${c})`),s()},window.addEventListener("unhandledrejection",function(l){n.error(l.reason),s()})};async function*nv(e,r={}){if(typeof e=="string"||typeof e=="object"&&"nodeName"in e)return nv([e],r);let i=r??!1,o=i?y$():a=>!0;if(Array.isArray(e))for(let a of e)if(typeof a=="string")for(let n of document.querySelectorAll(a)){let s=n;o(s)&&(yield s)}else o(a)&&(yield a);else for await(let a of e)if(typeof a=="string")for(let n of document.querySelectorAll(a))o(n)&&(yield n);else o(a)&&(yield a)}const i3=e=>{let r=e.panels,i=e.preselectId??r[0].id,o=`tabset-${Uu()}`,a=U(e.parent),n=`
  <div class="ixfx-tabset" id="${o}">
    <fieldset class="ixfx-tabset-controls">
    ${r.map(h=>{let p=`${o}-${h.id}-select`;return`<input type="radio" name="${o}-tabs" id="${p}" data-tabset="${h.id}"><label for="${p}">${h.label}</label>`}).join("")}
    </fieldset>
    <div class="ixfx-tabset-host" id="${o}-host"></div>
  </div>
  `;a.innerHTML=n;let s=document.getElementById(`${o}-host`),l=document.getElementById(o);l.querySelector("fieldset")?.addEventListener("change",h=>{let p=h.target;c(p.getAttribute("data-tabset"))});let u,c=h=>{let p=r.find(g=>g.id===h),y=u;if(e.onPanelChanging){let g=e.onPanelChanging(y,p);if(typeof g=="boolean"&&!g)return}if(y&&y.dismount(),u=p,p){p.mount(s);let g=`#${o}-${h}-select`,m=l.querySelector(g);m?m.checked=!0:console.warn(`Could not find INPUT element for panel id: ${h} (${g})`)}e.onPanelChange&&e.onPanelChange(y,p)};c(i);let f=!1;return{select:c,panels:r,hostEl:s,tabSetEl:l,notify:(h,p)=>{u&&(u.notify?u.notify(h,p):f||(f=!0,console.warn(`TabbedPanel.notify dropping notification '${h}'. Panel implementation is missing 'notify' function`)))}}};var o3=Ed(zy());const sv=(e="viewport")=>{switch(e){case"viewport":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x/window.innerWidth,y:o.y/window.innerHeight})};case"screen":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x/screen.width,y:o.y/screen.height})};case"document":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x/document.body.scrollWidth,y:o.y/document.body.scrollHeight})};default:throw Error(`Unknown 'reference' parameter: ${JSON.stringify(e)}`)}},lv=(e,r={})=>{let i=r.target??"viewport",o=r.relative??!1,a=r.anchor??"nw",n=U(e),s=uv(i);if(o){let l=sv(i);return()=>l(s(Ra(n.getBoundingClientRect(),a)))}else return()=>s(Ra(n.getBoundingClientRect(),a))},a3=(e,r="nw")=>{let i=U(e);return Ra(i.getBoundingClientRect(),r)},n3=(e,r="viewport")=>lv(e,{relative:!0,target:r})(),uv=(e="viewport")=>{switch(e){case"screen":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x+window.screenX,y:o.y+window.screenY})};case"document":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x+window.scrollX,y:o.y+window.scrollY})};case"viewport":return(r,i)=>{let o=Be(r,i);return Object.freeze({x:o.x,y:o.y})};default:throw Error(`Unexpected target coordinate space: ${e}. Expected: viewport, document or screen`)}},s3=(e,r,i="window")=>{if(!e)throw Error("domQueryOrEl is null or undefined");let o=U(e),a=wr(r,window.innerWidth,window.innerHeight),n=o.getBoundingClientRect(),s=$e(a,n.width/2,n.height/2);o.style.transform=`translate(${s.x}px, ${s.y}px)`},l3=(e,r)=>{if(!(e===null||!e)){if(!Array.isArray(r))throw TypeError("List should be an array of strings");for(let i=0;i<r.length;i++)if(e.classList.contains(r[i])){e.classList.remove(r[i]),i+1<r.length?e.classList.add(r[i+1]):e.classList.add(r[0]);return}e.classList.add(r[0])}},u3=e=>{let r=U(e),i=window.getComputedStyle(r),o=i.transform;if(o==="none"||o===void 0)return{x:0,y:0,z:0};let a=o.includes("3d")?"3d":"2d",n=/matrix.*\((.+)\)/.exec(o)[1].split(", ");return a==="2d"?{x:Number.parseFloat(n[4]),y:Number.parseFloat(n[5]),z:0}:a==="3d"?{x:Number.parseFloat(n[12]),y:Number.parseFloat(n[13]),z:Number.parseFloat(n[14])}:{x:0,y:0,z:0}},c3=(e,r)=>{let i=document.createElement(r);return e.parentElement?.insertBefore(i,e.nextSibling),i},f3=(e,r)=>{let i=document.createElement(r);return e.append(i),i},d3=e=>{let r=e.lastElementChild;for(;r;)r.remove(),r=e.lastElementChild},h3=e=>new Promise((i,o)=>{let a=o3.default.stringify(e);navigator.clipboard.writeText(JSON.stringify(a)).then(()=>{i(!0)},n=>{console.warn("Could not copy to clipboard"),console.log(a),o(Error(n))})}),p3=(e,r)=>{let i=r.getAttribute("data-sort")??"",o,a;for(let n of e.children){let s=n.getAttribute("data-sort")??"";if(i>=s&&(o=n),i<=s&&(a=n),o!==void 0&&a!==void 0)break}o===void 0?a===void 0?e.append(r):a.insertAdjacentElement("beforebegin",r):o.insertAdjacentElement("afterend",r)},y3=(e,r,i)=>{if(e===void 0)throw Error("Param 'parentEl' is undefined");if(e===null)throw Error("Param 'parentEl' is null");let o=new Set;for(let[n,s]of r){let l=`c-${n}`,u=e.querySelector(`#${l}`),c=i(s,u);u!==c&&(c.id=l,e.append(c)),o.add(l)}let a=[];for(let n of e.children)o.has(n.id)||a.push(n);for(let n of a)n.remove()},g3=e=>{let r=document.getElementById(e);if(r===null)throw Error(`HTML element with id '${e}' not found`);return r};var Ee={};C(Ee,{DataDisplay:()=>IS,DataTable:()=>Ty,DragDrop:()=>vm,ElementSizer:()=>bo,Forms:()=>wm,addShadowCss:()=>ov,byId:()=>g3,cardinalPosition:()=>a3,clear:()=>d3,copyToClipboard:()=>h3,createAfter:()=>c3,createIn:()=>f3,cycleCssClass:()=>l3,defaultErrorHandler:()=>t3,el:()=>qS,elRequery:()=>_S,getBoundingClientRectWithBorder:()=>LS,getComputedPixels:()=>uc,getCssVariable:()=>RS,getCssVariablesFromStyles:()=>Dm,getCssVariablesWithFallback:()=>jS,getTranslation:()=>u3,inlineConsole:()=>r3,insertSorted:()=>p3,log:()=>av,parseCssVariablesAsAttributes:()=>TS,pointScaler:()=>sv,positionFn:()=>lv,positionFromMiddle:()=>s3,positionRelative:()=>n3,query:()=>nv,reconcileChildren:()=>y3,resolveEl:()=>U,resolveElementTry:()=>ju,resolveEls:()=>Zr,setCssClass:()=>cc,setCssDisplay:()=>dc,setCssToggle:()=>fc,setCssVariables:()=>VS,setFromCssVariables:()=>OS,setHtml:()=>pc,setProperty:()=>Sn,setText:()=>hc,tabSet:()=>i3,viewportToSpace:()=>uv});var Oc=class{enc=new TextEncoder;dec=new TextDecoder("utf-8");toBuffer(e){return this.enc.encode(e)}fromBuffer(e){return this.dec.decode(e)}},jc=class{onData;separator;buffer="";stream;constructor(e,r=`
`){this.onData=e,this.separator=r}async close(){let e=this.stream;e&&(await e.abort(),await e.close())}clear(){this.buffer=""}writable(){return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){let e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}addImpl(e){let r=e.indexOf(this.separator);if(r<0)return this.buffer+=e,"";let i=e.substring(0,r);try{this.onData(this.buffer+i),e=e.substring(i.length+this.separator.length)}catch(o){console.warn(o)}return this.buffer="",e}add(e){for(;e.length>0;)e=this.addImpl(e)}},Rc=class{dataHandler;paused=!1;queue=new ct;writer;stream;closed=!1;chunkSize;constructor(e,r={}){this.dataHandler=e,this.chunkSize=r.chunkSize??-1,this.writer=or(async()=>{await this.onWrite()},r.interval??10)}async close(){if(this.closed)return;let e=this.stream?.getWriter();e?.releaseLock(),await e?.close(),this.closed=!0}clear(){if(this.closed)throw Error("Buffer closed");this.queue=new ct}writable(){if(this.closed)throw Error("Buffer closed");return this.stream===void 0&&(this.stream=this.createWritable()),this.stream}createWritable(){let e=this;return new WritableStream({write(r){e.add(r)},close(){e.clear()}})}async onWrite(){if(this.queue.isEmpty)return!1;if(this.paused)return console.warn("WriteBuffer.onWrite: paused..."),!0;let e=this.queue.dequeue();return e===void 0?!1:(await this.dataHandler(e),!0)}get isClosed(){return this.closed}add(e){if(this.closed)throw Error("Buffer closed");this.chunkSize>0?this.queue.enqueue(...lE(e,this.chunkSize)):this.queue.enqueue(e),this.writer.start()}};const Vc=Object.freeze({ready:"connecting",connecting:["connected","closed"],connected:["closed"],closed:"connecting"});var m3=class extends Ye{device;config;states;codec;rx;tx;gatt;verboseLogging=!1;rxBuffer;txBuffer;constructor(e,r){super(),this.device=e,this.config=r,this.verboseLogging=r.debug,this.txBuffer=new Rc(async i=>{await this.writeInternal(i)},r),this.rxBuffer=new jc(i=>{this.fireEvent("data",{data:i})}),this.codec=new Oc,this.states=new mn(Vc,{initial:"ready"}),this.states.addEventListener("change",i=>{this.fireEvent("change",i),this.verbose(`${i.priorState} -> ${i.newState}`),i.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())}),e.addEventListener("gattserverdisconnected",()=>{this.isClosed||(this.verbose("GATT server disconnected"),this.states.state="closed")}),this.verbose(`ctor ${e.name} ${e.id}`)}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async writeInternal(e){this.verbose(`writeInternal ${e}`);let r=this.tx;if(r===void 0)throw Error("Unexpectedly without tx characteristic");try{await r.writeValue(this.codec.toBuffer(e))}catch(i){this.warn(i)}}disconnect(){this.states.state==="connected"&&this.gatt?.disconnect()}async connect(){let e=this.config.connectAttempts??3;this.states.state="connecting",this.verbose("connect");let r=this.device.gatt;if(r===void 0)throw Error("Gatt not available on device");await Fu(async()=>{this.verbose("connect.retry");let i=await r.connect();this.verbose("Getting primary service");let o=await i.getPrimaryService(this.config.service);this.verbose("Getting characteristics");let a=await o.getCharacteristic(this.config.rxGattCharacteristic),n=await o.getCharacteristic(this.config.txGattCharacteristic);return a.addEventListener("characteristicvaluechanged",s=>{this.onRx(s)}),this.rx=a,this.tx=n,this.gatt=r,this.states.state="connected",await a.startNotifications(),!0},{limitAttempts:e,startAt:200})}onRx(e){if(this.rx===void 0)return;let i=e.target.value;if(i===void 0)return;let o=this.codec.fromBuffer(i.buffer),a=Na(o,19),n=Na(o,17);n&&a<n&&(this.verbose("Tx plz start"),o=Pa(o,n,1),this.txBuffer.paused=!1),a&&a>n&&(this.verbose("Tx plz stop"),o=Pa(o,a,1),this.txBuffer.paused=!0),this.rxBuffer.add(o)}verbose(e){this.verboseLogging&&console.info(this.config.name,e)}log(e){console.log(this.config.name,e)}warn(e){console.warn(this.config.name,e)}},cv={};C(cv,{NordicBleDevice:()=>fv,defaultOpts:()=>Zo});const Zo={chunkSize:20,service:"6e400001-b5a3-f393-e0a9-e50e24dcca9e",txGattCharacteristic:"6e400002-b5a3-f393-e0a9-e50e24dcca9e",rxGattCharacteristic:"6e400003-b5a3-f393-e0a9-e50e24dcca9e",name:"NordicDevice",connectAttempts:5,debug:!1};var fv=class extends m3{constructor(e,r={}){super(e,{...Zo,...r})}},dv=class{freqMaxRange=200;audio;parent;lastPointer={x:0,y:0};pointerDown=!1;pointerClicking=!1;pointerClickDelayMs=100;pointerDelaying=!1;waveTracker;freqTracker;el;constructor(e,r){this.audio=r,this.parent=e,this.waveTracker=ba(),this.freqTracker=ba(),e.innerHTML=`
    <section>
      <button id="rendererComponentToggle">🔼</button>
      <div>
        <h1>Visualiser</h1>
        <div style="display:flex; flex-wrap: wrap">
          <div class="visPanel">
            <h2>Frequency distribution</h2>
            <br />
            <canvas id="rendererComponentFreqData" height="200" width="400"></canvas>
          </div>
          <div class="visPanel">
            <h2>Waveform</h2>
            <button id="rendererComponentWaveReset">Reset</button>
            <div>
              Press and hold on wave to measure
            </div>
            <br />
            <canvas id="rendererComponentWaveData" height="200" width="400"></canvas>
          </div>
        </div>
      </div>
    </section>
    `,this.el=e.children[0],document.getElementById("rendererComponentToggle")?.addEventListener("click",()=>{this.setExpanded(!this.isExpanded())}),this.el.addEventListener("pointermove",i=>{this.onPointer(i)}),this.el.addEventListener("pointerup",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),this.el.addEventListener("pointerdown",()=>{this.pointerDelaying=!0,setTimeout(()=>{this.pointerDelaying&&(this.pointerDelaying=!1,this.pointerDown=!0)},this.pointerClickDelayMs)}),this.el.addEventListener("pointerleave",()=>{this.pointerDelaying=!1,this.pointerDown=!1}),document.getElementById("rendererComponentWaveReset")?.addEventListener("click",()=>{this.clear()})}renderFreq(e){if(!this.isExpanded()||!e)return;let r=document.getElementById("rendererComponentFreqData");if(r===null)throw Error("Cannot find canvas element");let i=r.getContext("2d");if(i===null)throw Error("Cannot create drawing context");let o=e.length,a=r.clientWidth,n=r.clientHeight;i.clearRect(0,0,a,n);let s=this.getPointerRelativeTo(r),l=a/o,u=To(e);for(let c=0;c<o;c++){if(!Number.isFinite(e[c]))continue;let f=e[c]-u.min,d=f/this.freqMaxRange,h=Math.abs(n*d),p=n-h,y=c/o*360,g=c*l;if(i.fillStyle=`hsl(${y}, 100%, 50%)`,s.y>0&&s.y<=n&&s.x>=g&&s.x<=g+l){this.freqTracker.id!==c.toString()&&(this.freqTracker=ba({id:c.toString()})),this.freqTracker.seen(e[c]);let m=this.freqTracker.getMinMaxAvg();i.fillStyle="black",this.audio&&i.fillText(`Frequency (${c}) at pointer: ${this.audio.getFrequencyAtIndex(c).toLocaleString("en")} - ${this.audio.getFrequencyAtIndex(c+1).toLocaleString("en")}`,2,10),i.fillText(`Raw value: ${e[c].toFixed(2)}`,2,20),i.fillText(`Min: ${m.min.toFixed(2)}`,2,40),i.fillText(`Max: ${m.max.toFixed(2)}`,60,40),i.fillText(`Avg: ${m.avg.toFixed(2)}`,120,40)}i.fillRect(g,p,l,h)}}isExpanded(){let e=this.el.querySelector("div");if(e===null)throw Error("contents div not found");return e.style.display===""}setExpanded(e){let r=this.el.querySelector("div"),i=this.el.querySelector("button");if(i===null)throw Error("Button element not found");if(r===null)throw Error("Contents element not found");e?(r.style.display="",i.innerText="🔼"):(r.style.display="none",i.innerText="🔽")}clear(){this.clearCanvas(document.getElementById("rendererComponentFreqData")),this.clearCanvas(document.getElementById("rendererComponentWaveData"))}clearCanvas(e){if(e===null)throw Error("Canvas is null");let r=e.getContext("2d");if(r===null)throw Error("Cannot create drawing context");r.fillStyle="white",r.fillRect(0,0,e.clientWidth,e.clientHeight)}renderWave(e,r=!0){if(!this.isExpanded()||!e)return;let i=document.getElementById("rendererComponentWaveData");if(i===null)throw Error("Cannot find wave canvas");let o=i.getContext("2d");if(o===null)throw Error("Cannot create drawing context for wave");let a=i.clientWidth,n=i.clientHeight,s=this.getPointerRelativeTo(i),l=20,u=60,c=e.length;o.fillStyle="white",o.fillRect(0,0,u,l);let f=a/c;o.fillStyle="rgba(255, 255, 255, 0.03)",o.fillRect(0,20,a,n),o.fillStyle="red",r?o.fillRect(0,n/2,a,1):o.fillRect(0,n-1,a,1),o.lineWidth=1,o.strokeStyle="black",o.beginPath();let d=0;for(let h=0;h<c;h++){let p=e[h]*n,y=r?n/2-p:n-p;h===0?o.moveTo(d,y):o.lineTo(d,y),d+=f,this.pointerDown&&this.waveTracker.seen(e[h])}if(o.lineTo(a,r?n/2:n),o.stroke(),this.pointerDown){let h=this.waveTracker.getMinMaxAvg();o.fillStyle="rgba(255,255,0,1)",o.fillRect(u,0,150,20),o.fillStyle="black",o.fillText("Min: "+h.min.toFixed(2),60,10),o.fillText("Max: "+h.max.toFixed(2),110,10),o.fillText("Avg: "+h.avg.toFixed(2),160,10)}else this.waveTracker.reset();s.y>0&&s.y<=n&&s.x>=0&&s.x<=a&&(o.fillStyle="black",o.fillText("Level: "+(1-s.y/n).toFixed(2),2,10))}getPointerRelativeTo(e){let r=e.getBoundingClientRect();return{x:this.lastPointer.x-r.left-window.scrollX,y:this.lastPointer.y-r.top-window.scrollY}}onPointer(e){this.lastPointer={x:e.pageX,y:e.pageY},e.preventDefault()}};const b3=(e,r={})=>new On((i,o)=>{let a=new Float32Array(i.frequencyBinCount),n=new Float32Array(i.fftSize);i.getFloatFrequencyData(a),i.getFloatTimeDomainData(n),e(a,n,o)},r),v3=(e,r={})=>new On((i,o)=>{let a=new Float32Array(i.frequencyBinCount);i.getFloatFrequencyData(a),e(a,o)},r),w3=(e,r={})=>new On((i,o)=>{let a=new Float32Array(i.fftSize);i.getFloatTimeDomainData(a),e(mu(a),o)},r);var On=class{showVis;fftSize;smoothingTimeConstant;#e=!1;debug;#t=!1;visualiser;audioCtx;analyserNode;analyse;constructor(e,r={}){if(this.showVis=r.showVis??!1,this.fftSize=r.fftSize??1024,this.debug=r.debug??!1,this.smoothingTimeConstant=r.smoothingTimeConstant??.8,w(G(this.fftSize,"positive","opts.fftSize"),$(this.smoothingTimeConstant,"percentage","opts.smoothingTimeConstant")),!$d(this.fftSize))throw Error(`fftSize must be a power of two from 32 to 32768 (${this.fftSize})`);if(this.fftSize<32)throw Error("fftSize must be at least 32");if(this.fftSize>32768)throw Error("fftSize must be no greater than 32768");this.analyse=e,this.paused=!1,this.init();let i=document.querySelector("#audio-visualiser");if(i){let o=new dv(i,this);o.setExpanded(this.showVis),this.visualiser=o}}init(){if(this.#t){this.debug&&console.debug("Init already in progress");return}this.#t=!0,navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{this.onMicSuccess(e)}).catch(e=>{this.#t=!1,console.error(e)})}get paused(){return this.#e}set paused(e){e!==this.#e&&(this.#e=e,e?this.debug&&console.log("Paused"):(this.debug&&console.log("Unpaused"),window.requestAnimationFrame(this.analyseLoop.bind(this))))}setup(e,r){let i=e.createAnalyser();return i.fftSize=this.fftSize,i.smoothingTimeConstant=this.smoothingTimeConstant,e.createMediaStreamSource(r).connect(i),i}onMicSuccess(e){try{let r=new AudioContext;r.addEventListener("statechange",()=>{this.debug&&console.log(`Audio context state: ${r.state}`)}),this.audioCtx=r,this.analyserNode=this.setup(r,e),window.requestAnimationFrame(this.analyseLoop.bind(this))}catch(r){this.#t=!1,console.error(r)}}analyseLoop(){if(this.paused){this.debug&&console.log("Paused");return}let e=this.analyserNode;if(e===void 0){console.warn("Analyser undefined");return}try{this.analyse(e,this)}catch(r){console.error(r)}window.requestAnimationFrame(this.analyseLoop.bind(this))}getFrequencyRangeMax(e,r,i){let o=this.sliceByFrequency(e,r,i);return pp(o)}sliceByFrequency(e,r,i){let o=this.getIndexForFrequency(e),a=this.getIndexForFrequency(r);return i.slice(o,a)}getFrequencyAtIndex(e){let r=this.analyserNode,i=this.audioCtx;if(r===void 0)throw Error("Analyser not available");if(i===void 0)throw Error("Audio context not available");if(w(G(e,"positive","index")),e>r.frequencyBinCount)throw Error(`Index ${e} exceeds frequency bin count ${r.frequencyBinCount}`);return e*i.sampleRate/(r.frequencyBinCount*2)}getIndexForFrequency(e){let r=this.analyserNode;if(r===void 0)throw Error("Analyser not available");let i=r.context.sampleRate/2,o=Math.round(e/i*r.frequencyBinCount);return o<0?0:o>=r.frequencyBinCount?r.frequencyBinCount-1:o}},x3=class{#e=!1;#t=new Map;filterType="lowpass";constructor(){}init(){if(!this.#e){this.#e=!0;for(let e of document.querySelectorAll("audio"))this.#t.set(e.id,hv(e,this.filterType))}}get(e){return this.init(),this.#t.get(e)}};function hv(e,r="lowpass"){let i=U(e),o=new AudioContext,a=o.createMediaElementSource(i),n=o.createStereoPanner(),s=o.createGain(),l=o.createBiquadFilter();return l.type=r,a.connect(s),s.connect(n),n.connect(l),l.connect(o.destination),{pan:n,gain:s,filter:l,id:i.id,ctx:o,el:i}}function E3(e={}){let r=new AudioContext,i=e.type??"sawtooth",o=e.frequency??440,a=e.id??Uu(),n=r.createOscillator();n.type=i,n.frequency.setValueAtTime(o,r.currentTime);let s=r.createStereoPanner(),l=r.createGain(),u=r.createBiquadFilter();return n.connect(l),l.connect(s),s.connect(u),u.connect(r.destination),{pan:s,gain:l,filter:u,ctx:r,osc:n,id:a}}var pv={};C(pv,{AudioAnalyser:()=>On,AudioElements:()=>x3,AudioVisualiser:()=>dv,analyserBasic:()=>b3,analyserFrequency:()=>v3,analyserPeakLevel:()=>w3,createFromAudioElement:()=>hv,createOscillator:()=>E3});var jn=class extends fv{evalTimeoutMs;evalReplyBluetooth=!0;constructor(e,r={}){super(e,r),this.evalTimeoutMs=r.evalTimeoutMs??5*1e3}async writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},i){let o=r.debug??!1;return Ic(e,r,this,"Bluetooth.println",o,i??(n=>{this.warn(n)}))}},D3=class extends Ye{states;codec;verboseLogging=!1;name;connectAttempts;chunkSize;rxBuffer;txBuffer;constructor(e={}){super(),this.verboseLogging=e.debug??!1,this.chunkSize=e.chunkSize??1024,this.connectAttempts=e.connectAttempts??3,this.name=e.name??"JsonDevice",this.txBuffer=new Rc(async r=>{await this.writeInternal(r)},e),this.rxBuffer=new jc(r=>{this.fireEvent("data",{data:r})}),this.codec=new Oc,this.states=new mn(Vc,{initial:"ready"}),this.states.addEventListener("change",r=>{this.fireEvent("change",r),this.verbose(`${r.priorState} -> ${r.newState}`),r.priorState==="connected"&&(this.rxBuffer.clear(),this.txBuffer.clear())})}get isConnected(){return this.states.state==="connected"}get isClosed(){return this.states.state==="closed"}write(e){if(this.states.state!=="connected")throw Error(`Cannot write while state is ${this.states.state}`);this.txBuffer.add(e)}async close(){this.states.state==="connected"&&this.onClosed()}async connect(){let e=this.connectAttempts;this.states.state="connecting",await this.onPreConnect(),await Fu(async()=>(await this.onConnectAttempt(),this.states.state="connected",!0),{limitAttempts:e,startAt:200})}onRx(e){let r=e.target.value;if(r===void 0)return;let i=this.codec.fromBuffer(r.buffer),o=Na(i,19),a=Na(i,17);a&&o<a&&(this.verbose("Tx plz start"),i=Pa(i,a,1),this.txBuffer.paused=!1),o&&o>a&&(this.verbose("Tx plz stop"),i=Pa(i,o,1),this.txBuffer.paused=!0),this.rxBuffer.add(i)}verbose(e){this.verboseLogging&&console.info(this.name,e)}log(e){console.log(this.name,e)}warn(e){console.warn(this.name,e)}},yv={};C(yv,{Device:()=>gv});var gv=class extends D3{config;port;tx;abort;baudRate;constructor(e={}){super(e),this.config=e,this.abort=new AbortController;let r=e.eol??`\r
`;this.baudRate=e.baudRate??9600,e.name===void 0&&(this.name="Serial.Device"),this.rxBuffer.separator=r}async writeInternal(e){if(this.tx===void 0)throw Error("tx not ready");try{this.tx.write(e)}catch(r){this.warn(r)}}onClosed(){this.tx?.releaseLock(),this.abort.abort("closing port"),this.states.state="closed"}onPreConnect(){return Promise.resolve()}async onConnectAttempt(){let e={filters:[]},r={baudRate:this.baudRate};this.config.filters&&(e={filters:[...this.config.filters]}),this.port=await navigator.serial.requestPort(e),this.port.addEventListener("disconnect",s=>{this.close()}),await this.port.open(r);let i=this.port.writable,o=new TextEncoderStream;i!==null&&(o.readable.pipeTo(i,{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt txText pipe:"),console.log(s)}),this.tx=o.writable.getWriter());let a=this.port.readable,n=new TextDecoderStream;a!==null&&(a.pipeTo(n.writable,{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt rxR pipe:"),console.log(s)}),n.readable.pipeTo(this.rxBuffer.writable(),{signal:this.abort.signal}).catch(s=>{console.log("Serial.onConnectAttempt rxText pipe:"),console.log(s);try{this.port?.close()}catch(l){console.log(l)}}))}},mv=class extends gv{evalTimeoutMs;evalReplyBluetooth=!1;constructor(e){super(e),e===void 0&&(e={}),this.evalTimeoutMs=e.evalTimeoutMs??5*1e3}async disconnect(){return super.close()}writeScript(e){this.write(`reset();
`),this.write(`${e}
`)}async eval(e,r={},i){let o=r.debug??!1;return Ic(e,r,this,"USB.println",o,i??(n=>{this.warn(n)}))}},bv={};C(bv,{EspruinoBleDevice:()=>jn,EspruinoSerialDevice:()=>mv,bangle:()=>$3,connectBle:()=>S3,deviceEval:()=>Ic,puck:()=>C3,serial:()=>A3});const C3=async(e={})=>{let r=e.name??"Puck",i=e.debug??!1,o=await navigator.bluetooth.requestDevice({filters:Lc(e,"Puck.js"),optionalServices:[Zo.service]});e.debug&&console.info(`Espruino.puck device name: ${o.name}`);let a=new jn(o,{name:r,debug:i});return await a.connect(),a},$3=async(e={})=>{let r=e.name??"Bangle",i=e.debug??!1,o=await navigator.bluetooth.requestDevice({filters:Lc(e,"Bangle.js"),optionalServices:[Zo.service]});e.debug&&console.info(`Espruino.bangle device name: ${o.name}`);let a=new jn(o,{name:r,debug:i});return await a.connect(),a},A3=async(e={})=>{let r=new mv(e);return await r.connect(),r},Lc=(e,r)=>{let i=[];return e.filters?i.push(...e.filters):e.name?(i.push({name:e.name}),console.info(`Filtering Bluetooth devices by name '${e.name}'`)):i.push({namePrefix:r}),i},S3=async(e={})=>{let r=await navigator.bluetooth.requestDevice({filters:Lc(e,"Puck.js"),optionalServices:[Zo.service]}),i=new jn(r,{name:"Espruino",...e});return await i.connect(),i},Ic=async(e,r={},i,o,a,n)=>{let s=r.timeoutMs??i.evalTimeoutMs,l=r.assumeExclusive??!0;if(typeof e!="string")throw TypeError(`Param 'code' should be a string. Got: ${typeof e}`);return new Promise((u,c)=>{let f=lg(5),d=g=>{try{let m=g.data.trim();m.startsWith(">{")&&m.endsWith("}")&&(m=m.slice(1));let v=JSON.parse(m);"reply"in v?v.reply===f?(p(),"result"in v&&u(v.result)):n(`Expected reply ${f}, got ${v.reply}`):n(`Expected packet, missing 'reply' field. Got: ${g.data}`)}catch(m){l?p(`Unexpected reply: ${g.data}. Error: ${ut(m)}`):n(ut(m))}},h=g=>{g.newState!=="connected"&&p(`State changed to '${g.newState}', aborting`)};i.addEventListener("data",d),i.addEventListener("change",h);let p=Bu(s,g=>{c(Error(g))},g=>{i.removeEventListener("data",d),i.removeEventListener("change",h)}),y=`${o}(JSON.stringify({reply:"${f}", result:JSON.stringify(${e})}))
`;a&&n(y),i.write(y)})};var vv={};C(vv,{dumpDevices:()=>k3,start:()=>wv});const F3=1e4,k3=async(e="videoinput")=>{let r=await navigator.mediaDevices.enumerateDevices();for(let i of r)i.kind===e&&(console.log(i.label),console.log(` Kind: ${i.kind}`),console.log(` Device id: ${i.deviceId}`))},wv=async(e={})=>{let r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-camera"),document.body.append(r);let i=()=>{},o=()=>{try{i()}catch{}r.remove()};try{return i=(await N3(r,e)).dispose,{videoEl:r,dispose:o}}catch(a){throw console.error(a),o(),a}},N3=async(e,r={})=>{if(e===void 0)throw Error("videoEl undefined");if(e===null)throw Error("videoEl null");let i=r.max,o=r.min,a=r.ideal,n={audio:!1,video:{width:{},height:{}}};r.facingMode==="front"&&(r={...r,facingMode:"user"}),r.facingMode==="back"&&(r={...r,facingMode:"environment"}),r.facingMode&&(n.video.facingMode=r.facingMode),r.deviceId&&(n.video.deviceId=r.deviceId),a&&(n.video.width={...n.video.width,ideal:a.width},n.video.height={...n.video.height,ideal:a.height}),i&&(n.video.width={...n.video.width,max:i.width},n.video.height={...n.video.height,max:i.height}),o&&(n.video.width={...n.video.width,min:o.width},n.video.height={...n.video.height,min:o.height});let s=Bu(r.startTimeoutMs??F3,l=>{throw Error(`Camera getUserMedia failed: ${l}`)});try{let l=await navigator.mediaDevices.getUserMedia(n),u=()=>{e.pause();let d=l.getTracks();for(let h of d)h.stop()};e.srcObject=l,s();let c={videoEl:e,dispose:u};return new Promise((d,h)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{d(c)}).catch(p=>{h(p)})})})}catch(l){throw s(ut(l)),l}};var xv={};C(xv,{start:()=>Ev});const Ev=async e=>{let r=document.createElement("VIDEO");r.style.display="none",r.playsInline=!0,r.muted=!0,r.classList.add("ixfx-video"),document.body.appendChild(r);let i=()=>{},o=()=>{try{i()}catch{}r.remove()};try{return i=(await P3(r,e)).dispose,{videoEl:r,dispose:o}}catch(a){throw console.error(a),o(),a}},P3=async(e,r)=>{if(e===void 0)throw Error("videoEl undefined");if(e===null)throw Error("videoEl null");let i=URL.createObjectURL(r);e.src=i,e.loop=!0;let o=()=>{e.pause()},a={videoEl:e,dispose:o};return new Promise((s,l)=>{e.addEventListener("loadedmetadata",()=>{e.play().then(()=>{s(a)}).catch(u=>{l(u)})})})};var Dv={};C(Dv,{arc:()=>Sv,bezier:()=>kv,circle:()=>_a,connectedPoints:()=>Rn,copyToImg:()=>j3,dot:()=>wt,drawingStack:()=>li,ellipse:()=>T3,getContext:()=>$v,line:()=>_c,lineThroughPoints:()=>z3,makeHelper:()=>Av,paths:()=>Fv,pointLabels:()=>Vn,rect:()=>Wa,textBlock:()=>Pv,textBlockAligned:()=>q3,textHeight:()=>I3,textRect:()=>Wc,textWidth:()=>L3,translatePoint:()=>O3,triangle:()=>V3});const Cv=Math.PI*2,$v=e=>{if(e===null)throw Error("canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element");if(e===void 0)throw Error("canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element");let r=e instanceof CanvasRenderingContext2D?e:e instanceof HTMLCanvasElement?e.getContext("2d"):typeof e=="string"?U(e).getContext("2d"):e;if(r===null)throw Error("Could not create 2d context for canvas");return r},Av=(e,r)=>{let i=$v(e);return{ctx:i,paths(o,a){Fv(i,o,a)},line(o,a){_c(i,o,a)},rect(o,a){Wa(i,o,a)},bezier(o,a){kv(i,o,a)},connectedPoints(o,a){Rn(i,o,a)},pointLabels(o,a){Vn(i,o,a)},dot(o,a){wt(i,o,a)},circle(o,a){_a(i,o,a)},arc(o,a){Sv(i,o,a)},textBlock(o,a){a.bounds===void 0&&r!==void 0&&(a={...a,bounds:{...r,x:0,y:0}}),Pv(i,o,a)}}},qc=e=>M3(e.strokeStyle,e.fillStyle),Je=(e,r={},...i)=>{if(e===void 0)throw Error("ctx undefined");let o=li(e).push(qc(r),...i);return o.apply(),o},Sv=(e,r,i={})=>{Je(e,i);let o=n=>{e.beginPath(),e.arc(n.x,n.y,n.radius,n.startRadian,n.endRadian),e.stroke()},a=Array.isArray(r)?r:[r];for(let n of a)o(n)},M3=(e,r)=>o=>{r&&(o.fillStyle=r),e&&(o.strokeStyle=e)},B3=(e,r,i)=>a=>{e&&(a.lineWidth=e),r&&(a.lineJoin=r),i&&(a.lineCap=i)},li=(e,r)=>(r??=new fo,{push:(...n)=>{r??=new fo;let s=r.push(...n);for(let l of n)l(e);return li(e,s)},pop:()=>{let n=r?.pop();return li(e,n)},apply:()=>{if(r===void 0)return li(e);for(let n of r.data)n(e);return li(e,r)}}),z3=(e,r,i)=>{Je(e,i),e.moveTo(r[0].x,r[0].y);for(let[o,a]of r.entries()){if(o+2>=r.length)continue;let n=r[o+1],s={x:(a.x+n.x)/2,y:(a.y+n.y)/2},l=(s.x+a.x)/2,u=(s.x+n.x)/2;e.quadraticCurveTo(l,n.y,s.x,s.y),e.quadraticCurveTo(u,n.y,n.x,n.y)}},_a=(e,r,i={})=>{Je(e,i);let o=a=>{e.beginPath(),e.arc(a.x,a.y,a.radius,0,Cv),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()};if(Array.isArray(r))for(let a of r)o(a);else o(r)},T3=(e,r,i={})=>{Je(e,i);let o=n=>{e.beginPath();let s=n.rotation??0,l=n.startAngle??0,u=n.endAngle??Cv;e.ellipse(n.x,n.y,n.radiusX,n.radiusY,s,l,u),i.strokeStyle&&e.stroke(),i.fillStyle&&e.fill()},a=Array.isArray(r)?r:[r];for(let n of a)o(n)},Fv=(e,r,i={})=>{Je(e,i);let o=a=>{if(Fi(a))Nv(e,a,i);else if(jt(a))_c(e,a,i);else throw Error(`Unknown path type ${JSON.stringify(a)}`)};if(Array.isArray(r))for(let a of r)o(a);else o(r)},Rn=(e,r,i={})=>{let o=i.loop??!1;if(w(Ie(r,"pts")),r.length!==0){for(let[a,n]of r.entries())O(n,`Index ${a}`);Je(e,i),i.lineWidth&&(e.lineWidth=i.lineWidth),e.beginPath(),e.moveTo(r[0].x,r[0].y);for(let a of r)e.lineTo(a.x,a.y);o&&e.lineTo(r[0].x,r[0].y),(i.strokeStyle||i.strokeStyle===void 0&&i.fillStyle===void 0)&&e.stroke(),i.fillStyle&&e.fill()}},Vn=(e,r,i={},o)=>{if(r.length!==0){for(let[a,n]of r.entries())O(n,`Index ${a}`);Je(e,i);for(let[a,n]of r.entries()){let s=o!==void 0&&a<o.length?o[a]:a.toString();e.fillText(s.toString(),n.x,n.y)}}},O3=(e,r)=>{let i=e.getTransform();return{x:r.x*i.a+r.y*i.c+i.e,y:r.x*i.b+r.y*i.d+i.f}},j3=e=>{let r=document.createElement("img");return r.src=e.toDataURL("image/jpeg"),r},wt=(e,r,i)=>{i??={};let o=i.radius??10,a=Array.isArray(r)?r:[r],n=i.stroke?i.stroke:i.strokeStyle!==void 0,s=i.filled?i.filled:i.fillStyle!==void 0;!n&&!s&&(s=!0),Je(e,i);for(let l of a)e.beginPath(),"radius"in l?e.arc(l.x,l.y,l.radius,0,2*Math.PI):e.arc(l.x,l.y,o,0,2*Math.PI),s&&e.fill(),n&&e.stroke()},kv=(e,r,i)=>{Fi(r)?Nv(e,r,i):Fn(r)&&R3(e,r,i)},R3=(e,r,i={})=>{let o=Je(e,i),{a,b:n,cubic1:s,cubic2:l}=r,u=i.debug??!1;e.beginPath(),e.moveTo(a.x,a.y),e.bezierCurveTo(s.x,s.y,l.x,l.y,n.x,n.y),e.stroke(),u&&(o=o.push(qc({...i,strokeStyle:mi(i.strokeStyle??"silver",.6),fillStyle:mi(i.fillStyle??"yellow",.4)})),o.apply(),e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.stroke(),e.moveTo(n.x,n.y),e.lineTo(l.x,l.y),e.stroke(),e.fillText("a",a.x+5,a.y),e.fillText("b",n.x+5,n.y),e.fillText("c1",s.x+5,s.y),e.fillText("c2",l.x+5,l.y),wt(e,s,{radius:3}),wt(e,l,{radius:3}),wt(e,a,{radius:3}),wt(e,n,{radius:3}),o=o.pop(),o.apply())},Nv=(e,r,i={})=>{let{a:o,b:a,quadratic:n}=r,s=i.debug??!1,l=Je(e,i);e.beginPath(),e.moveTo(o.x,o.y),e.quadraticCurveTo(n.x,n.y,a.x,a.y),e.stroke(),s&&(l=l.push(qc({...i,strokeStyle:mi(i.strokeStyle??"silver",.6),fillStyle:mi(i.fillStyle??"yellow",.4)})),Rn(e,[o,n,a]),e.fillText("a",o.x+5,o.y),e.fillText("b",a.x+5,a.y),e.fillText("h",n.x+5,n.y),wt(e,n,{radius:3}),wt(e,o,{radius:3}),wt(e,a,{radius:3}),l=l.pop(),l.apply())},_c=(e,r,i={})=>{let o=i.debug??!1,a=B3(i.lineWidth,i.lineJoin,i.lineCap);Je(e,i,a);let n=s=>{let{a:l,b:u}=s;e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(u.x,u.y),o&&(e.fillText("a",l.x,l.y),e.fillText("b",u.x,u.y),wt(e,l,{radius:5,strokeStyle:"black"}),wt(e,u,{radius:5,strokeStyle:"black"})),e.stroke()};if(Array.isArray(r))for(let s of r)n(s);else n(r)},V3=(e,r,i={})=>{Je(e,i);let o=a=>{Rn(e,sl(a),{...i,loop:!0}),i.debug&&Vn(e,sl(a),void 0,["a","b","c"])};if(Array.isArray(r))for(let a of r)o(a);else o(r)},Wa=(e,r,i={})=>{Je(e,i);let o=i.filled??i.fillStyle!==void 0,a=i.stroke??i.strokeStyle!==void 0,n=s=>{let l="x"in s?s.x:0,u="y"in s?s.y:0;o&&e.fillRect(l,u,s.width,s.height),a&&(i.strokeWidth&&(e.lineWidth=i.strokeWidth),e.strokeRect(l,u,s.width,s.height)),i.crossed&&(e.beginPath(),e.moveTo(l,u),e.lineTo(s.width,s.height),e.stroke(),e.moveTo(0,s.height),e.lineTo(s.width,0),e.stroke()),i.debug&&Vn(e,Vr(s),void 0,["NW","NE","SE","SW"])};if(Array.isArray(r))for(let s of r)n(s);else n(r)},L3=(e,r,i=0,o)=>Wc(e,r,i,o).width,Wc=(e,r,i=0,o)=>{if(r==null||r.length===0)return xn;let a=e.measureText(r);return{width:o?Br(a.width,o)+i:a.width+i,height:a.actualBoundingBoxAscent+a.actualBoundingBoxDescent+i+i}},I3=(e,r,i=0)=>Wc(e,r,i).height,Pv=(e,r,i)=>{Je(e,i);let o=i.anchorPadding??0,a=i.align??"top",n=i.anchor,s=i.bounds??{x:0,y:0,width:1e6,height:1e6},l=r.map(y=>e.measureText(y)),u=l.map(y=>y.width),c=l.map(y=>y.actualBoundingBoxAscent+y.actualBoundingBoxDescent+3),f=Math.max(...u),d=c.reduce((y,g)=>y+g,0),{x:h,y:p}=n;n.x+f>s.width?h=s.width-(f+o):h-=o,h<s.x&&(h=s.x+o),n.y+d>s.height?p=s.height-(d+o):p-=o,p<s.y&&(p=s.y+o),a==="top"?e.textBaseline="top":e.textBaseline="middle";for(let[y,g]of r.entries())e.fillText(g,h,p),p+=c[y]},q3=(e,r,i)=>{let{bounds:o}=i,{horiz:a="left",vert:n="top"}=i,s=typeof r=="string"?[r]:r;Je(e,i),e.save(),e.translate(o.x,o.y),e.textAlign="left",e.textBaseline="top";let l=o.width/2,u=o.height/2,c=s.map(p=>e.measureText(p)),f=c.map(p=>p.actualBoundingBoxAscent+p.actualBoundingBoxDescent),d=f.reduce((p,y)=>p+y,0),h=0;n==="center"?h=u-d/2:n==="bottom"&&(h=o.height-d);for(let[p,y]of s.entries()){let g=0;a==="center"?g=l-c[p].width/2:a==="right"&&(g=o.width-c[p].width),e.fillText(y,g,h),h+=f[p]}e.restore()};var Mv=Object.defineProperty,_3=(e,r,i)=>r in e?Mv(e,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[r]=i,W3=(e,r)=>{for(var i in r)Mv(e,i,{get:r[i],enumerable:!0})},Mr=(e,r,i)=>_3(e,typeof r=="symbol"?r:r+"",i);function z(e,r){if(e)return;let i=Error(r||"Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");throw i.name="colorizr",i}var Mt={hsl:["h","s","l"],oklab:["l","a","b"],oklch:["l","c","h"],rgb:["r","g","b"]},G3=["hsl","oklab","oklch","rgb"],gd=Math.PI/180,ai={l:[.3963377773761749,.2158037573099136],m:[-.1055613458156586,-.0638541728258133],s:[-.0894841775298119,-1.2914855480194092]},Ut={l:[.4122214708,.5363325363,.0514459929],m:[.2119034982,.6806995451,.1073969566],s:[.0883024619,.2817188376,.6299787005]},Jt={l:[.2104542553,.793617785,.0040720468],a:[1.9779984951,2.428592205,.4505937099],b:[.0259040371,.7827717662,.808675766]},Ht={r:[4.076741636075958,-3.307711539258063,.2309699031821043],g:[-1.2684379732850315,2.609757349287688,-.341319376002657],b:[-.0041960761386756,-.7034186179359362,1.7076146940746117]},yr=5,U3=180/Math.PI,_={alpha:"amount must be a number between 0 and 1",input:"input is required",inputHex:"input is required and must be a hex",inputNumber:"input is required and must be a number",inputString:"input is required and must be a string",invalid:"invalid input",invalidCSS:"invalid CSS string",left:"left is required and must be a string",right:"right is required and must be a string",threshold:"threshold must be a number between 0 and 255"},Ln={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function J3(e){return Array.isArray(e)&&e.length===6}function Yr(e){return de(e)&&Object.keys(Ln).includes(e.toLowerCase())}function lt(e){return typeof e=="number"&&!Number.isNaN(e)}function Mi(e){if(!e)return!1;let{toString:r}=Object.prototype,i=Object.getPrototypeOf(e);return r.call(e)==="[object Object]"&&(i===null||i===Object.getPrototypeOf({}))}function de(e,r=!0){let i=typeof e=="string";return r?i&&!!e.trim().length:i}function Bv(e){return In(e)||Wn(e)||qn(e)||_n(e)}function we(e){return de(e)?/^#([\da-f]{3,4}|[\da-f]{6,8})$/i.test(e):!1}function In(e){if(!Mi(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="h"?o>=0&&o<=360:i==="alpha"?o>=0&&o<=1:Mt.hsl.includes(i)&&o>=0&&o<=100)}function qn(e){if(!Mi(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="l"?o>=0&&o<=100:i==="alpha"?o>=0&&o<=1:Mt.oklab.includes(i)&&o>=-1&&o<=1)}function _n(e){if(!Mi(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="l"?o>=0&&o<=100:i==="alpha"?o>=0&&o<=1:Mt.oklch.includes(i)&&o>=0&&o<=(i==="h"?360:1))}function Wn(e){if(!Mi(e))return!1;let r=Object.entries(e);return!!r.length&&r.every(([i,o])=>i==="alpha"?o>=0&&o<=1:Mt.rgb.includes(i)&&o>=0&&o<=255)}function Ve(e,r){z(Bv(e),_.invalid);let i=r;return!i||(i>1&&(i/=100),i===1)?e:{...e,alpha:i}}function mr(e,r=0,i=100){return Math.min(Math.max(e,r),i)}function H3(e,r){z(lt(e),_.inputNumber);let i=e+r;return i>360&&(i%=360),i<0&&(i+=360),Math.abs(i)}function Zt(e,r,i){switch(z(lt(e),"Input is not a number"),z(G3.includes(r),`Invalid model${r?`: ${r}`:""}`),z(Mt[r].includes(i),`Invalid key${i?`: ${i}`:""}`),r){case"hsl":return z(Mt.hsl.includes(i),"Invalid key"),["s","l"].includes(i)?mr(e):mr(e,0,360);case"rgb":return z(Mt.rgb.includes(i),"Invalid key"),mr(e,0,255);default:throw Error("Invalid inputs")}}function qe(e,r){let i=Mt[r],o={hsl:In,oklab:qn,oklch:_n,rgb:Wn};z(Mi(e)||Array.isArray(e),_.invalid);let a=Array.isArray(e)?{[i[0]]:e[0],[i[1]]:e[1],[i[2]]:e[2]}:e;return z(o[r](a),`invalid ${r} color`),a}function pi(e,r=yr,i=!0){let o=new Map(Object.entries(e));for(let[a,n]of o.entries())o.set(a,ge(n,r,i));return Object.fromEntries(o)}function ge(e,r=2,i=!0){if(!lt(e)||e===0)return 0;if(i){let l=10**r;return Math.round(e*l)/l}let o=Math.abs(e),a=Math.abs(Math.ceil(Math.log(o)/Math.LN10));a===0?a=2:a>r&&(a=r);let n=r-(a<0?0:a);n<=1&&r>1?n=2:(n>r||n===0)&&(n=r);let s=10**n;return Math.round(e*s)/s}function md(e,r){return z(we(e),_.inputHex),z(lt(r),_.inputNumber),r>=1?Ua(e):`${Ua(e)}${Ga(r)}`}function Ga(e){z(lt(e),_.inputNumber);let r=e;return e>1&&(r/=100),Math.round(r*255).toString(16).padStart(2,"0")}function Gc(e){z(we(e),_.inputString);let r=e.substring(7,9);return r?ge(parseInt(r,16)/255):1}function Ua(e){return z(we(e),_.inputHex),e.length===5?e.substring(0,4):e.substring(0,7)}var zr={};W3(zr,{hex2hsl:()=>Uc,hex2oklab:()=>zv,hex2oklch:()=>Hc,hex2rgb:()=>$r,hsl2hex:()=>Tv,hsl2oklab:()=>Ov,hsl2oklch:()=>jv,hsl2rgb:()=>zi,oklab2hex:()=>e5,oklab2hsl:()=>Rv,oklab2oklch:()=>Jc,oklab2rgb:()=>Ti,oklch2hex:()=>i5,oklch2hsl:()=>Vv,oklch2oklab:()=>Kc,oklch2rgb:()=>Un,rgb2hex:()=>Gn,rgb2hsl:()=>Bi,rgb2oklab:()=>Xo,rgb2oklch:()=>Yo});function K3(e){z(we(e),_.inputHex);let r=e.replace("#","");if(r.length===3||r.length===4){let o=[...r];r="",o.forEach(a=>{r+=`${a}${a}`})}let i=`#${r}`;return z(we(i),"invalid hex"),i}function $r(e){z(we(e),_.inputHex);let r=K3(e).slice(1);return{r:parseInt(r.charAt(0)+r.charAt(1),16),g:parseInt(r.charAt(2)+r.charAt(3),16),b:parseInt(r.charAt(4)+r.charAt(5),16)}}function Bi(e){let r=qe(e,"rgb"),i=Zt(r.r,"rgb","r")/255,o=Zt(r.g,"rgb","g")/255,a=Zt(r.b,"rgb","b")/255,n=Math.min(i,o,a),s=Math.max(i,o,a),l=s-n,u=0,c,f=(s+n)/2,d;switch(s){case i:d=l?(o-a)/l:0,u=60*d;break;case o:d=(a-i)/l,u=60*d+120;break;case a:d=(i-o)/l,u=60*d+240;break}return u<0&&(u=360+u),c=n===s?0:f<.5?l/(2*f):l/(2-2*f),{h:Math.abs(+(u%360).toFixed(2)),s:+(c*100).toFixed(2),l:+(f*100).toFixed(2)}}function Uc(e){return z(we(e),_.inputHex),Bi($r(e))}var{cbrt:ws,sign:Q3}=Math;function xs(e){let r=Math.abs(e);return r<.04045?e/12.92:(Q3(e)||1)*((r+.055)/1.055)**2.4}function Xo(e,r=yr){let i=qe(e,"rgb"),[o,a,n]=[xs(i.r/255),xs(i.g/255),xs(i.b/255)],s=ws(Ut.l[0]*o+Ut.l[1]*a+Ut.l[2]*n),l=ws(Ut.m[0]*o+Ut.m[1]*a+Ut.m[2]*n),u=ws(Ut.s[0]*o+Ut.s[1]*a+Ut.s[2]*n),c={l:Jt.l[0]*s+Jt.l[1]*l-Jt.l[2]*u,a:Jt.a[0]*s-Jt.a[1]*l+Jt.a[2]*u,b:Jt.b[0]*s+Jt.b[1]*l-Jt.b[2]*u};return pi(c,r)}function zv(e,r){return z(we(e),_.inputHex),Xo($r(e),r)}var{atan2:Z3,sqrt:X3}=Math;function Jc(e,r){let{l:i,a:o,b:a}=pi(qe(e,"oklab")),n=X3(o**2+a**2),s=(Z3(a,o)*U3+360)%360;return ge(n*1e4)===0&&(s=0),pi({l:i,c:n,h:s},r)}function Yo(e,r){let i=qe(e,"rgb");return Jc(Xo(i,r),r)}function Hc(e,r){return z(we(e),_.inputHex),Yo($r(e),r)}function Es(e,r,i){z(lt(e)&&lt(r)&&lt(i),"point, chroma and h are required");let o=i;return o<0&&(o+=1),o>1&&--o,ge(o<1/6?e+(r-e)*6*o:o<1/2?r:o<2/3?e+(r-e)*(2/3-o)*6:e,4)}function zi(e){let r=qe(e,"hsl"),i=ge(r.h)/360,o=ge(r.s)/100,a=ge(r.l)/100,n,s,l,u,c;return o===0?(n=a,s=a,l=a):(c=a<.5?a*(1+o):a+o-a*o,u=2*a-c,n=Es(u,c,i+1/3),s=Es(u,c,i),l=Es(u,c,i-1/3)),{r:Math.round(n*255),g:Math.round(s*255),b:Math.round(l*255)}}function Gn(e){let r=qe(e,"rgb");return`#${Object.values(r).map(i=>`0${Math.floor(i).toString(16)}`.slice(-2)).join("")}`}function Tv(e){let r=qe(e,"hsl");return Gn(zi(r))}function Ov(e,r){let i=qe(e,"hsl");return Xo(zi(i),r)}function jv(e,r){let i=qe(e,"hsl");return Yo(zi(i),r)}var{abs:Y3}=Math;function Ds(e){let r=Y3(e),i=e<0?-1:1;return r>.0031308?i*(r**(1/2.4)*1.055-.055):e*12.92}function Ti(e,r=0){let{l:i,a:o,b:a}=qe(e,"oklab"),n=(i+ai.l[0]*o+ai.l[1]*a)**3,s=(i+ai.m[0]*o+ai.m[1]*a)**3,l=(i+ai.s[0]*o+ai.s[1]*a)**3,u=255*Ds(Ht.r[0]*n+Ht.r[1]*s+Ht.r[2]*l),c=255*Ds(Ht.g[0]*n+Ht.g[1]*s+Ht.g[2]*l),f=255*Ds(Ht.b[0]*n+Ht.b[1]*s+Ht.b[2]*l);return{r:mr(ge(u,r),0,255),g:mr(ge(c,r),0,255),b:mr(ge(f,r),0,255)}}function e5(e){let r=qe(e,"oklab");return Gn(Ti(r))}function Rv(e){let r=qe(e,"oklab");return Bi(Ti(r))}var{sin:t5,cos:r5}=Math;function Kc(e,r){let{l:i,c:o,h:a}=qe(e,"oklch");return(Number.isNaN(a)||a<0)&&(a=0),pi({l:i,a:o*r5(a*gd),b:o*t5(a*gd)},r)}function Un(e,r=0){let i=qe(e,"oklch");return Ti(Kc(i),r)}function i5(e){let r=qe(e,"oklch");return Gn(Un(r))}function Vv(e){let r=qe(e,"oklch");return Bi(Un(r))}function Qe(e){if(z(de(e),_.inputString),we(e)){let s=Mt.rgb,{r:l,g:u,b:c}=$r(e),f=Gc(e);return{model:"rgb",[s[0]]:l,[s[1]]:u,[s[2]]:c,alpha:f<1?f:void 0}}let r=/(?:(rgb|hsl|oklab|oklch)a?\s*\(\s*([\d%.-]+)\s*[ ,/]\s*([\d%.-]+)\s*[ ,/]\s*([\d%.-]+)(?:\s*[ ,/]\s*([\d%.-]+))?\s*\))/i,i=r.exec(e);z(J3(i),_.invalidCSS);let o=i[1],a=Mt[o],n=i[5]?parseFloat(i[5]):1;return n>1&&(n/=100),{model:o,[a[0]]:parseFloat(i[2]),[a[1]]:parseFloat(i[3]),[a[2]]:parseFloat(i[4]),alpha:n<1?n:void 0}}function Se(e,r){z(de(e),_.inputString);let i,o=Yr(e)?Ln[e.toLowerCase()]:e,a=r??(we(o)?"hex":Qe(o).model),n=s=>Object.values(s);if(we(o)){let s=Gc(o);switch(a){case"hsl":i=Ve(Uc(o),s);break;case"oklab":i=Ve(zv(o),s);break;case"oklch":i=Ve(Hc(o),s);break;case"rgb":i=Ve($r(o),s);break;default:i=`${Ua(o)}${s===1?"":Ga(s)}`;break}return i}switch(a){case"hsl":{let{alpha:s,model:l,...u}=Qe(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ge(u.l/100,yr)),i=Ve(l==="hsl"?u:zr[`${l}2hsl`](n(u)),s);break}case"oklab":{let{alpha:s,model:l,...u}=Qe(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ge(u.l/100,yr)),i=Ve(l==="oklab"?u:zr[`${l}2oklab`](n(u)),s);break}case"oklch":{let{alpha:s,model:l,...u}=Qe(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ge(u.l/100,yr)),i=Ve(l==="oklch"?u:zr[`${l}2oklch`](n(u)),s);break}case"rgb":{let{alpha:s,model:l,...u}=Qe(o);["oklab","oklch"].includes(l)&&u.l>1&&(u.l/=100),i=Ve(l==="rgb"?u:zr[`${l}2rgb`](n(u)),s);break}case"hex":default:{let{alpha:s,model:l,...u}=Qe(o),c="";["oklab","oklch"].includes(l)&&u.l>1&&(u.l=ge(u.l/100,yr)),s&&(c=Ga(s)),i=`${zr[`${l}2hex`](n(u))}${c}`;break}}return i}function o5(e){z(!!e,_.input);let r={};if(de(e)){let{alpha:i=1}=Qe(e),o=we(e)?"hex":Qe(e).model;r.hex=md(Se(e,"hex"),i),r.hsl=Ve(Se(e,"hsl"),i),r.oklab=Ve(Se(e,"oklab"),i),r.oklch=Ve(Se(e,"oklch"),i),r.rgb=Ve(Se(e,"rgb"),i),r.alpha=i,r.type=o}else if(Mi(e)){let{alpha:i=1}=e;if(In(e))r.hsl={h:Zt(e.h,"hsl","h"),s:Zt(e.s,"hsl","s"),l:Zt(e.l,"hsl","l")},r.rgb=zi(r.hsl),r.oklab=Ov(r.hsl),r.oklch=jv(r.hsl),r.type="hsl";else if(qn(e))r.hsl=Rv(e),r.oklab=e,r.oklch=Jc(e),r.rgb=Ti(e),r.type="oklab";else if(_n(e))r.hsl=Vv(e),r.oklab=Kc(e),r.oklch=e,r.rgb=Un(e),r.type="oklch";else if(Wn(e))r.rgb={r:Zt(e.r,"rgb","r"),g:Zt(e.g,"rgb","g"),b:Zt(e.b,"rgb","b")},r.hsl=Bi(r.rgb),r.oklab=Xo(r.rgb),r.oklch=Yo(r.rgb),r.type="rgb";else throw Error("invalid color");r.hex=md(Tv(r.hsl),i),r.hsl=Ve(r.hsl,i),r.oklab=Ve(r.oklab,i),r.oklch=Ve(r.oklch,i),r.rgb=Ve(r.rgb,i),r.alpha=i}else throw Error(_.input);return r}function Lv(e,r,i=yr){z(de(e),_.left),z(de(r),_.right);let o=Se(e,"rgb"),a=Se(r,"rgb"),n=(o.r*299+o.g*587+o.b*114)/1e3,s=(a.r*299+a.g*587+a.b*114)/1e3;return ge(Math.abs(s-n),i)}function a5(e){z(de(e),_.inputString);let{r,g:i,b:o}=Se(e,"rgb"),a=Math.max(r,i,o),n=Math.min(r,i,o);return ge((a-n)/255,4)}function Iv(e,r){z(de(e),_.left),z(de(r),_.right);let i=Se(e,"rgb"),o=Se(r,"rgb");return Math.max(i.r,o.r)-Math.min(i.r,o.r)+(Math.max(i.g,o.g)-Math.min(i.g,o.g))+(Math.max(i.b,o.b)-Math.min(i.b,o.b))}function ul(e){z(de(e),_.inputString);let{r,g:i,b:o}=Se(e,"rgb"),a=[r/255,i/255,o/255];for(let n=0;n<a.length;n++)a[n]<=.03928?a[n]/=12.92:a[n]=((a[n]+.055)/1.055)**2.4;return ge(.2126*a[0]+.7152*a[1]+.0722*a[2],4)}function qv(e,r){z(de(e),_.left),z(de(r),_.right);let i=ul(e),o=ul(r);return ge(i>=o?(i+.05)/(o+.05):(o+.05)/(i+.05))}function n5(e,r){z(de(e),_.left),z(de(r),_.right);let i=500,o=125,a=Iv(e,r),n=qv(e,r),s=Lv(e,r),l=s>=o,u=a>=i,c=0;return l&&u?c=2:(l||u)&&(c=1),{brightnessDifference:s,colorDifference:a,compliant:c,contrast:n,largeAA:n>=3,largeAAA:n>=4.5,normalAA:n>=4.5,normalAAA:n>=7}}function s5(e){if(we(e)||Yr(e))return"hex";if(de(e))return Qe(e).model;if(In(e))return"hsl";if(qn(e))return"oklab";if(_n(e))return"oklch";if(Wn(e))return"rgb";throw Error(_.invalid)}function Yi(e,r){let i=Yr(e)?Ln[e.toLowerCase()]:e,o=s5(i);if(o===r)return i;let a=`${o}2${r}`,n=zr[a];if(!n)throw Error(`Converter not found for ${o} to ${r}`);switch(o){case"hex":return r==="hex"?i:n(i);case"hsl":return r==="hsl"?i:n(i);case"oklab":return r==="oklab"?i:n(i);case"oklch":return r==="oklch"?i:n(i);default:return r==="rgb"?i:n(i)}}function xr(e,r={}){z(we(e)||Bv(e),_.invalid);let{alpha:i,format:o="hex",precision:a=yr,separator:n=" "}=r,s=i&&i!==1?`${ge(i*100)}%`:null,l=[],u=n;switch(o){case"hsl":{let{h:c,s:f,l:d}=Yi(e,"hsl");l=[c,`${f}%`,`${d}%`];break}case"oklab":{u=" ";let{l:c,a:f,b:d}=pi(Yi(e,"oklab"),a);l=[`${ge(c*100,a)}%`,f,d];break}case"oklch":{u=" ";let{l:c,c:f,h:d}=pi(Yi(e,"oklch"),a);l=[`${ge(c*100,a)}%`,f,d];break}case"rgb":{let{r:c,g:f,b:d}=Yi(e,"rgb");l=[c,f,d];break}default:{let c=Ua(Yi(e,"hex"));return i&&i!==1?`${c}${Ga(i)}`:c}}return`${o}(${l.join(u)}${s?` / ${s}`:""})`}function Jn(e,r,i){return(o,a)=>{z(de(o),_.inputString),z(lt(a),_.alpha);let n=Se(o,"hsl"),s=we(o)||Yr(o)?"hex":Qe(o).model;return xr({...n,[e]:mr(n[e]+(r==="+"?a:-a),0,100)},{format:s})}}function l5(e,r,i){return Jn("l","-")(e,r)}function u5(e,r,i){return Jn("s","-")(e,r)}function _v(e,r,i){z(de(e),_.inputString),z(lt(r),"degrees must be a number");let o=Se(e,"hsl"),a=we(e)||Yr(e)?"hex":Qe(e).model;return xr({...o,h:H3(o.h,r)},{format:a})}function c5(e){z(de(e),_.inputString);let r=we(e)||Yr(e)?"hex":Qe(e).model,i=Se(e,"hex");return xr(_v(i,180),{format:r})}function f5(e,r,i){return Jn("l","+")(e,r)}function d5(e,r,i){z(de(e),_.inputString),z(lt(r),_.alpha);let o=we(e)||Yr(e)?"hex":Qe(e).model,a=Se(e,"rgb");return xr(a,{format:i??o,alpha:r})}function Wv(e){if(z(de(e),_.inputString),we(e))return Gc(e);if(Object.keys(Ln).includes(e))return 1;let{alpha:r}=Qe(e);return r||1}function h5(e,r,i){return Jn("s","+")(e,r)}function p5(e,r={}){let{darkColor:i="#000000",lightColor:o="#ffffff",threshold:a=128}=r;z(de(e),_.inputString),z(a>=0&&a<=255,_.threshold);try{let{r:n,g:s,b:l}=$r(Se(e,"hex"));return(n*299+s*587+l*114)/1e3>=a?i:o}catch(n){return console.warn(`Invalid color input: ${e}`),console.warn(n),i}}function y5(e,r,i){z(de(e),_.inputString),z(lt(r),_.alpha),z(r>=-1&&r<=1,_.alpha);let o=Se(e,"oklab"),a=ge(mr(Wv(e)-r,0,1));return xr(o,{format:i,alpha:a})}var g5=class{constructor(e,r={}){Mr(this,"alpha"),Mr(this,"hex"),Mr(this,"hsl"),Mr(this,"oklab"),Mr(this,"oklch"),Mr(this,"rgb"),Mr(this,"type"),z(!!e,"color is required");let{alpha:i,hex:o,hsl:a,oklab:n,oklch:s,rgb:l,type:u}=o5(e);this.hex=o,this.hsl=a,this.oklab=n,this.oklch=s,this.rgb=l,this.alpha=i,this.type=r.format??u}get css(){return this.selectedColor}get red(){return Number(this.rgb.r)}get green(){return Number(this.rgb.g)}get blue(){return Number(this.rgb.b)}get hue(){return Number(this.hsl.h)}get saturation(){return Number(this.hsl.s)}get lightness(){return Number(this.hsl.l)}get luminance(){return ul(this.selectedColor)}get chroma(){return a5(this.selectedColor)}get opacity(){return Wv(this.selectedColor)}get textColor(){return p5(this.selectedColor)}get selectedColor(){return xr(this[this.type],{format:this.type,alpha:this.alpha})}brightnessDifference(e){return Lv(this.selectedColor,e)}colorDifference(e){return Iv(this.selectedColor,e)}compare(e){return n5(this.selectedColor,e)}contrast(e){return qv(this.selectedColor,e)}format(e,r){return xr(this.rgb,{alpha:this.alpha,format:e,precision:r})}lighten(e){return f5(this.selectedColor,e)}darken(e){return l5(this.selectedColor,e)}saturate(e){return h5(this.selectedColor,e)}desaturate(e){return u5(this.selectedColor,e)}invert(){return c5(this.selectedColor)}opacify(e=.9){return d5(this.selectedColor,e,this.type)}rotate(e){return _v(this.selectedColor,e)}transparentize(e=.1){return y5(this.selectedColor,e,this.type)}};function Qc(e,r){let i=Se(e,r);return xr(i,{format:r})}var Hn=g5;const Wr=e=>!(typeof e!="object"||!("h"in e)||!("s"in e)||!("l"in e)||!("unit"in e)||!("space"in e)||e.space!=="hsl"),br=e=>typeof e!="object"||!("r"in e)||!("g"in e)||!("b"in e)||!("space"in e)||!("unit"in e)?!1:e.space==="srgb",Gv=e=>{if("r"in e&&"g"in e&&"b"in e){if(!("unit"in e))if(e.r<=1&&e.g<=1&&e.b<=1)e.unit="scalar";else{if(e.r>255&&e.g<=255&&e.b<=255)return;e.unit="8bit"}return"space"in e||(e.space="srgb"),e}},Uv=e=>{if("h"in e&&"s"in e&&"l"in e){if(!("unit"in e))if(e.r<=1&&e.g<=1&&e.b<=1)e.unit="scalar";else{if(e.s>100&&e.l<=100)return;e.unit="absolute"}return"space"in e||(e.space="hsl"),e}},vo=e=>typeof e!="object"||!("l"in e)||!("c"in e)||!("h"in e)||!("unit"in e)||!("space"in e)?!1:e.space==="lch"||e.space==="oklch",Jv=e=>typeof e=="string"?!0:typeof e=="object"?!!(Wr(e)||vo(e)||br(e)):!1;function Hv(e,r,i=1){let o=-1,a=-1;r<e?(o=r-e,a=i-(e-r)):(o=r-e,a=o-i);let n=a>0?a:o,s=a>0?o:a;if(Math.abs(o)<Math.abs(a)){let l=a;a=o,o=l}return{long:o,short:a,forward:n,backward:s}}function Kv(e){return e%=1,e<0?(1-Math.abs(e))%1:e}var Qv={};C(Qv,{absolute:()=>xo,changeLightness:()=>m5,fromCss:()=>Gr,fromHexString:()=>cl,generateScalar:()=>w5,guard:()=>ji,interpolator:()=>Zc,parseCssHslFunction:()=>Xv,scalar:()=>Ur,toAbsolute:()=>Oi,toCssString:()=>wo,toLibraryRgb:()=>ea,toScalar:()=>yi,withOpacity:()=>Zv});const Zv=(e,r)=>{switch(e.unit){case"absolute":return{...e,opacity:r((e.opacity??100)/100,e)*100};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}},m5=(e,r)=>{let i=0;if(r.pdelta!==void 0)i=e.l+e.l*r.pdelta;else if(r.delta!==void 0)i=r.delta+e.l;else if(r.fixed!==void 0){if(r.fixed<0)throw TypeError("Cannot use negative value with 'fixed'");i=r.fixed}else throw TypeError("Parameter 'amount' is missing 'delta/pdelta/fixed' properties");return{...e,l:b5(e,i)}},b5=(e,r,i)=>(e.unit==="scalar"?r>1?r=1:r<0&&(r=0):r>100?r=100:r<0&&(r=0),r),v5=Object.freeze({h:0,s:0,l:0,opacity:0,unit:"absolute",space:"hsl"});function cl(e,r={}){return Kn(Uc(e),r)}function Gr(e,r={}){if(e=e.toLowerCase(),e.startsWith("hsla("))throw Error("hsla() not supported");if(e.startsWith("rgba("))throw Error("rgba() not supported");if(e.startsWith("#"))return cl(e,r);if(e.startsWith("--"))try{e=rf(e)}catch(i){if(r.fallbackString!==void 0&&(e=r.fallbackString),r.fallbackColour!==void 0)return r.fallbackColour;throw i}if(e==="transparent")return v5;if(Dt[e]!==void 0)return cl(Dt[e],r);if(e.startsWith("rgb(")){let i=ra(e);return Kn(i,r)}if(!e.startsWith("hsl("))try{e=Qc(e,"hsl")}catch(i){if(r.fallbackString)e=r.fallbackString;else throw i}try{let i=Xv(e);return r.scalar?yi(i):Oi(i)}catch(i){if(r.fallbackColour)return r.fallbackColour;throw i}}const wo=e=>{let r=Oi(e),i=`hsl(${r.h}deg ${r.s}% ${r.l}%`;return"opacity"in r&&r.opacity!==void 0&&r.opacity<100&&(i+=` / ${r.opacity}%`),i+=")",i};function Kn(e,r={}){if(e==null&&r.fallbackColour)return r.fallbackColour;let i=r.scalar??!0;return w(Ge(e.h,0,360,"h"),Ge(e.s,0,100,"s"),Ge(e.l,0,100,"l"),it(e.alpha??1,"alpha")),i?Ur(e.h/360,e.s/100,e.l/100,e.alpha??1):xo(e.h,e.s,e.l,(e.alpha??1)*100)}const Oi=e=>{if(typeof e=="string")return Gr(e,{scalar:!1});if(br(e))return Oi(Kn(ra(e),{scalar:!1}));let r=e;return ji(r),r.unit==="absolute"?r:{h:r.h*360,s:r.s*100,l:r.l*100,opacity:(r.opacity??1)*100,unit:"absolute",space:"hsl"}},w5=(e,r=1,i=.5,o=1)=>{typeof e=="string"&&e.startsWith("--")&&(e=getComputedStyle(document.body).getPropertyValue(e).trim());let a=An(e);if(r>1)throw TypeError("Param 'saturation' must be between 0..1");if(i>1)throw TypeError("Param 'lightness' must be between 0..1");if(o>1)throw TypeError("Param 'opacity' must be between 0..1");return{h:ic(a,"deg").value/360,s:r,l:i,opacity:o,unit:"scalar",space:"hsl"}},yi=e=>{if(typeof e=="string")return Gr(e,{scalar:!0});if(br(e))return yi(Kn(ra(e),{scalar:!0}));let r=e;return ji(r),r.unit==="scalar"?r:{h:r.h/360,s:r.s/100,l:r.l/100,opacity:(r.opacity??1)/100,unit:"scalar",space:"hsl"}},ji=e=>{let{h:r,s:i,l:o,opacity:a,space:n,unit:s}=e;if(n!=="hsl")throw Error(`Space is expected to be 'hsl'. Got: ${n}`);if(s==="absolute")w($(r,"finite","h"),Ge(i,0,100,"s"),Ge(o,0,100,"l"),()=>{if(typeof a=="number")return Ge(a,0,100,"opacity")});else if(s==="scalar")w($(r,"percentage","h"),$(i,"percentage","s"),$(o,"percentage","l"),()=>{if(typeof a=="number")return $(a,"percentage","opacity")});else throw Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${s}`)},Zc=(e,r,i="shorter")=>{e=yi(e),r=yi(r);let o=e.opacity??1,a=Hv(e.h,r.h,1),n=i==="longer"?a.long:a.short,s=r.s-e.s,l=r.l-e.l,u=(r.opacity??1)-o;return c=>{c=ie(c);let f=De(c,0,Math.abs(n));f=n<0?e.h-f:e.h+f;let d=De(c,0,s),h=De(c,0,l),p=De(c,0,u);return Ur(Kv(f),d+e.s,h+e.l,p+o)}};function Ur(e=.5,r=1,i=.5,o=1){let a={unit:"scalar",space:"hsl",h:e,s:r,l:i,opacity:o};return ji(a),a}function xo(e=200,r=100,i=50,o=100){let a={unit:"absolute",space:"hsl",h:e,s:r,l:i,opacity:o};return ji(a),a}function Xv(e){if(e.startsWith("hsla"))throw Error("hsla() is not supported");if(!e.startsWith("hsl("))throw Error("Expected hsl(..) CSS colour");let r=e.indexOf("("),i=e.indexOf(")");if(i<r)throw Error("Is hsl() not terminated? Missing ')'");let o=e.substring(r+1,i),a=o.split(/[\s,]+/);if(a.length<3)throw Error(`Expected three tokens. Got: ${a.length} length`);let n=!1;a[0].endsWith("%")&&(n=!0),a[1].endsWith("%")&&a[2].endsWith("%")&&(n=!0);let s=(u,c)=>{if(u==="none")return 0;if(u.endsWith("%"))return Number.parseFloat(u.substring(0,u.length-1))/100;u.endsWith("deg")&&c===0&&(u=u.substring(0,u.length-3));let f=Number.parseFloat(u);return c===0?f/360:c===3?f:f/100},l=(u,c)=>{if(u==="none")return 0;if(u.endsWith("%")){let d=Number.parseFloat(u.substring(0,u.length-1));return c===0?d*360:d}return u.endsWith("deg")&&c===0?Number.parseFloat(u.substring(0,u.length-3)):Number.parseFloat(u)};return a.length>3&&a[3]==="/"&&(a=[a[0],a[1],a[2],a[4]]),n?Ur(s(a[0],0),s(a[1],1),s(a[2],2),s(a[3]??"100%",3)):xo(l(a[0],0),l(a[1],1),l(a[2],2),l(a[3]??"100%",3))}function ea(e){if(typeof e=="string"){let i=Gr(e,{scalar:!1});return ea(i)}return e=Oi(e),{...zi({h:e.h,s:e.s,l:e.l}),alpha:(e.opacity??100)/100*255}}var Yv={};C(Yv,{OKLCH_CHROMA_MAX:()=>Ri,absolute:()=>r1,fromCss:()=>Qn,fromHexString:()=>fl,fromLibrary:()=>Ja,generateScalar:()=>E5,guard:()=>ei,interpolator:()=>Yc,scalar:()=>ef,toAbsolute:()=>Xc,toCssString:()=>e1,toScalar:()=>Eo,withOpacity:()=>t1});const Ri=.4,ei=e=>{let{l:r,c:i,h:o,opacity:a,space:n,unit:s}=e;if(n!=="oklch")throw Error(`Space is expected to be 'oklch'. Got: ${n}`);if(s==="absolute")w(it(r,"l"),()=>{if(typeof i=="number")return Ge(i,0,Ri,"c")},()=>{if(typeof o=="number")return Ge(i,0,360,"h")},it(a??1,"opacity"));else if(s==="scalar")w(it(r,"l"),it(i,"c"),it(o,"h"),it(e.opacity??1,"opacity"));else throw Error(`Unit is expected to be 'absolute' or 'scalar'. Got: ${s}`)};function Ja(e,r={}){if(e==null&&r.fallbackColour)return r.fallbackColour;let i=r.scalar??!0;return w(it(e.l,"l"),it(e.c,"c"),Ge(e.h,0,360,"h"),it(e.alpha??1,"alpha")),i?ef(e.l,e.c/Ri,e.h/360,e.alpha??1):r1(e.l,e.c,e.h,e.alpha??1)}const fl=(e,r={})=>Ja(Hc(e),r),x5=Object.freeze({l:0,c:0,h:0,opacity:0,unit:"absolute",space:"oklch"});function Qn(e,r={}){if(e=e.toLowerCase(),e.startsWith("#"))return fl(e,r);if(e==="transparent")return x5;if(Dt[e]!==void 0)return fl(Dt[e],r);if(e.startsWith("rgb(")){let a=ti(af(e)),n=Yo({r:a.r,g:a.g,b:a.b});return Ja(n,r)}if(!e.startsWith("hsl(")&&!e.startsWith("oklch("))try{e=Qc(e,"oklch")}catch(a){if(r.fallbackString)e=r.fallbackString;else throw a}let i=new Hn(e),o=i.oklch;return Ja(o,r)}const Xc=e=>typeof e=="string"?Xc(Qn(e,{scalar:!0})):(ei(e),e.unit==="absolute"?e:{space:"oklch",unit:"absolute",l:e.l,c:e.c*Ri,h:e.h*360,opacity:e.opacity}),Eo=e=>{if(typeof e=="string")return Eo(Qn(e,{scalar:!0}));let r=e;return ei(r),r.unit==="scalar"?r:{l:r.l,c:r.c/Ri,h:r.h/360,opacity:r.opacity??1,unit:"scalar",space:"oklch"}},e1=(e,r=3)=>{ei(e);let{l:i,c:o,h:a,opacity:n}=e,s="";switch(e.unit){case"absolute":s=`oklch(${(i*100).toFixed(r)}% ${o.toFixed(r)} ${a.toFixed(r)}`;break;case"scalar":s=`oklch(${i.toFixed(r)} ${(o*Ri).toFixed(r)} ${(a*360).toFixed(r)}`;break}return n!==void 0&&n!==1&&(s+=` / ${n.toFixed(r)}`),s+=")",s},E5=(e,r=1,i=.5,o=1)=>{if(typeof e=="string"&&e.startsWith("--")&&(e=getComputedStyle(document.body).getPropertyValue(e).trim()),i>1)throw TypeError("Param 'lightness' must be between 0..1");if(r>1)throw TypeError("Param 'chroma' must be between 0..1");let a=An(e),n=ic(a,"deg").value/360;if(o>1)throw TypeError("Param 'opacity' must be between 0..1");return{l:i,c:r,h:n,opacity:o,unit:"scalar",space:"oklch"}},t1=(e,r)=>{switch(e.unit){case"absolute":return{...e,opacity:r((e.opacity??100)/100,e)*100};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}},Yc=(e,r,i="shorter")=>{e=Eo(e),r=Eo(r);let o=e.opacity??1,a=Hv(e.h,r.h,1),n=i==="longer"?a.long:a.short,s=r.c-e.c,l=r.l-e.l,u=(r.opacity??1)-o;return c=>{c=ie(c);let f=De(c,0,Math.abs(n));f=n<0?e.h-f:e.h+f;let d=De(c,0,s),h=De(c,0,l),p=De(c,0,u);return ef(h+e.l,d+e.c,Kv(f),p+o)}};function ef(e=.7,r=.1,i=.5,o=1){let a={unit:"scalar",space:"oklch",l:e,c:r,h:i,opacity:o};return ei(a),a}const r1=(e,r,i,o=1)=>{let a={space:"oklch",unit:"absolute",opacity:o,l:e,c:r,h:i};return ei(a),a},tf=e=>{if(e.startsWith("#"))return Do(e,!0);if(Dt[e]!==void 0)return Do(Dt[e],!0);if(e.startsWith("--")){let r=getComputedStyle(document.body).getPropertyValue(e).trim();if(r.length===0||r===null)throw Error(`Variable missing: ${e}`);return tf(r)}if(e=e.toLowerCase(),e.startsWith("hsl("))return Gr(e,{scalar:!0});if(e.startsWith("rgb("))return Vi(e,{scalar:!0});if(e.startsWith("oklch("))return Qn(e,{scalar:!0});throw Error(`String colour is not a hex colour, CSS variable nor well-defined colour. Input: '${e}'`)},rf=(e,r)=>{if(e.startsWith("--")){let i=getComputedStyle(document.body).getPropertyValue(e).trim();if(i.length===0||i===null){if(r!==void 0)return r;throw Error(`CSS variable missing: '${e}'`)}return rf(i)}return Dt[e]===void 0?e:Dt[e]},Dt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:"#00000000"};var i1={};C(i1,{changeLightness:()=>C5,eightBit:()=>a1,fromCss:()=>Vi,fromHexString:()=>Do,guard:()=>ri,interpolator:()=>nf,lightness:()=>$5,parseCssRgbFunction:()=>af,scalar:()=>of,to8bit:()=>ti,toCssString:()=>Co,toLibraryHsl:()=>ra,toScalar:()=>gi,withOpacity:()=>o1});const o1=(e,r)=>{switch(e.unit){case"8bit":return{...e,opacity:r((e.opacity??255)/255,e)*255};case"scalar":return{...e,opacity:r(e.opacity??1,e)}}};function Do(e,r=!0){return ta($r(e),{scalar:r})}const D5=Object.freeze({r:0,g:0,b:0,opacity:0,unit:"8bit",space:"srgb"});function Vi(e,r={}){if(e=e.toLowerCase(),e.startsWith("hsla("))throw Error("hsla() not supported");if(e.startsWith("rgba("))throw Error("rgba() not supported");let i=r.scalar??!0;if(e.startsWith("#"))return Do(e,i);if(e==="transparent")return D5;if(Dt[e]!==void 0&&Do(Dt[e],i),e.startsWith("hsl(")){let o=ea(e);return ta(o,r)}if(!e.startsWith("rgb("))try{e=Qc(e,"rgb")}catch(o){if(r.fallbackString)e=r.fallbackString;else throw o}try{let o=af(e);return i?gi(o):ti(o)}catch(o){if(r.fallbackColour)return r.fallbackColour;throw o}}const Co=e=>{switch(ri(e),e.unit){case"8bit":return e.opacity===void 0||e.opacity===255?`rgb(${e.r} ${e.g} ${e.b})`:`rgb(${e.r} ${e.g} ${e.b} / ${(e.opacity??255)/255})`;case"scalar":return e.opacity===void 0||e.opacity===1?`rgb(${e.r*100}% ${e.g*100}% ${e.b*100}%)`:`rgb(${e.r*100}% ${e.g*100}% ${e.b*100}% / ${(e.opacity??1)*100}%)`;default:throw Error(`Unknown unit: ${e.unit}`)}};function ta(e,r={}){return r.scalar?{r:e.r/255,g:e.g/255,b:e.b/255,opacity:e.alpha??1,unit:"scalar",space:"srgb"}:{r:e.r,g:e.g,b:e.b,opacity:e.alpha??255,unit:"8bit",space:"srgb"}}const ti=e=>typeof e=="string"?Vi(e,{scalar:!1}):Wr(e)?ti(ta(ea(e),{scalar:!1})):(ri(e),e.unit==="8bit"?e:{r:e.r*255,g:e.g*255,b:e.b*255,opacity:(e.opacity??1)*255,unit:"8bit",space:"srgb"}),gi=e=>typeof e=="string"?Vi(e,{scalar:!0}):Wr(e)?gi(ta(ea(e),{scalar:!0})):(ri(e),e.unit==="scalar"?e:{r:e.r/255,g:e.g/255,b:e.b/255,opacity:(e.opacity??1)/255,unit:"scalar",space:"srgb"}),ri=e=>{let{r,g:i,b:o,opacity:a,space:n,unit:s}=e;if(n!=="srgb")throw Error(`Space is expected to be 'srgb'. Got: ${n}`);if(s==="8bit")w(Ge(r,0,255,"r"),Ge(i,0,255,"g"),Ge(o,0,255,"b"),()=>{if(typeof a=="number")return Ge(a,0,255,"opacity")});else if(s==="scalar")w($(r,"percentage","r"),$(i,"percentage","g"),$(o,"percentage","b"),()=>{if(typeof a=="number")return $(a,"percentage","opacity")});else throw Error(`Unit is expected to be '8bit' or 'scalar'. Got: ${s}`)},C5=(e,r)=>{let i=0,o=new Hn(Co(e)),a=e.unit==="scalar";if(r.pdelta!==void 0)i=o.oklab.l+o.oklab.l*r.pdelta;else if(r.delta!==void 0)i=o.oklab.l+r.delta;else if(r.fixed!==void 0){if(r.fixed<0)throw TypeError("Amount cannot be negative when using 'fixed'");i=r.fixed}else throw TypeError("Parameter 'amount' is missing 'pdelta/delta/fixed' properties");i<0?i=0:i>1&&(i=1);let n=Ti({a:o.oklab.a,b:o.oklab.b,l:i,alpha:o.oklab.alpha});return ta(n,{scalar:a})};function $5(e){return new Hn(Co(e)).oklab.l}function a1(e=100,r=100,i=100,o=255){let a={unit:"8bit",space:"srgb",r:e,g:r,b:i,opacity:o};return ri(a),a}function of(e=.5,r=.5,i=.5,o=1){let a={unit:"scalar",space:"srgb",r:e,g:r,b:i,opacity:o};return ri(a),a}function af(e){if(e.startsWith("rgba"))throw Error("RGBA is not supported");if(!e.startsWith("rgb("))throw Error("Expected rgb(..) CSS colour");let r=e.indexOf("("),i=e.indexOf(")");if(i<r)throw Error("Is rgb() not terminated? Missing ')'");let o=e.substring(r+1,i),a=o.split(/[\s,]+/);if(a.length<3)throw Error(`Expected three tokens. Got: ${a.length} length`);let n=0;for(let u of a)u.endsWith("%")&&n++;let s=(u,c)=>u.endsWith("%")?Number.parseFloat(u.substring(0,u.length-1))/100:c<3?Number.parseFloat(u)/255:Number.parseFloat(u),l=(u,c)=>u.endsWith("%")?Number.parseFloat(u.substring(0,u.length-1))/100*255:c<3?Number.parseFloat(u):Number.parseFloat(u)*255;return a.length>3&&a[3]==="/"&&(a=[a[0],a[1],a[2],a[4]]),n>1?of(s(a[0],0),s(a[1],1),s(a[2],2),s(a[3]??"1",3)):a1(l(a[0],0),l(a[1],1),l(a[2],2),l(a[3]??"1",3))}const nf=(e,r)=>{let i=gi(e),o=gi(r),a=i.opacity??1,n=(o.opacity??1)-a,s=o.r-i.r,l=o.g-i.g,u=o.b-i.b;return c=>(c=ie(c),of(i.r+De(c,0,s),i.g+De(c,0,l),i.b+De(c,0,u),a+De(c,0,n)))};function ra(e){if(typeof e=="string"){let i=Vi(e,{scalar:!1});return ra(i)}return e=ti(e),{...Bi({r:e.r,g:e.g,b:e.b}),alpha:(e.opacity??255)/255}}var n1={};C(n1,{accessor:()=>ia,byColumn:()=>F5,byRow:()=>S5,grid:()=>ii,setter:()=>sf,wrap:()=>A5});const ii=e=>({rows:e.width,cols:e.height}),A5=e=>({...ii(e),get:ia(e),set:sf(e)}),ia=e=>{let r=ii(e),i=e.data;return(a,n="undefined")=>{let s=Pi(r,a,n);if(s===void 0)return;let l=s*4;return{r:i[l],g:i[l+1],b:i[l+2],opacity:i[l+3],unit:"8bit",space:"srgb"}}},sf=e=>{let r=ii(e),i=e.data;return(a,n,s="undefined")=>{let l=Pi(r,n,s);if(l===void 0)throw Error(`Cell out of range. ${n.x},${n.y}`);let u=ti(a),c=l*4;i[c]=u.r,i[c+1]=u.g,i[c+2]=u.b,i[c+3]=u.opacity??255}};function*S5(e){let r=ia(e),i=ii(e),o=lb(i,{x:0,y:0});for(let a of o)yield a.map(s=>r(s,"undefined"))}function*F5(e){let r=ia(e),i=ii(e);for(let o=0;o<i.cols;o++){let a=[];for(let n=0;n<i.rows;n++){let s=r({x:o,y:n},"undefined");s&&a.push(s)}yield a}}var k5=class extends Ye{el;opts;#e;#t;#r=En;#i=xn;#o;#a;#n;#l=!1;constructor(e,r={}){if(super(),!e)throw Error("Param 'domQueryOrEl' is null or undefined");if(this.el=U(e),this.el.nodeName!=="CANVAS")throw Error(`Expected CANVAS HTML element. Got: ${this.el.nodeName}`);let i=this.el.getBoundingClientRect();this.opts={resizeLogic:r.resizeLogic??"none",disablePointerEvents:r.disablePointerEvents??!1,pixelZoom:r.pixelZoom??(window.devicePixelRatio||1),height:r.height??i.height,width:r.width??i.width,zIndex:r.zIndex??-1,coordinateScale:r.coordinateScale??"both",onResizing:r.onResizing,onResized:r.onResized,clearOnResize:r.clearOnResize??!0,draw:r.draw,skipCss:r.skipCss??!1,colourSpace:"srgb"},this.#e=oo("both"),this.#t=oo("both",i),this.#c()}getRectangle(){return{x:0,y:0,...this.#i}}dispose(e){this.#l||(this.#l=!0,this.#n&&(this.#n.dispose(`CanvasHelper disposing ${e}`.trim()),this.#n=void 0))}#s(e=!1){if(this.#o===void 0||e){let r=this.ratio,i=this.el.getContext("2d");if(i===null)throw Error("Could not create drawing context");this.#o=i,i.setTransform(1,0,0,1,0,0),i.scale(r,r)}return this.#o}getPhysicalSize(){return{width:this.width*this.ratio,height:this.height*this.ratio}}getDrawHelper(){this.#a||=Av(this.#s(),{width:this.width,height:this.height})}setLogicalSize(e){ht(e,"logicalSize");let r=qy(a=>Math.floor(a),e),i=this.opts.pixelZoom;this.#e=oo(this.opts.coordinateScale,e),this.#t=oo("both",e);let o=Yy(e,i);this.el.width=o.width,this.el.height=o.height,this.el.style.width=r.width.toString()+"px",this.el.style.height=r.height.toString()+"px",this.#s(!0),this.opts.clearOnResize&&this.ctx.clearRect(0,0,this.width,this.height),this.#i=r,this.opts.onResizing&&this.opts.onResizing(this.ctx,this.size,this),this.fireEvent("resize",{ctx:this.ctx,size:this.#i,helper:this})}#c(){let e=this.opts.draw;if(e){let i=()=>{e(this.ctx,this.#i,this),requestAnimationFrame(i)};setTimeout(()=>{i()},100)}if(this.opts.disablePointerEvents||this.#f(),(this.opts.resizeLogic??"none")==="none")this.setLogicalSize({width:this.opts.width,height:this.opts.height});else{let i={onSizeChanging:o=>{Qy(this.#i,o)||this.setLogicalSize(o)},onSizeDone:(o,a)=>{this.#u(o)},naturalSize:{width:this.opts.width,height:this.opts.height},stretch:this.opts.resizeLogic??"none"};this.#n=new bo(this.el,i)}this.#s()}#u(e){this.opts.onResized&&this.opts.onResized(this.ctx,this.size,this),this.fireEvent("resized",{ctx:this.ctx,size:this.#i,helper:this})}#f(){let e=r=>{let{offsetX:i,offsetY:o}=r,a=i*this.ratio,n=o*this.ratio;r=Sy(r);let s={physicalX:a,physicalY:n,...r};switch(r.type){case"pointerup":this.fireEvent("pointerup",s);break;case"pointermove":this.fireEvent("pointermove",s);break;case"pointerdown":this.fireEvent("pointerup",s);break}};this.el.addEventListener("pointermove",e),this.el.addEventListener("pointerdown",e),this.el.addEventListener("pointerup",e)}clear(){this.#o&&this.#o.clearRect(0,0,this.width,this.height)}fill(e){this.#o&&(e&&(this.#o.fillStyle=e),this.#o.fillRect(0,0,this.width,this.height))}get ctx(){if(this.#o===void 0)throw Error("Context not available");return this.#s()}get viewport(){return this.#r}get width(){return this.#i.width}get height(){return this.#i.height}get size(){return this.#i}get ratio(){return window.devicePixelRatio||1}get dimensionMin(){return Math.min(this.width,this.height)}get dimensionMax(){return Math.max(this.width,this.height)}drawBounds(e="green"){let r=this.#s();Wa(r,{x:0,y:0,width:this.width,height:this.height},{crossed:!0,strokeStyle:e,strokeWidth:1}),Wa(r,this.#r,{crossed:!0,strokeStyle:"silver",strokeWidth:3})}get toRelative(){return this.#e.rel}get toAbsoluteFixed(){return this.#t.abs}get toRelativeFixed(){return this.#t.rel}get logicalCenter(){return{x:this.#i.width/2,y:this.#i.height/2}}get toAbsolute(){return this.#e.abs}get center(){return{x:this.width/2,y:this.height/2}}getImageData(){let e=this.getPhysicalSize(),r=this.ctx.getImageData(0,0,e.width,e.height,{colorSpace:this.opts.colourSpace});if(r==null)throw Error("Could not get image data from context");return r}getWritableBuffer(){let e=this.ctx,r=this.getImageData(),i=ii(r),o=ia(r),a=sf(r);return{grid:i,get:o,set:a,flip:()=>{e.putImageData(r,0,0)}}}};const Rt=(e,r)=>{r.fillStyle&&e.setAttributeNS(null,"fill",r.fillStyle),r.opacity&&e.setAttributeNS(null,"opacity",r.opacity.toString())},N5=e=>{let r=e.getAttributeNS(null,"width"),i=r===null?0:Number.parseFloat(r),o=e.getAttributeNS(null,"height"),a=o===null?0:Number.parseFloat(o);return{width:i,height:a}},P5=(e,r)=>{e.setAttributeNS(null,"width",r.width.toString()),e.setAttributeNS(null,"height",r.height.toString())},Zn=(e,r)=>{let i=document.createElementNS("http://www.w3.org/2000/svg",e);return r&&(i.id=r),i},ir=(e,r,i,o)=>{let a=null;if(i!==void 0&&(a=typeof i=="string"?e.querySelector(i):i),a===null){let n=document.createElementNS("http://www.w3.org/2000/svg",r);return e.append(n),i&&typeof i=="string"&&i.startsWith("#")&&(n.id=o!==void 0&&!i.endsWith(o)?i.slice(1)+o:i.slice(1)),n}return a},s1=(e,r=.5,i=.75,o=1)=>{w($(e,"positive","index"),$(r,"percentage","saturation"),$(i,"percentage","lightness"),$(o,"percentage","alpha"));let a=e*137.508,n=a%360/360;return wo(Ur(n,r,i,o))},M5=(e=Math.random)=>e()*360;function mi(e,r){return l1(e,i=>ie(i*r))}function l1(e,r){let i=oa(e),o;switch(i.space){case"hsl":o=Zv(i,r);break;case"srgb":o=o1(i,r);break;case"oklch":o=t1(i,r);break;default:throw Error(`Unknown space: '${i.space}'. Expected hsl, srgb, oklch`)}if(!o)throw Error("Is colour in correct form?");return typeof e=="string"?Me(o):o}function B5(e,r){let i=oa(e);return i.opacity=r,typeof e=="string"?Me(i):i}function z5(e,r="hsl"){if(!Array.isArray(e))throw Error(`Param 'colours' is not an array as expected. Got: ${typeof e}`);if(e.length<2)throw Error(`Param 'colours' should be at least two in length. Got: ${e.length}`);let i=e.map(o=>Ha(o,r));return[...Bd(i)]}const T5=e=>`linear-gradient(to right, ${e.map(i=>Me(i)).join(", ")})`,O5=(e,r,i={})=>{let o=i.space??"oklch",a=i.direction??"shorter",n;switch(o){case"hsl":n=Zc(ot(e,"hsl-scalar"),ot(r,"hsl-scalar"),a);break;case"srgb":n=nf(ot(e,"srgb-scalar"),ot(r,"srgb-scalar"));break;default:n=Yc(ot(e,"oklch-scalar"),ot(r,"oklch-scalar"),a)}return s=>Me(n(s))},j5=(e,r={})=>{let i=r.direction??"shorter",o=r.space??"oklch",a=z5(e,o),n=0;if(typeof r.stepsBetween=="number"){if(n=r.stepsBetween,n<1)throw Error("Param 'stepsBetween' must be at least 1")}else if(typeof r.stepsTotal=="number"){if(r.stepsTotal<=e.length)throw Error(`Param 'stepsTotal' must be greater than number of provided colour stops (${e.length}) +1 per stop`);let u=r.stepsTotal-e.length;n=Math.floor(u/a.length)}let s=a.map(u=>{let c=u1(u[0],u[1],{steps:n,space:o,direction:i,exclusive:!0});return c.push(u[1]),c}),l=a[0];return s.unshift([l[0]]),s.flat().map(u=>Me(u))};function u1(e,r,i={}){let o=i.exclusive??!1,a=i.steps??5,n=i.space??"oklch",s=i.direction??"shorter";if(!o&&a<2)throw Error("Param 'steps' should be at least 2 when 'exclusive' is false");if(o&&a<1)throw Error("Param 'steps' should be at least 1 when 'exlusive' is true");let l=Ha(e,n),u=Ha(r,n),c;switch(n){case"hsl":c=Zc(l,u,s);break;case"oklch":c=Yc(l,u,s);break;case"srgb":c=nf(l,u);break;default:throw Error(`Colour space '${n}' not supported for interpolation.`)}if(!c)throw Error(`Could not create interpolator for space: ${n}`);let f=0,d=0,h=1;o?(f=1/(a+1),d=f,h=1-f):f=1/(a-1);let p=[];for(let y=d;y<=h;y+=f)p.push(c(y));return p}var lf={};C(lf,{HslSpace:()=>Qv,OklchSpace:()=>Yv,SrgbSpace:()=>i1,convert:()=>ot,convertScalar:()=>Ha,convertToString:()=>R5,createSteps:()=>u1,cssDefinedHexColours:()=>Dt,cssLinearGradient:()=>T5,fromCssColour:()=>tf,goldenAngleColour:()=>s1,guard:()=>c1,interpolator:()=>O5,isColourish:()=>Jv,isHsl:()=>Wr,isOkLch:()=>vo,isRgb:()=>br,multiplyOpacity:()=>mi,randomHue:()=>M5,resolveCss:()=>rf,rgbToHsl:()=>L5,scale:()=>j5,setOpacity:()=>B5,toColour:()=>oa,toCssColour:()=>Me,toLibraryColour:()=>V5,toStringFirst:()=>Tr,tryParseObjectToHsl:()=>Uv,tryParseObjectToRgb:()=>Gv,withOpacity:()=>l1});function ot(e,r){if(r==="hsl-scalar"){if(typeof e=="string"||Wr(e)||br(e))return yi(e)}else if(r==="hsl-absolute"){if(typeof e=="string"||Wr(e))return Oi(e)}else if(r==="oklch-scalar"){if(typeof e=="string"||vo(e))return Eo(e)}else if(r==="oklch-absolute"){if(typeof e=="string"||vo(e))return Xc(e)}else if(r==="srgb-8bit"){if(typeof e=="string"||br(e))return ti(e)}else if(r==="srgb-scalar"){if(typeof e=="string"||br(e))return gi(e)}else throw Error(`Destination '${r}' not supported for input: ${JSON.stringify(e)}`);return ot(Me(e),r)}function R5(e,r){let i=ot(e,r);return Me(i)}function Ha(e,r){if(r==="oklch")return ot(e,"oklch-scalar");if(r==="srgb")return ot(e,"srgb-scalar");if(r==="hsl")return ot(e,"hsl-scalar");throw Error(`Unknown destination: '${r}'`)}const Me=e=>{if(typeof e=="string")return e;if(Wr(e))return wo(e);if(br(e))return Co(e);if(vo(e))return e1(e);let r=Gv(e);if(r)return Co(r);let i=Uv(e);if(i)return wo(i);throw Error(`Unknown colour format: '${JSON.stringify(e)}'`)},V5=e=>{let r=Me(e);return new Hn(r)},c1=e=>{switch(e.space){case"hsl":ji(e);break;case"srgb":ri(e);break;case"oklch":ei(e);break;default:throw Error(`Unsupported colour space: '${e.space}'`)}},oa=e=>{if(!Jv(e))throw Error(`Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc. Got: ${JSON.stringify(e)}`);let r;if(r=typeof e=="string"?tf(e):e,r===void 0)throw Error("Could not parse input. Expected CSS colour string or structured colour {r,g,b}, {h,s,l} etc.");return c1(r),r},Tr=(...e)=>{for(let r of e)if(r!=null)try{let i=oa(r);return Me(i)}catch{}return"rebeccapurple"};function L5(e,r){let{r:i,g:o,b:a}=e,n=e.opacity??1;e.unit==="8bit"&&(i/=255,o/=255,a/=255);let s=Math.max(i,o,a),l=Math.min(i,o,a),u=(s+l)/2,c=u,f=u;if(s===l)return r?Ur(0,0,0,n):xo(0,0,0,n);let d=s-l;switch(c=f>=.5?d/(2-(s+l)):d/(s+l),s){case i:u=((o-a)/d+0)*60;break;case o:u=((a-i)/d+2)*60;break;case a:u=((i-o)/d+4)*60;break}return r?Ur(u/360,c,f,n):xo(u,c*100,f*100,n)}const ar=(e,r)=>{r.strokeStyle&&e.setAttributeNS(null,"stroke",r.strokeStyle),r.strokeWidth&&e.setAttributeNS(null,"stroke-width",r.strokeWidth.toString()),r.strokeDash&&e.setAttribute("stroke-dasharray",r.strokeDash),r.strokeLineCap&&e.setAttribute("stroke-linecap",r.strokeLineCap)},f1=(e,r,i)=>{let o=Zn("marker",e);if(r.markerWidth&&o.setAttribute("markerWidth",r.markerWidth?.toString()),r.markerHeight&&o.setAttribute("markerHeight",r.markerHeight?.toString()),r.orient?o.setAttribute("orient",r.orient.toString()):o.setAttribute("orient","auto-start-reverse"),r.viewBox&&o.setAttribute("viewBox",r.viewBox.toString()),r.refX&&o.setAttribute("refX",r.refX.toString()),r.refY&&o.setAttribute("refY",r.refY.toString()),i){let a=i();o.appendChild(a)}return o},$a=(e,r,i)=>{if(e===null)return"(elem null)";let o=e.ownerSVGElement;if(o===null)throw Error("parent for elem is null");let a=ir(o,"defs","defs"),n=a.querySelector(`#${r.id}`);if(n!==null)return`url(#${r.id})`;if(r.id==="triangle")r={...r,strokeStyle:"transparent"},r.markerHeight||(r={...r,markerHeight:6}),r.markerWidth||(r={...r,markerWidth:6}),r.refX||(r={...r,refX:r.markerWidth}),r.refY||(r={...r,refY:r.markerHeight}),(!r.fillStyle||r.fillStyle==="none")&&(r={...r,fillStyle:"black"}),r.viewBox||(r={...r,viewBox:"0 0 10 10"}),n=f1(r.id,r,()=>{let s=Zn("path");return s.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),r&&Rt(s,r),s});else throw Error(`Do not know how to make ${r.id}`);return n.id=r.id,a.appendChild(n),`url(#${r.id})`},Xn=(e,r)=>{r.markerEnd&&e.setAttribute("marker-end",$a(e,r.markerEnd)),r.markerStart&&e.setAttribute("marker-start",$a(e,r.markerStart)),r.markerMid&&e.setAttribute("marker-mid",$a(e,r.markerMid))};var d1={};C(d1,{circle:()=>Ka,circleUpdate:()=>y1,grid:()=>x1,group:()=>I5,groupUpdate:()=>g1,line:()=>Qa,lineUpdate:()=>m1,path:()=>h1,pathUpdate:()=>p1,polarRayUpdate:()=>q5,text:()=>w1,textPath:()=>v1,textPathUpdate:()=>b1,textUpdate:()=>uf});const bd=e=>e>=0&&e<=1?`${e*100}%`:e.toString(),h1=(e,r,i,o)=>{let a=ir(r,"path",o),n=typeof e=="string"?e:e.join(`
`);return a.setAttributeNS(null,"d",n),r.append(a),p1(a,i)},p1=(e,r)=>(r&&Rt(e,r),r&&ar(e,r),e),y1=(e,r,i)=>(e.setAttributeNS(null,"cx",r.x.toString()),e.setAttributeNS(null,"cy",r.y.toString()),e.setAttributeNS(null,"r",r.radius.toString()),i&&Rt(e,i),i&&ar(e,i),e),Ka=(e,r,i,o)=>{let a=ir(r,"circle",o);return y1(a,e,i)},I5=(e,r,i)=>{let o=ir(r,"g",i);return g1(o,e)},g1=(e,r)=>{for(let i of r)i.parentNode!==e&&e.append(i);return e},Qa=(e,r,i,o)=>{let a=ir(r,"line",o);return m1(a,e,i)},m1=(e,r,i)=>(e.setAttributeNS(null,"x1",r.a.x.toString()),e.setAttributeNS(null,"y1",r.a.y.toString()),e.setAttributeNS(null,"x2",r.b.x.toString()),e.setAttributeNS(null,"y2",r.b.y.toString()),i&&Rt(e,i),i&&Xn(e,i),i&&ar(e,i),e),q5=(e,r,i)=>{let o=_g(r);return e.setAttributeNS(null,"x1",o.a.x.toString()),e.setAttributeNS(null,"y1",o.a.y.toString()),e.setAttributeNS(null,"x2",o.b.x.toString()),e.setAttributeNS(null,"y2",o.b.y.toString()),i&&Rt(e,i),i&&Xn(e,i),i&&ar(e,i),e},b1=(e,r,i)=>(i?.method&&e.setAttributeNS(null,"method",i.method),i?.side&&e.setAttributeNS(null,"side",i.side),i?.spacing&&e.setAttributeNS(null,"spacing",i.spacing),i?.startOffset&&e.setAttributeNS(null,"startOffset",bd(i.startOffset)),i?.textLength&&e.setAttributeNS(null,"textLength",bd(i.textLength)),r&&(e.textContent=r),i&&Rt(e,i),i&&ar(e,i),e),v1=(e,r,i,o,a,n)=>{let s=ir(i,"text",a,"-text");uf(s,void 0,void 0,o);let l=ir(s,"textPath",n);return l.setAttributeNS(null,"href",e),b1(l,r,o)},uf=(e,r,i,o)=>(r&&(e.setAttributeNS(null,"x",r.x.toString()),e.setAttributeNS(null,"y",r.y.toString())),i&&(e.textContent=i),o&&(Rt(e,o),o&&ar(e,o),o.anchor&&e.setAttributeNS(null,"text-anchor",o.anchor),o.align&&e.setAttributeNS(null,"alignment-baseline",o.align),(o.userSelect??!0)||(e.style.userSelect="none")),e),w1=(e,r,i,o,a)=>{let n=ir(r,"text",a);return uf(n,i,e,o)},x1=(e,r,i,o,a,n={})=>{n.strokeStyle||(n={...n,strokeStyle:Tr("bg-dim","silver")}),n.strokeWidth||(n={...n,strokeWidth:1});let s=Zn("g");Rt(s,n),Xn(s,n),ar(s,n);let l=0;for(;l<a;){let c=qa(0,l,o,l);Qa(c,s),l+=i}let u=0;for(;u<o;){let c=qa(u,0,u,a);Qa(c,s),u+=i}return e.append(s),s},E1=e=>{if(!e)throw Error("Param 'el' is undefined");let r={x:e.x1.baseVal.value,y:e.y1.baseVal.value},i={x:e.x2.baseVal.value,y:e.y2.baseVal.value};return{a:r,b:i}},_5=(e,r)=>{let i=E1(e);return Wg(i,r)},D1=(e,r)=>{if(typeof r=="string"){let i=e.querySelector(r);if(i===null)return;i.remove()}else r.remove()},W5=e=>{let r=e.lastElementChild;for(;r;)r.remove(),r=e.lastElementChild},G5=(e,r)=>(r&&(Rt(e,r),ar(e,r)),{remove:o=>{D1(e,o)},text:(o,a,n,s)=>w1(o,e,a,n,s),textPath:(o,a,n,s,l)=>v1(o,a,e,n,s,l),line:(o,a,n)=>Qa(o,e,a,n),circle:(o,a,n)=>Ka(o,e,a,n),path:(o,a,n)=>h1(o,e,a,n),grid:(o,a,n,s,l)=>x1(e,o,a,n,s,l),query:o=>e.querySelector(o),get width(){let o=e.getAttributeNS(null,"width");return o===null?0:Number.parseFloat(o)},set width(o){e.setAttributeNS(null,"width",o.toString())},get parent(){return e},get height(){let o=e.getAttributeNS(null,"height");return o===null?0:Number.parseFloat(o)},set height(o){e.setAttributeNS(null,"height",o.toString())},clear:()=>{for(;e.firstChild;)e.lastChild.remove()}});var C1={};C(C1,{Elements:()=>d1,applyOpts:()=>Rt,applyPathOpts:()=>Xn,applyStrokeOpts:()=>ar,clear:()=>W5,createEl:()=>Zn,createMarker:()=>f1,createOrResolve:()=>ir,getBounds:()=>N5,lineFromSvgLine:()=>E1,makeHelper:()=>G5,markerPrebuilt:()=>$a,polarRayFromSvgLine:()=>_5,remove:()=>D1,setBounds:()=>P5});const U5=(e,r={})=>{let i=r.touchRadius??45,o=r.touchRadius??20,a=r.trace??!1,n=r.hue??100,s=`hsla(${n}, 100%, 10%, 10%)`,l=n,u=U(e),c=new lc({storeIntermediate:a}),f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.id="pointerVis",f.style.zIndex="-1000",f.style.position="fixed",f.style.top="0",f.style.left="0",f.style.width="100%",f.style.height="100%",f.style.boxSizing="border-box",f.style.border="3px solid red",f.style.pointerEvents="none",f.style.touchAction="none",bo.svgViewport(f);let d=0,h=y=>{let g=y.pointerId.toString();c.delete(g),l=n,f.querySelector(`#pv-start-${g}`)?.remove();for(let m=0;m<d+10;m++)f.querySelector(`#pv-progress-${g}-${m}`)?.remove();d=0},p=async y=>{let g=y.pointerId.toString(),m={x:y.x,y:y.y},v=y.pointerType;if(y.type==="pointermove"&&!c.has(g))return;let D=await c.seen(y.pointerId.toString(),{x:y.clientX,y:y.clientY});if(D.values.length===1){let x=Ka({...D.values[0],radius:v==="touch"?i:o},f,{fillStyle:s},`#pv-start-${g}`);x.style.pointerEvents="none",x.style.touchAction="none"}let B=`hsla(${l}, 100%, 50%, 50%)`,V=Ka({...m,radius:v==="touch"?i:o},f,{fillStyle:B},`#pv-progress-${g}-${D.values.length}`);V.style.pointerEvents="none",V.style.touchAction="none",l+=1,d=D.values.length};document.body.append(f),u.addEventListener("pointerdown",p),u.addEventListener("pointermove",p),u.addEventListener("pointerup",h),u.addEventListener("pointerleave",h),u.addEventListener("contextmenu",y=>{y.preventDefault()})};var $1={};C($1,{create:()=>J5});const J5=e=>new H5(e);var H5=class{#e=new Map;#t=new Map;fallbacks;#r=0;#i;constructor(e){e===void 0?this.fallbacks=["red","blue","green","orange"]:this.fallbacks=e,this.#i=document.body}setElementBase(e){this.#i=e}add(e,r){this.#e.set(e,r)}alias(e,r){this.#t.set(e,r)}get(e,r){let i=this.#t.get(e);i!==void 0&&(e=i);let o=this.#e.get(e);if(o!==void 0)return o;let a="--"+e,n=getComputedStyle(this.#i).getPropertyValue(a).trim();if(n===void 0||n.length===0){if(r!==void 0)return r;n=this.fallbacks[this.#r],this.#r++,this.#r===this.fallbacks.length&&(this.#r=0)}return n}getOrAdd(e,r){if(this.has(e))return this.get(e);let i=this.get(e,r);return this.add(e,i),i}has(e){return this.#e.has(e)}},cf={};C(cf,{capture:()=>Q5,frames:()=>K5,manualCapture:()=>A1});async function*K5(e,r={}){let i=r.maxIntervalMs??0,o=r.showCanvas??!1,a=r.canvasEl,n,s;n=s=0,a===void 0&&(a=document.createElement("CANVAS"),a.classList.add("ixfx-frames"),o||(a.style.display="none"),document.body.appendChild(a));let l=()=>{a!==void 0&&(n=e.videoWidth,s=e.videoHeight,a.width=n,a.height=s)},u=null,c=ay(i);for await(let f of c){if((n===0||s===0)&&l(),n===0||s===0)continue;if(u??=a.getContext("2d"),u===null)return;u.drawImage(e,0,0,n,s),yield u.getImageData(0,0,n,s)}}const Q5=(e,r={})=>{let i=r.maxIntervalMs??0,o=r.showCanvas??!1,a=r.onFrame,n=e.videoWidth,s=e.videoHeight,l=document.createElement("CANVAS");l.classList.add("ixfx-capture"),o||(l.style.display="none"),l.width=n,l.height=s;let u=null,c;r.workerScript&&(c=new Worker(r.workerScript));let f=c||a;!f&&!o&&console.warn("Video will be captured to hidden element without any processing. Is this what you want?");let d=or(()=>{if(u===null&&(u=l.getContext("2d")),u===null)return;u.drawImage(e,0,0,n,s);let h;if(f&&(h=u.getImageData(0,0,n,s)),c&&c.postMessage({pixels:h.data.buffer,width:n,height:s,channels:4},[h.data.buffer]),a)try{a(h)}catch(p){console.error(p)}},i);return{start:()=>{d.start()},cancel:()=>{d.cancel()},canvasEl:l}},A1=(e,r={})=>{let i=r.showCanvas??!1,o=e.videoWidth,a=e.videoHeight,n=r.canvasEl!==void 0,s=r.canvasEl;return s||(s=document.createElement("CANVAS"),s.classList.add("ixfx-capture"),document.body.append(s),i||(s.style.display="none")),s.width=o,s.height=a,{canvasEl:s,capture:()=>{let f;if(f||=s.getContext("2d",{willReadFrequently:!0}),!f)throw Error("Could not create graphics context");f.drawImage(e,0,0,o,a);let d=f.getImageData(0,0,o,a);return d.currentTime=e.currentTime,r.postCaptureDraw&&r.postCaptureDraw(f,o,a),d},dispose:()=>{if(!n)try{s.remove()}catch{}}}};var S1={};C(S1,{init:()=>Z5});function vd(e,r,i){let o=e.getAttribute(r);return o===null?i:Number.parseInt(o)}const Z5=(e,r={})=>{let i=document.querySelector(e);if(!i)throw Error(`Element query could not be found (${e})`);let o=r.labels??["x","y"],a=r.labelPrecision??2,n=r.asPercentages??!1,s=r.displayLastValues??0,l=r.showWhiskers??!0,u=r.showDot??!0,c=r.showLabels??!0,f=r.yAxisBottomNegative??!0,d=Tr(r.axisColour,"silver"),h=Tr(r.bgColour,"white"),p=Tr(r.whiskerColour,"black"),y=Tr(r.dotColour,r.whiskerColour,"black"),g=Tr(r.labelColour,r.axisColour,"silver"),m=r.axisWidth??1*window.devicePixelRatio,v=r.dotRadius??5*window.devicePixelRatio,D=r.padding??10*window.devicePixelRatio,B=r.whiskerSize??5*window.devicePixelRatio,V=r.width??vd(i,"width",200)*window.devicePixelRatio,x=r.height??vd(i,"height",200)*window.devicePixelRatio,F;s>0&&(F=new dn({capacity:s,discardPolicy:"older"})),i.width=V,i.height=x,i.style.width=`${V/window.devicePixelRatio}px`,i.style.height=`${x/window.devicePixelRatio}px`;let N=x/2,P=V/2,k=i.getContext("2d");if(!k)throw Error("Could not create drawing context");window.devicePixelRatio>=2&&(k.font="20px sans-serif");let te=J=>`${Math.round(J*100)}%`,le=J=>J.toFixed(a),ve=n?te:le;c?(o[0]+=":",o[1]+=":"):(o[0]="",o[1]="");let He=r.renderBackground??((J,Oe,sr)=>{r.bgColour==="transparent"?J.clearRect(0,0,Oe,sr):(J.fillStyle=h,J.fillRect(0,0,Oe,sr))});return(J,Oe)=>{J=jr(J),Oe=jr(Oe),He(k,V,x),k.fillStyle=g,k.textBaseline="top",k.save(),k.translate(P,N),k.rotate(-Math.PI/2),k.fillText((o[1]+" "+ve(Oe)).trim(),-P+D,1),k.restore(),k.fillText((o[0]+" "+ve(J)).trim(),D,P+2),f||(Oe*=-1),k.strokeStyle=d,k.lineWidth=m,k.beginPath(),k.moveTo(D,N),k.lineTo(V-D,N),k.moveTo(P,D),k.lineTo(P,x-D),k.stroke(),k.closePath();let sr=(x-D-D)/2*-Oe,qi=(V-D-D)/2*J,_i={x:qi,y:sr,radius:v};if(F&&=F.enqueue(_i),k.save(),k.translate(P,N),u)if(F){let ns=1/F.length,la=1;F.forEach(ss=>{let ls=mi(y,la);_a(k,ss,{fillStyle:ls}),la-=ns})}else _a(k,_i,{fillStyle:y});l&&(k.strokeStyle=p,k.beginPath(),k.moveTo(0,sr-B),k.lineTo(0,sr+B),k.moveTo(qi-B,0),k.lineTo(qi+B,0),k.stroke(),k.closePath()),k.restore()}},dl=e=>{let r=e.map(c=>c.x),i=e.map(c=>c.y),o=Math.min(...r),a=Math.max(...r),n=Math.min(...i),s=Math.max(...i),l=a-o,u=s-n;return{min:{x:o,y:n},max:{x:a,y:s},width:l,height:u,minDim:Math.min(l,u),maxDim:Math.max(l,u)}},F1=e=>{if(!Number.isFinite(e.height))return o=>o;let r=zt(e.min.x,e.max.x),i=zt(e.min.y,e.max.y);return o=>({x:r(o.x),y:i(o.y)})},k1=e=>{let r=zt(0,1,e.min.x,e.max.x),i=zt(0,1,e.min.y,e.max.y);return o=>({x:r(o.x),y:i(o.y)})},N1=(e,r,i)=>{let o=[],a=0;for(let s=e.min.x;s<e.max.x;s+=r){let l=a%i===0;o.push({x:s,y:0,major:l}),a++}a=0;let n=[];for(let s=e.min.y;s<e.max.y;s+=r){let l=a%i===0;n.push({x:0,y:s,major:l}),a++}return{x:o,y:n}};var P1=class{#e;#t;lastChange;constructor(){this.lastChange=performance.now(),this.#e=new hn,this.#t=new Map}get metaCount(){return this.#t.size}clear(){this.#e.clear(),this.lastChange=performance.now()}set(e,r){this.#e.setValues(e,r)}deleteBySeries(e){let r=this.#e.delete(e);return r&&(this.lastChange=performance.now()),r}setMeta(e,r){this.#t.set(e,r)}hasMeta(e){return this.#t.has(e)}getMeta(e){return this.#t.get(e)}*getValues(){yield*this.#e.valuesFlat()}*getEntries(){yield*this.#e.entries()}*getSeries(){yield*this.#e.values()}add(e,r="default"){this.#e.addKeyedValues(r,e),this.lastChange=performance.now()}};const X5=Math.PI*2;var Y5=class{#e;#t;#r;#i;#o;#a;#n=[];constructor(e,r="min"){this.#e=U(e),this.#r=r,this.#a=window.devicePixelRatio||1,this.#i=this.#l(),this.#o=this.setLogicalSize({width:this.#e.width,height:this.#e.height})}setLogicalSize(e){this.#o=e;let r=this.#e;return r.width=e.width*this.#a,r.height=e.height*this.#a,r.style.width=`${e.width.toString()}px`,r.style.height=`${e.height.toString()}px`,this.#i=this.#l(),this.invalidateContext(),e}#l(){let e=1;switch(this.#r){case"min":e=Math.min(this.#e.width,this.#e.height);break;case"max":e=Math.max(this.#e.width,this.#e.height);break}let r=Fp(0,e,0,1);return{abs:r.in,rel:r.out}}invalidateContext(){this.#t=void 0}#s(e){if(!e)throw Error("Param 'region' is undefined/null");if(this.#n.includes(e))throw Error("Region already exists");return this.#n.push(e),e}toAbsPoint(e,r="independent"){let{x:i,y:o}=e;switch(r){case"independent":i*=this.width,o*=this.height}return{x:i,y:o}}get offset(){let e=this.#e.getBoundingClientRect();return{x:e.left,y:e.top}}toRelPoint(e,r,i="independent",o=!0){let{x:a,y:n}=e;if(r==="screen"){let s=this.#e.getBoundingClientRect();a-=s.x,n-=s.y}switch(i){case"independent":a/=this.width,n/=this.height;break}return o&&(a=ie(a),n=ie(n)),{x:a,y:n}}toAbsRect(e,r="independent"){let{width:i,height:o}=e;switch(r){case"independent":if(i*=this.width,o*=this.height,xt(e))return{...this.toAbsPoint(e),width:i,height:o}}return{width:i,height:o}}createRegion(e){let r=e.marginPx??0,i=r*2;if("absPositioned"in e){let o=pg(e.absPositioned,r,r);return this.#s(new ya(this,()=>o))}if("relativePositioned"in e){let o,a=e.relativePositioned;switch(e.scale){case"independent":o=n=>({x:a.x*n.width+r,y:a.y*n.height+r,width:a.width*n.width-i,height:a.height*n.height-i});break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#s(new ya(this,o))}if("relativeSize"in e){let o,a=e.relativeSize,n=e.position;switch(e.scale){case"independent":o=s=>{let l=a.width*s.width-i,u=a.height*s.height-i,c=s.width/2-l/2,f=s.height/2-u/2;switch(n){case"n":f=0;break;case"s":f=s.height-u;break}return c+=r,f+=r,{width:l,height:u,x:c,y:f}};break;default:throw Error(`Param 'kind' unknown (${e.scale})`)}return this.#s(new ya(this,o))}if("match"in e){let o=ju(e.match);if(!o.success)throw Error(`Could not resolve match element. ${gl(o)}`);let a=n=>{let s=o.value.getBoundingClientRect();return{x:s.x+r,y:s.y+r,width:s.width-i,height:s.height-i}};return this.#s(new ya(this,a))}throw Error("Spec doesn't seem valid")}clear(){this.context.clearRect(0,0,this.width,this.height)}get context(){if(this.#t)return this.#t;let e=this.#e.getContext("2d");if(!e)throw Error("Could not create 2d context");e.setTransform(1,0,0,1,0,0),e.scale(this.#a,this.#a),this.#t=e;for(let r of this.#n)r.recomputeRegion();return this.#t}get sizeScaler(){return this.#i}get width(){return this.#o.width}get height(){return this.#o.height}},ya=class{source;#e;#t;constructor(e,r){this.source=e,this.#e=r,this.#t=r(e)}recomputeRegion(){this.#t=this.#e(this.source)}toAbsRegion(e,r="both"){switch(r){case"both":return{x:e.x*this.#t.width,y:e.y*this.#t.height}}}applyRegionOffset(e){return{x:e.x+this.#t.x,y:e.y+this.#t.y}}drawConnectedPointsRelative(e,r,i=1){let o=e.map(a=>this.toAbsRegion(a));this.drawConnectedPoints(o,r,i)}drawConnectedPoints(e,r,i=1){let o=this.context;o.save(),o.translate(this.#t.x,this.#t.y),o.beginPath(),o.strokeStyle=r,o.lineWidth=i;for(let a=0;a<e.length;a++)a===0?o.moveTo(e[a].x,e[a].y):o.lineTo(e[a].x,e[a].y);o.stroke(),o.restore()}fillTextRelative(e,r,i="black",o,a="alphabetic",n="start"){let s=this.toAbsRegion(r);this.fillTextRelative(e,s,i,o,a,n)}fillText(e,r,i="black",o,a="alphabetic",n="start"){let s=this.context;s.save(),s.translate(this.#t.x,this.#t.y),o.length>0&&(s.font=o),s.textBaseline=a,s.textAlign=n,s.fillStyle=i,s.fillText(e,r.x,r.y),s.restore()}drawCircles(e,r,i="",o=1){let a=e.map(s=>({...this.toAbsRegion(s),radius:this.source.sizeScaler.abs(s.radius)})),n=this.context;n.save(),n.translate(this.#t.x,this.#t.y),n.fillStyle=r,n.strokeStyle=i,n.lineWidth=o;for(let s of a)n.beginPath(),n.arc(s.x,s.y,s.radius,0,X5),n.closePath(),r.length>0&&n.fill(),i.length>0&&n.stroke();n.restore()}clear(){this.context.clearRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}fill(e="white"){let r=this.context;r.fillStyle=e,r.fillRect(this.#t.x,this.#t.y,this.#t.width,this.#t.height)}drawBounds(e,r=1){this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:0,y:0}],e,r),this.drawConnectedPointsRelative([{x:0,y:1},{x:1,y:0}],e,r),this.drawConnectedPointsRelative([{x:0,y:0},{x:1,y:1}],e,r)}toRelPoint(e,r="screen",i="independent",o=!0){e=this.source.toRelPoint(e,r,"skip",!1);let{x:a,y:n}=e;switch(a-=this.x,n-=this.y,i){case"independent":a/=this.width,n/=this.height}return o&&(a=ie(a),n=ie(n)),{x:a,y:n}}absToRegionPoint(e,r,i){r==="screen"&&(e=$e(e,this.source.offset));let{x:o,y:a}=e;return o-=this.x,a-=this.y,i&&(o<0&&(o=0),a<0&&(a=0),o>this.width+this.x&&(o=this.x+this.width),a>this.height+this.y&&(a=this.y+this.height)),{x:o,y:a}}get center(){return wn(this.#t)}get context(){return this.source.context}set region(e){this.#t=e}get region(){return this.#t}get width(){return this.#t.width}get height(){return this.#t.height}get x(){return this.#t.x}get y(){return this.#t.y}get dimensionMin(){return Math.min(this.#t.width,this.#t.height)}};const eN=(e,r={})=>{let i=e.parent===void 0?document.body:U(e.parent),o=document.createElement("canvas");i.prepend(o);let a=new P1,n=new Y5(o,"min"),s=e.region??{relativePositioned:{x:0,y:0,width:1,height:1}},l=n.createRegion(s),u=new M1(l,a,r);return e.canvasResizeTo==="viewport"?bo.canvasViewport(o,{onSizeChanging:(c,f)=>{n.setLogicalSize(c),u.invalidateRange(),u.draw()}}):bo.canvasParent(o,{onSizeChanging:(c,f)=>{n.setLogicalSize(c),u.invalidateRange(),u.draw()}}),u};var M1=class{#e;#t;#r;actualDataRange=En;visibleRange=Gu;show;whiskerLength;axisRounder=di(1,!0);onInvalidated;overlayLines=[];#i;#o;#a;#n;#l;#s;#c;#u;#f;#p;constructor(e,r,i={}){if(!r)throw TypeError("Param 'data' is undefined");if(typeof r!="object")throw TypeError(`Param 'data' is not an object. Got: ${typeof r}`);this.onInvalidated=i.onInvalidated,this.#e=r,this.#r=e,this.#t=0,this.#p=i.clear??"region",this.#o=i.range??"auto",this.#l=i.valueStyle??"dot",this.#s=i.connectStyle??"",this.whiskerLength=i.whiskerLength??5,this.#f=i.visualPadding??20,this.show={axes:!0,axisValues:!0,grid:!0,whiskers:!0,...i.show},this.#n={colour:"black",width:2,...i.axisStyle},this.#u={colour:"black",size:"1em",font:"system-ui",...i.textStyle},this.#i={increments:.1,major:5,colour:"whitesmoke",width:1,...i.grid}}getCurrentRange(){if(this.#e.lastChange===this.#t&&this.#a)return this.#a;this.#t=this.#e.lastChange;let e=this.#y();return this.#a=e,this.onInvalidated&&this.onInvalidated(),e}invalidateRange(){this.#a=void 0}#y(){let e=this.getDataRange(),r=F1(e),i=k1(e),o=this.#r,a=this.#f,n=o.x+a,s=o.y+a,l=o.height-a*2,u=o.width-a*2,c=Math.min(l,u);return u>=l?n+=u/2-c/2:s+=l/2-c/2,{absDataToRelative:r,relDataToCanvas:p=>{let{x:y,y:g}=p;return y===-1/0?y=0:y===1/0&&(y=1),g===-1/0?g=0:g===1/0&&(g=1),y*=c,g=(1-g)*c,y+=n,g+=s,{x:y,y:g}},canvasToRelData:p=>{let{x:y,y:g}=p;return y-=n,g-=s,y/=c,g=1-g/c,{x:y,y:g}},regionSpaceToRelative:p=>{let{x:y,y:g}=p;return y=y-o.x+this.#f,g=c+this.#f-g,y/=c,g/=c,{x:y,y:g}},relDataToAbs:i,range:e}}positionElementAt(e,r,i="middle",o){let a=U(r),{x:n,y:s}=this.valueToScreenSpace(e);if(i==="middle"){let l=a.getBoundingClientRect();n-=l.width/2,s-=l.height/2}else if(i!=="top-left")throw Error("Param 'by' expected to be 'middle' or 'top-left'.");if(o){let l=U(o),u=l.getBoundingClientRect();n-=u.x,s-=u.y}a.style.left=`${n}px`,a.style.top=`${s}px`}getDataRange(){return this.#o==="auto"?dl([...this.#e.getValues()]):(this.#c||=dl([this.#o.max,this.#o.min]),this.#c)}valueToScreenSpace(e){let r=this.valueToRegionSpace(e),i=this.canvasSource.offset;return{x:r.x+i.x,y:r.y+i.y}}valueToRegionSpace(e,r=!1){let i=this.getCurrentRange(),o=i.absDataToRelative(e),a=i.relDataToCanvas(o);return r&&console.log(`orig: ${e.x}x${e.y} rel: ${o.x}x${o.y} region: ${a.x}x${a.y}`),{...e,x:a.x,y:a.y}}pointToValue(e,r){let i=this.getCurrentRange(),o=$e(e,this.canvasSource.offset),a=i.canvasToRelData(o);return i.relDataToAbs(a)}#d(e,r,i=!1){return e=this.valueToRegionSpace(e,i),r=this.valueToRegionSpace(r,i),{a:e,b:r}}getDefaultMeta(){return{colour:s1(this.#e.metaCount),lineWidth:2,dotRadius:5}}draw(){this.#p==="region"?this.#r.clear():this.canvasSource.clear(),this.#x(),this.show.axes&&this.#g();for(let[e,r]of this.#e.getEntries()){let i=this.#e.getMeta(e);i||(i=this.getDefaultMeta(),this.#e.setMeta(e,i)),this.#E(e,r,i)}for(let e of this.overlayLines)this.drawLine(e,e.colour,e.width)}drawLine(e,r,i){let o=this.#d(e.a,e.b);this.#h(o,r,i)}setMeta(e,r){this.#e.setMeta(e,{...this.getDefaultMeta(),...r})}#g(){let{colour:e,width:r}=this.#n,i=this.#d({x:0,y:-1/0},{x:0,y:1/0},!1),o=this.#d({x:-1/0,y:0},{x:1/0,y:0},!1);this.#h(o,e,r,!1),this.#h(i,e,r,!1)}#v(e){let r=this.#r.context;r.font=this.#u.size+" "+this.#u.font,r.fillStyle=this.#u.colour,r.textBaseline="middle";for(let i of e){if(i.x===0&&i.y===0)continue;let o=this.valueToRegionSpace(i,!1),a=this.axisRounder(i.y),n=a.toString(),s=r.measureText(n),l=o.x-s.width-this.whiskerLength/2-5,u=o.y;r.fillText(n,l,u)}}#w(e){let r=this.#r.context;r.font=this.#u.size+" "+this.#u.font,r.fillStyle=this.#u.colour,r.textBaseline="top";for(let i of e){let o=this.valueToRegionSpace(i,!1),a=this.axisRounder(i.x),n=a.toString(),s=r.measureText(n),l=o.x-s.width/2,u=o.y+s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+this.whiskerLength/2;r.fillText(n,l,u)}}#m(e,r){let i=this.whiskerLength/2,o=r?{x:e.x,y:0}:{y:e.y,x:0},a=this.valueToRegionSpace(o,!1),n=r?{a:{x:a.x,y:a.y-i},b:{x:a.x,y:a.y+i}}:{a:{y:a.y,x:a.x-i},b:{y:a.y,x:a.x+i}};this.#h(n,this.#n.colour,this.#n.width,!1)}#b(e,r){let i=r?this.#d({x:e.x,y:-1/0},{x:e.x,y:1/0}):this.#d({y:e.y,x:-1/0},{y:e.y,x:1/0},!1);this.#h(i,this.#i.colour,e.major?this.#i.width*2:this.#i.width)}#x(){let e=this.#i,r=this.show.grid,i=this.show.whiskers,o=this.show.axisValues,a=this.getCurrentRange().range,{increments:n,major:s}=e,l=N1(a,n,s);for(let u of l.x)r&&this.#b(u,!0),i&&u.major&&this.#m(u,!0);for(let u of l.y)r&&this.#b(u,!1),i&&u.major&&this.#m(u,!1);o&&(this.#w(l.x.filter(u=>u.major)),this.#v(l.y.filter(u=>u.major)))}#E(e,r,i){if(this.#s==="line"&&this.#D(r,i.colour,i.lineWidth),this.#l==="dot")for(let o of r)this.#C(o,i.colour,i.dotRadius)}#D(e,r,i){let o=this.#r.context;o.beginPath();for(let[a,n]of e.entries()){let s=this.valueToRegionSpace(n,!1);a===0&&o.moveTo(s.x,s.y),o.lineTo(s.x,s.y)}o.strokeStyle=Me(r),o.lineWidth=i,o.stroke(),o.closePath()}#C(e,r,i){let o=Me(e.fillStyle??r),a=this.valueToRegionSpace(e),n=e.radius??i;this.#r.drawCircles([{...a,radius:n}],o)}#h(e,r,i,o=!1){o&&console.log(e);let a=this.#r.context;r=Me(r),a.beginPath(),a.moveTo(e.a.x,e.a.y),a.lineTo(e.b.x,e.b.y),a.strokeStyle=Me(r),a.lineWidth=i,a.stroke(),a.closePath()}get dataSet(){return this.#e}get canvasRegion(){return this.#r}get canvasSource(){return this.#r.source}},B1={};C(B1,{BipolarView:()=>S1,CartesianCanvasPlot:()=>M1,DataSet:()=>P1,absoluteCompute:()=>k1,computeAxisMark:()=>N1,computeMinMax:()=>dl,insert:()=>eN,relativeCompute:()=>F1});var tN={};C(tN,{CanvasHelper:()=>k5,Colour:()=>lf,Drawing:()=>Dv,ImageDataGrid:()=>n1,Plot:()=>B1,Svg:()=>C1,Video:()=>cf,pointerVisualise:()=>U5});try{typeof window<"u"&&(window.ixfx={...window.ixfx,Visuals:{NamedColourPalette:$1,Colour:lf,Video:cf}})}catch{}var rN=class{_source;_state;_teardownNeeded=!1;_cameraConstraints;_cameraStartResult;_videoSourceCapture;_videoFile;_videoStartResult;_showCanvas;_showPreview;_postCaptureDraw;_timer;_captureCanvasEl;constructor(e={}){this._state="ready",this._source="",this._timer=performance.now(),this._showCanvas=e.showCanvas??!1,this._showPreview=e.showPreview??!1,this._cameraConstraints=e.cameraConstraints??void 0,this._captureCanvasEl=e.captureCanvasEl??void 0,this._postCaptureDraw=e.postCaptureDraw}showPreview(e){if(this._state==="disposed")throw Error("Disposed");let r;switch(this._source){case"camera":r=this._cameraStartResult?.videoEl,r!==void 0&&(r.style.display=e?"block":"none");break}this._showPreview=e}showCanvas(e){if(this._state==="disposed")throw Error("Disposed");let r;if(this._source==="camera"||this._source==="video")r=this._videoSourceCapture?.canvasEl,r!==void 0&&(r.style.display=e?"block":"none");else throw Error(`Source not implemented: ${this._source}`);this._showCanvas=e}getCapturer(){if(this._state==="disposed")throw Error("Disposed");if(this._source==="camera"||this._source==="video")return this._videoSourceCapture;throw Error(`Source kind not supported ${this._source}`)}async useCamera(e){if(this._state==="disposed")throw Error("Disposed");this._source="camera",this._teardownNeeded&&this.teardown(),e&&(this._cameraConstraints=e),await this.init()}async useVideo(e){if(this._state==="disposed")throw Error("Disposed");this._source="video",this._teardownNeeded&&this.teardown(),this._videoFile=e,await this.init()}async initCamera(){let e=await wv(this._cameraConstraints);if(e===void 0)throw Error("Could not start camera");this._cameraStartResult=e,this.postInit(e)}async initVideo(){if(!this._videoFile)throw Error("Video file not defined");let e=await Ev(this._videoFile);this._videoStartResult=e,this.postInit(e)}async postInit(e){return this._showPreview&&(e.videoEl.style.display="block"),this._videoSourceCapture=A1(e.videoEl,{postCaptureDraw:this._postCaptureDraw,showCanvas:this._showCanvas,canvasEl:this._captureCanvasEl}),this._teardownNeeded=!0,this._cameraStartResult=e,Promise.resolve()}dispose(){this._state!=="disposed"&&(this.teardown(),this._state="disposed")}async init(){switch(this._timer=performance.now(),this._source){case"camera":await this.initCamera();break;case"video":await this.initVideo();break}this._state="initialised"}teardown(){if(this._teardownNeeded){switch((this._source==="camera"||this._source==="video")&&this._videoSourceCapture?.dispose(),this._source){case"camera":this._cameraStartResult?.dispose();break;case"video":this._videoStartResult?.dispose();break}this._teardownNeeded=!1}}getFrame(){if(this._state==="disposed")throw Error("Disposed");switch(this._source){case"camera":return this.getFrameCamera();case"video":return this.getFrameCamera();default:throw Error(`source type unhandled ${this._source}`)}}getTimestamp(){return performance.now()-this._timer}getFrameCamera(){return this._videoSourceCapture?.capture()}};const iN=(e,r={})=>{let i=j(r.startDelay,2e3),o=j(r.maxDelay,i*10),a=j(r.checkStateMs,5e3);if(i>o)throw Error("startDelay should be less than maxDelay");if(a<0)throw Error("Param 'checkState' should be above zero");let n=!0,s=$i({closed:"connecting",open:"closed",connecting:["closed","open"]}),l,u=m=>{r.onError?r.onError(m):(console.log("rw on error",m),console.error(` error: ${m.error}`),console.error(` type: ${m.type}`),console.error(` error msg: ${m.message}`))},c=m=>{r.onMessage&&r.onMessage(m.data)},f=async()=>{if(s.value==="connecting")throw Error("Cannot connect twice");s=Pe(s,"connecting"),l!==void 0&&(l.removeEventListener("error",u),r.onMessage&&l.removeEventListener("message",c),l=void 0);let m=await ku({async probe(D){try{let B=new WebSocket(e);return(await ny(B,["open","error"],{timeoutMs:1e3})).type==="open"?{success:!0,value:B}:{success:!1,error:"Could not open"}}catch(B){return{success:!1,error:ut(B)}}}},{predelayMs:i,limitAttempts:r.limitAttempts});l=m.value;let v=!1;return m.success&&l?(r.onMessage,v=!0,s=Pe(s,"open"),r.onConnected&&r.onConnected()):s=Pe(s,"closed"),v},d=m=>{if(l)l.readyState===l.OPEN?l.send(m):h();else throw Error("Not connected")},h=()=>{s.value!=="closed"&&(s.value==="open"&&(s=Pe(s,"closed"),r.onDisconnected&&r.onDisconnected()),n&&s.value!=="connecting"&&(console.log("Scheduling connect"),setTimeout(()=>{f()},100)))},p=()=>l?l.readyState===l.OPEN:!1,y=()=>{n=!1,s=Pe(s,"closed"),l?.close(),r.onDisconnected&&r.onDisconnected()},g=()=>(n=!0,s.value==="open"?Promise.resolve(!0):s.value==="connecting"?Promise.resolve(!1):f());return f(),setInterval(()=>{if(l)switch(l.readyState){case l.CLOSED:s.value==="open"&&h();break}},a),{send:d,isConnected:p,close:y,open:g}};var oN={};C(oN,{Audio:()=>pv,Bluetooth:()=>cv,Camera:()=>vv,Codec:()=>Oc,Espruino:()=>bv,FrameProcessor:()=>rN,Serial:()=>yv,StringReceiveBuffer:()=>jc,StringWriteBuffer:()=>Rc,VideoFile:()=>xv,genericStateTransitionsInstance:()=>Vc,reconnectingWebsocket:()=>iN});function z1(e,r={}){w(G(e,"aboveZero","totalTicks"));let i=r.exclusiveStart??!1,o=r.exclusiveEnd??!1,a=r.cycleLimit??2**53-1,n=i?1:0,s=o?e-1:e,l=0,u=r.startAt??n;if(r.startAtRelative){let c=e;i&&c--,o&&c--,u=Math.round(r.startAtRelative*c)}return c=>{if(c&&(c.resetAt!==void 0&&(u=c.resetAt),c.resetAtRelative!==void 0&&(u=Math.floor(c.resetAtRelative*e))),l>=a)return 1;let f=u/e;return u++,u>s&&(l++,u=n),f}}function bi(e,r={}){let i=r.cycleLimit??9007199254740991,o=1,a=r.startAt??performance.now(),n=0,s=j(e,1e3);return r.startAtRelative&&(w($(r.startAtRelative,"percentage","startAtRelative")),a=performance.now()-s*r.startAtRelative),l=>{if(l&&(l.resetAt!==void 0&&(a=l.resetAt,a===0&&(a=performance.now())),l.resetAtRelative!==void 0&&(w($(l.resetAtRelative,"percentage","resetAtRelative")),a=performance.now()-s*l.resetAtRelative)),n>=i)return o;let u=performance.now(),c=u-a;return c>=s&&(n+=Math.floor(c/s),a=u,n>=i)?o:c%s/s}}function T1(e,r={}){let i=6e4/e;return bi(i,r)}function ff(e,r={}){let i=1e3/e;return bi(i,r)}const O1=(e,r={})=>{let i=e/1e3,o=r.min??-9007199254740991,a=r.max??2**53-1,n=r.clamp??!1;if(n&&r.max)throw Error("Use either 'max' or 'clamp', not both.");n&&(a=e);let s=performance.now();return()=>{let l=performance.now(),u=l-s;s=l;let c=i*u;return c>a?a:c<o?o:c}},aN=(e,r={})=>O1(e/60,r);var j1={};C(j1,{bpm:()=>T1,elapsed:()=>bi,hertz:()=>ff,perMinute:()=>aN,perSecond:()=>O1,ticks:()=>z1});var R1={};C(R1,{saw:()=>uN,sine:()=>nN,sineBipolar:()=>sN,square:()=>cN,triangle:()=>lN});const V1=Math.PI*2;function*nN(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Qr(e));;)yield(Math.sin(e.elapsed*V1)+1)/2}function*sN(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Qr(e));;)yield Math.sin(e.elapsed*V1)}function*lN(e){for(typeof e=="number"&&(e=Qr(e));;){let r=e.elapsed;r<.5?r*=2:r=2-r*2,yield r}}function*uN(e){if(e===void 0)throw TypeError("Parameter 'timerOrFreq' is undefined");for(typeof e=="number"&&(e=Qr(e));;)yield e.elapsed}function*cN(e){for(typeof e=="number"&&(e=Qr(e));;)yield e.elapsed<.5?0:1}const fN=Math.pow,dN=1/Math.sqrt(2*Math.PI),L1=(e=.4)=>{let r=.5;return i=>{let o=dN/e,a=-2.5,n=(i-r)/e;n*=n,a*=n;let s=o*fN(Math.E,a);return s>1?1:s<0?0:s}};var df={};C(df,{arch:()=>yN,backIn:()=>zN,backInOut:()=>jN,backOut:()=>TN,bell:()=>IN,bounceIn:()=>LN,bounceInOut:()=>_N,bounceOut:()=>Xa,circIn:()=>MN,circInOut:()=>ON,circOut:()=>BN,cubicIn:()=>CN,cubicOut:()=>$N,elasticIn:()=>RN,elasticInOut:()=>qN,elasticOut:()=>VN,expoIn:()=>FN,expoInOut:()=>PN,expoOut:()=>kN,quadIn:()=>wN,quadInOut:()=>DN,quadOut:()=>xN,quartIn:()=>AN,quartOut:()=>SN,quintIn:()=>hN,quintInOut:()=>NN,quintOut:()=>pN,sineIn:()=>bN,sineInOut:()=>EN,sineOut:()=>vN,smootherstep:()=>mN,smoothstep:()=>gN});const Za=Math.sqrt,be=Math.pow,I1=Math.cos,Li=Math.PI,$o=Math.sin,Xa=e=>{let r=7.5625,i=2.75;return e<1/i?r*e*e:e<2/i?r*(e-=1.5/i)*e+.75:e<2.5/i?r*(e-=2.25/i)*e+.9375:r*(e-=2.625/i)*e+.984375},hN=e=>e*e*e*e*e,pN=e=>1-be(1-e,5),yN=e=>e*(1-e)*4,gN=e=>e*e*(3-2*e),mN=e=>(e*(e*6-15)+10)*e*e*e,bN=e=>1-I1(e*Li/2),vN=e=>$o(e*Li/2),wN=e=>e*e,xN=e=>1-(1-e)*(1-e),EN=e=>-(I1(Li*e)-1)/2,DN=e=>e<.5?2*e*e:1-be(-2*e+2,2)/2,CN=e=>e*e*e,$N=e=>1-be(1-e,3),AN=e=>e*e*e*e,SN=e=>1-be(1-e,4),FN=e=>e===0?0:be(2,10*e-10),kN=e=>e===1?1:1-be(2,-10*e),NN=e=>e<.5?16*e*e*e*e*e:1-be(-2*e+2,5)/2,PN=e=>e===0?0:e===1?1:e<.5?be(2,20*e-10)/2:(2-be(2,-20*e+10))/2,MN=e=>1-Za(1-be(e,2)),BN=e=>Za(1-be(e-1,2)),zN=e=>{let r=1.70158;return(r+1)*e*e*e-r*e*e},TN=e=>{let r=1.70158;return 1+(r+1)*be(e-1,3)+r*be(e-1,2)},ON=e=>e<.5?(1-Za(1-be(2*e,2)))/2:(Za(1-be(-2*e+2,2))+1)/2,jN=e=>{let r=1.70158,i=r*1.525;return e<.5?be(2*e,2)*((i+1)*2*e-i)/2:(be(2*e-2,2)*((i+1)*(e*2-2)+i)+2)/2},RN=e=>{let r=2*Li/3;return e===0?0:e===1?1:-be(2,10*e-10)*$o((e*10-10.75)*r)},VN=e=>{let r=2*Li/3;return e===0?0:e===1?1:be(2,-10*e)*$o((e*10-.75)*r)+1},LN=e=>1-Xa(1-e),IN=L1(),qN=e=>{let r=2*Li/4.5;return e===0?0:e===1?1:e<.5?-(be(2,20*e-10)*$o((20*e-11.125)*r))/2:be(2,-20*e+10)*$o((20*e-11.125)*r)/2+1},_N=e=>e<.5?(1-Xa(1-2*e))/2:(1+Xa(2*e-1))/2,WN=(e=0,r=0)=>{let i=1,o={x:ft(e,-1,1,0,i),y:ft(e,-1,1,i,0)},a=ma(Math.abs(e),ee,o);e!==0&&r>0&&(a=e>0?ma(r,a,{x:0,y:o.x*2}):ma(r,a,{x:o.y*2,y:0}));let n=Nb(ee,Eg,a,o),s=Fb(n);return l=>s(l)},q1=(e,r)=>{w(So(e,"fn"));let i;return()=>(i===void 0&&(i=Nu(r,{clampValue:!0})),e(i()))},_1=(e,r)=>{w(So(e,"fn"));let i=Er(),o=j(r);if(o===void 0)throw Error("Param 'duration' not provided");let a=Ci(o,{timer:i,clampValue:!0});return Mu(e,a)},W1=(e,r)=>{w(So(e,"fn"));let i;return()=>(i===void 0&&(i=yy(r,{clampValue:!0})),e(i()))},G1=(e,r)=>{w(So(e,"fn"));let i=Pu(),o=Ci(r,{timer:i,clampValue:!0});return Mu(e,o)};var U1={};C(U1,{Named:()=>df,create:()=>GN,get:()=>Yn,getEasingNames:()=>HN,line:()=>WN,tickEasing:()=>JN,ticks:()=>H1,time:()=>J1,timeEasing:()=>UN});const GN=e=>{let r=aa(e.name??"quintIn"),i=r??e.fn;if(i===void 0)throw Error("Either 'name' or 'fn' must be set");if("duration"in e)return J1(i,e.duration);if("ticks"in e)return H1(i,e.ticks);throw Error("Expected 'duration' or 'ticks' in options")},UN=(e,r)=>{let i=aa(e);return _1(i,r)},J1=(e,r)=>{let i=aa(e);return q1(i,r)},H1=(e,r)=>{let i=aa(e);return W1(i,r)},JN=(e,r)=>{let i=aa(e);return G1(i,r)},aa=e=>{let r=typeof e=="function"?e:Yn(e);if(r===void 0)throw Error(typeof e=="string"?`Easing function not found: '${e}'`:"Easing function not found");return r};let eo;const Yn=function(e){w(ml(e,"non-empty","easingName"));let r=K1().get(e.toLowerCase());if(r===void 0)throw Error(`Easing not found: '${e}'`);return r};function K1(){if(eo===void 0){eo=new Map;for(let[e,r]of Object.entries(df))eo.set(e.toLowerCase(),r);return eo}else return eo}function*HN(){yield*K1().keys()}const Q1=Object.freeze({attack:["decay","release"],decay:["sustain","release"],sustain:["release"],release:["complete"],complete:null}),ao=Object.freeze({attackDuration:600,decayDuration:200,releaseDuration:800,shouldLoop:!1});var Z1=class extends Ye{#e;#t;#r;#i;#o;#a=!1;#n=!1;attackDuration;decayDuration;releaseDuration;decayDurationTotal;shouldLoop;constructor(e={}){super(),this.attackDuration=e.attackDuration??ao.attackDuration,this.decayDuration=e.decayDuration??ao.decayDuration,this.releaseDuration=e.releaseDuration??ao.releaseDuration,this.shouldLoop=e.shouldLoop??ao.shouldLoop,this.#e=new mn(Q1,{initial:"attack"}),this.#e.addEventListener("change",r=>{r.newState==="release"&&this.#o&&this.#r?.reset(),super.fireEvent("change",r)}),this.#e.addEventListener("stop",r=>{super.fireEvent("complete",r)}),this.#t=()=>Er(),this.#i=this.#o=!1,this.decayDurationTotal=this.attackDuration+this.decayDuration}dispose(){this.#a||this.#e.dispose()}get isDisposed(){return this.#a}switchStateIfNeeded(e){if(this.#r===void 0)return!1;let r=this.#r.elapsed,i=this.#o&&!this.#i,o=!1,a=this.#e.state;do switch(o=!1,a=this.#e.state,a){case"attack":(r>this.attackDuration||i)&&(this.#e.next(),o=!0);break;case"decay":(r>this.decayDurationTotal||i)&&(this.#e.next(),o=!0);break;case"sustain":(!this.#i||i)&&(r=0,this.#e.next(),this.#r.reset(),o=!0);break;case"release":r>this.releaseDuration&&(this.#e.next(),o=!0);break;case"complete":this.shouldLoop&&e&&this.trigger(this.#o)}while(o&&a!=="complete");return o}computeRaw(e=!0,r=!0){if(this.#r===void 0)return[void 0,0,this.#e.state];e&&this.switchStateIfNeeded(r);let i=this.#e.state,o=this.#r.elapsed,a=0,n=this.#e.state;switch(n){case"attack":a=o/this.attackDuration;break;case"decay":a=(o-this.attackDuration)/this.decayDuration;break;case"sustain":a=1;break;case"release":a=Math.min(o/this.releaseDuration,1);break;case"complete":return["complete",1,i];default:throw Error(`State machine in unknown state: ${n}`)}return[n,a,i]}get isDone(){return this.#e.isDone}onTrigger(){}trigger(e=!1){this.onTrigger(),this.#n=!0,this.#e.reset(),this.#r=this.#t(),this.#i=e,this.#o=e}get hasTriggered(){return this.#n}compute(){}release(){this.isDone||!this.#o||(this.#i=!1,this.compute())}};const Kt=Object.freeze({attackBend:-1,decayBend:-.3,releaseBend:-.3,peakLevel:1,initialLevel:0,sustainLevel:.6,releaseLevel:0,retrigger:!1});var X1=class{adsr;constructor(e){this.adsr=e}next(...e){this.adsr.hasTriggered||this.adsr.trigger();let r=this.adsr.compute();return{value:r[1],done:r[0]==="complete"}}get[Symbol.toStringTag](){return"Generator"}},hf=class extends Z1{attackPath;decayPath;releasePath;initialLevel;peakLevel;releaseLevel;sustainLevel;attackBend;decayBend;releaseBend;initialLevelOverride;retrigger;releasedAt;constructor(e={}){super(e),this.retrigger=e.retrigger??Kt.retrigger,this.initialLevel=e.initialLevel??Kt.initialLevel,this.peakLevel=e.peakLevel??Kt.peakLevel,this.releaseLevel=e.releaseLevel??Kt.releaseLevel,this.sustainLevel=e.sustainLevel??Kt.sustainLevel,this.attackBend=e.attackBend??Kt.attackBend,this.releaseBend=e.releaseBend??Kt.releaseBend,this.decayBend=e.decayBend??Kt.decayBend;let r=1;this.attackPath=Ca(Da({x:0,y:this.initialLevel},{x:r,y:this.peakLevel},-this.attackBend)),this.decayPath=Ca(Da({x:0,y:this.peakLevel},{x:r,y:this.sustainLevel},-this.decayBend)),this.releasePath=Ca(Da({x:0,y:this.sustainLevel},{x:r,y:this.releaseLevel},-this.releaseBend))}onTrigger(){if(this.initialLevelOverride=void 0,!this.retrigger){let[e,r,i]=this.compute(!0,!1);!Number.isNaN(r)&&r>0&&(this.initialLevelOverride=r)}}[Symbol.iterator](){return new X1(this)}get value(){return this.compute(!0)[1]}compute(e=!0,r=!0){let[i,o]=super.computeRaw(e,r);if(i===void 0)return[void 0,NaN,NaN];let a;switch(i){case"attack":a=this.attackPath.interpolate(o).y,this.initialLevelOverride!==void 0&&(a=ft(a,0,1,this.initialLevelOverride,1)),this.releasedAt=a;break;case"decay":a=this.decayPath.interpolate(o).y,this.releasedAt=a;break;case"sustain":a=this.sustainLevel,this.releasedAt=a;break;case"release":a=this.releasePath.interpolate(o).y,this.releasedAt!==void 0&&(a=ft(a,0,this.sustainLevel,0,this.releasedAt));break;case"complete":a=this.releaseLevel,this.releasedAt=void 0;break;default:throw Error(`Unknown state: ${i}`)}return[i,a,o]}},Y1={};C(Y1,{Adsr:()=>hf,AdsrBase:()=>Z1,AdsrIterator:()=>X1,adsr:()=>KN,adsrIterable:()=>QN,adsrStateTransitions:()=>Q1,defaultAdsrOpts:()=>Kt,defaultAdsrTimingOpts:()=>ao});const KN=(e={})=>{let r=new hf(e),i=r.releaseLevel,o=r[Symbol.iterator]();return()=>bE(o,{overrideWithLast:!0,value:i})};async function*QN(e){let r=new hf(e.env),i=e.sampleRateMs??100;r.trigger();let o=dy(()=>r.value,{while:()=>!r.isDone,delay:i,signal:e.signal});for await(let a of o)yield a}var ew={};C(ew,{accelerationForce:()=>rP,angleFromAccelerationForce:()=>iw,angleFromVelocityForce:()=>ow,angularForce:()=>rw,apply:()=>tP,attractionForce:()=>YN,computeAccelerationToTarget:()=>aw,computeAttractionForce:()=>tw,computePositionFromAngle:()=>nw,computePositionFromVelocity:()=>yf,computeVelocity:()=>pf,constrainBounce:()=>XN,guard:()=>ZN,magnitudeForce:()=>iP,nullForce:()=>oP,orientationForce:()=>cP,pendulumForce:()=>sP,springForce:()=>nP,targetForce:()=>eP,velocityForce:()=>aP});const ZN=(e,r="t")=>{if(e===void 0)throw Error(`Parameter ${r} is undefined. Expected ForceAffected`);if(e===null)throw Error(`Parameter ${r} is null. Expected ForceAffected`);if(typeof e!="object")throw TypeError(`Parameter ${r} is type ${typeof e}. Expected object of shape ForceAffected`)},XN=(e,r=1)=>{e||={width:1,height:1};let i=Hs(e,"left"),o=Hs(e,"right"),a=Ks(e,"top"),n=Ks(e,"bottom");return s=>{let l=yf(s.position??ee,s.velocity??ee),u=s.velocity??ee,{x:c,y:f}=l;return c>o?(c=o,u=Or(vt(u,r),"x")):c<i&&(c=i,u=Or(vt(u,r),"x")),f>n?(f=n,u=vt(Or(u,"y"),r)):l.y<a&&(f=a,u=Or(vt(u,r),"y")),Object.freeze({...s,position:{x:c,y:f},velocity:u})}},YN=(e,r,i={})=>o=>{let a=o.acceleration??ee;for(let n of e){if(n===o)continue;let s=tw(n,o,r,i);a=Xe(a,s)}return{...o,acceleration:a}},tw=(e,r,i,o={})=>{if(e.position===void 0)throw Error("attractor.position not set");if(r.position===void 0)throw Error("attractee.position not set");let a=o.min??.01,n=o.max??.7,s=Wo($e(e.position,r.position)),l=ie(X(s),a,n);return vt(s,i*(e.mass??1)*(r.mass??1)/(l*l))},eP=(e,r={})=>o=>{let a=aw(e,o.position??{x:.5,y:.5},r);return{...o,acceleration:Xe(o.acceleration??ee,a)}},tP=(e,...r)=>{if(e===void 0)throw Error("t parameter is undefined");for(let n of r)n!=null&&(e=typeof n=="function"?n(e):{...e,acceleration:Xe(e.acceleration??ee,n)});let i=pf(e.acceleration??ee,e.velocity??ee),o=yf(e.position??ee,i);return{...e,position:o,velocity:i,acceleration:ee}},rP=(e,r="ignored")=>i=>Object.freeze({...i,acceleration:es(e,i,r)}),es=(e,r,i="ignored")=>{let o;switch(i){case"dampen":o=a=>yo(e,a,a);break;case"multiply":o=a=>wr(e,a,a);break;case"ignored":o=a=>e;break;default:throw Error(`Unknown 'mass' parameter '${i}. Expected 'dampen', 'multiply' or 'ignored'`)}return Xe(r.acceleration??ee,o(r.mass??1))},iP=(e,r="ignored")=>i=>{if(i.velocity===void 0)return i;let o=X(Wo(i.velocity)),a=e*o*o,n=vt(Or(i.velocity),a);return Object.freeze({...i,acceleration:es(n,i,r)})},oP=e=>e,aP=(e,r)=>{let i=Xu(Or,o=>vt(o,e));return o=>{if(o.velocity===void 0)return o;let a=i(o.velocity);return Object.freeze({...o,acceleration:es(a,o,r)})}},rw=()=>e=>{let r=e.angularAcceleration??0,i=e.angularVelocity??0,o=e.angle??0,a=i+r,n=o+a;return Object.freeze({...e,angle:n,angularVelocity:a,angularAcceleration:0})},iw=(e=20)=>r=>{let i=r.acceleration??ee;return Object.freeze({...r,angularAcceleration:i.x*e})},ow=(e=1)=>r=>{let i=Nt(r.velocity??ee);return Object.freeze({...r,angle:e<1?$p(e,r.angle??0,i):i})},nP=(e,r=.5,i=2e-4,o=.999)=>a=>{let n=$e(a.position??ee,e),s=X(n),l=Math.abs(r-s),u=Cg(n,Wo,h=>vt(h,-i*l)),c=es(u,a,"dampen"),f=pf(c??ee,a.velocity??ee),d=wr(f,o,o);return{...a,velocity:d,acceleration:ee}},sP=(e,r={})=>i=>{e||={x:0,y:0};let o=r.length??X(e,i.position??ee),a=r.speed??.001,n=r.damping??.995,s=i.angle;s===void 0&&(s=i.position?Nt(e,i.position)-Math.PI/2:0);let l=-1*a/o*Math.sin(s),u=(i.angularVelocity??0)+l;return s+=u,Object.freeze({angularVelocity:u*n,angle:s,position:nw(o,s+Math.PI/2,e)})},pf=(e,r,i)=>{let o=Xe(r,e);return i===void 0?o:Zu(o,i)},aw=(e,r,i={})=>{let o=i.diminishBy??.001,a=$e(e,r);return i.range&&bg(gg(a),i.range)===-2?ee:vt(a,o)},yf=(e,r)=>Xe(e,r),nw=(e,r,i)=>Ue(e,r,i),lP=rw(),uP=iw(),cP=(e=.5)=>{let r=ow(e);return i=>(i=lP(i),i=uP(i),i=r(i),i)},fP=(e,r)=>i=>{let o=1-i,a=o*o,n=i*i,s=n*i;return 3*e*a*i+3*r*o*n+s},dP=e=>{let r=performance.now();return{update:(a=1)=>{let n=performance.now()-r,s=e*n%1;return r=performance.now(),(a+s)%1},reset:()=>{r=performance.now()}}},wd=Math.PI*2;function gf(e,r,i,o){let a,n="clamp",s=f=>(a&&(f=a(f)),n===void 0||n==="clamp"?f=ie(f):n==="wrap"&&(f>1?f%=1:f<0&&(f=1+f%1)),f),l=(f,d,h)=>(w($(d,"","a"),$(h,"","b"),$(f,"","amount")),f=s(f),(1-f)*d+f*h),u=(f={})=>{if(f.easing){let d=Yn(f.easing);if(!d)throw Error(`Easing function '${f.easing}' not found`);a=d}else if(f.transform){if(typeof f.transform!="function")throw Error(`Param 'transform' is expected to be a function. Got: ${typeof f.transform}`);a=f.transform}n=f.limits??"clamp"},c=(f,d,h)=>(1-f)*d+f*h;if(typeof e!="number")throw TypeError(`First param is expected to be a number. Got: ${typeof e}`);if(typeof r=="number"){let f,d;if(i===void 0||typeof i=="object")return f=e,d=r,u(i),h=>l(h,f,d);if(typeof i=="number")return f=r,d=i,u(o),l(e,f,d);throw Error("Values for 'a' and 'b' not defined")}else if(r===void 0||typeof r=="object"){let f=s(e);return u(r),w($(f,"","amount")),(d,h)=>c(f,d,h)}}const hP=(e,r=0,i=1,o=0,a)=>{let n=o;return(s,l)=>{if(s!==void 0&&(i=s),l!==void 0&&(r=l),n>=1)return i;let u=gf(n,r,i,a);return n+=e,u}},pP=(e,r,i,o)=>{let a=ho(i-r,0,wd);return gf(e,r,r+(a>Math.PI?a-wd:a),o)},yP=(e,r=0,i=1,o)=>{let a=Nu(e,{clampValue:!0});return(n,s)=>{let l=a();return n!==void 0&&(i=n),s!==void 0&&(r=s),l>=1?i:gf(l,r,i,o)}},gP=e=>{let{relative:r,absolute:i}=e,o=e.clamped??!1,a=e.source??Math.random;if(i!==void 0)return n=>{let s=a()*i*2-i,l=n+s;return o?ie(l,0,n):l};if(r!==void 0)return n=>{let s=n*r,l=a()*s*2-s,u=n+l;return o?ie(u,0,n):u};throw Error("Either absolute or relative fields expected")},mP=(e={})=>{let r=e.clamped??!0,i=a=>0;if(e.absolute!==void 0){w($(e.absolute,r?"percentage":"bipolar","opts.absolute"));let a=Cn({min:-e.absolute,max:e.absolute,source:e.source});i=n=>n+a()}else{if(e.relative===void 0)throw TypeError("Either absolute or relative jitter amount is required.");{let a=e.relative??.1;w($(a,r?"percentage":"bipolar","opts.relative")),i=n=>n+ag({min:-Math.abs(a*n),max:Math.abs(a*n),source:e.source})}}return a=>{w($(a,r?"percentage":"bipolar","value"));let n=i(a);return r&&(n=ie(n)),n}},bP=(e,r,i)=>{let o=i*e;return(1-e)*r+r*o},sw=(e,r,i)=>o=>De(e,r(o),i(o)),vP=(e,r)=>i=>sw(i,e,r)(i),wP=e=>e,xP=function(e=.1,r,i,o,a){return r===void 0&&(r=0),i===void 0&&(i=1),o===void 0&&(o=r),w($(e,"bipolar","interval"),$(i,"bipolar","end"),$(o,"bipolar","offset"),$(r,"bipolar","start")),lw(e,r,i,o,a)},lw=function*(e,r,i,o,a){if(r===void 0)throw Error("Parameter 'lower' is undefined");if(e===void 0)throw Error("Parameter 'interval' is undefined");if(i===void 0)throw Error("Parameter 'upper' is undefined");if(a===void 0&&e<=1&&e>=0?a=10/e:a===void 0&&(a=1234),Number.isNaN(e))throw Error("interval parameter is NaN");if(Number.isNaN(r))throw Error("lower parameter is NaN");if(Number.isNaN(i)||Number.isNaN(o))throw Error("upper parameter is NaN");if(r>=i)throw Error("lower must be less than upper");if(e===0)throw Error("Interval cannot be zero");let n=i-r;if(Math.abs(e)>=n)throw Error(`Interval should be between -${n} and ${n}`);let s=e>0;if(i=Math.floor(i*a),r=Math.floor(r*a),e=Math.floor(Math.abs(e*a)),e===0)throw Error(`Interval is zero (rounding: ${a})`);if(o=o===void 0?r:Math.floor(o*a),o>i||o<r)throw Error(`Start (${o/a}) must be within lower (${r/a}) and upper (${i/a})`);let l=o;yield l/a;let u=!0;for(;;)l+=s?e:-e,s&&l>=i?(s=!1,l=i,l===i&&u&&(l=r,s=!0)):!s&&l<=r&&(s=!0,l=r,l===r&&u&&(l=i,s=!1)),yield l/a,u=!1};function*uw(e={},r){r===void 0?r=Er():typeof r=="number"&&(r=Qr(r));let i=cw(e),o=e.countdown??10;for(;o>0;){let a=i(r.elapsed/1e3);yield a,a===1?o--:o=100}}function EP(e={},r){let i=uw(e,r);return()=>{let o=i.next();return o.done?1:o.value}}const cw=(e={})=>{let r=0,i=1,o=e.mass??1,a=e.stiffness??100,n=e.soft??!1,s=e.damping??10,l=e.velocity??.1,u=i-r;if(n||1<=s/(2*Math.sqrt(a*o))){let c=-Math.sqrt(a/o),f=-c*u-l;return d=>i-(u+d*f)*Math.E**(d*c)}else{let c=Math.sqrt(4*o*a-s**2),f=(s*u-2*o*l)/c,d=.5*c/o,h=-(.5*s)/o;return p=>i-(Math.cos(p*d)*u+Math.sin(p*d)*f)*Math.E**(p*h)}},DP=(e,r,i={})=>{switch(e){case"elapsed":return()=>bi(r,i);case"bpm":return()=>T1(r,i);case"hertz":return()=>ff(r,i);default:throw Error(`Unknown source '${e}'. Expected: 'elapsed', 'hertz' or 'bpm'`)}};function fw(e=1){e=1/e;let r=e/2;return i=>Math.abs(i%e-r)}function dw(e=1){e=1/e;let r=e/2;return i=>i%e<r?1:0}function hw(e=1){return e*=Math.PI*2,r=>(Math.sin(r*e)+1)/2}function pw(e=1){return e*=Math.PI*2,r=>Math.abs(Math.sin(r*e))}function yw(e=1){return e*=Math.PI*2,r=>Math.sin(r*e)}function CP(e){let r=e.shape??"sine",i=e.invert??!1,o=e.period??1,a;w(G(o,"aboveZero","period"));let n={...e};if(e.ticks)a=z1(e.ticks,n);else if(e.hertz)a=ff(e.hertz,n);else if(e.millis)a=bi(e.millis,n);else if(e.source)a=e.source;else{let l=e.secs??5;a=bi(l*1e3,n)}let s;switch(r){case"saw":s=l=>l;break;case"sine":s=hw(o);break;case"sine-bipolar":s=yw(o);break;case"square":s=dw(o);break;case"triangle":s=fw(o);break;case"arc":s=pw(o);break;default:throw Error(`Unknown wave shape '${r}'. Expected: sine, sine-bipolar, saw, triangle, arc or square`)}return gw(a,s,i)}function gw(e,r,i=!1){return o=>{let a=e(o?.clock);return o?.override&&(a=o.override),a=r(a),i&&(a=1-a),a}}const $P=(e,r,i)=>(e*(i-1)+r)/i,AP=(e="quadIn")=>mw(e)(),mw=(e="quadIn")=>{let r=typeof e=="string"?{easing:e}:e,i=r.source??Math.random,o=r.easing??"quadIn",a=Yn(o);if(a===void 0)throw Error(`Easing function '${o}' not found.`);return()=>{let s=i();return a(s)}};var SP={};C(SP,{Easings:()=>U1,Envelopes:()=>Y1,Forces:()=>ew,Oscillators:()=>R1,Sources:()=>j1,arcShape:()=>pw,crossfade:()=>vP,cubicBezierShape:()=>fP,drift:()=>dP,gaussian:()=>L1,interpolate:()=>De,interpolateAngle:()=>pP,interpolatorInterval:()=>yP,interpolatorStepped:()=>hP,jitter:()=>mP,jitterAbsolute:()=>gP,mix:()=>bP,mixModulators:()=>sw,noop:()=>wP,pingPong:()=>lw,pingPongPercent:()=>xP,sineBipolarShape:()=>yw,sineShape:()=>hw,spring:()=>uw,springShape:()=>cw,springValue:()=>EP,squareShape:()=>dw,tickModulator:()=>G1,ticks:()=>W1,time:()=>q1,timeModulator:()=>_1,timingSourceFactory:()=>DP,triangleShape:()=>fw,wave:()=>CP,waveFromSource:()=>gw,weighted:()=>AP,weightedAverage:()=>$P,weightedSource:()=>mw});var mf=class extends Error{constructor(e){super(e),this.name="CancelError"}};function FP(...e){return r=>{let i=r;for(let o of e)try{i=o(i)}catch(a){if(a instanceof mf)break;throw a}return i}}function kP(e){return r=>r===void 0?r:e(r)}function NP(){return e=>{if(e===void 0)throw new mf("cancel");return e}}function PP(e){return r=>r===void 0?e():r}const MP=(e,r)=>e===r,BP=e=>typeof e=="string"?e:JSON.stringify(e);function zP(e){let r;return i=>{if(i!==r)return r=i,i}}function TP(e){let r=[];return e===void 0&&(e=MP),i=>{if(i!==void 0){for(let o of r)if(e(o,i))return;return r.push(i),i}}}function OP(e){let r=new Set;return e===void 0&&(e=BP),i=>{if(i===void 0)return;let o=e(i);if(!r.has(o))return r.add(o),i}}var jP={};C(jP,{CancelError:()=>mf,average:()=>hu,cancelIfUndefined:()=>NP,flow:()=>FP,ifNotUndefined:()=>kP,ifUndefined:()=>PP,max:()=>cu,min:()=>fu,rank:()=>yu,seenLastToUndefined:()=>zP,seenToUndefined:()=>TP,seenToUndefinedByKey:()=>OP,sum:()=>du,tally:()=>pu});function vi(e){return e.value===void 0?"signal"in e&&e.signal!==void 0:!1}function dt(e){return e.value===void 0?"signal"in e&&e.signal==="done":!1}function ke(e){return e.value!==void 0}const bw=e=>na(e)?"ping"in e:!1,Ar=e=>na(e)?"last"in e&&e.last()!==void 0:!1,na=e=>typeof e!="object"||!e?!1:"on"in e&&"onValue"in e,bf=e=>na(e)?"set"in e:!1,vw=e=>!(typeof e!="object"||!("source"in e)||!("annotate"in e)),We=(e,...r)=>i=>e(i,...r),vf=e=>"value"in e,wf=e=>"fn"in e,xf=e=>wi(e),ww=e=>typeof e=="object"?!!(vf(e)||wf(e)||xf(e)):!1;function xw(e){if(vf(e))return[e.value,!1];if(wf(e)){let r=e.fn();return r===void 0?[void 0,!0]:[r,!1]}if(xf(e)){let r=e.gen.next();return r.done?[void 0,!0]:[r.value,!1]}throw Error("Invalid trigger. Missing 'value' or 'fn' fields")}function Ew(e,r={}){let i=r.maximumRepeats??9007199254740991,o=r.closeOnError??!0,a=r.interval?j(r.interval):-1,n=r.manual??!1;if(r.interval===void 0&&r.manual===void 0&&(n=!0),n&&r.interval)throw Error("If option 'manual' is set, option 'interval' cannot be used");let s=j(r.predelay,0),l=r.lazy??"very",u=r.signal,c=new AbortController,f=v=>{c.abort(v)},d=0,h=!1,p=v=>{m.dispose(v),h=!1,g&&g.cancel()},y=async()=>{if(!h)return!1;if(s&&await Ce(s),d>=i)return p(`Maximum repeats reached ${i.toString()}`),!1;try{if(u?.aborted)return p(`Signal (${u.aborted})`),!1;let v=await e(f);return d++,m.set(v),!0}catch(v){return o?(p(`Function error: ${ut(v)}`),!1):(m.signal("warn",ut(v)),!0)}},g=n?void 0:or(async()=>{if(!await y())return!1;if(c.signal.aborted)return p(`callback function aborted (${c.signal.reason})`),!1},a),m=nr({lazy:l,onStart(){h=!0,g&&g.start()},onStop(){h=!1,g&&g.cancel()}});return l==="never"&&g&&g.start(),{...m,ping:y}}function hl(e,r={}){let i=r.lazy??"very",o=r.traceLifecycle?p=>{console.log(`Rx.From.iterator ${p}`)}:p=>{},a=j(r.readInterval,5),n=j(r.readTimeout,300*1e3),s=r.whenStopped??"continue",l,u,c=$i({idle:["wait_for_next"],wait_for_next:["processing_result","stopping","disposed"],processing_result:["queued","disposed","stopping"],queued:["wait_for_next","disposed","stopping"],stopping:"idle",disposed:null},"idle"),f=()=>{o("onExternalSignal"),u?.abort(r.signal?.reason)};r.signal&&r.signal.addEventListener("abort",f,{once:!0});let d=async()=>{o(`read. State: ${c.value}`),u=new AbortController;try{c=Pe(c,"wait_for_next");let p=await lu(l,{signal:u.signal,millis:n});if(c=Pe(c,"processing_result"),u.abort("nextWithTimeout completed"),p.done&&(o("read v.done true"),h.dispose("Generator complete"),c=Pe(c,"disposed")),c.value==="stopping"){o("read. sm.value = stopping"),c=Pe(c,"idle");return}if(c.value==="disposed"){o("read. sm.value = disposed");return}h.set(p.value)}catch(p){h.dispose(`Generator error: ${p.toString()}`);return}c.value==="processing_result"?(c=Pe(c,"queued"),o(`scheduling read. State: ${c.value}`),setTimeout(d,a)):c=Pe(c,"idle")},h=nr({...r,lazy:i,onStart(){o(`onStart state: ${c.value} whenStopped: ${s}`),c.value==="idle"&&((c.value==="idle"&&s==="reset"||l===void 0)&&(l=Z(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]()),d())},onStop(){o(`onStop state: ${c.value} whenStopped: ${s}`),c=Pe(c,"stopping"),s==="reset"&&(o("onStop reiniting iterator"),l=Z(e)?e[Symbol.asyncIterator]():e[Symbol.iterator]())},onDispose(p){o(`onDispose (${p})`),u?.abort(`Rx.From.iterator disposed (${p})`),r.signal&&r.signal.removeEventListener("abort",f)}});return h}const ce=(e,r={})=>{if(na(e))return e;let i=r.generator??{lazy:"initial",interval:5},o=r.function??{lazy:"very"};if(Array.isArray(e))return hl(e.values(),i);if(typeof e=="function")return Ew(e,o);if(typeof e=="object"){if(vw(e))return e.source;if(wi(e)||Z(e))return hl(e,i)}throw TypeError(`Unable to resolve source. Supports: array, Reactive, Async/Iterable. Got type: ${typeof e}`)};function Ef(e,r){let i=r;return e.onValue(o=>{i=o}),{...e,last(){return i},resetCachedValue(){i=void 0}}}function Te(e,r){let i=r.lazy??"initial",o=r.disposeIfSourceDone??!0,a=r.onValue??(d=>{}),n=ce(e),s,l=r.debugLabel?`[${r.debugLabel}]`:"",u=()=>{s!==void 0&&(s(),s=void 0,r.onStop&&r.onStop())},c=()=>{s===void 0&&(r.onStart&&r.onStart(),s=n.on(d=>{vi(d)?d.signal==="done"?(u(),f.signal(d.signal,d.context),o&&f.dispose(`Upstream source ${l} has completed (${d.context??""})`)):f.signal(d.signal,d.context):ke(d)&&a(d.value)}))},f=nr({...r,lazy:i,onStart:c,onStop:u});return f}function RP(e){let r=nr(e);return Ef(r,e.initialValue)}function nr(e){let r=e.lazy??"initial",i=e.onStop??(()=>{}),o=e.onStart??(()=>{});e.debugLabel&&`${e.debugLabel}`;let a=ze({...e,onFirstSubscribe(){r!=="never"&&o()},onNoSubscribers(){r==="very"&&i()}});return r==="never"&&o(),a}function ze(e={}){let r,i=!1,o=!1,a=!0,n=e.onFirstSubscribe??void 0,s=e.onNoSubscribers??void 0,l=e.debugLabel?`[${e.debugLabel}]`:"",u=()=>{r!==void 0&&r.isEmpty&&(a||(a=!0,o=!1,s&&s()))},c=f=>{if(i)throw Error(`Disposed, cannot subscribe ${l}`);r===void 0&&(r=new Au);let d=r.add(f);return a=!1,o||(o=!0,n&&n()),()=>{r?.remove(d),u()}};return{dispose:f=>{i||(r?.notify({value:void 0,signal:"done",context:`Disposed: ${f}`}),i=!0,e.onDispose&&e.onDispose(f))},isDisposed:()=>i,removeAllSubscribers:()=>{r?.clear(),u()},set:f=>{if(i)throw Error(`${l} Disposed, cannot set`);r?.notify({value:f})},signal:(f,d)=>{if(i)throw Error(`${l} Disposed, cannot signal`);r?.notify({signal:f,value:void 0,context:d})},on:f=>c(f),onValue:f=>c(h=>{ke(h)&&f(h.value)})}}const Df=(e,r)=>{let i,o;if(typeof r=="string"&&(o={query:r}),typeof r=="object"&&(o="nodeName"in r?{el:r}:r),o===void 0)throw TypeError("Missing element as second parameter or option");if("el"in o)i=o.el;else if("query"in o)i=document.querySelector(o.query);else throw TypeError("Options does not include 'el' or 'query' fields");if(i==null)throw Error("Element could not be resolved.");let a=ce(e),n=Sn(o.asHtml?"innerHTML":"textContent",i);return a.onValue(l=>{n(l)})},$t=e=>({on:e.on,dispose:e.dispose,isDisposed:e.isDisposed,onValue:e.onValue});function Cf(e,r,i={}){let o=Te(e,{...i,onValue(a){let n=r(a);o.set({value:a,annotation:n})}});return $t(o)}function $f(e,r){let i=ce(e),o=r(i);return os({value:i,annotation:o})}function Af(e,r={}){let i=new ct,o=r.quantity??0,a=r.returnRemainder??!0,n={...r,onStop(){if(a&&!i.isEmpty){let c=i.toArray();i.clear(),s.set(c)}},onValue(c){i.enqueue(c),o>0&&i.length>=o&&l(),u!==void 0&&u.runState==="idle"&&u.start()}},s=Te(e,n),l=()=>{if(i.isEmpty)return;u!==void 0&&u.start();let c=i.toArray();i.clear(),setTimeout(()=>{s.set(c)})},u=r.elapsed?Di(l,r.elapsed):void 0;return $t(s)}function Vt(e,r,i={}){let o=i.traceInput??!1,a=i.traceOutput??!1,n=Te(e,{lazy:"initial",...i,onValue(s){let l=r(s);o&&a?console.log(`Rx.Ops.transform input: ${JSON.stringify(s)} output: ${JSON.stringify(l)}`):o?console.log(`Rx.Ops.transform input: ${JSON.stringify(s)}`):a&&console.log(`Rx.Ops.transform output: ${JSON.stringify(l)}`),n.set(l)}});return $t(n)}const Dw=e=>Vt(e,r=>{let i=[];for(let o in r){let a=r[o];on(a)&&i.push([o,a])}return Object.fromEntries(i)});function Sf(e,r={}){let i=ze(),o=r.onSourceDone??"break",a=[],n=e.map(f=>ce(f)),s=()=>{},l=n.map(f=>s),u=n.map(f=>!1),c=()=>{for(let f of l)f()};for(let[f,d]of n.entries())a[f]=void 0,l[f]=d.on(h=>{if(dt(h)){if(u[f]=!0,l[f](),l[f]=s,o==="break"){c(),i.dispose("Source has completed and 'break' is set");return}u.includes(!1)||(c(),i.dispose("All sources completed"))}else ke(h)&&(a[f]=h.value,i.set([...a]))});return{dispose:i.dispose,isDisposed:i.isDisposed,on:i.on,onValue:i.onValue}}function sa(e,r={}){let i=r.eq??Vd,o=ze(),a=ze(),n=[],s=e,l=!1,u=y=>{let g=[...lo(s??{},y,{...r,includeMissingFromA:!0})];g.length!==0&&(s=y,o.set(y),a.set(g))},c=(y,g)=>{for(let[m,v,D]of n)m(y)&&D.notify({fieldName:y,pattern:v,value:g})},f={asPartial:!0,includeParents:!0},d=y=>{if(s===void 0){s=y,o.set(s);for(let[g,m]of Object.entries(y))c(g,m);return s}else{let g=[...lo(s,y,f)];if(g.length===0)return s;s={...s,...y},o.set(s),a.set(g);for(let m of g)c(m.path,m.value);return s}};return{dispose:y=>{l||(a.dispose(y),o.dispose(y),l=!0)},isDisposed(){return l},updateField:(y,g)=>{if(s===void 0)throw Error("Cannot update value when it has not already been set");let m=Py(s,y);if(Ft(m))throw Hr(m);if(i(m.value,g,y))return;let v=[...lo(m.value,g,{...r,includeMissingFromA:!0})];v=v.map(B=>B.path.length>0?{...B,path:y+"."+B.path}:{...B,path:y});let D=Ou(s,y,g,!0);s=D,o.set(D),a.set(v),c(y,g)},last:()=>s,on:o.on,onValue:o.onValue,onDiff:a.onValue,onField(y,g){let m=uE(y),v=new Au;n.push([m,y,v]);let D=v.add(g);return()=>v.remove(D)},set:u,update:d}}function ts(e,r={}){let i=r.disposeSources??!0,o=sa(void 0),a=r.onSourceDone??"break",n=r.emitInitial??!0,s=!1,l=new Map;for(let[y,g]of Object.entries(e)){let m="last"in g?g.last():void 0,v={source:ce(g),done:!1,data:m,off:()=>{}};l.set(y,v)}let u=Object.fromEntries(Object.entries(l).map(y=>[y[0],y[1].source])),c=()=>co(l,y=>!y.done),f=()=>{for(let y of l.values())y.off()},d=()=>{let y={};for(let[g,m]of l)m.data!==void 0&&(y[g]=m.data);return y},h=()=>{s=!0;let y=d();o.set(y)},p=y=>{y.off=y.source.on(g=>{if(dt(g)){if(y.done=!0,y.off(),y.off=()=>{},a==="break"){f(),o.dispose("Source has completed and 'break' is behaviour");return}c()||(f(),o.dispose("All sources completed"))}else ke(g)&&(y.data=g.value,h())})};for(let y of l.values())p(y);return!s&&n&&h(),{...o,hasSource(y){return l.has(y)},replaceSource(y,g){let m=l.get(y);if(m===void 0)throw Error(`Field does not exist: '${y}'`);m.off();let v=ce(g);m.source=v,p(m)},setWith(y){let g={};for(let[m,v]of Object.entries(y)){let D=l.get(m);D!==void 0&&(bf(D.source)&&(D.source.set(v),g[m]=v),D.data=v)}return g},sources:u,last(){return d()},dispose(y){if(f(),o.dispose(y),i)for(let g of l.values())g.source.dispose("Part of disposed mergeToObject")}}}function Cw(e,r){let i,o;Ar(e)&&(o=i=e.last());let a=()=>{if(i===void 0&&o!==void 0)i=o,n.set(i);else if(i!==void 0&&o!==void 0){let s=r(i,o);i=s,n.set(s)}},n=Te(e,{lazy:"very",debugLabel:"computeWithPrevious",onValue(s){o=s,a()}});return o&&a(),{...$t(n),ping:()=>{o!==void 0&&a()}}}function $w(e,r={}){let i=j(r.elapsed,50),o,a=Di(()=>{let s=o;s&&(n.set(s),o=void 0)},i),n=Te(e,{...r,onValue(s){o=s,a.start()}});return $t(n)}function Ff(e){return r=>$w(r,e)}const Aw=e=>{let r=0;return Vt(e,i=>{let o=r===0?0:Date.now()-r;return r=Date.now(),o})};function rs(e,r,i={}){let o=i.fallbackFieldValue,a=i.fallbackObject,n=Te(e,{disposeIfSourceDone:!0,...i,onValue(s){let l;r in s?l=s[r]:a&&r in a&&(l=a[r]),l===void 0&&(l=o),l!==void 0&&n.set(l)}});return $t(n)}function kf(e,r,i){if(typeof r!="function")throw TypeError("Param 'predicate' should be a function");let o=Te(e,{...i,onValue(a){r(a)&&o.set(a)}});return $t(o)}function Sw(e,r,i){if(typeof r!="function")throw TypeError("Param 'predicate' should be a function");let o=Te(e,{...i,onValue(a){r(a)||o.set(a)}});return $t(o)}function Fw(e,r={}){let i=r.amount??.1,o=r.snapAt??.99,a=De(i,r);return Cw(e,(n,s)=>{let l=a(n,s);return s>n&&l/s>=o?s:l})}function Nf(e,r){let i=cu();return Ii(i,"max",e,r)}function Pf(e,r){let i=fu();return Ii(i,"min",e,r)}function Mf(e,r){let i=hu();return Ii(i,"average",e,r)}function Bf(e,r){let i=du();return Ii(i,"sum",e,r)}function zf(e,r={}){let i=r.countArrayItems??!0,o=pu(i);return Ii(o,"tally",e,r)}function kw(e,r,i){let o=yu(r,i);return Ii(o,"rank",e,i)}function Ii(e,r,i,o={}){let a=o.annotate,n,s=o.skipUndefined??!0,l=o.skipIdentical??!0,u=Te(i,{...o,onValue(c){let f=e(c);if(!(f===void 0&&s)&&!(l&&f===n))if(n=f,a){let d={value:c};d[r]=f,u.set(d)}else u.set(f)}});return $t(u)}const Nw=(...e)=>{let r=ze(),i=[],o=a=>{for(let n of e)n.isDisposed||n.dispose(a);for(let n of i)n();r.dispose(a)};for(let a=0;a<e.length;a++)i.push(e[a].on(n=>{let s=a===e.length-1;ke(n)?s?r.set(n.value):e[a+1].set(n.value):dt(n)&&o("Upstream disposed")}));return{on:r.on,onValue:r.onValue,dispose(a){o(a)},isDisposed(){return r.isDisposed()}}};function Pw(e,r={}){let i=r.order??"default";if(!r.at&&!r.predicate)throw Error("Options must have 'predicate' or 'at' fields");let o=n=>n;i==="random"?o=vl:typeof i=="function"&&(o=n=>n.toSorted(i));let a=Te(e,{onValue(n){if(n=o(n),r.predicate)for(let s of n)r.predicate(s)&&a.set(s);else r.at&&a.set(n.at(r.at))}});return a}const Tf=(e,r={})=>{let i=r.quantity??2,o=[],a=ce(e);for(let n=0;n<i;n++)o.push(Te(a,{disposeIfSourceDone:!0,lazy:"initial"}));return o},Of=(e,r)=>{let i=ce(e),o={};for(let a of r)o[a]=Te(i,{lazy:"initial",disposeIfSourceDone:!0});return o},jf=(e,r,i={})=>{let o=i.match??"first",a=ce(e),n=!1,s={};for(let c of Object.keys(r))s[c]=ze();let l=()=>{if(!n){u(),n=!0;for(let c of Object.values(s))c.dispose("switcher source dispose")}},u=a.on(c=>{if(ke(c)){for(let[f,d]of Object.entries(r))if(d(c.value)&&(s[f].set(c.value),o==="first"))break}else dt(c)&&l()});return s};function is(e,r={}){let i=r.onSourceDone??"break",o=r.finalValue??"undefined",a=j(r.maximumWait,2e3),n,s=[],l=e.map(m=>({finalData:void 0,done:!1,source:ce(m),unsub:()=>{}})),u=()=>{for(let m of l)m.unsub(),m.unsub=()=>{}},c=()=>{for(let m=0;m<s.length;m++)if(!(i==="allow"&&l[m].done)&&s[m]===void 0)return!1;return!0},f=()=>l.some(m=>!m.done),d=()=>{for(let m=0;m<s.length;m++)o==="last"&&l[m].done||(s[m]=void 0)},h=()=>{p(`Sync timeout exceeded (${a.toString()})`)},p=m=>{n&&clearTimeout(n),u(),g.dispose(m)},y=()=>{n=setTimeout(h,a);for(let[m,v]of l.entries())s[m]=void 0,v.unsub=v.source.on(D=>{if(vi(D)){if(D.signal==="done"){if(v.finalData=s[m],v.unsub(),v.done=!0,v.unsub=()=>{},o==="undefined"&&(s[m]=void 0),i==="break"){p(`Source '${m.toString()}' done, and onSourceDone:'break' is set`);return}if(!f()){p("All sources done");return}}return}s[m]=D.value,c()&&(g.set([...s]),d(),n&&clearTimeout(n),n=setTimeout(h,a))})},g=ze({onFirstSubscribe(){u(),y()},onNoSubscribers(){n&&clearTimeout(n),u()}});return{dispose:g.dispose,isDisposed:g.isDisposed,on:g.on,onValue:g.onValue}}function os(e,r={}){let i=Object.keys(e),o=Object.values(e),a=is(o,r);return Vt(a,s=>Po(i,s))}function Rf(e,...r){let i=ce(e),o=Process.flow(...r);return i.onValue(a=>{o(a)}),i}function Vf(e,r){let i=ce(e);return i.onValue(o=>{r.set(o)}),i}const Lf=(e,...r)=>{for(let i of r)e=i(e);return e};function If(e,r={}){let i=j(r.elapsed,0),o=performance.now(),a,n=Te(e,{...r,onValue(l){a=l,s()}}),s=()=>{let l=performance.now();i>0&&l-o>i&&(o=l,a!==void 0&&n.set(a))};return $t(n)}function qf(e,r){let i,o=r.immediate??!0,a=r.repeat??!1,n=j(r.interval,1e3);if(!ww(r))throw Error("Param 'options' does not contain trigger 'value' or 'fn' fields");let s=()=>{let[u,c]=xw(r);if(c)l.dispose("Trigger completed");else{if(l.isDisposed())return;l.set(u),a&&(i=setTimeout(s,n))}},l=Te(e,{disposeIfSourceDone:!0,onValue(u){i&&clearTimeout(i),i=setTimeout(s,n),l.set(u)},onDispose(){i&&clearTimeout(i)}});return o&&!i&&(i=setTimeout(s,n)),l}function _f(e,r){let i,o=ce(e),a=r.abort,n=j(r,1e3),s=()=>{if(a?.aborted||o.isDisposed()){u();return}bw(o)&&o.ping(),i=setTimeout(s,n)},l=()=>{i&&clearTimeout(i)},u=o.on(c=>{ke(c)?(l(),i=setTimeout(s,n)):dt(c)&&(u(),l())});return i=setTimeout(s,n),o}function VP(e,r,i={}){let o=i.lazy??"initial",a=i.signal,n=ce(e),s=i.gate??(h=>!0),l,u;a&&a.addEventListener("abort",()=>{d(`Abort signal ${a.reason}`)},{once:!0});let c=ze({onFirstSubscribe(){o!=="never"&&l===void 0&&f()},onNoSubscribers(){o==="very"&&l!==void 0&&(l(),l=void 0)}}),f=()=>{l=n.on(h=>{dt(h)?d("Upstream closed"):vi(h)?c.signal(h.signal):ke(h)&&s(h.value)&&r.ping()}),u=r.on(h=>{dt(h)?d("Downstream closed"):vi(h)?c.signal(h.signal,h.context):ke(h)&&c.set(h.value)})},d=h=>{c.dispose(h),l&&l(),u&&u()};return o==="never"&&f(),c}function Mw(e,r){let i=r.initial,o=Te(e,{...r,onValue(n){i=n,o.set(n)}});return{...$t(o),last(){return i}}}const LP=(e,r={})=>{if(Array.isArray(e))return Bw(e,r)},Bw=(e,r={})=>{let i=r.lazy??"initial",o=r.signal,a=r.whenStopped??"continue",n=r.debugLifecycle??!1,s=[...e];if(i!=="very"&&a==="reset")throw Error(`whenStopped:'reset' has no effect with 'lazy:${i}'. Use lazy:'very' instead.`);let l=j(r.interval,5),u=0,c=s[0],f=nr({...r,lazy:i,onStart(){n&&console.log("Rx.readFromArray:onStart"),d.start()},onStop(){n&&console.log(`Rx.readFromArray:onStop. whenStopped: ${a} index: ${u}`),d.cancel(),a==="reset"&&(u=0)}}),d=or(()=>{if(o?.aborted)return f.dispose(`Signalled (${o.reason})`),!1;if(c=s[u],u++,f.set(c),u===s.length)return f.dispose("Source array complete"),!1},l);return i||d.start(),{dispose:f.dispose,isDisposed:f.isDisposed,isDone(){return u===s.length},last(){return c},on:f.on,onValue:f.onValue}};function zw(e=[],r={}){let i=r.eq??Rd,o=ze(),a=ze(),n=e,s=!1,l=g=>{io(n,g,i),n=g,o.set([...g])},u=(g,m)=>{n[g]=m,o.set([...n])},c=g=>{n=[...n,g],o.set([...n]);let m=["add",n.length-1,g];a.set([m])},f=g=>{let m=Td(n,g);if(m.length===n.length)return;let v=io(n,m,i);n=m,o.set([...n]),a.set(v.summary)},d=g=>{let m=n.filter(B=>!g(B)),v=n.length-m.length,D=io(n,m,i);return n=m,o.set([...n]),a.set(D.summary),v},h=(g,m)=>{let v=Md(n,g,m),D=io(n,v,i);n=v,o.set([...n]),a.set(D.summary)};return{dispose:g=>{s||(o.dispose(g),s=!0)},isDisposed(){return s},last:()=>n,on:o.on,onArray:a.on,onValue:o.onValue,setAt:u,push:c,deleteAt:f,deleteWhere:d,insertAt:h,set:l}}function IP(e){let r=e,i=ze(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}function qP(e={}){let r=e.lazy??"initial",i=j(e.interval,1e3),o=e.amount??1,a=e.offset??0,n=0,s=a,l=f=>{c.dispose(f)},u=or(()=>{if(e.signal?.aborted)return l(`Aborted (${e.signal.reason})`),!1;if(c.set(s),s+=1,n++,n>=o)return l("Limit reached"),!1},i),c=nr({onStart(){u.start()},onStop(){u.cancel()},onDispose(){u.cancel()},lazy:r});return c}function _P(e,r,i={}){let o=i.ignoreIdentical??!0,a=i.eq??Rd,n=ts(r),s=c=>{let f=u.last(),d=e(c);if(d!==void 0){if(o&&f!==void 0&&a(d,f))return d;u.set(d)}return d},l=Te(n,{...i,onValue(c){s(c)}}),u=Ef(l,e(n.last()));return u}function WP(e,r,i,o,a={}){let n={};return n[i]=o,rs(Ao(e,r,n,a),i,a)}function Ao(e,r,i,o={}){let a;if(typeof e=="string"){if(a=document.querySelector(e),a===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else a=e;if(a===null)throw Error("Param 'targetOrQuery' is null");let n=o.debugLifecycle??!1,s=o.debugFiring??!1;o.diff;let l=o.lazy??!1;i===void 0&&(i={});let u=sa(i,{deepEntries:!0}),c=!1,f=!1,d=y=>{s&&console.log(`Reactive.event '${r}' firing '${JSON.stringify(y)}`),u.set(y)},h=()=>{c&&(c=!1,a.removeEventListener(r,d),n&&console.log(`Rx.From.event remove '${r}'`))},p=()=>{c||(c=!0,a.addEventListener(r,d),n&&console.log(`Rx.From.event add '${r}'`))};return l||p(),{last:()=>(l&&p(),u.last()),dispose:y=>{f||(f=!0,h(),u.dispose(y))},isDisposed(){return f},on:y=>(l&&p(),u.on(y)),onValue:y=>(l&&p(),u.onValue(y))}}function Wf(e,r,i={}){let o;if(typeof e=="string"){if(o=document.querySelector(e),o===null)throw Error(`Target query did not resolve to an element. Query: '${e}'`)}else o=e;if(o===null)throw Error("Param 'targetOrQuery' is null");let a=i.debugLifecycle??!1,n=i.debugFiring??!1,s=i.fireInitial??!1,l=0,u=iE(),c=nr({lazy:i.lazy??"very",onStart(){o.addEventListener(r,f),a&&console.log(`Rx.From.eventTrigger add '${r}'`),s&&l===0&&((a||n)&&console.log("Rx.From.eventTrigger: firing initial"),f())},onStop(){o.removeEventListener(r,f),a&&console.log(`Rx.From.eventTrigger remove '${r}'`)}}),f=d=>{n&&console.log(`Rx.From.eventTrigger '${r}' triggered'`),c.set({sinceLast:u(),total:++l})};return c}function GP(...e){return Tw(e)}function Tw(e,r={}){let i=[],o=nr({...r,onStart(){for(let a of e)i.push(a.onValue(n=>{o.set(n)}))},onStop(){for(let a of i)a();i=[]}});return o}function UP(e){let r=e,i=ze(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}const Ow=Symbol("Rx"),jw=e=>{let r=sa(e);return{proxy:new Proxy(e,{set(o,a,n,s){let l=Array.isArray(o);if(l&&a==="length")return!0;if(typeof a=="string"&&r.updateField(a,n),l&&typeof a=="string"){let u=Number.parseInt(a);if(!Number.isNaN(u))return o[u]=n,!0}return o[a]=n,!0}}),rx:r}},JP=e=>{let r=zw(e);return{proxy:new Proxy(e,{set(o,a,n,s){if(a==="length")return!0;if(typeof a!="string")throw Error(`Expected numeric index, got type: ${typeof a} value: ${JSON.stringify(a)}`);let l=Number.parseInt(a);if(Number.isNaN(l))throw Error(`Expected numeric index, got: '${a}'`);return r.setAt(l,n),o[l]=n,!0}}),rx:r}},HP=e=>{let{proxy:r,rx:i}=jw(e),o=r;return o[Ow]=i,o};function Gf(e){let r=Rw(e);return{dispose:r.dispose,isDisposed:r.isDisposed,on:r.on,onValue:r.onValue}}function Rw(e){let r=()=>{},i=Jf({onFirstSubscribe(){r=e(i)},onNoSubscribers(){r&&r()}});return{...i,onValue:o=>i.on(a=>{ke(a)&&o(a.value)})}}function KP(e){let r=e,i=ze(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o}}var Vw={};C(Vw,{array:()=>Bw,arrayObject:()=>zw,arrayProxy:()=>JP,boolean:()=>IP,count:()=>qP,derived:()=>_P,event:()=>Ao,eventField:()=>WP,eventTrigger:()=>Wf,func:()=>Ew,iterator:()=>hl,merged:()=>GP,mergedWithOptions:()=>Tw,number:()=>UP,object:()=>sa,objectProxy:()=>jw,objectProxySymbol:()=>HP,observable:()=>Gf,observableWritable:()=>Rw,of:()=>LP,string:()=>KP});function QP(e){let r=Jf({onNoSubscribers(){e.removeEventListener("removed",i),e.removeEventListener("enqueue",o)},onFirstSubscribe(){e.addEventListener("removed",i),e.addEventListener("enqueue",o),r.set(e.toArray())}}),i=n=>{r.set(n.finalData)},o=n=>{r.set(n.finalData)};return{...r,set:n=>{e.enqueue(...n)}}}var Lw={};C(Lw,{asResponsive:()=>QP});function ZP(e){let r=Jp(),i=ze();return{dispose:i.dispose,isDisposed:i.isDisposed,graph:r,on:i.on,onValue:i.onValue}}async function Uf(e,r={}){let i=r.limit??9007199254740991,o=j(r.maximumWait,10*1e3),a=r.underThreshold??"partial",n=[],s=ce(e);return new Promise((u,c)=>{let f=()=>{if(clearTimeout(d),h(),n.length<i&&a==="throw"){c(Error(`Threshold not reached. Wanted: ${i} got: ${n.length}. Maximum wait: ${o}`));return}if(n.length<i&&a==="fill")for(let p=0;p<i;p++)n[p]===void 0&&(n[p]=r.fillValue);u(n)},d=setTimeout(()=>{f()},o),h=s.on(p=>{dt(p)?f():ke(p)&&(n.push(p.value),n.length===i&&f())})})}async function Iw(e,r={}){let i=r.limit??9007199254740991,o=r.maximumWait??5*1e3,a=await Uf(e,{limit:i,maximumWait:o,underThreshold:"partial"});if(r.limit&&a.length<r.limit)throw Error(`Threshold not reached. Wanted: ${r.limit}, got ${a.length}`);return a}async function*XP(e){let r=ce(e),i=l=>{},o=l=>{},a=()=>new Promise((l,u)=>{i=l,o=u}),n=a(),s=!0;for(r.on(l=>{ke(l)?(i(l.value),n=a()):dt(l)&&(s=!1,o("Source has completed"))});s;)yield await n}function ae(e){return{source:ce(e),enacts:{setHtmlText:r=>Df(e,r)},annotate:r=>{let i=Cf(e,r);return ae(i)},annotateWithOp:r=>{let i=$f(e,r);return ae(i)},chunk:r=>ae(Af(e,r)),debounce:(r={})=>ae($w(e,r)),field:(r,i={})=>{let o=rs(e,r,i);return ae(o)},filter:(r,i)=>ae(kf(e,r,i)),combineLatestToArray:(r,i={})=>{let o=[e,...r];return ae(Sf(o,i))},combineLatestToObject:(r,i)=>{let o=i.name??"source",a={...r};return a[o]=e,ae(ts(a,i))},min:(r={})=>ae(Pf(e,r)),max:(r={})=>ae(Nf(e,r)),average:(r={})=>ae(Mf(e,r)),sum:(r={})=>ae(Bf(e,r)),tally:(r={})=>ae(zf(e,r)),split:(r={})=>Tf(e,r).map(o=>ae(o)),splitLabelled:(...r)=>{let i=Of(e,r);return _s(i,a=>ae(a.value))},switcher:(r,i={})=>{let o=jf(e,r,i);return _s(o,n=>ae(n.value))},syncToArray:(r,i={})=>{let o=[e,...r].map(n=>ce(n)),a=is(o,i);return ae(a)},syncToObject:(r,i={})=>{let o=i.name??"source",a={...r};return a[o]=e,ae(os(a,i))},tapProcess:(...r)=>(Rf(e,...r),ae(e)),tapStream:r=>(Vf(e,r),ae(e)),tapOps:(r,...i)=>(Lf(r,...i),ae(r)),throttle:(r={})=>ae(If(e,r)),transform:(r,i={})=>ae(Vt(e,r,i)),timeoutValue:r=>ae(qf(e,r)),timeoutPing:r=>ae(_f(e,r)),toArray:r=>Uf(e,r),toArrayOrThrow:r=>Iw(e,r),onValue:r=>{ce(e).on(o=>{ke(o)&&r(o.value)})}}}var YP={};C(YP,{Collections:()=>Lw,From:()=>Vw,Ops:()=>iM,Sinks:()=>rM,annotate:()=>Cf,annotateWithOp:()=>$f,average:()=>Mf,cache:()=>Ef,chunk:()=>Af,cloneFromFields:()=>Dw,combineLatestToArray:()=>Sf,combineLatestToObject:()=>ts,computeWithPrevious:()=>Cw,debounce:()=>Ff,drop:()=>Sw,elapsed:()=>Aw,field:()=>rs,filter:()=>kf,hasLast:()=>Ar,initLazyStream:()=>nr,initLazyStreamWithInitial:()=>RP,initStream:()=>ze,initUpstream:()=>Te,interpolate:()=>Fw,isPingable:()=>bw,isReactive:()=>na,isTrigger:()=>ww,isTriggerFunction:()=>wf,isTriggerGenerator:()=>xf,isTriggerValue:()=>vf,isWrapped:()=>vw,isWritable:()=>bf,manual:()=>Jf,max:()=>Nf,messageHasValue:()=>ke,messageIsDoneSignal:()=>dt,messageIsSignal:()=>vi,min:()=>Pf,opify:()=>We,pipe:()=>Nw,prepare:()=>ZP,rank:()=>kw,resolveSource:()=>ce,resolveTriggerValue:()=>xw,run:()=>eM,setHtmlText:()=>Df,singleFromArray:()=>Pw,split:()=>Tf,splitLabelled:()=>Of,sum:()=>Bf,switcher:()=>jf,symbol:()=>Ow,syncToArray:()=>is,syncToObject:()=>os,takeNextValue:()=>oM,tally:()=>zf,tapOps:()=>Lf,tapProcess:()=>Rf,tapStream:()=>Vf,throttle:()=>If,timeoutPing:()=>_f,timeoutValue:()=>qf,to:()=>aM,toArray:()=>Uf,toArrayOrThrow:()=>Iw,toGenerator:()=>XP,transform:()=>Vt,valueToPing:()=>VP,withValue:()=>Mw,wrap:()=>ae,writable:()=>tM});function eM(e,...r){let i=ce(e);for(let o of r)i=o(i);return i}function tM(e,...r){let i=ce(e),o=i;for(let n of r)i=n(i);return{...i,set(n){if(bf(o))o.set(n);else throw Error("Original source is not writable")}}}function Jf(e={}){let r=ze(e);return{dispose:r.dispose,isDisposed:r.isDisposed,set(i){r.set(i)},on:r.on,onValue:r.onValue}}const rM={setHtmlText:e=>r=>{Df(r,e)}},iM={annotate:e=>We(Cf,e),annotateWithOp:e=>We($f,e),chunk:e=>r=>Af(r,e),cloneFromFields:()=>e=>Dw(e),combineLatestToArray:(e={})=>r=>Sf(r,e),combineLatestToObject:(e={})=>r=>ts(r,e),drop:e=>We(Sw,e),elapsed:()=>We(Aw),field:(e,r={})=>i=>rs(i,e,r),filter:e=>We(kf,e),interpolate:e=>We(Fw,e),min:e=>We(Pf,e),max:e=>We(Nf,e),sum:e=>We(Bf,e),average:e=>We(Mf,e),tally:e=>We(zf,e),rank:(e,r)=>We(kw,e,r),pipe:(...e)=>r=>{let i=ce(r),o=[i,...e];return Nw(...o)},singleFromArray:(e={})=>r=>Pw(r,e),split:(e={})=>r=>Tf(r,e),splitLabelled:e=>r=>Of(r,e),switcher:(e,r={})=>i=>jf(i,e,r),syncToArray:(e={})=>r=>is(r,e),syncToObject:(e={})=>r=>os(r,e),tapProcess:e=>r=>Rf(r,e),tapStream:e=>r=>Vf(r,e),tapOps:(...e)=>r=>Lf(r,...e),throttle:e=>We(If,e),timeoutValue:e=>r=>qf(r,e),timeoutPing:e=>r=>_f(r,e),transform:(e,r={})=>i=>Vt(i,e,r),withValue:e=>We(Mw,e)};async function oM(e,r=1e3){let i=ce(e),o=()=>{},a;return new Promise((s,l)=>{o=i.on(u=>{a&&clearTimeout(a),ke(u)?(o(),s(u.value)):dt(u)&&(l(Error(`Source closed. ${u.context??""}`)),o())}),a=setTimeout(()=>{a=void 0,o(),l(Error(`Timeout waiting for value (${JSON.stringify(r)})`))},j(r))})}const aM=(e,r,i,o=!1)=>{let a=e.on(n=>{if(ke(n)){let s=i?i(n.value):n.value;r.set(s)}else dt(n)&&(a(),o&&r.dispose(`Source closed (${n.context??""})`))});return a},nM=(e,r)=>{if(e===null)throw Error("Param 'elem' is null. Expected element to observe");if(e===void 0)throw Error("Param 'elem' is undefined. Expected element to observe");let i=Gf(o=>{let a=new ResizeObserver(n=>{o.set(n)});return a.observe(e),()=>{a.unobserve(e)}});return Ff({elapsed:r??100})(i)},sM=e=>Ff({elapsed:e??100})(Ao(window,"resize",{innerWidth:0,innerHeight:0})),lM=(e=document.documentElement)=>Gf(i=>{let o=new MutationObserver(n=>{i.set(n)}),a={attributeFilter:["class"],attributes:!0};return o.observe(e,a),()=>{o.disconnect()}});function uM(e){let r=e,i=ze(),o=a=>{r=a,i.set(a)};return{dispose:i.dispose,isDisposed:i.isDisposed,last:()=>r,on:i.on,onValue:i.onValue,set:o,setHsl:a=>{o(a)}}}function cM(e,r={}){let i=Hf(e,r),o=i.el,a=r.relative??!1,n=r.inverted??!1,s=Vt(i,u=>Number.parseFloat(u));return a&&(o.max=n?"0":"1",o.min=n?"1":"0",o.hasAttribute("step")||(o.step="0.1")),o.getAttribute("type")===null&&(o.type="range"),{...s,last(){return Number.parseFloat(i.last())},set:u=>{i.set(u.toString())}}}function fM(e,r={}){let i=Hf(e,{...r,upstreamFilter:a=>typeof a=="object"?Me(a):a});return{...Vt(i,a=>Gr(a,{scalar:!0,ensureSafe:!0})),last(){return Gr(i.last(),{scalar:!0,ensureSafe:!0})},set(a){i.set(wo(a))}}}function Hf(e,r={}){let i=typeof e=="string"?document.querySelector(e):e;if(i===null&&typeof e=="string")throw Error(`Element query could not be resolved '${e}'`);if(i===null)throw Error("targetOrQuery is null");let o=U(e),a=r.when??"changed",n=a==="changed"?"change":"input",s=r.emitInitialValue??!1,l=r.fallbackValue??"",u=r.upstreamSource,c=()=>{},f=r.attributeName,d=r.fieldName;d===void 0&&f===void 0&&(f=d="value");let h=()=>{let v;return f&&(v=o.getAttribute(f)),d&&(v=o[d]),v??=l,v},p=v=>{f&&o.setAttribute(f,v),d&&(o[d]=v)},y=v=>{v=r.upstreamFilter?r.upstreamFilter(v):v,p(v)};u&&(c=u.onValue(y),Ar(u)&&y(u.last()));let g=Wf(o,n,{fireInitial:s,debugFiring:r.debugFiring??!1,debugLifecycle:r.debugLifecycle??!1}),m=Vt(g,v=>h());return{...m,el:o,last(){return h()},set(v){p(v)},dispose(v){c(),m.dispose(v),g.dispose(v)}}}function dM(e,r={}){let i=U(e),o=r.when??"changed",a=o==="changed"?"change":"input",n=r.emitInitialValue??!1,s=r.upstreamSource,l=new Map,u=()=>{},c=()=>{let g=new FormData(i),m=[];for(let[D,B]of g.entries()){let V=B.toString(),x=l.get(D);if(!x){let F=f(D,V);F&&(x=F.type==="range"||F.type==="number"?"number":F.type==="color"?"colour":F.type==="checkbox"&&(B==="true"||B==="on")?"boolean":"string",l.set(D,x))}if(x==="number")m.push([D,Number.parseFloat(V)]);else if(x==="boolean"){let F=V==="true";m.push([D,F])}else if(x==="colour"){let F=Me(V);m.push([D,Vi(F,{scalar:!1})])}else m.push([D,B.toString()])}for(let D of i.querySelectorAll('input[type="checkbox"]'))!D.checked&&D.value==="true"&&m.push([D.name,!1]);return Object.fromEntries(m)},f=(g,m)=>{let v=i.querySelector(`[name="${g}"]`);if(!v){console.warn(`Form does not contain an element with name="${g}"`);return}if(v.type==="radio"){let D=i.querySelector(`[name="${g}"][value="${m}"]`);if(!D){console.warn(`Form does not contain radio option for name=${g} value=${m}`);return}return D}return v},d=(g,m)=>{let v=f(g,m);if(v&&(v.nodeName==="INPUT"||v.nodeName==="SELECT")){if(v.type==="color")typeof m=="object"&&(m=Me(m));else if(v.type==="checkbox")if(typeof m=="boolean"){v.checked=m;return}else console.warn(`Rx.Sources.domForm: Trying to set non boolean type to a checkbox. Name: ${g} Value: ${m} (${typeof m})`);else if(v.type==="radio"){v.checked=!0;return}v.value=m}},h=g=>{for(let[m,v]of Object.entries(g)){let D=l.get(m);D||(D=typeof v,D==="object"&&(oa(v),D="colour"),l.set(m,D));let B=r.upstreamFilter?r.upstreamFilter(m,v):v;d(m,B)}};s&&(u=s.onValue(h),Ar(s)&&h(s.last()));let p=Wf(i,a,{fireInitial:n,debugFiring:r.debugFiring??!1,debugLifecycle:r.debugLifecycle??!1}),y=Vt(p,g=>c());return{...y,el:i,last(){return c()},set:h,setNamedValue:d,dispose(g){u(),y.dispose(g),p.dispose(g)}}}function hM(e){let r=[...document.querySelectorAll(e)];return sa(r)}const pM=(e,r,i={})=>as(e,r,{...i,elField:"textContent"}),yM=(e,r,i={})=>as(e,r,{...i,elField:"value",attribName:"value"}),gM=(e,r,i={})=>as(e,r,{...i,elField:"innerHTML"}),as=(e,r,...i)=>{if(r===null)throw Error("Param 'elOrQuery' is null");if(r===void 0)throw Error("Param 'elOrQuery' is undefined");let o=U(r),a=[];i.length===0?a.push({elField:"textContent"}):a=[...i];let n=a.map(s=>"element"in s?s:{...s,element:o});return Ww(e,...n)},mM=(e,r)=>{let i=qw(e);return o=>{i(o,r)}},qw=e=>{if(e.elField!==void 0||e.cssVariable===void 0&&e.attribName===void 0&&e.cssProperty===void 0&&e.textContent===void 0&&e.htmlContent===void 0){let r=e.elField??"textContent";return(i,o)=>{o[r]=i}}if(e.attribName!==void 0){let r=e.attribName;return(i,o)=>{o.setAttribute(r,i)}}if(e.textContent)return(r,i)=>{i.textContent=r};if(e.htmlContent)return(r,i)=>{i.innerHTML=r};if(e.cssVariable!==void 0){let r=e.cssVariable;return r.startsWith("--")||(r="--"+r),(i,o)=>{o.style.setProperty(r,i)}}return e.cssProperty===void 0?(r,i)=>{}:(r,i)=>{i.style[e.cssProperty]=r}},_w=e=>{if(!(!e.transform&&!e.transformValue)){if(e.transformValue){if(e.sourceField===void 0)throw Error("Expects 'sourceField' to be set when 'transformValue' is set");return r=>{let i=r[e.sourceField];return e.transformValue(i)}}else if(e.transform){if(e.sourceField!==void 0)throw Error("If 'transform' is set, 'sourceField' is ignored");return r=>e.transform(r)}}},Ww=(e,...r)=>{let i=r.map(s=>{if(s.element&&s.element!==void 0)return s;if(s.query)return{...s,element:U(s.query)};throw Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${JSON.stringify(s)}`)}),o=i.map(s=>({update:mM(s,s.element),transformer:_w(s),sourceField:s.sourceField})),a=s=>{for(let l of o)if(l.transformer)l.update(l.transformer(s));else{let u=l.sourceField?s[l.sourceField]:s;typeof u=="object"?(l.sourceField,l.update(JSON.stringify(u))):l.update(u)}},n=e.on(s=>{ke(s)?a(s.value):vi(s)&&console.warn(s)});return Ar(e)&&a(e.last()),{remove:s=>{if(n(),s)for(let l of i)l.element.remove()}}},bM=(e,r,i)=>{let o=U(r),a=s=>{i(s,o)},n=e.on(s=>{ke(s)?(console.log(s),a(s.value)):console.warn(s)});return Ar(e)&&a(e.last()),{remove:s=>{n(),s&&o.remove()}}},vM=(e,r,i,o={})=>{if(r===null)throw Error("Param 'elOrQuery' is null");if(r===void 0)throw Error("Param 'elOrQuery' is undefined");let a=U(r),n=u=>{i(u,a)},s=e.onDiff(u=>{n(u)}),l=()=>{Ar(e)&&o.initial&&o.initial(e.last(),a)};return l(),{refresh:()=>{l()},remove:u=>{s(),u&&a.remove()}}},wM=(e,r)=>{let i=r.container?U(r.container):document.body,o=r.defaultTag??"div",a=new Map,n=new Map;for(let[d,h]of Object.entries(r.binds??{})){let p=h.tagName??o;n.set(d,{...h,update:qw(h),transform:_w(h),tagName:p,path:d})}let s=d=>{let h=xl(n,aE(d));if(h!==void 0)return h;if(!d.includes("."))return n.get("_root")};function*l(d){for(let h of nE(d))n.has(h)&&(yield n.get(h));n.has("_root")&&d.includes(".")&&(yield n.get("_root"))}let u=(d,h)=>{let p=Cs(d);console.log(`Rx.Dom.elements.create: ${d} rooted: ${p} value: ${JSON.stringify(h)}`);let y=s(Cs(d)),g=o;y?.tagName&&(g=y.tagName);let m=document.createElement(g);m.setAttribute("data-path",d),c(d,m,h);let v;for(let D of l(p))if(D?.nestChildren){let B=th(d,"."),V=D.path.replace("_root",B);if(v=a.get(V),v!==void 0)break}(v??i).append(m),a.set(d,m),console.log(`Added el: ${d}`)},c=(d,h,p)=>{console.log(`Rx.dom.update path: ${d} value:`,p);let y=s(Cs(d));y===void 0?(typeof p=="object"&&(p=JSON.stringify(p)),h.textContent=p):(y.transform&&(p=y.transform(p)),y.update(p,h))},f=d=>{let h=new ct({},d),p=h.dequeue(),y=new Set;for(;p!==void 0;){let g=p.path;if(!("previous"in p)||p.previous===void 0){console.log(`Rx.Dom.elements.changes no previous. path: ${g}`),u(g,p.value);let m=[...Us(p.value,!1,2**53-1,g)];console.log(m);for(let v of m)y.has(v.path)||(h.enqueue(v),y.add(v.path))}else if(p.value===void 0){let m=a.get(g);m===void 0?console.warn(`No element to delete? ${g} `):(console.log(`Rx.Dom.elements.changes delete ${g}`),m.remove())}else{let m=a.get(g);m===void 0?(console.warn(`Rx.Dom.elements.changes No element to update ? ${g} `),u(g,p.value)):c(g,m,p.value)}p=h.dequeue()}};if(e.onDiff(d=>{f(d)}),Ar(e)){let d=e.last();f([...Us(d,!1,1)])}},Cs=e=>{let r=nn(e,".");return r===e?"_root":"_root."+r};function xM(){let e=()=>({width:window.innerWidth,height:window.innerHeight}),r=Ao(window,"resize",{lazy:"very",transform:()=>e()}),i=Ao(window,"pointermove",{lazy:"very",transform:a=>{if(a===void 0)return{x:0,y:0};let n=a;return{x:n.x,y:n.y}}});return{dispose:(a="Reactive.win.dispose")=>{r.dispose(a),i.dispose(a)},size:r,pointer:i}}var Gw={};C(Gw,{bind:()=>Ww,bindDiffUpdate:()=>vM,bindElement:()=>as,bindHtml:()=>gM,bindText:()=>pM,bindUpdate:()=>bM,bindValueText:()=>yM,browserResizeObservable:()=>nM,colour:()=>uM,cssClassChange:()=>lM,domForm:()=>dM,domHslInputValue:()=>fM,domInputValue:()=>Hf,domNumberInputValue:()=>cM,elements:()=>wM,fromDomQuery:()=>hM,win:()=>xM,windowResize:()=>sM});var EM={};C(EM,{RxUi:()=>Gw});const DM=e=>{let r,i=e[0],o=e[1],a=e[2],n=0;if(i>=144&&i<=159?(n=i-143,r=a===0?"noteoff":"noteon"):i>=128&&i<=143?(n=i-127,r="noteoff"):i>=160&&i<=175?(n=i-159,r="poly-at"):i>=176&&i<=191?(n=i-175,r="cc"):i>=192&&i<=207?(n=i-191,r="progchange"):i>=208&&i<=223?(n=i-207,r="at"):i>=224&&i<=239&&(n=i-223,r="pitchbend"),r===void 0)console.error(`Unknown command: '${r}'`),console.log(e);else return{command:r,note:o,velocity:a,channel:n}},CM=e=>{const r=new Uint8Array(3);switch(r[1]=e.note,r[2]=e.velocity,e.command){case"cc":r[0]=e.channel+175;break;case"noteon":r[0]=e.channel+143;break;case"noteoff":r[0]=e.channel+127;break;case"pitchbend":r[0]=e.channel+223;break;case"poly-at":r[0]=e.channel+159;break;case"progchange":r[0]=e.channel+191;break;case"at":r[0]=e.channel+207;break;default:throw new Error(`Command not supported '${e.command}'`)}return r},pe=Object.freeze({inputLastEl:document.getElementById("inputLast"),inputLog:Ee.log("#inputLog",{timestamp:!0}),outputLog:Ee.log("#outputLog",{timestamp:!0}),mainLog:Ee.log("#mainLog",{timestamp:!0}),chkEvFilterCc:Ee.Forms.checkbox("#evFilterCc"),chkEvFilterPb:Ee.Forms.checkbox("#evFilterPb"),chkEvFilterNotes:Ee.Forms.checkbox("#evFilterNotes"),chkOutFollow:Ee.Forms.checkbox("#outFollow"),outChannel:Ee.Forms.numeric("#outChannel"),outVelocity:Ee.Forms.numeric("#outVelocity"),outCc:Ee.Forms.numeric("#outCc"),outNote:Ee.Forms.numeric("#outNote"),outNoteDuration:Ee.Forms.numeric("#outNoteDuration")});let Ct={inputDeviceSelEl:void 0,outputDeviceSelEl:void 0,inputDevices:[],outputDevices:[],connectedInputs:[],connectedOutputs:[],omniInput:!0,omniOutput:!0};function $s(e){const{outputLog:r}=pe;r.log(e);for(const i of Ct.connectedOutputs)try{i.send(CM(e))}catch(o){r.error(o)}}function $M(e){const{port:r}=e;if(r===null)return;Ct.connectedInputs.find(o=>o.id===r.id)&&pe.mainLog.log(`${r.name} state: ${r.state} connection: ${r.connection}`)}const AM=()=>{const{inputDeviceSelEl:e,outputDeviceSelEl:r}=Ct;if(!navigator.requestMIDIAccess)throw new Error("MIDI not supported in this browser.");navigator.requestMIDIAccess().then(i=>{i.addEventListener("statechange",$M);const o=i.inputs;let a=[],n=[];for(const c of o.values())a.push(c.name??"?"),n.push(c);e?.setOpts(a),Jr({inputDevices:n});const s=i.outputs;let l=[],u=[];for(const c of s.values())l.push(c.name??"?"),u.push(c);r?.setOpts(l),Jr({outputDevices:u}),pe.mainLog.log(`MIDI initialised, ${n.length} input(s) and ${u.length} output(s) found.`),pl("both")},i=>{console.log(i)})};function xd(e){const{inputLog:r,chkEvFilterCc:i,chkEvFilterNotes:o,chkEvFilterPb:a,inputLastEl:n,chkOutFollow:s}=pe,l=e.data;if(l===null)return;const u=DM(l);u&&(!o.checked&&(u.command==="noteoff"||u.command==="noteon")||!i.checked&&u.command==="cc"||!a.checked&&u.command==="pitchbend"||(s.checked&&(pe.outChannel.value=u.channel,u.command==="cc"?(pe.outVelocity.value=u.velocity,pe.outCc.value=u.note):u.command==="noteoff"?pe.outNote.value=u.note:u.command==="noteon"&&(pe.outVelocity.value=u.velocity,pe.outNote.value=u.note)),n.innerText=JSON.stringify(u),r.log(u)))}async function Ya(e){let{connectedInputs:r}=Ct;for(const i of r)console.log(`Closing input: ${i.name}`),await i.close(),i.removeEventListener("midimessage",xd);for(const i of e)console.log(`Connecting input: ${i.name}`),i.addEventListener("midimessage",xd),await i.open();Jr({connectedInputs:e,omniInput:!1})}async function en(e){let{connectedOutputs:r}=Ct;for(const i of r)console.log(`Closing output: ${i.name}`),await i.close();for(const i of e)console.log(`Connecting output: ${i.name}`),await i.open();Jr({connectedOutputs:e,omniOutput:!1})}function pl(e){(e==="both"||e==="input")&&(Ya([]),Ya(Ct.inputDevices),Jr({omniInput:!0})),(e==="both"||e==="output")&&(en([]),en(Ct.outputDevices),Jr({omniOutput:!0}))}const SM=()=>{const e=Ee.Forms.select("#inputDevice",i=>{if(i==="Omni"){pl("input");return}const o=Ct.inputDevices.find(a=>a.name===i);o?Ya([o]):(console.warn("Could not find selected MIDI input"),Ya([]))},{placeholderOpt:"Omni"}),r=Ee.Forms.select("#outputDevice",i=>{if(i==="Omni"){pl("output");return}const o=Ct.outputDevices.find(a=>a.name===i);o?en([o]):(console.warn("Could not find selected MIDI output"),en([]))},{placeholderOpt:"Omni"});Jr({inputDeviceSelEl:e,outputDeviceSelEl:r}),Ee.Forms.button("#btnInputLogClear",()=>{pe.inputLog.clear()}),Ee.Forms.button("#btnOutputLogClear",()=>{pe.outputLog.clear()}),Ee.Forms.button("#btnSendCc",()=>{const i={command:"cc",channel:pe.outChannel.value,velocity:pe.outVelocity.value,note:pe.outCc.value};$s(i)}),Ee.Forms.button("#btnSendNote",()=>{const i={command:"noteon",channel:pe.outChannel.value,velocity:pe.outVelocity.value,note:pe.outNote.value},o={command:"noteoff",channel:pe.outChannel.value,velocity:0,note:pe.outNote.value};$s(i),setTimeout(()=>{$s(o)},pe.outNoteDuration.value)})};SM();try{AM()}catch(e){pe.mainLog.error(e)}function Jr(e){Ct=Object.freeze({...Ct,...e})}
