import"../../modulepreload-polyfill-B5Qt9EMX.js";import{e as le}from"../../io-D4vlQEz_.js";import{l as Le,f as $e}from"../../dom-DCcQsJJW.js";import"../../src-BeVDUOoq-B6OoJ3p3.js";import"../../src-C7XtfIer-DYL4nwfS.js";import"../../src-sHR31-XU-C1xj0KeO.js";import"../../dist-DE4H3J9W-BscYlIcj.js";var qe={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function ie(o){return o.replace(RegExp("^"+(o.match(/^(\t| )+/)||"")[0],"gm"),"")}function F(o){return(o+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Q(o,r){var i,c,l,g,u,m=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,a=[],$="",O=r||{},B=0;function D(y){var w=qe[y[1]||""],q=a[a.length-1]==y;return w?w[1]?(q?a.pop():a.push(y),w[0|q]):w[0]:y}function I(){for(var y="";a.length;)y+=D(a[a.length-1]);return y}for(o=o.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(y,w,q){return O[w.toLowerCase()]=q,""}).replace(/^\n+|\n+$/g,"");l=m.exec(o);)c=o.substring(B,l.index),B=m.lastIndex,i=l[0],c.match(/[^\\](\\\\)*\\$/)||((u=l[3]||l[4])?i='<pre class="code '+(l[4]?"poetry":l[2].toLowerCase())+'"><code'+(l[2]?' class="language-'+l[2].toLowerCase()+'"':"")+">"+ie(F(u).replace(/^\n+|\n+$/g,""))+"</code></pre>":(u=l[6])?(u.match(/\./)&&(l[5]=l[5].replace(/^\d+/gm,"")),g=Q(ie(l[5].replace(/^\s*[>*+.-]/gm,""))),u==">"?u="blockquote":(u=u.match(/\./)?"ol":"ul",g=g.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),i="<"+u+">"+g+"</"+u+">"):l[8]?i='<img src="'+F(l[8])+'" alt="'+F(l[7])+'">':l[10]?($=$.replace("<a>",'<a href="'+F(l[11]||O[c.toLowerCase()])+'">'),i=I()+"</a>"):l[9]?i="<a>":l[12]||l[14]?i="<"+(u="h"+(l[14]?l[14].length:l[13]>"="?1:2))+">"+Q(l[12]||l[15],O)+"</"+u+">":l[16]?i="<code>"+F(l[16])+"</code>":(l[17]||l[1])&&(i=D(l[17]||"--"))),$+=c,$+=i;return($+o.substring(B)+I()).replace(/^\n+|\n+$/g,"")}const b=typeof window<"u"?window:null,V=b===null,P=V?void 0:b.document,z="addEventListener",v="removeEventListener",Z="getBoundingClientRect",H="_a",E="_b",k="_c",J="horizontal",x=()=>!1,Me=V?"calc":`${["","-webkit-","-moz-","-o-"].filter(o=>{const r=P.createElement("div");return r.style.cssText=`width:${o}calc(9px)`,!!r.style.length}).shift()}calc`,ge=o=>typeof o=="string"||o instanceof String,ae=o=>{if(ge(o)){const r=P.querySelector(o);if(!r)throw new Error(`Selector ${o} did not match a DOM element`);return r}return o},f=(o,r,i)=>{const c=o[r];return c!==void 0?c:i},K=(o,r,i,c)=>{if(r){if(c==="end")return 0;if(c==="center")return o/2}else if(i){if(c==="start")return 0;if(c==="center")return o/2}return o},Ae=(o,r)=>{const i=P.createElement("div");return i.className=`gutter gutter-${r}`,i},Be=(o,r,i)=>{const c={};return ge(r)?c[o]=r:c[o]=`${Me}(${r}% - ${i}px)`,c},Ie=(o,r)=>({[o]:`${r}px`}),me=(o,r={})=>{if(V)return{};let i=o,c,l,g,u,m,a;Array.from&&(i=Array.from(i));const O=ae(i[0]).parentNode,B=getComputedStyle?getComputedStyle(O):null,D=B?B.flexDirection:null;let I=f(r,"sizes")||i.map(()=>100/i.length);const y=f(r,"minSize",100),w=Array.isArray(y)?y:i.map(()=>y),q=f(r,"maxSize",1/0),he=Array.isArray(q)?q:i.map(()=>q),Se=f(r,"expandToMin",!1),W=f(r,"gutterSize",10),U=f(r,"gutterAlign","center"),T=f(r,"snapOffset",30),ye=Array.isArray(T)?T:i.map(()=>T),X=f(r,"dragInterval",1),j=f(r,"direction",J),Y=f(r,"cursor",j===J?"col-resize":"row-resize"),be=f(r,"gutter",Ae),te=f(r,"elementStyle",Be),ze=f(r,"gutterStyle",Ie);j===J?(c="width",l="clientX",g="left",u="right",m="clientWidth"):j==="vertical"&&(c="height",l="clientY",g="top",u="bottom",m="clientHeight");function N(n,e,t,s){const d=te(c,e,t,s);Object.keys(d).forEach(p=>{n.style[p]=d[p]})}function ve(n,e,t){const s=ze(c,e,t);Object.keys(s).forEach(d=>{n.style[d]=s[d]})}function _(){return a.map(n=>n.size)}function ne(n){return"touches"in n?n.touches[0][l]:n[l]}function oe(n){const e=a[this.a],t=a[this.b],s=e.size+t.size;e.size=n/this.size*s,t.size=s-n/this.size*s,N(e.element,e.size,this[E],e.i),N(t.element,t.size,this[k],t.i)}function Ee(n){let e;const t=a[this.a],s=a[this.b];this.dragging&&(e=ne(n)-this.start+(this[E]-this.dragOffset),X>1&&(e=Math.round(e/X)*X),e<=t.minSize+t.snapOffset+this[E]?e=t.minSize+this[E]:e>=this.size-(s.minSize+s.snapOffset+this[k])&&(e=this.size-(s.minSize+this[k])),e>=t.maxSize-t.snapOffset+this[E]?e=t.maxSize+this[E]:e<=this.size-(s.maxSize-s.snapOffset+this[k])&&(e=this.size-(s.maxSize+this[k])),oe.call(this,e),f(r,"onDrag",x)(_()))}function re(){const n=a[this.a].element,e=a[this.b].element,t=n[Z](),s=e[Z]();this.size=t[c]+s[c]+this[E]+this[k],this.start=t[g],this.end=t[u]}function xe(n){if(!getComputedStyle)return null;const e=getComputedStyle(n);if(!e)return null;let t=n[m];return t===0?null:(j===J?t-=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight):t-=parseFloat(e.paddingTop)+parseFloat(e.paddingBottom),t)}function se(n){const e=xe(O);if(e===null||w.reduce((p,h)=>p+h,0)>e)return n;let t=0;const s=[],d=n.map((p,h)=>{const A=e*p/100,G=K(W,h===0,h===n.length-1,U),R=w[h]+G;return A<R?(t+=R-A,s.push(0),R):(s.push(A-R),A)});return t===0?n:d.map((p,h)=>{let A=p;if(t>0&&s[h]-t>0){const G=Math.min(t,s[h]-t);t-=G,A=p-G}return A/e*100})}function we(){const n=this,e=a[n.a].element,t=a[n.b].element;n.dragging&&f(r,"onDragEnd",x)(_()),n.dragging=!1,b[v]("mouseup",n.stop),b[v]("touchend",n.stop),b[v]("touchcancel",n.stop),b[v]("mousemove",n.move),b[v]("touchmove",n.move),n.stop=null,n.move=null,e[v]("selectstart",x),e[v]("dragstart",x),t[v]("selectstart",x),t[v]("dragstart",x),e.style.userSelect="",e.style.webkitUserSelect="",e.style.MozUserSelect="",e.style.pointerEvents="",t.style.userSelect="",t.style.webkitUserSelect="",t.style.MozUserSelect="",t.style.pointerEvents="",n.gutter.style.cursor="",n.parent.style.cursor="",P.body.style.cursor=""}function Ce(n){if("button"in n&&n.button!==0)return;const e=this,t=a[e.a].element,s=a[e.b].element;e.dragging||f(r,"onDragStart",x)(_()),n.preventDefault(),e.dragging=!0,e.move=Ee.bind(e),e.stop=we.bind(e),b[z]("mouseup",e.stop),b[z]("touchend",e.stop),b[z]("touchcancel",e.stop),b[z]("mousemove",e.move),b[z]("touchmove",e.move),t[z]("selectstart",x),t[z]("dragstart",x),s[z]("selectstart",x),s[z]("dragstart",x),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t.style.pointerEvents="none",s.style.userSelect="none",s.style.webkitUserSelect="none",s.style.MozUserSelect="none",s.style.pointerEvents="none",e.gutter.style.cursor=Y,e.parent.style.cursor=Y,P.body.style.cursor=Y,re.call(e),e.dragOffset=ne(n)-e.end}I=se(I);const M=[];a=i.map((n,e)=>{const t={element:ae(n),size:I[e],minSize:w[e],maxSize:he[e],snapOffset:ye[e],i:e};let s;if(e>0&&(s={a:e-1,b:e,dragging:!1,direction:j,parent:O},s[E]=K(W,e-1===0,!1,U),s[k]=K(W,!1,e===i.length-1,U),D==="row-reverse"||D==="column-reverse")){const d=s.a;s.a=s.b,s.b=d}if(e>0){const d=be(e,j,t.element);ve(d,W,e),s[H]=Ce.bind(s),d[z]("mousedown",s[H]),d[z]("touchstart",s[H]),O.insertBefore(d,t.element),s.gutter=d}return N(t.element,t.size,K(W,e===0,e===i.length-1,U),e),e>0&&M.push(s),t});function ce(n){const e=n.i===M.length,t=e?M[n.i-1]:M[n.i];re.call(t);const s=e?t.size-n.minSize-t[k]:n.minSize+t[E];oe.call(t,s)}a.forEach(n=>{const e=n.element[Z]()[c];e<n.minSize&&(Se?ce(n):n.minSize=e)});function Oe(n){const e=se(n);e.forEach((t,s)=>{if(s>0){const d=M[s-1],p=a[d.a],h=a[d.b];p.size=e[s-1],h.size=t,N(p.element,p.size,d[E],p.i),N(h.element,h.size,d[k],h.i)}})}function ke(n,e){M.forEach(t=>{if(e!==!0?t.parent.removeChild(t.gutter):(t.gutter[v]("mousedown",t[H]),t.gutter[v]("touchstart",t[H])),n!==!0){const s=te(c,t.a.size,t[E]);Object.keys(s).forEach(d=>{a[t.a].element.style[d]="",a[t.b].element.style[d]=""})}})}return{setSizes:Oe,getSizes:_,collapse(n){ce(a[n])},destroy:ke,parent:O,pairs:M}};me(["#editor","#data"],{sizes:[50,50],direction:"horizontal"});me(["#plot","#stream"],{sizes:[50,50],direction:"vertical"});let S=Object.freeze({board:"puck",jsonWarning:!1,clearedWelcome:!1,p:void 0,frozen:!1});const C=Object.freeze({puckIntro:`
Puck.accelOn(12.5);
Puck.on('accel', (a) => {
  Bluetooth.println(JSON.stringify(a));
});`,picoIntro:`
setInterval(() => {
  const data = { x: analogRead(A5) };
  USB.println(JSON.stringify(data));
}, 500);`,log:Le("#log",{capacity:50,timestamp:!0}),plot:document.querySelector("#plotCanvas"),txtCode:document.querySelector("#txtCode"),dlgHelp:document.querySelector("#dlgHelp"),selBoard:document.querySelector("#board")}),ee=o=>{const{plot:r}=C;o?(r.clear(),L({frozen:!1}),document.querySelector("#btnConnect")?.setAttribute("disabled","true"),document.querySelector("#btnSend")?.removeAttribute("disabled")):(document.querySelector("#btnSend")?.setAttribute("disabled","true"),document.querySelector("#btnConnect")?.removeAttribute("disabled"))},ue=o=>{const{log:r,plot:i}=C,c=o.data.trim();if(!c.startsWith("{")||!c.endsWith("}")){S.jsonWarning?L({jsonWarning:!0}):(console.warn(`Plotter expects JSON response. Got: ${c}`),L({jsonWarning:!0})),r.log(c);return}try{const l=JSON.parse(c);S.frozen||(r.log(c),i.plotObject(l),i.draw())}catch(l){console.warn(l)}},je=()=>{const{log:o}=C;o.log("eg: Bluetooth.println(JSON.stringify(v));"),o.log("eg: let v =  { light: Puck.light() };"),o.log("Once connected, tap 'Send' to upload code. Code should send back string-formatted JSON to be properly displayed in this playground."),o.log("Power on your Espruino, and tap 'Connect'.")},De=async()=>{const{log:o,selBoard:r}=C,i=r.value;(i==="pico"||i==="puck")&&(L({board:i}),localStorage.setItem("board",i));try{if(S.board==="puck"){const c=await le.connectBle();L({p:c})}else if(S.board==="pico"){const c=await le.serial();L({p:c})}S.clearedWelcome||(o.clear(),L({clearedWelcome:!0}))}catch(c){console.error(c)}},de=()=>{const{p:o}=S,{log:r,plot:i,txtCode:c}=C;if(o===void 0)return;const l=c.value.trim(),g=l+(S.board==="puck"?"NRF.on('disconnect',()=>reset());":"");try{i.clear(),o.writeScript(g),localStorage.setItem(`last-${S.board}`,l)}catch(u){r.error(u)}},We=()=>{const{log:o,plot:r,txtCode:i,dlgHelp:c,selBoard:l}=C,g=localStorage.getItem("board");(g==="pico"||g==="puck")&&(l.value=g,L({board:g})),$e.textAreaKeyboard(i),document.querySelector("#btnClear")?.addEventListener("click",()=>{o.clear(),r.clear()}),document.querySelector("#btnHelp")?.addEventListener("click",async u=>{const m=c.querySelector("section");if(m){c.showModal();try{let a=await fetch("README.md");if(a.ok){const $=await a.text();m.innerHTML=Q($)}else m.innerHTML="Could not load help :/",console.log(a)}catch(a){console.log(a),m.innerHTML="Could not load help :/"}}}),document.querySelector("#btnHelpClose")?.addEventListener("click",u=>{c.close()}),document.querySelector("#btnFreeze")?.addEventListener("click",()=>{L({frozen:!S.frozen})}),document.querySelector("#btnSend")?.addEventListener("click",de),document.querySelector("#txtCode")?.addEventListener("keyup",u=>{const m=u;m.key==="Enter"&&m.ctrlKey&&de()}),document.querySelector("#btnConnect")?.addEventListener("click",De),ee(!1),je(),l.addEventListener("change",u=>{pe()})};We();pe();function pe(){const{txtCode:o,selBoard:r}=C,i=r.value==="pico"?C.picoIntro:C.puckIntro,c=localStorage.getItem(`last-${S.board}`);o.value=c===null?i.trim():c}function L(o){const r=S.p;S=Object.freeze({...S,...o}),o.p&&(r&&(r.removeEventListener("change",fe),r.removeEventListener("data",ue)),o.p.addEventListener("change",fe),o.p.addEventListener("data",ue),o.p.isConnected&&ee(!0))}function fe(o){const{log:r}=C;r.log(`${o.priorState} -> ${o.newState}`),ee(o.newState==="connected")}
