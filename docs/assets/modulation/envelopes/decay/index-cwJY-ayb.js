import"../../../modulepreload-polyfill-B5Qt9EMX.js";import{c as O,g as x,_ as D,p as P,t as J}from"../../../src-BeVDUOoq-B6OoJ3p3.js";import{r as se}from"../../../records-Cei7yF1D-Dejnhz0L.js";import{c as F,ai as U,i as ie,k as B,aX as ae}from"../../../src-C7XtfIer-DYL4nwfS.js";import{i as W}from"../../../is-integer-BmMnD0ra-CbN5m7X_.js";import{e as ce}from"../../../modulation-BTLRubu4.js";const C=(e,r)=>{const t={};for(const n of Object.entries(e)){const o=r(n[0]);t[o]=n[1]}return t},L=(e,r)=>ae(Object.keys(e),Object.keys(r)),ue=(e,r)=>{const t=$(e,r,!0);if(Object.entries(t.added).length>0)throw new Error("Shape of data has changed");if(Object.entries(t.removed).length>0)throw new Error("Shape of data has changed");return z(t,r)},z=(e,r)=>{const t={};if(e.isArray)return r;for(const n of Object.entries(e.changed))t[n[0]]=n[1];for(const n of Object.entries(e.added))t[n[0]]=n[1];for(const n of Object.entries(e.children)){const o=n[1];o.hasChanged&&(t[n[0]]=z(o,r[n[0]]))}return t},fe=(e,r,t=U)=>{if(!Array.isArray(e))throw new Error("Param 'a' is not an array");if(!Array.isArray(r))throw new Error("Param 'b' is not an array");const n=$(e,r,!1,t);if(!n.isArray)throw new Error("Change set does not have arrays as parameters");const o=s=>{if(s.startsWith("_"))return Number.parseInt(s.slice(1));throw new Error(`Unexpected key '${s}'`)};return{...n,added:C(n.added,o),changed:C(n.changed,o),removed:n.removed.map(s=>o(s)),summary:n.summary.map(s=>[s[0],o(s[1]),s[2]])}},$=(e,r,t=!1,n=U)=>{e??={},r??={};const o=Object.entries(e),i=Object.entries(r),s=new Set,c={},f={},m={},v=[],y=Array.isArray(e),p=new Array;let u=!1;for(const a of o){const d=y?`_${a[0]}`:a[0],h=a[1],l=r[a[0]];if(s.add(a[0]),l===void 0){u=!0,t&&!y?(c[d]=l,p.push(["mutate",d,l])):(v.push(d),p.push(["del",d,h]));continue}if(typeof h=="object"){const w=$(h,l,t,n);w.hasChanged&&(u=!0),m[d]=w;const j=w.summary.map(b=>[b[0],d+"."+b[1],b[2]]);p.push(...j)}else n(h,l)||(c[d]=l,u=!0,p.push(["mutate",d,l]))}if(!t||y)for(const a of i){const d=y?`_${a[0]}`:a[0];s.has(a[0])||(f[d]=a[1],u=!0,p.push(["add",d,a[1]]))}return{changed:c,added:f,removed:v,children:m,hasChanged:u,isArray:y,summary:p}},le=e=>{const r=[];for(const t in e){const n=e[t];J(n)&&r.push([t,n])}return Object.fromEntries(r)},de=(e,r)=>{const n=Object.entries(e).map(([o,i],s)=>[o,r({value:i,field:o,index:s,path:o})]);return Object.fromEntries(n)};function X(e,r){const t=Object.entries(e);for(const n of t)if(n[0]in r){const o=r[n[0]];n[1]=typeof o=="object"?X(n[1],o):o(n[1],e)}return Object.fromEntries(t)}function A(e){return typeof e=="number"||typeof e=="string"||typeof e=="bigint"||typeof e=="boolean"}function ye(e){if(e.length===0)return"(empty)";let r="";for(const[t,n]of e.entries())r+="  ".repeat(t),r+=n.name+" = "+JSON.stringify(n.nodeValue)+`
`;return r}const H=(e,r=0,t={})=>{O(P(e,"node"));const n=t.name??"node",o=pe(e,n),i=`${"  ".repeat(r)} + name: ${o.name} value: ${JSON.stringify(o.nodeValue)}`,s=[...S(e,t)];return s.length>0?i+`
`+s.map(c=>H(c.nodeValue,r+1,{...t,name:c.name})).join(`
`):i};function*S(e,r={}){O(P(e,"node"));const t=r.filter??"none",n=o=>t==="none"?[!0,A(o)]:t==="leaves"&&A(o)?[!0,!0]:t==="branches"&&!A(o)?[!0,!1]:[!1,A(o)];if(Array.isArray(e))for(const[o,i]of e.entries()){const s=n(i);s[0]&&(yield{name:o.toString(),sourceValue:i,nodeValue:s[1]?i:void 0})}else if(typeof e=="object"){const o="entries"in e?e.entries():Object.entries(e);for(const[i,s]of o){const c=n(s);c[0]&&(yield{name:i,sourceValue:s,nodeValue:c[1]?s:void 0})}}}function*Q(e,r={},t=[]){for(const n of S(e,r))yield{...n,ancestors:[...t]},yield*Q(n.sourceValue,r,[...t,n.name])}function he(e,r){for(const t of S(r))if(t.name===e)return t}function me(e,r,t={}){const n=[...Y(e,r,t)];if(n.length===0)throw new Error(`Could not trace path: ${e} `);return n.at(-1)}function*Y(e,r,t={}){O(P(e,"path"),P(r,"node"));const n=t.separator??".",o=e.split(n),i=[];for(const s of o){const c=he(s,r);if(!c){yield{name:s,sourceValue:void 0,nodeValue:void 0,ancestors:i};return}r=c.sourceValue,yield{...c,ancestors:[...i]},i.push(s)}}function pe(e,r=""){return"name"in e&&"nodeValue"in e&&"sourceValue"in e?e:"name"in e?{name:e.name,nodeValue:e,sourceValue:e}:{name:r,nodeValue:e,sourceValue:e}}function ge(...e){return Object.assign({},...e)}const we=(e,r="throw")=>{const t={};for(const n of Object.entries(e)){const o=Number.parseInt(n[0]);if(Number.isNaN(o))switch(r){case"throw":throw new TypeError(`Cannot convert key '${n[0]}' to an integer`);case"ignore":continue;case"keep":{t[n[0]]=n[1];continue}default:throw new Error("Param 'onInvalidKey' should be: 'throw', 'ignore' or 'keep'.")}t[o]=n[1]}return t};var ve={};D(ve,{changedObjectDataFields:()=>ue,cloneFromFields:()=>le,compareArrays:()=>fe,compareObjectData:()=>$,compareObjectKeys:()=>L,getRecordEntryByPath:()=>me,keysToNumbers:()=>we,mapObjectByObject:()=>X,mapObjectKeys:()=>C,mapObjectShallow:()=>de,mergeObjects:()=>ge,prettyPrintEntries:()=>ye,recordChildren:()=>S,recordEntriesDepthFirst:()=>Q,recordEntryPrettyPrint:()=>H,traceRecordEntryByPath:()=>Y});const Z=(e,r=null,t=new WeakSet,n="")=>{if(e===null)return e;if(typeof e!="object")throw new TypeError(`Param 'value' must be an object. Got type: ${typeof e}`);t.add(e);const o=Object.entries(e);for(const i of o)if(i[1]!==null&&typeof i[1]=="object"){if(t.has(i[1])){i[1]=r;continue}i[1]=Z(i[1],r,t,`${i[0]}.`)}return Object.fromEntries(o)},be=e=>typeof e=="string"?e:JSON.stringify(e),R=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw new TypeError("Symbol cannot be converted to string");try{return JSON.stringify(e)}catch(r){if(typeof e=="object")return JSON.stringify(Z(e,"(circular)"));throw r}},Ee=(e,r)=>e===r?0:e>r?1:-1,Oe=(e,r)=>{if(e===void 0&&r===void 0)return 0;if(e===void 0)return 1;if(r===void 0)return-1;const t=R(e),n=R(r);return t<n?-1:t>n?1:0},ee=(e,r)=>typeof e=="number"&&typeof r=="number"?Ee(e,r):Oe(e,r),K=(e,r)=>e===r;var je={};D(je,{addObjectEntriesMutate:()=>T,addValue:()=>Ce,addValueMutate:()=>Be,addValueMutator:()=>te,deleteByValueCompareMutate:()=>$e,filterValues:()=>De,findBySomeKey:()=>Pe,findEntryByPredicate:()=>Se,findEntryByValue:()=>Ne,findValue:()=>Fe,fromIterable:()=>ke,fromObject:()=>xe,getClosestIntegerKey:()=>Ae,getOrGenerate:()=>ze,getOrGenerateSync:()=>Le,hasAnyValue:()=>Me,hasKeyValue:()=>Ve,mapToArray:()=>Ue,mapToObjectTransform:()=>qe,mergeByKey:()=>We,some:()=>Re,sortByValue:()=>Te,sortByValueProperty:()=>Ie,toArray:()=>Ke,toObject:()=>Je,transformMap:()=>Ge,zipKeyValue:()=>_e});const Ae=(e,r)=>{if(r=Math.round(r),e.has(r))return r;{let t=1;for(;t<1e3;){if(e.has(r-t))return r-t;if(e.has(r+t))return r+t;t++}throw new Error(`Could not find target ${r.toString()}`)}},Pe=(e,r)=>{for(const t of r)if(e.has(t))return e.get(t)},Ve=(e,r,t,n=K)=>e.has(r)?[...e.values()].some(i=>n(i,t)):!1,$e=(e,r,t=K)=>{for(const n of e.entries())t(n[1],r)&&e.delete(n[0])},Se=(e,r)=>{for(const t of e.entries())if(r(t[1],t[0]))return t},Ne=(e,r,t=K)=>{for(const n of e.entries())if(t(n[1],r))return n},Be=(e,r,t,...n)=>{const o=e??new Map;return te(o,r,t)(...n),o},Ce=(e,r,t,...n)=>{const o=e===void 0?new Map:new Map(e);for(const i of n){const s=r(i);if(t!=="overwrite"&&o.has(s)){if(t==="throw")throw new Error(`Key '${s}' already in map`);if(t==="skip")continue}o.set(s,i)}return o},te=(e,r,t="overwrite")=>(...n)=>{for(const o of n){const i=r(o);if(t!=="overwrite"&&e.has(i)){if(t==="throw")throw new Error(`Key '${i}' already in map`);if(t==="skip")continue}e.set(i,o)}return e},Te=(e,r)=>{const t=r??ee;return[...e.entries()].sort((n,o)=>t(n[1],o[1]))},Ie=(e,r,t)=>{const n=typeof t>"u"?ee:t;return[...e.entries()].sort((o,i)=>{const s=o[1],c=i[1];return n(s[r],c[r])})},Me=(e,r,t)=>[...e.entries()].some(o=>t(o[1],r));function*De(e,r){for(const t of e.values())r(t)&&(yield t)}const Ke=e=>[...e.values()],ke=(e,r=be,t="overwrite")=>{const n=new Map;for(const o of e){const i=r(o);if(n.has(i)){if(t==="throw")throw new Error(`Key '${i}' is already used and new data will overwrite it. `);if(t==="skip")continue}n.set(i,o)}return n},xe=e=>{const r=new Map;if(Array.isArray(e))for(const t of e)T(r,t);else T(r,e);return r},T=(e,r)=>{const t=Object.entries(r);for(const[n,o]of t)e.set(n,o)},Fe=(e,r)=>[...e.values()].find(t=>r(t)),Re=(e,r)=>[...e.values()].some(t=>r(t)),qe=(e,r)=>[...e].reduce((t,[n,o])=>{const i=r(o);return t[n]=i,t},{}),_e=(e,r)=>{if(e.length!==r.length)throw new Error("Keys and values arrays should be same length");return Object.fromEntries(e.map((t,n)=>[t,r[n]]))},Ge=(e,r)=>new Map(Array.from(e,t=>[t[0],r(t[1],t[0])])),Je=e=>[...e].reduce((r,[t,n])=>(r[t]=n,r),{}),Ue=(e,r)=>[...e.entries()].map(t=>r(t[0],t[1])),We=(e,...r)=>{const t=new Map;for(const n of r)for(const[o,i]of n){let s=t.get(o);s=s?e(s,i):i,t.set(o,s)}return t},Le=(e,r)=>(t,n)=>{let o=e.get(t);return o!==void 0||(o=r(t,n),e.set(t,o)),o},ze=(e,r)=>async(t,n)=>{let o=e.get(t);if(o!==void 0)return o;if(o=await r(t,n),o===void 0)throw new Error("fn returned undefined");return e.set(t,o),o};var Xe={};D(Xe,{applyChanges:()=>He,compareData:()=>re,getField:()=>Qe,getPaths:()=>Ye,getPathsAndData:()=>Ze,updateByPath:()=>ne});const q=(e,r)=>{if(e===void 0)throw new Error("Param 'target' is undefined");if(e===null)throw new Error("Param 'target' is null");if(typeof e!="object")throw new Error(`Param 'target' is not an object (got: ${typeof e})`);if(r){const t=[];for(const n in e){const o=e[n];J(o)&&t.push([n,o])}return t}else return Object.entries(e)};function*re(e,r,t={}){if(typeof e>"u"){yield{path:t.pathPrefix??"",value:r,state:"added"};return}if(typeof r>"u"){yield{path:t.pathPrefix??"",previous:e,value:void 0,state:"removed"};return}const n=t.asPartial??!1,o=t.skipInstances??new WeakSet,i=t.undefinedValueMeansRemoved??!1,s=t.pathPrefix??"",c=t.deepEntries??!1,f=t.eq??ie,m=t.includeMissingFromA??!1,v=t.includeParents??!1;if(B(e)&&B(r)){e!==r&&(yield{path:s,value:r,previous:e,state:"change"});return}if(B(r)){yield{path:s,value:r,previous:e,state:"change"};return}const y=q(e,c),p=new Set;for(const[u,a]of y){p.add(u);const d=u in r,h=r[u];if(typeof a=="object"&&a!==null){if(o.has(a))continue;if(o.add(a),d){if(h===void 0)throw new Error(`Pathed.compareData Value for key ${u} is undefined`);{const l=[...re(a,h,{...t,skipInstances:o,pathPrefix:s+u+"."})];if(l.length>0){for(const w of l)yield w;v&&(yield{path:s+u,value:r[u],previous:a,state:"change"})}}}else{if(n)continue;yield{path:s+u,value:void 0,previous:a,state:"removed"}}}else{const l=s+u;if(d)h===void 0&&i?yield{path:l,previous:a,value:void 0,state:"removed"}:f(a,h,l)||(yield{path:l,previous:a,value:h,state:"change"});else{if(n)continue;yield{path:l,previous:a,value:void 0,state:"removed"}}}}if(m){const u=q(r,c);for(const[a,d]of u)p.has(a)||(yield{path:s+a,previous:void 0,value:d,state:"added"})}}const He=(e,r)=>{for(const t of r)e=ne(e,t.path,t.value);return e},ne=(e,r,t,n=!1)=>{if(r===void 0)throw new Error("Parameter 'path' is undefined");if(typeof r!="string")throw new Error(`Parameter 'path' should be a string. Got: ${typeof r}`);if(e===void 0)throw new Error("Parameter 'target' is undefined");if(e===null)throw new Error("Parameter 'target' is null");const o=r.split(".");return I(e,o,t,n)},I=(e,r,t,n)=>{if(r.length===0){if(n)return t;if(Array.isArray(e)&&!Array.isArray(t))throw new Error(`Expected array value, got: '${JSON.stringify(t)}'. Set allowShapeChange=true to ignore.`);if(!Array.isArray(e)&&Array.isArray(t))throw new Error(`Unexpected array value, got: '${JSON.stringify(t)}'. Set allowShapeChange=true to ignore.`);if(typeof e!=typeof t)throw new Error(`Cannot reassign object type. (${typeof e} -> ${typeof t}). Set allowShapeChange=true to ignore.`);if(typeof e=="object"&&!Array.isArray(e)){const s=L(e,t);if(s.a.length>0)throw new Error(`New value is missing key(s): ${s.a.join(",")}`);if(s.b.length>0)throw new Error(`New value cannot add new key(s): ${s.b.join(",")}`)}return t}const o=r.shift();if(!o)return t;if(W(o)&&Array.isArray(e)){const s=Number.parseInt(o);if(s>=e.length&&!n)throw new Error(`Array index ${s.toString()} is outside of the existing length of ${e.length.toString()}. Use allowShapeChange=true to permit this.`);const c=[...e];return c[s]=I(c[s],r,t,n),c}else if(o in e){const s={...e};return s[o]=I(s[o],r,t,n),s}else throw new Error(`Path ${o} not found in data`)},Qe=(e,r,t=".")=>{if(typeof r!="string")throw new Error(`Param 'path' ought to be a string. Got: '${typeof r}'`);if(r.length===0)throw new Error("Param string 'path' is empty");if(e===void 0)throw new Error("Param 'object' is undefined");if(e===null)throw new Error("Param 'object' is null");const n=r.split(t);return M(e,n,r)},M=(e,r,t)=>{if(e===void 0)return{success:!1,error:`Param 'object' is undefined. Position: ${t}`};if(r.length===0)return{success:!1,error:`Path has been exhausted. position: ${t}`};const n=r.shift();if(!n)return{success:!1,error:`Unexpected empty split path. Position: ${t}`};if(W(n)&&Array.isArray(e)){const i=Number.parseInt(n);return typeof e[i]>"u"?{success:!1,error:`Index '${i}' does not exist. Length: ${e.length}. Position: ${t}`}:r.length===0?{value:e[i],success:!0}:M(e[i],r,r.join("."))}else return typeof e=="object"&&n in e?r.length===0?{value:e[n],success:!0}:M(e[n],r,r.join(".")):{success:!1,error:`Path '${n}' not found. Position: ${t}`}};function*Ye(e,r=!1){if(e==null)return;const t=se(e);for(const n of t){if(n.nodeValue===void 0&&r)continue;let o=n.name;n.ancestors.length>0&&(o=n.ancestors.join(".")+"."+o),yield o}}function*Ze(e,r=!1,t=Number.MAX_SAFE_INTEGER,n=""){e!==null&&e!==void 0&&(yield*oe(e,n,r,t))}function*oe(e,r,t=!1,n){if(!(n<=0)&&typeof e=="object")for(const o of Object.entries(e)){const i=(r.length>0?r+".":"")+o[0],s=o[1];(t&&typeof s!="object"||!t)&&(yield{path:i,value:s}),yield*oe(s,i,t,n-1)}}const et=(e,r=0,t={})=>{let n=F(r,0);O(x(n,"positive","interval"));const o=t.fireBeforeWait??!1,i=t.onStartCalled,s=t.signal;let c=!1,f="idle",m=0,v=0,y=performance.now(),p=r??0,u=!1,a;const d=()=>{a!==void 0&&(globalThis.clearTimeout(a),a=void 0,m=0,y=NaN)},h=g=>{n===0?typeof requestAnimationFrame>"u"?a=globalThis.setTimeout(g,0):(a=void 0,requestAnimationFrame(g)):a=globalThis.setTimeout(g,n)},l=()=>{u||(u=!0,f!=="idle"&&(f="idle",d()))},w=async()=>{if(s?.aborted&&(f="idle"),f==="idle")return;f="running",m++,v++;const g=e(m,performance.now()-y),E=typeof g=="object"?await g:g;if(!u){if(f="scheduled",E!==void 0&&!E){l();return}u||h(w)}},j=()=>{if(c)throw new Error("Disposed");if(u=!1,i!==void 0)switch(i(m,performance.now()-y)){case"cancel":{l();return}case"reset":{b();return}case"dispose":{c=!0,l();return}}f==="idle"&&(m=0,y=performance.now(),f="scheduled",o?w():h(w))},b=()=>{if(c)throw new Error("Disposed");u=!1,m=0,y=NaN,f!=="idle"&&l(),j()};return{start:j,reset:b,cancel:l,get interval(){return p},get runState(){return f},get startCountTotal(){return v},get startCount(){return m},set interval(g){const E=F(g,0);O(x(E,"positive","interval")),n=E,p=g},get isDisposed(){return c},get elapsedMs(){return performance.now()-y}}};(typeof window>"u"||!("requestAnimationFrame"in window))&&typeof window>"u"&&(globalThis.requestAnimationFrame=e=>{setTimeout(e,1)});const N={env:new ce.Adsr({attackDuration:2e3,releaseDuration:5e3,sustainLevel:1,retrigger:window.location.hash.includes("retrigger")}),run:et(tt)};console.log(`Retrigger: ${N.env.retrigger}`);let V={scaled:0,stage:"",raw:0,triggered:!1};function tt(){const{env:e}=N,[r,t,n]=e.compute();return k({scaled:t,stage:r,raw:n}),nt(),!Number.isNaN(t)}const rt=e=>Math.floor(e*100)+"%",nt=()=>{const{scaled:e,stage:r,raw:t,triggered:n}=V,o=Number.isNaN(e),i=f=>`hsl(60, ${f*100}%, 40%)`;console.log(`scaled: ${e.toPrecision(2)}	raw: ${t.toPrecision(2)}	stage: ${r}`);const s=document.querySelector("#without");if(s){s.style.backgroundColor=i(n?1:0);const f=document.querySelector("#trigState");f&&(f.textContent=n?"triggered":"")}const c=document.querySelector("#with");if(c){c.style.backgroundColor=i(o?0:e);const f=document.querySelector("#envStage");f&&(f.textContent=o?"":`${r} ${rt(t)}`)}},_=e=>{const{env:r,run:t}=N;e.preventDefault(),!V.triggered&&(r.trigger(!0),k({triggered:!0}),t.start())},G=e=>{const{env:r,run:t}=N;e.preventDefault(),k({triggered:!1}),r.release(),t.start()};function ot(){document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("pointerdown",_),document.addEventListener("keydown",_),document.addEventListener("pointerup",G),document.addEventListener("keyup",G)}ot();function k(e){V=Object.freeze({...V,...e})}
