import"../../modulepreload-polyfill-B5Qt9EMX.js";import{P as F,h as y,a as p,p as h,t as w}from"../../geometry-CqFA_olX.js";import{d as C,r as x}from"../../dom-CHyIdTDe.js";import{z as L,m as I,A as R}from"../../src-2eX6lIN8-VI_Nykma.js";import{v as A,s as m,p as c}from"../../util-DhqRJzH_.js";import"../../src-CURfSkGx-Bgs9tt00.js";import"../../dist-DE4H3J9W-C3hFOwYK.js";var P=class{seenCount;storeIntermediate;resetAfterSamples;sampleLimit;id;debug;constructor(t={}){this.id=t.id??"tracker",this.debug=t.debug??!1,this.sampleLimit=t.sampleLimit??-1,this.resetAfterSamples=t.resetAfterSamples??-1,this.storeIntermediate=t.storeIntermediate??(this.sampleLimit>-1||this.resetAfterSamples>-1),this.seenCount=0,this.debug&&console.log(`TrackerBase: sampleLimit: ${this.sampleLimit} resetAfter: ${this.resetAfterSamples} store: ${this.storeIntermediate}`)}reset(){this.seenCount=0,this.onReset()}seen(...t){this.resetAfterSamples>0&&this.seenCount>this.resetAfterSamples?this.reset():this.sampleLimit>0&&this.seenCount>this.sampleLimit*2&&(this.seenCount=this.trimStore(this.sampleLimit),this.onTrimmed("resize")),this.seenCount+=t.length;const e=this.filterData(t);return this.computeResults(e)}},M=class extends P{values;timestamps;constructor(t){super(t),this.values=[],this.timestamps=[]}trimStore(t){return t>=this.values.length?this.values.length:(this.values=this.values.slice(-t),this.timestamps=this.timestamps.slice(-t),this.values.length)}onTrimmed(t){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(t){const i={value:t.at(-1),at:performance.now()},s=t.map(n=>({at:performance.now(),value:n}));if(this.storeIntermediate)this.values.push(...t),this.timestamps.push(...s.map(n=>n.at));else switch(this.values.length){case 0:{this.values.push(i.value),this.timestamps.push(i.at);break}case 2:{this.values[1]=i.value,this.timestamps[1]=i.at;break}case 1:{this.values.push(i.value),this.timestamps.push(i.at);break}}return s}},_=class extends M{total=0;min=Number.MAX_SAFE_INTEGER;max=Number.MIN_SAFE_INTEGER;get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onTrimmed(t){this.min=L(this.values),this.max=I(this.values),this.total=R(this.values)}computeResults(t){if(t.some(s=>Number.isNaN(s)))throw new Error("Cannot add NaN");const e=t.map(s=>s.value);return this.total=e.reduce((s,n)=>s+n,this.total),this.min=Math.min(...e,this.min),this.max=Math.max(...e,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}};const d=(t={})=>new _(t),k=Object.freeze({currentPointsEl:document.querySelector("#current-points"),startPointsEl:document.querySelector("#start-points"),centroidEl:document.querySelector("#centroid"),startCentroidEl:document.querySelector("#startCentroid"),thingSize:100});let r={pointers:new y({storeIntermediate:!1}),twoFinger:{rotation:d(),distance:d()},threeFinger:{area:d()},centroid:new F,centroidAngle:0};const D=(t,e)=>{if(t===void 0)throw new Error("point a undefined");if(e===void 0)throw new Error("point b undefined");const{twoFinger:i}=r,s=h.distance(t,e);i.distance.seen(s);const n=p(h.angleRadian(t,e));i.rotation.seen(n/180)},z=(t,e,i)=>{if(t===void 0)throw new Error("point a undefined");if(e===void 0)throw new Error("point b undefined");if(i===void 0)throw new Error("point c undefined");const s=w.fromPoints([t,e,i]);r.threeFinger.area.seen(w.area(s))},q=t=>{if(t.size<2){r.centroid.reset();return}const e=h.centroid(...t.last());r.centroid.seen(e),$({centroidAngle:p(h.angleRadian(e,r.centroid.initial))})},T=()=>{const{pointers:t}=r;q(t);const e=[...t.trackedByAge()];e.length>=2?D(e[0].last,e[1].last):(r.twoFinger.distance.reset(),r.twoFinger.rotation.reset()),e.length>=3?z(e[0].last,e[1].last,e[2].last):r.threeFinger.area.reset();const i=new Map;for(const s of e){if(s===void 0)continue;const n=s.last;i.set(s.id,{id:s.id,length:Math.round(s.length),angle:Math.round(n?p(h.angleRadian(n,s.initial)):Number.NaN)})}C.fromList("#pointers",i),G()},G=()=>{const{centroidEl:t,startCentroidEl:e,thingSize:i,currentPointsEl:s,startPointsEl:n}=k,{pointers:f}=r,{centroid:l,twoFinger:v,threeFinger:N}=r;if(!s||(x(s,f.store,(u,a)=>(a===null&&(a=document.createElement("div"),a.textContent=u.id),o(a,u,i),a)),!n))return;x(n,f.store,(u,a)=>{a===null&&(a=document.createElement("div"),a.textContent=u.id);const E=u.initial;return E&&o(a,E,i),a});const g=document.querySelector("#centroidTravel");g&&(g.textContent=A(l.distanceFromStart())),l.initial===void 0?o(e,{x:-1e3,y:-1e3},i):o(e,l.initial,i),l.last===void 0?o(t,{x:-1e3,y:-1e3},i):o(t,l.last,i),m("threePtrArea",c(N.area.relativeDifference())),m("twoPtrDistance",c(v.distance.relativeDifference())),m("twoPtrRotation",c(v.rotation.difference())),m("centroidAngle",A(r.centroidAngle))},S=t=>{r.pointers.delete(t.pointerId.toString()),T()},b=t=>{if(t.pointerType==="mouse")return;t.preventDefault();const{pointers:e}=r;e.seen(t.pointerId.toString(),{x:t.x,y:t.y}),T()},o=(t,e,i)=>{t&&(t.style.left=e.x-i/2+"px",t.style.top=e.y-i/2+"px")},B=()=>{document.addEventListener("pointerup",t=>S(t)),document.addEventListener("pointerleave",t=>S(t)),document.addEventListener("pointerdown",t=>b(t)),document.addEventListener("pointermove",t=>b(t)),document.addEventListener("contextmenu",t=>t.preventDefault())};B();function $(t){r=Object.freeze({...r,...t})}
