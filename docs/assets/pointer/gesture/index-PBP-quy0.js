import"../../modulepreload-polyfill-B5Qt9EMX.js";import{v as y,s as f,p}from"../../util-DhqRJzH_.js";import{T as S,j as M,P,a as I,b as E,c as _,d as k,e as C}from"../../point-tracker-CIZps_3F.js";import{g as v}from"../../guard-RzpFIjKH.js";import{l as R}from"../../length-BrmuG0lR.js";import"../../resolve-el-BUhvOf7L.js";import"../../result-aflA1LW7.js";import"../../round-CDFh2_Rm.js";import"../../numbers-SvRH5ijj.js";import"../../guard-DRLb5kU_.js";import"../../subtract-BmiCoi7k.js";import"../../maps-CLnHBw0l.js";const D=t=>{let e=Number.MIN_SAFE_INTEGER;for(const r of t)e=Math.max(e,r);return e},q=t=>{let e=0;for(const r of t)e+=r;return e},G=t=>{let e=Number.MIN_SAFE_INTEGER;for(const r of t)e=Math.min(e,r);return e};class L extends S{values;timestamps;constructor(e){super(e),this.values=[],this.timestamps=[]}trimStore(e){return e>=this.values.length?this.values.length:(this.values=this.values.slice(-e),this.timestamps=this.timestamps.slice(-e),this.values.length)}onTrimmed(e){}get last(){return this.values.at(-1)}get initial(){return this.values.at(0)}get size(){return this.values.length}get elapsed(){if(this.values.length<0)throw new Error("No values seen yet");return Date.now()-this.timestamps[0]}onReset(){this.values=[],this.timestamps=[]}filterData(e){const n={value:e.at(-1),at:performance.now()},i=e.map(o=>({at:performance.now(),value:o}));if(this.storeIntermediate)this.values.push(...e),this.timestamps.push(...i.map(o=>o.at));else switch(this.values.length){case 0:{this.values.push(n.value),this.timestamps.push(n.at);break}case 2:{this.values[1]=n.value,this.timestamps[1]=n.at;break}case 1:{this.values.push(n.value),this.timestamps.push(n.at);break}}return i}}class $ extends L{total=0;min=Number.MAX_SAFE_INTEGER;max=Number.MIN_SAFE_INTEGER;get avg(){return this.total/this.seenCount}difference(){if(this.last!==void 0&&this.initial!==void 0)return this.last-this.initial}relativeDifference(){if(this.last!==void 0&&this.initial!==void 0)return this.last/this.initial}onReset(){this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER,this.total=0,super.onReset()}onTrimmed(e){this.min=G(this.values),this.max=D(this.values),this.total=q(this.values)}computeResults(e){if(e.some(i=>Number.isNaN(i)))throw new Error("Cannot add NaN");const r=e.map(i=>i.value);return this.total=r.reduce((i,o)=>i+o,this.total),this.min=Math.min(...r,this.min),this.max=Math.max(...r,this.max),{max:this.max,min:this.min,total:this.total,avg:this.avg}}getMinMaxAvg(){return{min:this.min,max:this.max,avg:this.avg}}}const g=(t={})=>new $(t);function w(t){return Array.isArray(t)?t.map(e=>e*180/Math.PI):t*180/Math.PI}const A=(t,e="t")=>{if(t===void 0)throw new Error("{$name} undefined");v(t.a,e+".a"),v(t.b,e+".b"),v(t.c,e+".c")},z=t=>(A(t),M(t.a,t.b,t.c,t.a)),j=t=>{A(t,"t");const e=z(t).map(n=>R(n)),r=(e[0]+e[1]+e[2])/2;return Math.sqrt(r*(r-e[0])*(r-e[1])*(r-e[2]))},B=t=>{if(!Array.isArray(t))throw new Error("points expected as array");if(t.length!==3)throw new Error(`points array expected with 3 elements. Got ${t.length}`);return{a:t[0],b:t[1],c:t[2]}},N=(t,e,r)=>{if(typeof t>"u")throw new Error("Param 'parentEl' is undefined");if(t===null)throw new Error("Param 'parentEl' is null");const n=new Set;for(const[o,c]of e){const u=`c-${o}`,m=t.querySelector(`#${u}`),l=r(c,m);m!==l&&(l.id=u,t.append(l)),n.add(u)}const i=[];for(const o of t.children)n.has(o.id)||i.push(o);for(const o of i)o.remove()},O=Object.freeze({currentPointsEl:document.querySelector("#current-points"),startPointsEl:document.querySelector("#start-points"),centroidEl:document.querySelector("#centroid"),startCentroidEl:document.querySelector("#startCentroid"),thingSize:100});let s={pointers:new I({storeIntermediate:!1}),twoFinger:{rotation:g(),distance:g()},threeFinger:{area:g()},centroid:new P,centroidAngle:0};const X=(t,e)=>{if(t===void 0)throw new Error("point a undefined");if(e===void 0)throw new Error("point b undefined");const{twoFinger:r}=s,n=C(t,e);r.distance.seen(n);const i=w(E(t,e));r.rotation.seen(i/180)},H=(t,e,r)=>{if(t===void 0)throw new Error("point a undefined");if(e===void 0)throw new Error("point b undefined");if(r===void 0)throw new Error("point c undefined");const n=B([t,e,r]);s.threeFinger.area.seen(j(n))},J=t=>{if(t.size<2){s.centroid.reset();return}const e=k(...t.last());s.centroid.seen(e),U({centroidAngle:w(E(e,s.centroid.initial))})},F=()=>{const{pointers:t}=s;J(t);const e=[...t.trackedByAge()];e.length>=2?X(e[0].last,e[1].last):(s.twoFinger.distance.reset(),s.twoFinger.rotation.reset()),e.length>=3?H(e[0].last,e[1].last,e[2].last):s.threeFinger.area.reset();const r=new Map;for(const n of e){if(n===void 0)continue;const i=n.last;r.set(n.id,{id:n.id,length:Math.round(n.length),angle:Math.round(i?w(E(i,n.initial)):Number.NaN)})}_("#pointers",r),K()},K=()=>{const{centroidEl:t,startCentroidEl:e,thingSize:r,currentPointsEl:n,startPointsEl:i}=O,{pointers:o}=s,{centroid:c,twoFinger:u,threeFinger:m}=s;if(!n||(N(n,o.store,(h,a)=>(a===null&&(a=document.createElement("div"),a.textContent=h.id),d(a,h,r),a)),!i))return;N(i,o.store,(h,a)=>{a===null&&(a=document.createElement("div"),a.textContent=h.id);const x=h.initial;return x&&d(a,x,r),a});const l=document.querySelector("#centroidTravel");l&&(l.textContent=y(c.distanceFromStart())),c.initial===void 0?d(e,{x:-1e3,y:-1e3},r):d(e,c.initial,r),c.last===void 0?d(t,{x:-1e3,y:-1e3},r):d(t,c.last,r),f("threePtrArea",p(m.area.relativeDifference())),f("twoPtrDistance",p(u.distance.relativeDifference())),f("twoPtrRotation",p(u.rotation.difference())),f("centroidAngle",y(s.centroidAngle))},b=t=>{s.pointers.delete(t.pointerId.toString()),F()},T=t=>{if(t.pointerType==="mouse")return;t.preventDefault();const{pointers:e}=s;e.seen(t.pointerId.toString(),{x:t.x,y:t.y}),F()},d=(t,e,r)=>{t&&(t.style.left=e.x-r/2+"px",t.style.top=e.y-r/2+"px")},Q=()=>{document.addEventListener("pointerup",t=>b(t)),document.addEventListener("pointerleave",t=>b(t)),document.addEventListener("pointerdown",t=>T(t)),document.addEventListener("pointermove",t=>T(t)),document.addEventListener("contextmenu",t=>t.preventDefault())};Q();function U(t){s=Object.freeze({...s,...t})}
