import{_ as M}from"./src-2eX6lIN8-VI_Nykma.js";import{Q as z,k as O,l as B,m as L,o as J,p as W}from"./src-CURfSkGx-Bgs9tt00.js";import{d as D,e as R,o as G,h as N,a as _,t as V,b as k,f as q,i as K,m as j,j as X}from"./src-DUdYWbDU-DVRE-5Mg.js";import{r as x}from"./src-CtUbQWIP-Vt_fnXRn.js";import{t as Q,f as P,a as I,b as Y,c as Z}from"./src-3nHXiifJ-B3Cja0hK.js";const $=(t,e)=>{if(t===null)throw new Error("Param 'elem' is null. Expected element to observe");if(t===void 0)throw new Error("Param 'elem' is undefined. Expected element to observe");const n=q(i=>{const s=new ResizeObserver(f=>{i.set(f)});return s.observe(t),()=>{s.unobserve(t)}});return D({elapsed:e??100})(n)},ee=t=>D({elapsed:t??100})(R(window,"resize",{innerWidth:0,innerHeight:0})),te=(t=document.documentElement)=>q(n=>{const i=new MutationObserver(f=>{n.set(f)}),s={attributeFilter:["class"],attributes:!0};return i.observe(t,s),()=>{i.disconnect()}});function ne(t){let e=t;const n=K(),i=s=>{e=s,n.set(s)};return{dispose:n.dispose,isDisposed:n.isDisposed,last:()=>e,on:n.on,onValue:n.onValue,set:i,setHsl:s=>{i(s)}}}function oe(t,e={}){const n=T(t,e),i=n.el,s=e.relative??!1,f=e.inverted??!1,o=V(n,m=>Number.parseFloat(m));return s&&(i.max=f?"0":"1",i.min=f?"1":"0",i.hasAttribute("step")||(i.step="0.1")),i.getAttribute("type")===null&&(i.type="range"),{...o,last(){return Number.parseFloat(n.last())},set:m=>{n.set(m.toString())}}}function re(t,e={}){const n=T(t,{...e,upstreamFilter:s=>typeof s=="object"?I(s):s});return{...V(n,s=>P(s,{scalar:!0,ensureSafe:!0})),last(){return P(n.last(),{scalar:!0,ensureSafe:!0})},set(s){n.set(Q(s))}}}function T(t,e={}){const n=typeof t=="string"?document.querySelector(t):t;if(n===null&&typeof t=="string")throw new Error(`Element query could not be resolved '${t}'`);if(n===null)throw new Error("targetOrQuery is null");const i=x(t),f=(e.when??"changed")==="changed"?"change":"input",o=e.emitInitialValue??!1,p=e.fallbackValue??"",m=e.upstreamSource;let y=()=>{},v=e.attributeName,a=e.fieldName;a===void 0&&v===void 0&&(v=a="value");const d=()=>{let r;return v&&(r=i.getAttribute(v)),a&&(r=i[a]),r==null&&(r=p),r},u=r=>{v&&i.setAttribute(v,r),a&&(i[a]=r)},g=r=>{r=e.upstreamFilter?e.upstreamFilter(r):r,u(r)};m&&(y=m.onValue(g),N(m)&&g(m.last()));const c=k(i,f,{fireInitial:o,debugFiring:e.debugFiring??!1,debugLifecycle:e.debugLifecycle??!1}),l=V(c,r=>d());return{...l,el:i,last(){return d()},set(r){u(r)},dispose(r){y(),l.dispose(r),c.dispose(r)}}}function se(t,e={}){const n=x(t),s=(e.when??"changed")==="changed"?"change":"input",f=e.emitInitialValue??!1,o=e.upstreamSource,p=new Map;let m=()=>{};const y=()=>{const c=new FormData(n),l=[];for(const[b,F]of c.entries()){const E=F.toString();let h=p.get(b);if(!h){const w=v(b,E);w&&(w.type==="range"||w.type==="number"?h="number":w.type==="color"?h="colour":w.type==="checkbox"&&(F==="true"||F==="on")?h="boolean":h="string",p.set(b,h))}if(h==="number")l.push([b,Number.parseFloat(E)]);else if(h==="boolean"){const w=E==="true";l.push([b,w])}else if(h==="colour"){const w=I(E);l.push([b,Z(w,{scalar:!1})])}else l.push([b,F.toString()])}for(const b of n.querySelectorAll('input[type="checkbox"]'))!b.checked&&b.value==="true"&&l.push([b.name,!1]);return Object.fromEntries(l)},v=(c,l)=>{const r=n.querySelector(`[name="${c}"]`);if(!r){console.warn(`Form does not contain an element with name="${c}"`);return}if(r.type==="radio"){const b=n.querySelector(`[name="${c}"][value="${l}"]`);if(!b){console.warn(`Form does not contain radio option for name=${c} value=${l}`);return}return b}return r},a=(c,l)=>{const r=v(c,l);if(r&&(r.nodeName==="INPUT"||r.nodeName==="SELECT")){if(r.type==="color")typeof l=="object"&&(l=I(l));else if(r.type==="checkbox")if(typeof l=="boolean"){r.checked=l;return}else console.warn(`Rx.Sources.domForm: Trying to set non boolean type to a checkbox. Name: ${c} Value: ${l} (${typeof l})`);else if(r.type==="radio"){r.checked=!0;return}r.value=l}},d=c=>{for(const[l,r]of Object.entries(c)){let b=p.get(l);b||(b=typeof r,b==="object"&&(Y(r),b="colour"),p.set(l,b));const F=e.upstreamFilter?e.upstreamFilter(l,r):r;a(l,F)}};o&&(m=o.onValue(d),N(o)&&d(o.last()));const u=k(n,s,{fireInitial:f,debugFiring:e.debugFiring??!1,debugLifecycle:e.debugLifecycle??!1}),g=V(u,c=>y());return{...g,el:n,last(){return y()},set:d,setNamedValue:a,dispose(c){m(),g.dispose(c),u.dispose(c)}}}function ie(t){const e=[...document.querySelectorAll(t)];return G(e)}const le=(t,e,n={})=>S(t,e,{...n,elField:"textContent"}),ae=(t,e,n={})=>S(t,e,{...n,elField:"value",attribName:"value"}),ce=(t,e,n={})=>S(t,e,{...n,elField:"innerHTML"}),S=(t,e,...n)=>{if(e===null)throw new Error("Param 'elOrQuery' is null");if(e===void 0)throw new Error("Param 'elOrQuery' is undefined");const i=x(e);let s=[];n.length===0?s.push({elField:"textContent"}):s=[...n];const f=s.map(o=>"element"in o?o:{...o,element:i});return U(t,...f)},ue=(t,e)=>{const n=A(t);return i=>{n(i,e)}},A=t=>{if(t.elField!==void 0||t.cssVariable===void 0&&t.attribName===void 0&&t.cssProperty===void 0&&t.textContent===void 0&&t.htmlContent===void 0){const e=t.elField??"textContent";return(n,i)=>{i[e]=n}}if(t.attribName!==void 0){const e=t.attribName;return(n,i)=>{i.setAttribute(e,n)}}if(t.textContent)return(e,n)=>{n.textContent=e};if(t.htmlContent)return(e,n)=>{n.innerHTML=e};if(t.cssVariable!==void 0){let e=t.cssVariable;return e.startsWith("--")||(e="--"+e),(n,i)=>{i.style.setProperty(e,n)}}return t.cssProperty!==void 0?(e,n)=>{n.style[t.cssProperty]=e}:(e,n)=>{}},H=t=>{if(!(!t.transform&&!t.transformValue)){if(t.transformValue){if(t.sourceField===void 0)throw new Error("Expects 'sourceField' to be set when 'transformValue' is set");return e=>{const n=e[t.sourceField];return t.transformValue(n)}}else if(t.transform){if(t.sourceField!==void 0)throw new Error("If 'transform' is set, 'sourceField' is ignored");return e=>t.transform(e)}}},U=(t,...e)=>{const n=e.map(o=>{if(o.element&&o.element!==void 0)return o;if(o.query)return{...o,element:x(o.query)};throw new Error(`Unable to resolve element. Missing 'element' or 'query' values on bind. ${JSON.stringify(o)}`)}),i=n.map(o=>({update:ue(o,o.element),transformer:H(o),sourceField:o.sourceField})),s=o=>{for(const p of i)if(p.transformer)p.update(p.transformer(o));else{const m=p.sourceField?o[p.sourceField]:o;typeof m=="object"?(p.sourceField,p.update(JSON.stringify(m))):p.update(m)}},f=t.on(o=>{j(o)?s(o.value):X(o)&&console.warn(o)});return N(t)&&s(t.last()),{remove:o=>{if(f(),o)for(const p of n)p.element.remove()}}},fe=(t,e,n)=>{const i=x(e),s=o=>{n(o,i)},f=t.on(o=>{j(o)?(console.log(o),s(o.value)):console.warn(o)});return N(t)&&s(t.last()),{remove:o=>{f(),o&&i.remove()}}},de=(t,e,n,i={})=>{if(e===null)throw new Error("Param 'elOrQuery' is null");if(e===void 0)throw new Error("Param 'elOrQuery' is undefined");const s=x(e),f=m=>{n(m,s)},o=t.onDiff(m=>{f(m)}),p=()=>{N(t)&&i.initial&&i.initial(t.last(),s)};return p(),{refresh:()=>{p()},remove:m=>{o(),m&&s.remove()}}},me=(t,e)=>{const n=e.container?x(e.container):document.body,i=e.defaultTag??"div",s=new Map,f=new Map;for(const[a,d]of Object.entries(e.binds??{})){const u=d.tagName??i;f.set(a,{...d,update:A(d),transform:H(d),tagName:u,path:a})}const o=a=>{const d=L(f,J(a));if(d!==void 0)return d;if(!a.includes("."))return f.get("_root")};function*p(a){for(const d of W(a))f.has(d)&&(yield f.get(d));f.has("_root")&&a.includes(".")&&(yield f.get("_root"))}const m=(a,d)=>{const u=C(a);console.log(`Rx.Dom.elements.create: ${a} rooted: ${u} value: ${JSON.stringify(d)}`);const g=o(C(a));let c=i;g?.tagName&&(c=g.tagName);const l=document.createElement(c);l.setAttribute("data-path",a),y(a,l,d);let r;for(const b of p(u))if(b?.nestChildren){const F=O(a,"."),E=b.path.replace("_root",F);if(r=s.get(E),r!==void 0)break}(r??n).append(l),s.set(a,l),console.log(`Added el: ${a}`)},y=(a,d,u)=>{console.log(`Rx.dom.update path: ${a} value:`,u);const g=o(C(a));g===void 0?(typeof u=="object"&&(u=JSON.stringify(u)),d.textContent=u):(g.transform&&(u=g.transform(u)),g.update(u,d))},v=a=>{const d=new z({},a);let u=d.dequeue();const g=new Set;for(;u!==void 0;){const c=u.path;if(!("previous"in u)||u.previous===void 0){console.log(`Rx.Dom.elements.changes no previous. path: ${c}`),m(c,u.value);const l=[..._(u.value,!1,Number.MAX_SAFE_INTEGER,c)];console.log(l);for(const r of l)g.has(r.path)||(d.enqueue(r),g.add(r.path))}else if(u.value===void 0){const l=s.get(c);l===void 0?console.warn(`No element to delete? ${c} `):(console.log(`Rx.Dom.elements.changes delete ${c}`),l.remove())}else{const l=s.get(c);l===void 0?(console.warn(`Rx.Dom.elements.changes No element to update ? ${c} `),m(c,u.value)):y(c,l,u.value)}u=d.dequeue()}};if(t.onDiff(a=>{v(a)}),N(t)){const a=t.last();v([..._(a,!1,1)])}},C=t=>{const e=B(t,".");return e===t?"_root":"_root."+e};function pe(){const t=()=>({width:window.innerWidth,height:window.innerHeight}),e=R(window,"resize",{lazy:"very",transform:()=>t()}),n=R(window,"pointermove",{lazy:"very",transform:s=>{if(s===void 0)return{x:0,y:0};const f=s;return{x:f.x,y:f.y}}});return{dispose:(s="Reactive.win.dispose")=>{e.dispose(s),n.dispose(s)},size:e,pointer:n}}var be={};M(be,{bind:()=>U,bindDiffUpdate:()=>de,bindElement:()=>S,bindHtml:()=>ce,bindText:()=>le,bindUpdate:()=>fe,bindValueText:()=>ae,browserResizeObservable:()=>$,colour:()=>ne,cssClassChange:()=>te,domForm:()=>se,domHslInputValue:()=>re,domInputValue:()=>T,domNumberInputValue:()=>oe,elements:()=>me,fromDomQuery:()=>ie,win:()=>pe,windowResize:()=>ee});export{be as r};
