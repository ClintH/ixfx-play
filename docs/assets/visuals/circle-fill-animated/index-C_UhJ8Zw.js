import"../../modulepreload-polyfill-B5Qt9EMX.js";import{a as repeatSync}from"../../repeat-VL_PzXI7.js";import{t as timeout,E as Empty}from"../../timeout-BR7pLkQL.js";import{r as resultThrow}from"../../result-aflA1LW7.js";import{n as numberTest}from"../../numbers-SvRH5ijj.js";import{a as toCssColour}from"../../conversion-CGf7QoDW.js";import{C as CanvasHelper}from"../../canvas-helper-7wztVhc3.js";import{a as isPoint,g as guard}from"../../guard-RzpFIjKH.js";import{i as interpolate$1}from"../../interpolate-CjV-b_hr.js";import"../../interval-type-CIaujdcR.js";import"../../sleep-DwDBk_RX.js";import"../../math-DVpWUKCU.js";import"../../resolve-el-BUhvOf7L.js";import"../../StackFns-BOj2Sa9A.js";import"../../guard-DHhxSbUy.js";import"../../guard-BPeP3-pA.js";import"../../clamp-ClLuI7HB.js";import"../../guard-DRLb5kU_.js";import"../../arrays-Dsf3vC8Q.js";import"../../indexing-Xa_Aovu7.js";import"../../simple-event-emitter-BaCTAiR9.js";import"../../placeholder-DHFnYwCJ.js";import"../../element-sizing-Bsx-rrC3.js";import"../../length-BrmuG0lR.js";const calculateNonZero=(e=Math.random)=>{let t=0;for(;t===0;)t=e();return t},gaussian=(e=1)=>gaussianSource(e)(),gaussianSource=(e=1)=>{const r=()=>{const o=calculateNonZero(),s=calculateNonZero();let i=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*s);return i=i/10+.5,i>1||i<0?i=r():(i=Math.pow(i,e),i*=1,i+=0),i};return r},weightedSource=e=>{const t=e.source??Math.random;if(typeof e.easing<"u")throw new Error("Param 'easingName' unavailable. Use @ixfx/modulation.weighted instead.");if(typeof e.easingFunction>"u")throw new Error("Param 'easingFunction' is undefined");return()=>e.easingFunction(t())},interpolate=(e,t,n,r=!1)=>interpolate$1(e,t,n,r),debounce=(e,t)=>{const n=timeout(e,t);return(...r)=>{n.start(void 0,r)}},isPolarCoord=e=>!(e.distance===void 0||e.angleRadian===void 0),toCartesian=(e,t,n)=>{if(isPolarCoord(e)){if(typeof t>"u"&&(t=Empty),isPoint(t))return polarToCartesian(e.distance,e.angleRadian,t);throw new Error("Expecting (Coord, Point). Second parameter is not a point")}else{if(typeof e=="object")throw new TypeError(`First param is an object, but not a Coord: ${JSON.stringify(e)}`);if(typeof e=="number"&&typeof t=="number"){if(n===void 0&&(n=Empty),!isPoint(n))throw new Error("Expecting (number, number, Point). Point param wrong type");return polarToCartesian(e,t,n)}else throw new TypeError(`Expecting parameters of (number, number). Got: (${typeof e}, ${typeof t}, ${typeof n}). a: ${JSON.stringify(e)}`)}},polarToCartesian=(e,t,n=Empty)=>(guard(n),Object.freeze({x:n.x+e*Math.cos(t),y:n.y+e*Math.sin(t)})),pingPongPercent=function(e=.1,t,n,r,o){return typeof t>"u"&&(t=0),typeof n>"u"&&(n=1),typeof r>"u"&&(r=t),resultThrow(numberTest(e,"bipolar","interval"),numberTest(n,"bipolar","end"),numberTest(r,"bipolar","offset"),numberTest(t,"bipolar","start")),pingPong(e,t,n,r,o)},pingPong=function*(e,t,n,r,o){if(t===void 0)throw new Error("Parameter 'lower' is undefined");if(e===void 0)throw new Error("Parameter 'interval' is undefined");if(n===void 0)throw new Error("Parameter 'upper' is undefined");if(o===void 0&&e<=1&&e>=0?o=10/e:typeof o>"u"&&(o=1234),Number.isNaN(e))throw new Error("interval parameter is NaN");if(Number.isNaN(t))throw new Error("lower parameter is NaN");if(Number.isNaN(n))throw new Error("upper parameter is NaN");if(Number.isNaN(r))throw new Error("upper parameter is NaN");if(t>=n)throw new Error("lower must be less than upper");if(e===0)throw new Error("Interval cannot be zero");const s=n-t;if(Math.abs(e)>=s)throw new Error(`Interval should be between -${s} and ${s}`);let i=e>0;if(n=Math.floor(n*o),t=Math.floor(t*o),e=Math.floor(Math.abs(e*o)),e===0)throw new Error(`Interval is zero (rounding: ${o})`);if(r=r===void 0?t:Math.floor(r*o),r>n||r<t)throw new Error(`Start (${r/o}) must be within lower (${t/o}) and upper (${n/o})`);let a=r;yield a/o;let u=!0;for(;;)a=a+(i?e:-e),i&&a>=n?(i=!1,a=n,a===n&&u&&(a=t,i=!0)):!i&&a<=t&&(i=!0,a=t,a===t&&u&&(a=n,i=!1)),yield a/o,u=!1},settings=Object.freeze({canvas:new CanvasHelper("#canvas",{resizeLogic:"min",onResized(e,t,n){onCodeUpdated()}}),piPi:Math.PI*2,pointSize:.005,pointColour:toCssColour("--point-fill"),radius:.5,origin:{x:.5,y:.5},pingPong:pingPongPercent(.001)});let state={randomSource:Math.random,numberOfPoints:500,startPoints:[],endPoints:[],startExpression:"r()",endExpression:"1 - r()",animationPoint:0};const evaluateExpression=(txt,contextLabel)=>{try{window.r=state.randomSource;let result=eval(txt);return clearError(),result}catch(e){handleError(e,contextLabel)}},onCodeUpdated=()=>{const{canvas:e,radius:t,piPi:n,origin:r}=settings,{numberOfPoints:o}=state,s=()=>evaluateExpression(state.startExpression,"start expression"),i=()=>evaluateExpression(state.endExpression,"end expression"),a=[...repeatSync(s,{count:o})];if(a.length<o)return;let u=[...repeatSync(i,{count:o})];u.length<o&&(u=[...a]);const d=[...repeatSync(()=>Math.random()*n,{count:o})],f=e.toAbsolute(r),c=(l,h)=>toCartesian(l*t*e.dimensionMin,d[h],f),m=a.map(c),p=u.map(c);updateState({startPoints:m,endPoints:p}),drawState()},computeState=()=>{const{pingPong:e}=settings,t=e.next().value;updateState({animationPoint:t})},drawState=()=>{const{canvas:e,pointColour:t,pointSize:n}=settings,{animationPoint:r,startPoints:o,endPoints:s,numberOfPoints:i}=state,{ctx:a,width:u,height:d}=e;if(o.length===0||o.length===0)return;a.clearRect(0,0,u,d);const f=n*e.dimensionMin;for(let c=0;c<i;c++){const m=interpolate(r,o[c],s[c],!0);drawPoint(a,m,t,f)}},setup=()=>{const e=()=>{computeState(),drawState(),window.requestAnimationFrame(e)};e();const t=document.querySelector("#numberParticles");t?.addEventListener("change",()=>{updateState({numberOfPoints:Number.parseInt(t.value)})}),inputChangeDebounce("startExpr",r=>{updateState({startExpression:r})}),inputChangeDebounce("endExpr",r=>{updateState({endExpression:r})});const n=document.querySelector("#source");n?.addEventListener("change",()=>{const r=n.value;if(r==="Gaussian")updateState({randomSource:gaussian});else if(r.startsWith("Weighted (")){const o=r.slice(10,-1);updateState({randomSource:weightedSource(o)})}else updateState({randomSource:Math.random})}),onCodeUpdated()};setup();function updateState(e){state=Object.freeze({...state,...e}),("numberOfPoints"in e||"randomSource"in e||"startExpression"in e||"endExpression"in e)&&onCodeUpdated()}function drawPoint(e,t,n="black",r=1){e.fillStyle=n,e.beginPath(),e.arc(t.x,t.y,r,0,settings.piPi),e.fill()}function inputChangeDebounce(e,t){const n=document.querySelector(`#${e}`);if(!n)throw new Error(`${e} not found`);const r=debounce(o=>{t(n.value)},500);n?.addEventListener("input",o=>{r(o)})}function handleError(e,t){const n=document.querySelector("#error");n&&(n.classList.remove("hidden"),n.innerHTML=`<h1>Error with ${t}</h1><p>${e}</p>`)}function clearError(){const e=document.querySelector("#error");e&&(e.classList.contains("hidden")||(e.innerHTML="",e.classList.add("hidden")))}
